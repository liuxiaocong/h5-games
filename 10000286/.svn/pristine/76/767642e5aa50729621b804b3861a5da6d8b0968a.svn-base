/* TreSensa Game Engine, TGE-SDK, Version 1.0.21 */
/* Copyright (c) 2013 TreSensa, Inc. All Rights Reserved. */
function extend(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype,a.prototype=new d,a.prototype.constructor=a,a.superclass=b.prototype,b.prototype.constructor===Object.prototype.constructor&&(b.prototype.constructor=b);for(var e in c)c.hasOwnProperty(e)&&(a.prototype[e]=c[e])}function getElementPosition(a){var b=a,c="",d=0,e=0;if(null==b)return null;for(;"object"==typeof b&&"undefined"!=typeof b.tagName;)if(e+=b.offsetTop,d+=b.offsetLeft,c=b.tagName.toUpperCase(),"BODY"==c&&(b=0),"object"==typeof b&&"object"==typeof b.offsetParent&&(b=b.offsetParent),null==b)return null;return{x:d,y:e}}function getQueryString(){for(var a,b={},c=location.search.substring(1),d=/([^&=]+)=([^&]*)/g;a=d.exec(c);)b[decodeURIComponent(a[1])]=decodeURIComponent(a[2]);return b}function getDistributionPartner(){var a=getQueryString().dst;return"string"==typeof a?a:null}function loadScript(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript",d.src=a,d.onreadystatechange=b,d.onload=b,c.appendChild(d)}var TGE=TGE||{};if(TGE.log=function(){},TGE.debugLog=function(){},TGE.Debug=TGE.Debug||{},TGE.Debug.LOG_NONE=0,TGE.Debug.LOG_ERROR=1,TGE.Debug.LOG_WARNING=2,TGE.Debug.LOG_INFO=3,TGE.Debug.LOG_VERBOSE=4,TGE.Debug.LogLevel="undefined"!=typeof GameConfig&&"number"==typeof GameConfig.LOG_LEVEL?GameConfig.LOG_LEVEL:TGE.Debug.LOG_INFO,TGE.Debug.Log=function(a){if(window.console&&a<=TGE.Debug.LogLevel){var b="TGE: ",c="log";a===TGE.Debug.LOG_ERROR?(b+="**ERROR** ",c="error"):a===TGE.Debug.LOG_WARNING&&(b+="**WARNING** ",c="warn"),window.console[c](b+Array.prototype.slice.call(arguments,1))}},Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),trimmedFilename=function(a){var b=a.lastIndexOf("/")+1;return a.substr(b,a.lastIndexOf(".")-b)},TGE.BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"an unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.platform=this.searchString(this.dataPlatform)||"an unknown OS or Device",this.OSversion=this.detectOSversion(this.platform),this.onFirefoxMobile=/Firefox/i.test(navigator.userAgent)&&(/Android/i.test(navigator.userAgent)||/Mobile/i.test(navigator.userAgent)),this.oniOS="iPhone"===this.platform||"iPad"===this.platform,this.onAndroid="Android"===this.platform,this.onWindowsMobile="Windows Phone"===this.platform||"Windows Tablet"===this.platform,this.isMobileDevice=!("Windows"===this.platform||"Mac"===this.platform||"Linux"===this.platform),this.usingPhoneGap=window.PhoneGap||window.cordova||window.Cordova},detectOSversion:function(a){var b="-1",c="",d=navigator.userAgent.toString();switch(a){case"Windows Phone":c=/Windows Phone OS\s+[\d\.]+/,b=String(d.match(c)).substring(17,20);break;case"iPhone":case"iPad":c=/OS\s+[\d\_]+/,b=String(d.match(c)).substring(3,6);break;case"Windows":c=/Windows NT\s+[\d\.]+/;var e=String(d.match(c)).substring(11,14);"6.1"==e?b="7":"5.1"==e?b="XP":"5.2"==e?b="XP":"6.0"==e?b="Vista":"5.01"==e?b="2000 SP1":"5.0"==e&&(b="2000");break;case"Mac":c=/Mac OS X\s+[\d\_]+/,b=String(d.match(c)).substring(9,13);break;case"Android":c=/ndroid\s+[\d\.]+/,b=String(d.match(c)).substring(7,10)}return b},searchString:function(a){for(var b=0;b<a.length;b++)if(null!=a[b]){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!==c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(-1!==b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{prop:window.opera,identity:"Opera"},{string:navigator.userAgent,subString:"Silk",identity:"Silk",versionSearch:"Silk"},{string:navigator.userAgent,subString:"Kindle Fire",identity:"Amazon Web App",versionSearch:"AppleWebKit"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.vendor,subString:"BlackBerry",identity:"BlackBerry"}],dataPlatform:[{string:navigator.userAgent,subString:"Windows Phone",identity:"Windows Phone"},{string:navigator.userAgent,subString:"Tablet PC",identity:"Windows Tablet"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"iPod",identity:"iPod"},{string:navigator.userAgent,subString:"Silk",identity:"Kindle Fire"},{string:navigator.userAgent,subString:"Kindle Fire",identity:"Kindle Fire"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"webOS",identity:"webOS"},{string:navigator.userAgent,subString:"Mobile",identity:"Mobile"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]},TGE.BrowserDetect.init(),!navigator.isCocoonJS){var _vp=document.querySelector("meta[name=viewport]");_vp&&_vp.setAttribute("content"," initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui")}TGE.Matrix=function(a,b,c,d,e,f){a="undefined"!=typeof a?a:1,b="undefined"!=typeof b?b:0,c="undefined"!=typeof c?c:0,d="undefined"!=typeof d?d:1,e="undefined"!=typeof e?e:0,f="undefined"!=typeof f?f:0,this._internal=[a,c,e,b,d,f]},TGE.Matrix.RotationMatrix=function(a){var b=new TGE.Matrix;return b._internal[0]=Math.cos(a),b._internal[1]=-Math.sin(a),b._internal[3]=Math.sin(a),b._internal[4]=Math.cos(a),b},TGE.Matrix.ScaleMatrix=function(a,b){return(new TGE.Matrix).scale(a,b)},TGE.Matrix.TranslationMatrix=function(a,b){return(new TGE.Matrix).translate(a,b)},TGE.Matrix.prototype={_internal:null,identity:function(){var a=this._internal;return a[1]=a[2]=a[3]=a[5]=0,a[0]=a[4]=1,this},copyFrom:function(a){var b=this._internal,c=a._internal;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],this},concat:function(a){var b=this._internal,c=a._internal,d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return b[0]=d*j+e*m,b[1]=d*k+e*n,b[2]=d*l+e*o+f,b[3]=g*j+h*m,b[4]=g*k+h*n,b[5]=g*l+h*o+i,this},rotate:function(a){return this.concat(TGE.Matrix.RotationMatrix(a*TGE.DEG2RAD))},scale:function(a,b){var c=this._internal;return c[0]*=a,c[1]*=b,c[3]*=a,c[4]*=b,this},translate:function(a,b){return this._internal[2]+=a,this._internal[5]+=b,this},transformPoint:function(a){var b=a.x,c=a.y;return a.x=b*this._internal[0]+c*this._internal[1]+this._internal[2],a.y=b*this._internal[3]+c*this._internal[4]+this._internal[5],a}},TGE.Point=function(a,b){return a="undefined"!=typeof a?a:0,b="undefined"!=typeof b?b:0,this.x=a,this.y=b,this},TGE.Point.prototype={setTo:function(a,b){this.x=a,this.y=b},copyFrom:function(a){return this.x=a.x,this.y=a.y,this},add:function(a){return new this.constructor(this.x+a.x,this.y+a.y)},subtract:function(a){return new this.constructor(this.x-a.x,this.y-a.y)},offset:function(a,b){return this.x+=a,this.y+=b,this},rotate:function(a){var b=a*TGE.DEG2RAD;return new this.constructor(this.x*Math.cos(b)-this.y*Math.sin(b),this.y*Math.cos(b)+this.x*Math.sin(b))},rotateThis:function(a){var b=a*TGE.DEG2RAD,c=this.x*Math.cos(b)-this.y*Math.sin(b),d=this.y*Math.cos(b)+this.x*Math.sin(b);return this.setTo(c,d),this}},TGE.Vector2D=function(a,b){TGE.Vector2D.superclass.constructor.call(this,a,b)},TGE.Vector2D.prototype={magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},dotProduct:function(a){return this.x*a.x+this.y*a.y},crossProduct:function(a){return this.x*a.y-this.y*a.x},angleBetween:function(a){var b=this.magnitude()*a.magnitude();return 0===b?0:Math.acos(this.dotProduct(a)/b)*TGE.RAD2DEG}},extend(TGE.Vector2D,TGE.Point),TGE.Rectangle=function(a,b,c,d){a="undefined"!=typeof a?a:0,b="undefined"!=typeof b?b:0,c="undefined"!=typeof c?c:0,d="undefined"!=typeof d?d:0,this.x=a,this.y=b,this.width=c,this.height=d},TGE.Rectangle.prototype={intersects:function(a,b,c){b="undefined"==typeof b?1:b,c="undefined"==typeof c?1:c;var d=this.width*(1-b)/2,e=this.height*(1-b)/2,f=this.x+d,g=this.y+e,h=this.x+this.width-d,i=this.y+this.height-e;d=a.width*(1-c)/2,e=a.height*(1-c)/2;var j=a.x+d,k=a.y+e,l=a.x+a.width-d,m=a.y+a.height-e;return j>=f&&h>=l&&k>=g&&i>=m?!0:j>h||f>l||k>i||g>m?!1:!0},union:function(a){var b=this.x+this.width,c=this.y+this.height,d=a.x+a.width,e=a.y+a.height;this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y);var f=Math.max(b,d),g=Math.max(c,e);this.width=f-this.x,this.height=g-this.y}},TGE.PI=3.1415926535,TGE.TWO_PI=6.2831853072,TGE.RAD2DEG=57.2957795,TGE.DEG2RAD=.0174532925,TGE.POSITIVE_X_VECTOR=new TGE.Vector2D(1,0),TGE.NEGATIVE_X_VECTOR=new TGE.Vector2D(-1,0),TGE.POSITIVE_Y_VECTOR=new TGE.Vector2D(0,1),TGE.NEGATIVE_Y_VECTOR=new TGE.Vector2D(0,-1),TGE.DisplayObject=function(){return this.x=0,this.y=0,this.worldX=0,this.worldY=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.alpha=1,this.backgroundColor=null,this.visible=!0,this.width=0,this.height=0,this.registrationX=TGE.DisplayObject.DefaultRegistrationX,this.registrationY=TGE.DisplayObject.DefaultRegistrationY,this.parent=null,this.stage=TGE.Game.GetInstance()?TGE.Game.GetInstance().stage:null,this.mouseEnabled=!1,this.mouseX=0,this.mouseY=0,this.cameraShakeTag="DEFAULT",this.instanceName="",this._mPreviousX=0,this._mPreviousY=0,this._mPreviousScaleX=1,this._mPreviousScaleY=1,this._mPreviousRotation=0,this._mPreviousRegistrationX=0,this._mPreviousRegistrationY=0,this._mPreviousWidth=0,this._mPreviousHeight=0,this._mPreviousVisibility=!1,this._mPreviousAlpha=1,this._mRegistrationOffset=new TGE.Point(0,0),this._mLocalTransformNoReg=new TGE.Matrix,this._mLocalTransformDirty=!0,this._mWorldTransform=new TGE.Matrix,this._mWorldTransformNoReg=new TGE.Matrix,this._mWorldTransformDirty=!0,this._mTopLeft=new TGE.Point,this._mTopRight=new TGE.Point,this._mBottomLeft=new TGE.Point,this._mBottomRight=new TGE.Point,this._mAABB=new TGE.Rectangle,this._mBoundingInfoDirty=!0,this._mWorldAlpha=1,this._mIgnoreProperties=!1,this._mMouseOver=null,this._mVisibilityChanged=!1,this._mMarkedForRemoval=!1,this._mEventListeners={},this._mUseDrawEvents=!1,this._mLastUpdate=-1,this._mViewportCulling=null,this._mWorldPositionListener=-1,this._mTweens=[],this._mTweenListener=null,this._mShakes=[],this._mShakeListener=null,this},TGE.DisplayObject.DefaultRegistrationX=.5,TGE.DisplayObject.DefaultRegistrationY=.5,TGE.DisplayObject._sNextEventListenerID=0,TGE.DisplayObject.prototype={setup:function(a){return"string"==typeof a.instanceName?this.instanceName=a.instanceName:null,"boolean"==typeof a.visible?this.visible=a.visible:null,"number"==typeof a.x?this.x=a.x:null,"number"==typeof a.y?this.y=a.y:null,"number"==typeof a.worldX?this.worldX=a.worldX:null,"number"==typeof a.worldY?this.worldY=a.worldY:null,"number"==typeof a.width?this.width=a.width:null,"number"==typeof a.height?this.height=a.height:null,"number"==typeof a.scaleX?this.scaleX=a.scaleX:null,"number"==typeof a.scaleY?this.scaleY=a.scaleY:null,"number"==typeof a.scale?this.scaleX=this.scaleY=a.scale:null,"number"==typeof a.rotation?this.rotation=a.rotation:null,"string"==typeof a.backgroundColor?this.backgroundColor=a.backgroundColor:null,"number"==typeof a.alpha?this.alpha=a.alpha:null,"number"==typeof a.registrationX?this.registrationX=a.registrationX:null,"number"==typeof a.registrationY?this.registrationY=a.registrationY:null,"string"==typeof a.cameraShakeTag?this.cameraShakeTag=a.cameraShakeTag:"DEFAULT","undefined"!=typeof a.parent?a.parent.addChild(this):null,this},setLocalTransform:function(a,b,c,d,e,f){var g=this._mLocalTransformNoReg._internal;g[0]=a,g[1]=c,g[2]=e,g[3]=b,g[4]=d,g[5]=f,this._mIgnoreProperties=!0,this._mLocalTransformDirty=!0},useDisplayProperties:function(){this._mIgnoreProperties=!1,this._mLocalTransformDirty=!0},getBounds:function(){return this._checkVisibilityChange(),this._mBoundingInfoDirty&&this._updateAABB(),this._mAABB},hitTestPoint:function(a,b){var c=this.getBounds();return a>c.x&&a<c.x+c.width&&b>c.y&&b<c.y+c.height},markForRemoval:function(){this._mMarkedForRemoval=!0,this.stage._trashObject(this)},markedForRemoval:function(){return this._mMarkedForRemoval},removeChildByName:function(a){var b;if("string"==typeof a)for(b=this._mChildren.length;--b>=0;){var c=this._mChildren[b];c.instanceName===a&&this.removeChild(c)}else for(b=a.length;--b>=0;)this.removeChildByName(a[b])},removeFromScene:function(){this.handleEvent({type:"remove"}),this.clearEventListeners(),null!==this.parent&&this.parent.removeChild(this),this._mMarkedForRemoval=!0},numChildren:function(){return 0},bringForward:function(){if(null!==this.parent){var a=this.parent.getChildIndex(this);if(a<this.parent._mChildren.length-1){var b=this.parent._mChildren[a+1];this.parent._mChildren[a+1]=this,this.parent._mChildren[a]=b}}},bringToFront:function(){if(null!==this.parent){var a=this.parent.getChildIndex(this);this.parent._mChildren.splice(a,1),this.parent._mChildren.push(this)}},sendBackward:function(){if(null!==this.parent){var a=this.parent.getChildIndex(this);if(a>0){var b=this.parent._mChildren[a-1];this.parent._mChildren[a-1]=this,this.parent._mChildren[a]=b}}},sendToBack:function(){if(null!==this.parent){var a=this.parent.getChildIndex(this);this.parent._mChildren.splice(a,1),this.parent._mChildren.unshift(this)}},isMouseOver:function(){return this._mMouseOver===!0},addEventListener:function(a,b){this._mEventListeners[a]||(this._mEventListeners[a]=[]);var c={id:TGE.DisplayObject._sNextEventListenerID++,listener:b};return this._mEventListeners[a].push(c),"mousedown"===a||"mouseup"===a||"mousemove"===a||"mouseover"===a||"mouseout"===a?this.mouseEnabled=!0:"drawbegin"===a||"drawend"===a?this._mUseDrawEvents=!0:"update"===a&&this.stage&&this.stage._addUpdateObj(this),c.id},removeEventListener:function(a,b){if(this._mEventListeners[a]){for(var c=this._mEventListeners[a].length,d=0;c>d;d++)if(this._mEventListeners[a][d].id===b||this._mEventListeners[a][d].listener===b)return void this._mEventListeners[a].splice(d,1);TGE.Debug.Log(TGE.Debug.LOG_ERROR,"removeEventListener could not find listener specified for "+a+" event")}},removeEventListenersFor:function(a){this._mEventListeners[a]&&(this._mEventListeners[a]=[])},clearEventListeners:function(){this._mEventListeners={}},dispatchEvent:function(a){"undefined"==typeof a.target&&(a.target=this),a.currentTarget=this,this.handleEvent(a)},handleEvent:function(a){var b=this._mEventListeners[a.type];if(b&&b.length){a.currentTarget=this;for(var c=b.length-1;b[c].listener.call(this,a),!(--c<0||!this._mEventListeners[a.type]||c>=this._mEventListeners[a.type].length););}},percentageOfWidth:function(a){return this.width*a},percentageOfHeight:function(a){return this.height*a},pixelsFromLeft:function(a){return a},pixelsFromRight:function(a){return this.width-a},pixelsFromTop:function(a){return a},pixelsFromBottom:function(a){return this.height-a},cullToViewport:function(a,b,c,d){null===this._mViewportCulling&&this.addEventListener("camerachange",this._checkViewportCulling.bind(this)),this._mViewportCulling=[a,b,c,d]},useWorldPosition:function(a){a&&-1===this._mWorldPositionListener?this._mWorldPositionListener=this.addEventListener("camerachange",this._updateScreenPosition.bind(this)):a||-1===this._mWorldPositionListener||(this.removeEventListener("camerachange",this._mWorldPositionListener),this._mWorldPositionListener=-1)},tweenTo:function(a){a.target=this;var b=(new TGE.Tween).setup(a);return this._mTweens.push(b),null===this._mTweenListener&&(this._mTweenListener=this.addEventListener("update",this._updateTweens.bind(this))),b},tweenFrom:function(a){return a.startFromEnd=!0,this.tweenTo(a)},clearTweens:function(){this._mTweens.length>0&&(this._mTweens=[],this.removeEventListener("update",this._mTweenListener),this._mTweenListener=null)},addCameraShake:function(a,b){if("function"==typeof a){b.target=this;var c=(new a).setup(b);return this._mShakes.push(c),null===this._mShakeListener&&(this._mShakeListener=this.addEventListener("update",this._updateShakes.bind(this))),c}},clearCameraShakes:function(){this._mShakes.length>0&&(this._mShakes=[],this.removeEventListener("update",this._mShakeListener),this._mShakeListener=null)},_lastTweenInChain:function(){return this._mTweens.length>0&&!this._mTweens[0].finished()?this._mTweens[0]._lastTweenInChain():null},_injectTween:function(a){this._mTweens.push(a)},_updateTweens:function(a){for(var b=this._mTweens.length-1;b>=0;b--){var c=this._mTweens[b];c._update(a.elapsedTime),c.finished()&&c===this._mTweens[b]&&this._mTweens.splice(b,1)}0===this._mTweens.length&&(this.removeEventListener("update",this._mTweenListener),this._mTweenListener=null)},_updateShakes:function(a){for(var b=this._mShakes.length-1;b>=0;b--){var c=this._mShakes[b];c._update(a.elapsedTime),c.finished()&&c===this._mShakes[b]&&this._mShakes.splice(b,1)}0===this._mShakes.length&&(this.removeEventListener("update",this._mShakeListener),this._mShakeListener=null)},_updateScreenPosition:function(a){var b=this.stage.width/2+(this.worldX-a.cx),c=this.stage.height/2-(this.worldY-a.cy);this.x=b,this.y=c},_checkViewportCulling:function(){if(null!==this._mViewportCulling){var a=this.getBounds(),b=!1;this._mViewportCulling[0]&&a.y+a.height<0&&(b=!0),this._mViewportCulling[1]&&a.x>this.stage.width&&(b=!0),this._mViewportCulling[2]&&a.y>this.stage.height&&(b=!0),this._mViewportCulling[3]&&a.x+a.width<0&&(b=!0),b&&this.markForRemoval()}},_draw:function(a){this._checkVisibilityChange(),this.visible&&(this._updateTransformations(),null!==this.stage&&this.mouseEnabled&&this.stage._mMouseTargets.push(this),this._applyCanvasXForm(this._mWorldTransform,a),a.globalAlpha=this._mWorldAlpha,null!==this.backgroundColor&&(a.fillStyle=this.backgroundColor,a.fillRect(0,0,this.width,this.height)),this._mUseDrawEvents?(this.handleEvent({type:"drawbegin",canvasContext:a}),this._drawClass(a),this.handleEvent({type:"drawend",canvasContext:a})):this._drawClass(a),this.stage._mNumDrawnObjects++)},_drawClass:function(){},_updateTransformations:function(){this._mWorldTransformDirty=!1;var a=this.x!==this._mPreviousX||this.y!==this._mPreviousY||this.scaleX!==this._mPreviousScaleX||this.scaleY!==this._mPreviousScaleY||this.rotation!==this._mPreviousRotation||this._mVisibilityChanged;if(a&&!this._mIgnoreProperties&&(this._mVisibilityChanged=!1,this._mPreviousX=this.x,this._mPreviousY=this.y,this._mPreviousScaleX=this.scaleX,this._mPreviousScaleY=this.scaleY,this._mPreviousRotation=this.rotation,this._mLocalTransformDirty=!0),(this.registrationX!==this._mPreviousRegistrationX||this.registrationY!==this._mPreviousRegistrationY||this.width!==this._mPreviousWidth||this.height!==this._mPreviousHeight)&&(this._mPreviousRegistrationX=this.registrationX,this._mPreviousRegistrationY=this.registrationY,this._mPreviousWidth=this.width,this._mPreviousHeight=this.height,this._mRegistrationOffset.x=-this.width*this.registrationX,this._mRegistrationOffset.y=-this.height*this.registrationY),this.alpha!==this._mPreviousAlpha&&(this.alpha=Math.min(Math.max(this.alpha,0),1),this._mPreviousAlpha=this.alpha),this._mLocalTransformDirty&&!this._mIgnoreProperties){this._mLocalTransformNoReg.identity();var b=this._mLocalTransformNoReg._internal;if(b[2]=this.x,b[5]=this.y,0!==this.rotation&&this._mLocalTransformNoReg.rotate(this.rotation),1!==this.scaleX||1!==this.scaleY){var c=TGE.BrowserDetect.onFirefoxMobile?Math.max(1e-4,this.scaleX):this.scaleX,d=TGE.BrowserDetect.onFirefoxMobile?Math.max(1e-4,this.scaleY):this.scaleY;b[0]*=c,b[1]*=d,b[3]*=c,b[4]*=d}}if(null!==this.parent){if(this._mLocalTransformDirty||this.parent._mWorldTransformDirty){var e=this.parent._mWorldTransformNoReg._internal,f=this._mLocalTransformNoReg._internal,g=this._mWorldTransform._internal,h=this._mWorldTransformNoReg._internal,i=e[0],j=e[1],k=e[2],l=e[3],m=e[4],n=e[5],o=f[0],p=f[1],q=f[2],r=f[3],s=f[4],t=f[5],u=o*this._mRegistrationOffset.x+p*this._mRegistrationOffset.y,v=r*this._mRegistrationOffset.x+s*this._mRegistrationOffset.y;g[0]=h[0]=i*o+j*r,g[1]=h[1]=i*p+j*s,h[2]=i*q+j*t+k,g[2]=h[2]+i*u+j*v,g[3]=h[3]=l*o+m*r,g[4]=h[4]=l*p+m*s,h[5]=l*q+m*t+n,g[5]=h[5]+l*u+m*v,this._mWorldTransformDirty=!0}}else this._mWorldTransformDirty=this._mLocalTransformDirty;this._mWorldTransformDirty&&this._setBoundingInfoDirty(),this._mWorldAlpha=null!==this.parent?this.parent._mWorldAlpha*this.alpha:this.alpha,this._mLocalTransformDirty=!1},_applyCanvasXForm:function(a,b){var c=a._internal;if(null!==this.stage&&1!==this.stage._mScale){var d=this.stage._mScale;b.setTransform(c[0]*d,c[3]*d,c[1]*d,c[4]*d,c[2]*d,c[5]*d)}else b.setTransform(c[0],c[3],c[1],c[4],c[2],c[5])},_updateAABB:function(){if(this._mWorldTransformDirty&&this._updateTransformations(),this._mTopLeft.x=this._mBottomLeft.x=0,this._mBottomRight.x=this._mTopRight.x=this.width,this._mTopLeft.y=this._mTopRight.y=0,this._mBottomLeft.y=this._mBottomRight.y=this.height,0!==this.rotation||this._mIgnoreProperties){this._mWorldTransform.transformPoint(this._mTopLeft),this._mWorldTransform.transformPoint(this._mTopRight),this._mWorldTransform.transformPoint(this._mBottomLeft),this._mWorldTransform.transformPoint(this._mBottomRight);var a=Math.min(this._mTopLeft.x,this._mTopRight.x,this._mBottomLeft.x,this._mBottomRight.x),b=Math.max(this._mTopLeft.x,this._mTopRight.x,this._mBottomLeft.x,this._mBottomRight.x),c=Math.min(this._mTopLeft.y,this._mTopRight.y,this._mBottomLeft.y,this._mBottomRight.y),d=Math.max(this._mTopLeft.y,this._mTopRight.y,this._mBottomLeft.y,this._mBottomRight.y)}else{this._mWorldTransform.transformPoint(this._mTopLeft),this._mWorldTransform.transformPoint(this._mBottomRight);var a=Math.min(this._mTopLeft.x,this._mBottomRight.x),b=Math.max(this._mTopLeft.x,this._mBottomRight.x),c=Math.min(this._mTopLeft.y,this._mBottomRight.y),d=Math.max(this._mTopLeft.y,this._mBottomRight.y)}this._mAABB.x=a,this._mAABB.y=c,this._mAABB.width=b-a,this._mAABB.height=d-c,this._mBoundingInfoDirty=!1},_setBoundingInfoDirty:function(){this._mBoundingInfoDirty=!0,null!==this.parent&&this.parent._setBoundingInfoDirty()},_checkVisibilityChange:function(){this.visible!==this._mPreviousVisibility&&(this._mVisibilityChanged=!0,this._mPreviousVisibility=this.visible,this._setBoundingInfoDirty())},_setStage:function(a){this.stage=a}},TGE.DisplayObjectContainer=function(){return TGE.DisplayObjectContainer.superclass.constructor.call(this),this._mChildren=[],this},TGE.DisplayObjectContainer.prototype={addChild:function(a){return this.addChildAt(a,this._mChildren.length)},addChildAt:function(a,b,c){if(0>b||b>this._mChildren.length){if(1!=c)return TGE.Debug.Log(TGE.Debug.LOG_ERROR,"TGE.DisplayObjectContainer.addChildAt called with invalid index: "+b),a;b=Math.min(this._mChildren.length,Math.max(0,b))}return null!==a.parent&&a.parent.removeChild(a),a.parent=this,this._mChildren.splice(b,0,a),a._setStage(this.stage),a},getChildAt:function(a){return this._mChildren[a]},getChildByName:function(a,b){b="undefined"==typeof b?!1:b;for(var c=this._mChildren.length,d=0;c>d;d++){if(this._mChildren[d].instanceName===a)return this._mChildren[d];if(b){var e=this._mChildren[d].getChildByName(a,!0);if(null!==e)return e}}return null},getChildIndex:function(a){for(var b=this._mChildren.length,c=0;b>c;c++)if(this._mChildren[c]===a)return c;return-1},removeChild:function(a){var b=this.getChildIndex(a);return-1!==b&&(this._mChildren[b].parent=null,this._mChildren.splice(b,1)),a},removeFromScene:function(){this.removeChildren(),TGE.DisplayObjectContainer.superclass.removeFromScene.call(this)},removeChildren:function(){for(var a=this._mChildren.length-1;a>=0;a--)this._mChildren[a].removeFromScene();this._mChildren=[]},clearChildren:function(){this.removeChildren()},numChildren:function(a){a="undefined"==typeof a?!1:a;var b=this._mChildren.length;if(a){for(var c=0,d=0;b>d;d++)c+=1+this._mChildren[d].numChildren(!0);return c}return b},dispatchEvent:function(a){TGE.DisplayObjectContainer.superclass.dispatchEvent.call(this,a);for(var b=this._mChildren.length,c=0;b>c;c++)this._mChildren[c]&&this._mChildren[c].dispatchEvent(a)},_drawClass:function(a){TGE.DisplayObjectContainer.superclass._drawClass.call(this,a);for(var b=this._mChildren.length,c=0;b>c;c++){var d=this._mChildren[c];d._checkVisibilityChange(),d.visible&&d._draw(a)}},_updateAABB:function(){TGE.DisplayObjectContainer.superclass._updateAABB.call(this);for(var a=this._mChildren.length,b=0;a>b;b++)this._mChildren[b].visible&&this._mAABB.union(this._mChildren[b].getBounds())},_setStage:function(a){TGE.DisplayObjectContainer.superclass._setStage.call(this,a);for(var b=this._mChildren.length-1;b>=0;b--)this._mChildren[b]._setStage(a)}},extend(TGE.DisplayObjectContainer,TGE.DisplayObject),TGE.Stage=function(a,b,c){TGE.Stage.superclass.constructor.call(this),this._mCanvasContext=null,this._mMouseTargets=[],this._mObjectTrash=[],this._mUpdateGroup=[],this._mUpdateCycle=0,this._mMouseDown=!1,this._mNumDrawnObjects=0,this.stage=this,this.mouseEnabled=!0;var d=!1;a&&(a instanceof HTMLDivElement?d=!1:a instanceof HTMLCanvasElement?d=!0:a=document.body);var e;return d?e=a:(e=document.createElement("canvas"),a.appendChild(e)),this.width=a.clientWidth,this.height=a.clientHeight,this.registrationX=0,this.registrationY=0,e.width=navigator.isCocoonJS?window.GameConfig?GameConfig.WIDTH:960:this.width,e.height=navigator.isCocoonJS?window.GameConfig?GameConfig.HEIGHT:536:this.height,this.width=this._mOriginalWidth="undefined"!=typeof b?b:a.clientWidth,this.height=this._mOriginalHeight="undefined"!=typeof c?c:a.clientHeight,this._mAABB.x=this._mAABB.y=0,this._mAABB.width=this.width,this._mAABB.height=this.height,this._mScale=1,this._mCanvas=e,this._mCanvasContext=e.getContext("2d",{alpha:!1}),navigator.isCocoonJS&&(this._mCanvas.screencanvas=!0),this},TGE.Stage.prototype={draw:function(){this._mMouseTargets=[],this._mCanvasContext.globalAlpha=1,this._mCanvasContext.globalCompositeOperation="source-over",this._mNumDrawnObjects=-1,this._draw(this._mCanvasContext)},numDrawnObjects:function(){return this._mNumDrawnObjects},setScale:function(a){this._mScale=a,this._mCanvas.width=this._mOriginalWidth*a,this._mCanvas.height=this._mOriginalHeight*a,this.width=this._mAABB.width=this._mOriginalWidth,this.height=this._mAABB.height=this._mOriginalHeight},setSize:function(a,b){this._mScale=1,this._mCanvas.width=a,this._mCanvas.height=b,this.width=this._mAABB.width=a,this.height=this._mAABB.height=b},isMouseDown:function(){return this._mMouseDown},getBounds:function(){return this._mAABB},dispatchEvent:function(a){"update"===a.type?this._updateAllObjects(a):TGE.Stage.superclass.dispatchEvent.call(this,a)},_updateAllObjects:function(a){for(var b=this._mUpdateGroup.length-1;b>=0;b--){var c=this._mUpdateGroup[b];c._mMarkedForRemoval||c._mLastUpdate===this._mUpdateCycle?this._mUpdateGroup.splice(b,1):(c.handleEvent(a),c._mLastUpdate=this._mUpdateCycle)}this._mUpdateCycle++},_addUpdateObj:function(a){this._mUpdateGroup.push(a)},_trashObject:function(a){this._mObjectTrash.push(a)},_emptyTrash:function(){for(len=this._mObjectTrash.length,i=0;len>i;i++)this._mObjectTrash[i].removeFromScene();this._mObjectTrash=[]},_notifyObjectsOfMouseEvent:function(a,b,c){"down"===a?this._mMouseDown=!0:"up"===a&&(this._mMouseDown=!1);var d={type:"mouse"+a,stageX:b,stageY:c};this.handleEvent(d);for(var e=this._mMouseTargets.length-1;e>=0;e--){var f=this._mMouseTargets[e];if(f.mouseX=b-f._mAABB.x,f.mouseY=c-f._mAABB.y,f.hitTestPoint(b,c)){switch(a){case"up":f.handleEvent(d),TGE.BrowserDetect.isMobileDevice||(d.type="click",f.handleEvent(d));break;case"down":f.handleEvent(d),TGE.BrowserDetect.isMobileDevice&&(d.type="click",f.handleEvent(d));break;case"move":f.handleEvent(d)}return}}},_updateObjectMouseOverStates:function(a,b){for(var c=this._mMouseTargets.length;--c>=0;){var d=this._mMouseTargets[c],e={stageX:a,stageY:b},f=(!TGE.BrowserDetect.isMobileDevice||this._mMouseDown)&&d.hitTestPoint(a,b);f?d._mMouseOver!==!0&&(d._mMouseOver=!0,e.type="mouseover",d.handleEvent(e)):(d._mMouseOver===!0&&(e.type="mouseout",d.handleEvent(e)),d._mMouseOver=!1),d.mouseX=a-d._mAABB.x,d.mouseY=b-d._mAABB.y}},_notifyObjectsOfKeyEvent:function(a,b){var c={type:a,keyCode:b};this.dispatchEvent(c)}},extend(TGE.Stage,TGE.DisplayObjectContainer),TGE.Sprite=function(){return TGE.Sprite.superclass.constructor.call(this),this._mImage=null,this._mCellWidth=0,this._mCellHeight=0,this._mSpriteIndex=0,this._mOffsetX=0,this._mOffsetY=0,this._mCoordinateCache=null,this},TGE.Sprite.prototype={setup:function(a){return TGE.Sprite.superclass.setup.call(this,a),"undefined"!=typeof a.image?this.setImage(a.image):null,"undefined"!=typeof a.width?this.width=a.width:null,"undefined"!=typeof a.height?this.height=a.height:null,this},setImage:function(a,b,c){if(b="undefined"==typeof b?1:b,c="undefined"==typeof c?1:c,this._mNumRows=b,this._mNumColumns=c,"string"==typeof a&&(a=TGE.AssetManager.GetImage(a)),!a||a instanceof Image||!a.spriteSheet)a instanceof Image?(this._mImage=a,this.width=this._mDrawWidth=this._mOriginalWidth=Math.floor(a.width/c),this.height=this._mDrawHeight=this._mOriginalHeight=Math.floor(a.height/b),this._resetCoordinateCache()):this._mImage=null;else{this._mImage=a.spriteSheet,this._mCellWidth=Math.floor(a.width/c),this._mCellHeight=Math.floor(a.height/b),this._mCoordinateCache=[];for(var d,e,f=0;b*c>f;f++)d=a.x+(f%c|0)*this._mCellWidth,e=a.y+(f/c|0)*this._mCellHeight,this._mCoordinateCache.push([d,e]);this.width=this._mDrawWidth=this._mOriginalWidth=this._mCellWidth,this.height=this._mDrawHeight=this._mOriginalHeight=this._mCellHeight,this._mOffsetX=0,this._mOffsetY=0,a.hasOwnProperty("offsetX")&&(this._mOffsetX=a.offsetX,this._mOffsetY=a.offsetY,this._mDrawWidth=a.drawWidth,this._mDrawHeight=a.drawHeight)}this._mImage&&(this._mImage.width<=0||this._mImage.height<=0)&&(TGE.Debug.Log(TGE.Debug.LOG_ERROR,"TGE.Sprite.setImage: HTMLImageElement has invalid dimensions ("+this._mImage.width+"x"+this._mImage.height+"), image likely did not load"),this._mImage=null),this._mSpriteIndex=0},setSpriteIndex:function(a){return null===this._mImage?void TGE.Debug.Log(TGE.Debug.LOG_ERROR,"Attempt to call TGE.Sprite.setSpriteIndex on null image"):(this._mSpriteIndex=a,void(this._mSpriteIndex>=this._mCoordinateCache.length&&(TGE.Debug.Log(TGE.Debug.LOG_ERROR,"Attempt to call TGE.Sprite.setSpriteIndex with an out of range index ("+a.toString()+")"),this._mSpriteIndex=0)))
},_drawClass:function(a){if(null!==this._mImage){var b=this.width/this._mOriginalWidth,c=this.height/this._mOriginalHeight;a.drawImage(this._mImage,this._mCoordinateCache[this._mSpriteIndex][0]>>0,this._mCoordinateCache[this._mSpriteIndex][1]>>0,this._mDrawWidth,this._mDrawHeight,this._mOffsetX*b,this._mOffsetY*c,this._mDrawWidth*b,this._mDrawHeight*c)}TGE.Sprite.superclass._drawClass.call(this,a)},_resetCoordinateCache:function(){this._mCellWidth=Math.floor(this._mImage.width/this._mNumColumns),this._mCellHeight=Math.floor(this._mImage.height/this._mNumRows),this._mCoordinateCache=[];for(var a,b,c=0;c<this._mNumRows*this._mNumColumns;c++)a=(c%this._mNumColumns|0)*this._mCellWidth,b=(c/this._mNumColumns|0)*this._mCellHeight,this._mCoordinateCache.push([a,b])}},extend(TGE.Sprite,TGE.DisplayObjectContainer),TGE.SpriteSheetAnimation=function(){return TGE.SpriteSheetAnimation.superclass.constructor.call(this),this.fps=24,this.totalFrames=1,this.looping=!0,this._mAge=0,this._mPlaying=!1,this._mCurrentFrame=-1,this.addEventListener("update",this._updateAnimation.bind(this)),this},TGE.SpriteSheetAnimation.prototype={setup:function(a){TGE.SpriteSheetAnimation.superclass.setup.call(this,a);var b="number"==typeof a.rows?b=a.rows:1,c="number"==typeof a.columns?c=a.columns:1;return 1===b&&1===c||"undefined"==typeof a.image||this.setImage(a.image,b,c),"number"==typeof a.fps?this.fps=a.fps:null,"number"==typeof a.totalFrames?this.totalFrames=a.totalFrames:null,"boolean"==typeof a.looping?this.looping=a.looping:!0,"undefined"!=typeof a.width?this.width=a.width:null,"undefined"!=typeof a.height?this.height=a.height:null,this},play:function(){this._mPlaying=!0},stop:function(){this._mPlaying=!1},gotoAndStop:function(a){this._jumpToFrame(a),this.stop()},gotoAndPlay:function(a){this._jumpToFrame(a),this.play()},currentFrame:function(){return this._mCurrentFrame},_jumpToFrame:function(a){this._setFrame(a),this._mAge=this._mCurrentFrame*(1/this.fps)},_setFrame:function(a){a!==this._mCurrentFrame&&(this._mCurrentFrame=a,this.setSpriteIndex(a),this.handleEvent({type:"frame"+this._mCurrentFrame.toString(),frame:this._mCurrentFrame}),this.looping||a!==this.totalFrames-1||this.handleEvent({type:"finished",frame:this._mCurrentFrame}))},_updateAnimation:function(a){if(this._mPlaying){this._mAge+=a.elapsedTime;var b=1/this.fps,c=Math.floor(this._mAge/b),d=this._mCurrentFrame;d=this.looping||c<this.totalFrames?c%this.totalFrames:this.totalFrames-1,this._setFrame(d)}}},extend(TGE.SpriteSheetAnimation,TGE.Sprite),TGE.TFXAnimationSet=function(){return TGE.TFXAnimationSet.superclass.constructor.call(this),this.imageSet=null,this.fps=24,this.looping=!0,this._mAnimationsData=null,this._mInverseGlobalScale=1,this._mPartInstances=[],this._mCurrentAnimationID=null,this._mAge=0,this._mPlaying=!1,this._mAnimationDir=1,this._mCurrentFrame=-1,this._mTotalFrames=1,this._mNextAnimation=null,this._mStopFrame=-1,this._mOldImageSet=null,this.addEventListener("update",this._updateAnimation.bind(this)),this},TGE.TFXAnimationSet.AddRequiredImagesToAssetList=function(a,b){var c=b.imageList,d=b.location,e=b.imageSet,f="string"==typeof b.spriteSheet?b.spriteSheet:null;if(e="undefined"==typeof e?null:e,c){"undefined"==typeof d&&(d="");for(var g in a.parts)if(a.parts.hasOwnProperty(g)){var h=a.parts[g];if(h.width>0&&h.height>0){var i=null===e?g:e+"_"+g;g.indexOf(".")<0&&(g+=".png"),c.push(null!==f?{id:i,url:d+"/"+g,sheet:f}:{id:i,url:d+"/"+g})}}}},TGE.TFXAnimationSet.ExpandData=function(a){return"object"==typeof a&&"f"in a&&"cjson"===a.f?TGE.TFXAnimationSet._expand(a.t,a.v):a},TGE.TFXAnimationSet.prototype={setup:function(a){return TGE.TFXAnimationSet.superclass.setup.call(this,a),"number"==typeof a.fps?this.fps=a.fps:null,"string"==typeof a.imageSet?this.imageSet=a.imageSet:null,this},animationExists:function(a){return null!==this._mAnimationsData?void 0!==this._mAnimationsData.animations[a]:!1},setCurrentAnimation:function(a,b){return this.animationExists(a)?(this.looping="undefined"==typeof b?!0:b,a!==this._mCurrentAnimationID&&(this._mCurrentAnimationID=a,this._mAge=0,this._mCurrentFrame=-1,this._mTotalFrames=this._mAnimationsData.animations[a].frames.length),void(this._mNextAnimation=null)):void TGE.Debug.Log(TGE.Debug.LOG_ERROR,"animation not found: '"+a+"'")},setNextAnimation:function(a,b,c){this._mNextAnimation={anim:a,looping:b,frame:c}},play:function(){this._mStopFrame=-1,this._mPlaying=!0},playFromStart:function(){this.gotoAndPlay(0)},playUntilFrame:function(a){this.play(),this._mStopFrame=a},playReverse:function(){this._mStopFrame=-1,this._jumpToFrame(this._mTotalFrames-1,!0),this._mPlaying=!0},playFromTo:function(a,b){this._mStopFrame=b,this._jumpToFrame(a,0>b-a),this._mPlaying=a!=b},stop:function(){this._mPlaying=!1},gotoAndStop:function(a){this._mStopFrame=-1,this._jumpToFrame(a),this.stop()},gotoAndPlay:function(a){this._mStopFrame=-1,this._jumpToFrame(a),this.play()},currentFrame:function(){return this._mCurrentFrame<0?0:this._mCurrentFrame},totalFrames:function(){return this._mTotalFrames},currentAnimation:function(){return this._mCurrentAnimationID},_setAnimationData:function(a){if(this._mAnimationsData=a,this.fps=a.framerate,this._mInverseGlobalScale=1/a.image_scale,this._mPartInstances.length>0)for(var b=this._mPartInstances.length,c=0;b>c;c++)this._mPartInstances[c].markForRemoval();this._mPartInstances=[];for(var d=this._mAnimationsData.max_children,c=0;d>c;c++){var e=this.addChild(new TGE.Sprite);e.visible=!1,this._mPartInstances.push(e)}},_posePartInstances:function(a){if(null!==this._mAnimationsData){this._mOldImageSet=this.imageSet;for(var b=this._mAnimationsData.animations[this._mCurrentAnimationID],c=b.frames[a],d=this._mPartInstances.length,e=c.instances.length,f=0;d>f;f++){var g=this._mPartInstances[f];if(f>=e)g.visible=!1;else{var h=c.instances[f],i=this._mAnimationsData.part_instances[h.i],j=this._mAnimationsData.parts[i];if(j.width>0&&j.height>0){var k=null===this.imageSet?i:this.imageSet+"_"+i;g.setImage(k)}else g.setImage(null);g.registrationX=j.regx,g.registrationY=j.regy;var l=void 0===h.a?1:h.a,m=void 0===h.b?0:h.b,n=void 0===h.c?0:h.c,o=void 0===h.d?1:h.d,p=void 0===h.x?0:h.x,q=void 0===h.y?0:h.y,r=void 0===h.o?1:h.o;l*=this._mInverseGlobalScale,m*=this._mInverseGlobalScale,n*=this._mInverseGlobalScale,o*=this._mInverseGlobalScale,g.setLocalTransform(l,m,n,o,p,q),g.alpha=r,g.visible=!0}}}},_jumpToFrame:function(a,b){(0>a||a>=this._mTotalFrames)&&TGE.Debug.Log(TGE.Debug.LOG_ERROR,"invalid frame "+a+" for animation '"+this._mCurrentAnimationID+"'"),this._mAnimationDir=b?-1:1,this._setFrame(a),this._mAge=this._mCurrentFrame*(1/this.fps)},_setFrame:function(a){if(a!==this._mCurrentFrame){a=Math.max(0,Math.min(a,this._mTotalFrames-1)),this._mCurrentFrame=a;var b=!1;this._mStopFrame>=0&&(this._mCurrentFrame-this._mStopFrame)*this._mAnimationDir>=0&&(this._mCurrentFrame=this._mStopFrame,this.stop(),b=!0),this.handleEvent({type:"enterFrame",frame:this._mCurrentFrame}),this._posePartInstances(this._mCurrentFrame),this.handleEvent({type:"frame"+this._mCurrentFrame.toString(),frame:this._mCurrentFrame});var c=this._mAnimationDir>0?this._mTotalFrames-1:0;if(!this.looping&&(a===c||b)&&(this._mPlaying=!1,this.handleEvent({type:"finished",frame:this._mCurrentFrame}),null!==this._mNextAnimation)){var d=this._mNextAnimation.frame;this.setCurrentAnimation(this._mNextAnimation.anim,this._mNextAnimation.looping),d&&this._jumpToFrame(d),this._mPlaying=!0}}},_updateAnimation:function(a){if(!this._mPlaying)return void(this.imageSet!==this._mOldImageSet&&this._posePartInstances(this._mCurrentFrame));this._mAge+=a.elapsedTime*this._mAnimationDir;var b=1/this.fps,c=b*this._mTotalFrames;this._mAge<0&&(this._mAge=this._mAge%c+c,this.looping||(this._mAge=0)),this._mAge>=c&&(this._mAge%=c,this.looping||(this._mAge=c-b/2)),this._setFrame(Math.floor(this._mAge/b))}},extend(TGE.TFXAnimationSet,TGE.DisplayObjectContainer),TGE.TFXAnimationSet._getKeys=function(a,b){for(var c=[];b>0;)c=a[b-1].slice(1).concat(c),b=a[b-1][0];return c},TGE.TFXAnimationSet._expand=function(a,b){var c,d,e,f;if("object"==typeof b)if("[object Array]"===Object.prototype.toString.apply(b))for(c=[],d=0;d<b.length;d++)c.push(TGE.TFXAnimationSet._expand(a,b[d]));else for(c={},f=TGE.TFXAnimationSet._getKeys(a,b[""][0]),d=0;d<f.length;d++)c[f[d]]=TGE.TFXAnimationSet._expand(a,b[""][d+1]);else c=b;if(c.version&&2===c.version){for(var e in c.animations)if(c.animations.hasOwnProperty(e))for(var g={},h=c.animations[e],i=0;i<h.frames.length;i++)for(var j=h.frames[i],d=0;d<j.instances.length;d++){var k=j.instances[d],l=.001;"undefined"==typeof k.a&&Math.abs(g[k.i].a-1)>l&&(k.a=g[k.i].a),"undefined"==typeof k.b&&Math.abs(g[k.i].b)>l&&(k.b=g[k.i].b),"undefined"==typeof k.c&&Math.abs(g[k.i].c)>l&&(k.c=g[k.i].c),"undefined"==typeof k.d&&Math.abs(g[k.i].d-1)>l&&(k.d=g[k.i].d),"undefined"==typeof k.x&&Math.abs(g[k.i].x)>l&&(k.x=g[k.i].x),"undefined"==typeof k.y&&Math.abs(g[k.i].y)>l&&(k.y=g[k.i].y),"undefined"==typeof k.o&&Math.abs(g[k.i].o-1)>l&&(k.o=g[k.i].o),g[k.i]=k}}else if(c.version&&3===c.version)for(var e in c.animations)if(c.animations.hasOwnProperty(e))for(var g={},m=null,h=c.animations[e],i=0;i<h.frames.length;i++){var j=h.frames[i];j.instances_map?m=j.instances_map:j.instances_map=m,j.instances||(j.instances=[]);for(var n=j.instances.length,d=n-1;d>=0;d--){var k=j.instances[d],o=j.instances_map[k.i];d!==o&&(j.instances[o]=k,j.instances[d]=null)}for(var p in j.instances_map)if(j.instances_map.hasOwnProperty(p)){var q=j.instances_map[p];j.instances[q]||(j.instances[q]={i:p})}for(var d=0;d<j.instances.length;d++){var k=j.instances[d],l=.001;"undefined"==typeof k.a&&Math.abs(g[k.i].a-1)>l&&(k.a=g[k.i].a),"undefined"==typeof k.b&&Math.abs(g[k.i].b)>l&&(k.b=g[k.i].b),"undefined"==typeof k.c&&Math.abs(g[k.i].c)>l&&(k.c=g[k.i].c),"undefined"==typeof k.d&&Math.abs(g[k.i].d-1)>l&&(k.d=g[k.i].d),"undefined"==typeof k.x&&Math.abs(g[k.i].x)>l&&(k.x=g[k.i].x),"undefined"==typeof k.y&&Math.abs(g[k.i].y)>l&&(k.y=g[k.i].y),"undefined"==typeof k.o&&Math.abs(g[k.i].o-1)>l&&(k.o=g[k.i].o),g[k.i]=k}}return c},TGE.Window=function(a,b){TGE.Window.superclass.constructor.call(this),this._mLayers={},this._mFadeDuration=0,this._mFadeColor=null,this._mFadePanel=null,this._mFadingOut=!1,this._mCallback=null,this._mUpdateListenerID=null,this.registrationX=0,this.registrationY=0,this.width=a,this.height=b,this.mouseEnabled=!0},TGE.Window._sTrackWindows=!1,TGE.Window._sActiveWindows=[],TGE.Window.prototype={transitionToWindow:function(a){var b=this._createNewWindow(a);return this._mFadeDuration=0,b.show(this.stage,this.close.bind(this)),b},overlayWindow:function(a){var b=this._createNewWindow(a);return b.show(this),b},resetToWindow:function(a){var b=this._createNewWindow(a);return this.stage.removeChildren(),b.show(this.stage),b},createLayer:function(a){var b=new TGE.DisplayObjectContainer;this._mLayers[a]=b,b.registrationX=0,b.registrationY=0,b.width=this.width,b.height=this.height,b.instanceName=a,this.addChild(b)},getLayer:function(a){return a in this._mLayers?this._mLayers[a]:null},show:function(a,b){if(a.addChild(this),this._mCallback="function"==typeof b?b:null,this._mFadeDuration>0?(this.alpha=0,this._mUpdateListenerID=this.addEventListener("update",this._updateTransitions.bind(this))):null!==this._mCallback&&(this._mCallback.call(),this._mCallback=null),TGE.Window._sTrackWindows){var c=this._windowName();TGE.Window._sActiveWindows.push(c),this.addEventListener("remove",this._removeFromDebugList.bind(this,c))}},close:function(a){this._mCallback="function"==typeof a?a:null,this._mFadeDuration>0?(this._mFadingOut=!0,null===this._mUpdateListenerID&&(this._mUpdateListenerID=this.addEventListener("update",this._updateTransitions.bind(this)))):this._forceClose()},setupFade:function(a,b){this._mFadeColor="undefined"!=typeof b?b:null,this._mFadeDuration=a,null!==this._mFadePanel&&null===this._mFadeColor&&this._destroyFadePanel(),null!==this._mFadePanel&&(this._mFadePanel.backgroundColor=this._mFadeColor)},_createNewWindow:function(a){var b=new a.windowClass(this.width,this.height);return b.setup(a),"number"==typeof a.fadeTime&&b.setupFade(a.fadeTime),b},_forceClose:function(){this.markForRemoval(),null!==this._mCallback&&(this._mCallback.call(),this._mCallback=null)},_windowName:function(){for(var a in window)if(window[a]==this.constructor)return a;return"TGE.Window"},_removeFromDebugList:function(a){if(TGE.Window._sTrackWindows)for(var b=TGE.Window._sActiveWindows.length-1;b>=0;b--)if(TGE.Window._sActiveWindows[b]===a)return void TGE.Window._sActiveWindows.splice(b,1)},_updateTransitions:function(a){var b=!1,c=a.elapsedTime;null!==this._mFadeColor&&null===this._mFadePanel&&this._setupFadePanel();var d=null===this._mFadePanel?this.alpha:1-this._mFadePanel.alpha;this._mFadeDuration>0?this._mFadingOut?(d-=c*(1/this._mFadeDuration),0>d&&(d=0,this._forceClose())):1>d&&(d+=c*(1/this._mFadeDuration),d>=1&&(d=1,b=!0,this.removeEventListener("update",this._mUpdateListenerID),this._mUpdateListenerID=null)):(d=1,b=!0),null===this._mFadePanel?this.alpha=d:(this._mFadePanel.visible=!0,this._mFadePanel.alpha=1-d,this.alpha=1),b&&null!==this._mCallback&&(this._mCallback.call(),this._mCallback=null)},_setupFadePanel:function(){this._mFadePanel=(new TGE.DisplayObjectContainer).setup({width:this.width,height:this.height,backgroundColor:this._mFadeColor}),this._mFadePanel.registrationX=this._mFadePanel.registrationY=0,this.addChild(this._mFadePanel)},_destroyFadePanel:function(){null!==this._mFadePanel&&(this._mFadePanel.markForRemoval(),this._mFadePanel=null)}},extend(TGE.Window,TGE.Sprite),TGE.Button=function(){TGE.Button.superclass.constructor.call(this),this.enabled=!0,this.text="",this.idleColor=TGE.Button.DefaultIdleColor,this.hoverColor=TGE.Button.DefaultHoverColor,this.downColor=TGE.Button.DefaultDownColor,this.disableColor=TGE.Button.DefaultDisableColor,this.verticalPressOffset=TGE.Button.DefaultVerticalPressOffset,this._mState="idle",this._mMouseDown=!1,this._mNumStates=1,this._mTextObject=null,this.addEventListener("mousedown",this._buttonMouseDown),this.addEventListener("mouseup",this._buttonMouseUp),this.addEventListener("click",this._onClick),this.addEventListener("update",this._update),this.pressFunction=null},TGE.Button.DefaultWidth=250,TGE.Button.DefaultHeight=60,TGE.Button.DefaultFont="bold 40px Arial",TGE.Button.DefaultTextColor="#000",TGE.Button.DefaultIdleColor="#ddd",TGE.Button.DefaultHoverColor="#ffc",TGE.Button.DefaultDownColor="#ccf",TGE.Button.DefaultDisableColor="#888",TGE.Button.DefaultVerticalPressOffset=0,TGE.Button.prototype={setup:function(a){TGE.Button.superclass.setup.call(this,a),"number"==typeof a.numStates?this._mNumStates=a.numStates:null,this._mNumStates>1&&"undefined"!=typeof a.image&&this.setImage(a.image,1,this._mNumStates),"function"==typeof a.pressFunction?this.pressFunction=a.pressFunction:null,"string"==typeof a.text?this.text=a.text:null;var b="string"==typeof a.font?a.font:TGE.Button.DefaultFont,c="string"==typeof a.textColor?a.textColor:TGE.Button.DefaultTextColor;return null!==this.text&&(this._mTextObject=this.addChild((new TGE.Text).setup({text:this.text,font:b,color:c}))),a.image||(this.width="number"==typeof a.width?a.width:TGE.Button.DefaultWidth,this.height="number"==typeof a.height?a.height:TGE.Button.DefaultHeight,this.idleColor="string"==typeof a.idleColor?a.idleColor:TGE.Button.DefaultIdleColor,this.hoverColor="string"==typeof a.hoverColor?a.hoverColor:TGE.Button.DefaultHoverColor,this.downColor="string"==typeof a.downColor?a.downColor:TGE.Button.DefaultDownColor,this.disableColor="string"==typeof a.disableColor?a.disableColor:TGE.Button.DefaultDisableColor,this.backgroundColor=this.idleColor),this.verticalPressOffset="number"==typeof a.verticalPressOffset?a.verticalPressOffset:TGE.Button.DefaultVerticalPressOffset,"boolean"==typeof a.enabled?this.enabled=a.enabled:null,this},_update:function(){return null!==this._mTextObject&&(this._mTextObject.text=this.text),this.enabled?void(this._mMouseOver?(this._mMouseDown=TGE.Game.GetInstance().isMouseDown(),this._setButtonState(this._mMouseDown?"down":"hover")):this._setButtonState("idle")):void this._setButtonState("disable")},_buttonMouseDown:function(){this._mMouseDown=!0},_buttonMouseUp:function(){this._mMouseDown=!1},_onClick:function(a){this.enabled&&null!==this.pressFunction&&this.pressFunction.call(this,a.currentTarget)},_setButtonState:function(a){if(a!=this._mState)if(this._mState=a,null!==this._mImage){var b=0;switch(this._mState){case"disable":b=3;break;case"down":b=2;break;case"hover":b=1;break;case"idle":default:b=0}b<this._mNumStates&&this.setSpriteIndex(b)}else switch(this._mState){case"disable":this.backgroundColor=this.disableColor;break;case"down":this.backgroundColor=this.downColor;break;case"hover":this.backgroundColor=this.hoverColor;break;case"idle":default:this.backgroundColor=this.idleColor}},_draw:function(a){var b=0!==this.verticalPressOffset&&this.mouseEnabled&&this.isMouseOver()&&"down"===this._mState;b&&(this.y+=this.verticalPressOffset),TGE.Button.superclass._draw.call(this,a),b&&(this.y-=this.verticalPressOffset)}},extend(TGE.Button,TGE.Sprite),TGE.Text=function(){return TGE.Text.superclass.constructor.call(this),this.text="",this.font="12px Arial",this.hAlign="center",this.vAlign="middle",this.textColor=null,this.wrapWidth=-1,this.lineSpacing=.05,this.strokeWidth=0,this.strokeColor=null,this._mPreviousText=null,this._mPreviousFont=null,this._mPreviousWrapWidth=null,this._mLines=[],this._mLineHeight=0,this},TGE.Text.prototype={setup:function(a){return TGE.Text.superclass.setup.call(this,a),"string"==typeof a.text?this.text=a.text:null,"string"==typeof a.font?this.font=a.font:null,"string"==typeof a.hAlign?this.hAlign=a.hAlign:null,"string"==typeof a.vAlign?this.vAlign=a.vAlign:null,"string"==typeof a.color?this.textColor=a.color:null,"number"==typeof a.wrapWidth?this.wrapWidth=a.wrapWidth:-1,"number"==typeof a.lineSpacing?this.lineSpacing=a.lineSpacing:.05,"number"==typeof a.strokeWidth?this.strokeWidth=a.strokeWidth:0,"string"==typeof a.strokeColor?this.strokeColor=a.strokeColor:null,this},_calculateDimensions:function(a){a.save(),a.font=this.font,this._mLines=[],this._mLineHeight=30;try{var b=this.font.indexOf("px"),c=this.font.substring(0,b).replace(/[^\d.]/g,"");this._mLineHeight=parseInt(c,10),this._mLineHeight+=this._mLineHeight*this.lineSpacing>>0}catch(d){}if(this.wrapWidth>0){this.width=this.wrapWidth;for(var e=this.text.split(" "),f=e[0],g=1;g<e.length;g++){var h=f+" "+e[g],i=a.measureText(h);i.width>this.wrapWidth?(this._mLines[this._mLines.length]=f,f=e[g]):f=h}this._mLines[this._mLines.length]=f,this.height=this._mLineHeight*this._mLines.length}else{this._mLines.push(this.text);var i=a.measureText(this.text);this.width=i.width,this.height=this._mLineHeight}this.registrationX=null===this.hAlign||"center"===this.hAlign?.5:"left"===this.hAlign?0:1,this.registrationY=null===this.vAlign||"middle"===this.vAlign?.5:"top"===this.vAlign?0:1,this._mLocalTransformDirty=!0,a.restore()},_drawClass:function(a){if(null!==this.text){(this._mPreviousText!==this.text||this._mPreviousFont!==this.font||this._mPreviousWrapWidth!==this.wrapWidth)&&(this._mPreviousText=this.text,this._mPreviousFont=this.font,this._mPreviousWrapWidth=this.wrapWidth,this._mLines=[],this._calculateDimensions(a)),0===this._mLines.length&&this._mLines.push(this.text),this._applyCanvasXForm(this._mWorldTransformNoReg,a),a.font=null!==this.font?this.font:"Arial",a.textAlign=null!==this.hAlign?this.hAlign:"center",a.textBaseline=null!==this.vAlign?this.vAlign:"middle",a.fillStyle=null!==this.textColor?this.textColor:"#000",this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=null!==this.strokeColor?this.strokeColor:"#fff");var b=0;this._mLines.length>1&&(b="top"===this.vAlign?0:"middle"===this.vAlign?-this.height/2:b=-this.height,a.textBaseline="top");for(var c=0;c<this._mLines.length;c++)(null!==this.textColor||0===this.strokeWidth)&&a.fillText(this._mLines[c],0,b),this.strokeWidth>0&&a.strokeText(this._mLines[c],0,b),b+=this._mLineHeight}}},extend(TGE.Text,TGE.DisplayObjectContainer),TGE.ParallaxPane=function(){TGE.ParallaxPane.superclass.constructor.call(this),this.trackingSpeed=1,this.offset=0,this.scrollVertically=!1,this.horizontalOffset=0,this.horizontalSpacing=0,this.verticalOffset=0,this.verticalSpacing=0,this._mPane1=null,this._mPane2=null,this.addEventListener("camerachange",this._updateToCamera)},TGE.ParallaxPane.prototype={setup:function(a){TGE.ParallaxPane.superclass.setup.call(this,a);var b="undefined"!=typeof a.image?a.image:null;return this.trackingSpeed="number"==typeof a.trackingSpeed?a.trackingSpeed:1,this.scrollVertically="boolean"==typeof a.vertical?a.vertical:!1,this.horizontalOffset="number"==typeof a.horizontalOffset?a.horizontalOffset:0,this.horizontalSpacing="number"==typeof a.horizontalSpacing?a.horizontalSpacing:0,this.verticalOffset="number"==typeof a.verticalOffset?a.verticalOffset:0,this.verticalSpacing="number"==typeof a.verticalSpacing?a.verticalSpacing:0,this.registrationX=0,this.registrationY=0,this._mPane1=new TGE.Sprite,this._mPane1.setImage(b),this._mPane1.registrationX=0,this._mPane1.registrationY=0,this.addChild(this._mPane1),this._mPane2=new TGE.Sprite,this._mPane2.setImage(b),this._mPane2.registrationX=0,this._mPane2.registrationY=0,this.addChild(this._mPane2),this},_updateToCamera:function(a){if(this.scrollVertically){var b=a.cy,c=this.verticalOffset/this.scaleY+(b+this.offset)*this.trackingSpeed/this.scaleY,d=(this.stage.height+this.verticalSpacing)/this.scaleY;this._mPane1.x=0,this._mPane1.y=c%d,this._mPane2.x=0,this._mPane2.y=this._mPane1.y-d}else{var e=a.cx,f=this.horizontalOffset/this.scaleX+(-e+this.offset)*this.trackingSpeed/this.scaleX,g=(this.stage.width+this.horizontalSpacing)/this.scaleX;this._mPane1.x=f%g,this._mPane1.y=this.stage.height/2-(this.worldY-a.cy),this._mPane2.x=this._mPane1.x+g,this._mPane2.y=this._mPane1.y}}},extend(TGE.ParallaxPane,TGE.DisplayObjectContainer),TGE.iOSAudioLoader=function(){this.audioToPreload=[],this.nextToLoad=0,this.playThrough=!1,this.currentlyLoading=!1,this.stopPlayer=this.stopPlay.bind(this),this.loader=this.loadNext.bind(this),"ontouchstart"in document.documentElement&&TGE.BrowserDetect.isMobileDevice?TGE.Game.GetInstance().mCanvasDiv.addEventListener("touchstart",this.loader,!1):TGE.Game.GetInstance().mCanvasDiv.addEventListener("mousedown",this.loader,!1)},TGE.iOSAudioLoader.prototype={loadNext:function(){console.log("Loading next"),this.currentlyLoading||0==this.audioToPreload.length||(this.playThrough?this.playThrough=!1:(this.audioToPreload[this.nextToLoad].addEventListener("play",this.stopPlayer,!1),this.currentlyLoading=!0),this.audioToPreload[this.nextToLoad].play())},stopPlay:function(){console.log("Loading next"),this.audioToPreload[this.nextToLoad].pause(),this.audioToPreload[this.nextToLoad].removeEventListener("play",this.stopPlayer,!1),this.audioToPreload.splice(this.nextToLoad,1),this.currentlyLoading=!1,this.nextToLoad=0,0==this.audioToPreload.length&&("ontouchstart"in document.documentElement&&TGE.BrowserDetect.isMobileDevice?TGE.Game.GetInstance().mCanvasDiv.removeEventListener("touchstart",this.loader,!1):TGE.Game.GetInstance().mCanvasDiv.removeEventListener("mousedown",this.loader,!1))}},TGE.AudioLoader=function(a,b,c,d,e){var f=this;if(this.id=a,this.loader=null,this.forceHandler=null,this.audio=document.createElement("audio"),this.audio.setAttribute("preload","auto"),document.body.appendChild(this.audio),("Safari"===TGE.BrowserDetect.browser||TGE.BrowserDetect.onWindowsMobile)&&"undefined"!=typeof b&&c.lastIndexOf("mp3")==c.length-"mp3".length){var g=b;b=c,c=g}if(navigator.isCocoonJS)this.audio.src=b;else{var h=document.createElement("source");h.setAttribute("src",b),this.audio.appendChild(h);var i=document.createElement("source");i.setAttribute("src",c),this.audio.appendChild(i)}this.url=b,this.tags=d,this.priority=e,this.complete=!1,this.pollCount=0,this.start=function(a){if(this.loader=a,this.isLimited())"undefined"==typeof TGE.Game.GetInstance().iOSAudioLoader&&(TGE.Game.GetInstance().iOSAudioLoader=new TGE.iOSAudioLoader),TGE.Game.GetInstance().iOSAudioLoader.audioToPreload.push(this.audio);else{var b=function(){this.audio.removeEventListener("loadedmetadata",this.forceHandler,!1),this.complete=!0,this.loader.onLoad(f)};this.forceHandler=b.bind(this),this.audio.addEventListener("loadedmetadata",this.forceHandler,!1),this.audio.load()}},this.checkStatus=function(){return this.audio.networkState===HTMLMediaElement.NETWORK_NO_SOURCE?void this.loader.onError(f):this.pollCount>=3?void this.loader.onTimeout(f):((this.complete===!0||TGE.BrowserDetect.onWindowsMobile)&&this.loader.onLoad(f),this.isLimited()?void this.loader.onTimeout(f):void this.pollCount++)},this.onTimeout=function(){this.loader.onTimeout(f)},this.getName=function(){return b}},TGE.AudioLoader.prototype.isLimited=function(){return"iPhone"===TGE.BrowserDetect.platform||"iPad"===TGE.BrowserDetect.platform},"function"==typeof PxLoader&&(PxLoader.prototype.addAudio=function(a,b,c,d,e){var f=new TGE.AudioLoader(a,b,c,d,e);return this.add(f),f.audio}),TGE.AudioManager=function(a){this.mAssetManager=a,this.mVolume=1,this.mMuted=!1,this.mplayerManagerList={}},TGE.AudioManager.prototype={Play:function(a){if(!("A0011"===getDistributionPartner()||"A0020"===getDistributionPartner()&&TGE.BrowserDetect.onAndroid&&parseInt(TGE.BrowserDetect.OSversion.charAt(0))<4)){var b=null;if(a.id in this.mplayerManagerList)b=this.mplayerManagerList[a.id];else{if(b=new TGE.PlayerManager(this),b.init(a)===!1)return;this.mplayerManagerList[a.id]=b}(1!=this.isMobile()||this.mMuted!==!0)&&(1!=this.isMobile()||b.isPlaying()!==!0)&&b.playAudio(a)}},Pause:function(a){if(a in this.mplayerManagerList){var b=this.mplayerManagerList[a];b.pauseAudio()}},Mute:function(){if(this.mMuted!==!0){this.mMuted=!0;for(var a in this.mplayerManagerList){var b=this.mplayerManagerList[a];this.isMobile()===!0?0==b.nLoop?b.stopAudio():b.pauseAudio():b.muteAudio()}}},Unmute:function(){if(this.mMuted!==!1){this.mMuted=!1;for(var a in this.mplayerManagerList){var b=this.mplayerManagerList[a];this.isMobile()===!0?0!=b.nLoop&&(b.mState===b.STATE.Stopped?b.playAudio({}):b.resumeAudio()):b.unmuteAudio()}}},ToggleMute:function(){this.mMuted===!0?this.Unmute():this.Mute()},StopAll:function(){if(1!=this.isMobile()||this.mMuted!==!0)for(var a in this.mplayerManagerList){var b=this.mplayerManagerList[a];b.stopAudio()}},PauseAll:function(){for(var a in this.mplayerManagerList){var b=this.mplayerManagerList[a];b.pauseAudio()}},ResumeAll:function(){for(var a in this.mplayerManagerList){var b=this.mplayerManagerList[a];(1!=this.isMobile()||this.mMuted!==!0)&&b.resumeAudio()}},isLoadAudio:function(){return this.mAssetManager.loadAudio},isMobile:function(){return"Windows"!==TGE.BrowserDetect.platform&&"Mac"!==TGE.BrowserDetect.platform}},TGE.PlayerManager=function(a){this.mAudioManager=a,this.nStartTime=0,this.nEndTime=-1,this.nLoop=0,this.callback=null,this.audioElement=null,this.bPlaySegment=!1,this.STATE={NotLoaded:0,Playing:1,Stopped:2,Paused:3,AutoPaused:4},this.mState=this.STATE.NotLoaded,this.audioId=null,this.audioPlaybackInProgressHandler=null,this.audioPlaybackCompleteHandler=null},TGE.PlayerManager.prototype={init:function(a){if(!TGE.AssetManager.Exists(a.id))return TGE.Debug.Log(TGE.Debug.LOG_ERROR,"Unknown audio id: "+a.id),!1;this.mState=this.STATE.NotLoaded,this.audioId=a.id;var b=this;if(this.callback=void 0!==a.callBackFunction?a.callBackFunction:null,this.audioElement=this.mAudioManager.mAssetManager.getImage(a.id),this.nStartTime=0,this.nEndTime=-1,"audio_sprite"===this.audioElement.assetType&&(this.bPlaySegment=!0,this.nStartTime=this.audioElement.startTime,this.nEndTime=this.audioElement.endTime,this.audioElement=this.mAudioManager.mAssetManager.getImage(this.audioElement.id)),("Android"===TGE.BrowserDetect.platform||"Kindle Fire"===TGE.BrowserDetect.platform)&&(this.bPlaySegment=!0,this.nStartTime=0,this.nEndTime=this.audioElement.duration),!this.audioElement.canPlayType)return TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"No canPlayType attribute found in audio tag: "+a.id),!1;this.nLoop=0,void 0!==a.loop&&(this.nLoop=Number(a.loop),"boolean"==typeof this.audioElement.loop&&0!=this.nLoop&&(this.audioElement.loop=!0)),void 0===this.nLoop&&(this.nLoop=0);var c=function(){if(this.bPlaySegment){if(this.audioElement.currentTime<this.nStartTime)try{this.audioElement.currentTime=this.nStartTime}catch(a){return void TGE.Debug.Log(TGE.Debug.LOG_ERROR,"AudioManager.audioPlaybackInProgress exception setting currentTime: "+a)}this.audioElement.currentTime>=this.nEndTime&&(0===this.nLoop?this.stopAudio():"boolean"!=typeof this.audioElement.loop&&this.restartAudio())}},d=function(){0===this.nLoop?this.stopAudio():"boolean"!=typeof this.audioElement.loop&&this.restartAudio()};return this.audioElement.addEventListener("timeupdate",c.bind(this),!1),this.audioElement.addEventListener("ended",d.bind(this),!1),window.addEventListener("pagehide",function(){b.mState===b.STATE.Playing&&(b.pauseAudio(),b.mState=b.STATE.AutoPaused)}),window.addEventListener("pageshow",function(){b.mState===b.STATE.AutoPaused&&b.resumeAudio()}),this.mState=this.STATE.Stopped,!0},playAudio:function(){if(this.mAudioManager.isLoadAudio()!==!1){this.audioElement.volume=this.mAudioManager.mMuted===!0?0:this.mAudioManager.mVolume;try{4==this.audioElement.readyState&&(this.audioElement.currentTime=this.nStartTime)}catch(a){return void TGE.Debug.Log(TGE.Debug.LOG_ERROR,"AudioManager.playAudio exception setting currentTime: "+a)}this.bPlaySegment===!1&&(this.nEndTime=this.audioElement.duration),this.mState=this.STATE.Playing,this.audioElement.play()}},stopAudio:function(){if(this.mAudioManager.isLoadAudio()!==!1&&void 0!==this.audioElement){try{this.audioElement.currentTime=0}catch(a){return void TGE.Debug.Log(TGE.Debug.LOG_ERROR,"AudioManager.stopAudio exception setting currentTime: "+a)}this.mState=this.STATE.Stopped,this.audioElement.pause(),null!==this.callback&&this.callback()}},restartAudio:function(){if(this.mAudioManager.isLoadAudio()!==!1&&void 0!==this.audioElement){try{this.audioElement.currentTime=this.nStartTime}catch(a){return void TGE.Debug.Log(TGE.Debug.LOG_ERROR,"AudioManager.restartAudio exception setting currentTime: "+a)}this.mState=this.STATE.Playing,this.audioElement.play()}},pauseAudio:function(){this.mAudioManager.isLoadAudio()!==!1&&void 0!==this.audioElement&&this.mState===this.STATE.Playing&&(this.mState=this.STATE.Paused,this.audioElement.pause())},resumeAudio:function(){this.mAudioManager.isLoadAudio()!==!1&&void 0!==this.audioElement&&this.mState===this.STATE.Paused&&(this.mState=this.STATE.Playing,this.audioElement.play())},muteAudio:function(){this.mAudioManager.isLoadAudio()!==!1&&void 0!==this.audioElement&&(this.audioElement.volume=0)},unmuteAudio:function(){this.mAudioManager.isLoadAudio()!==!1&&void 0!==this.audioElement&&(this.audioElement.volume=this.mAudioManager.mVolume)},isPlaying:function(){return this.mState===this.STATE.Playing?!0:!1}},TGE.Game=function(){if(null!==TGE.Game._sInstance)return TGE.Debug.Log(TGE.Debug.LOG_ERROR,"you can only create one instance of a TGE.Game object"),this;TGE.Game._sInstance=this,this.analytics=null,"undefined"!=typeof window.GameConfig&&GameConfig.GoogleAnalytics.ENABLED&&(TGE.Debug.Log(TGE.Debug.LOG_INFO,"automatically instantiating GoogleAnalytics object with label '"+GameConfig.GoogleAnalytics.LABEL+"'"),this.analytics=new TGE.TGSAnalyticsBridge(GameConfig.GoogleAnalytics.LABEL)),this.mCanvasDiv=null,this.mReorientationDiv=null,this.mCanvasPosition=null,this.mLayers={},this.mCameraLocation=null,this.mLoadingStartTime=(new Date).getTime(),this.mLoadingScreen=null,this.stage=null,this.assetManager=new TGE.AssetManager,this.audioManager=new TGE.AudioManager(this.assetManager),this.onLoad=null,this.mPlaying=!1,this.mPaused=!1,this.mCurrentLevel=null,this.pauseButton=null,this._mUserPauseEnabled=!1,this.mGameTime=0,this._mFilterStrength=10,this._mFrameTime=0,this._mLastLoop=new Date,this._mLastDisplay=new Date,this._mThisLoop,this._mCurrentFPS=0,this.mMaxTickTime=.25,this.mMinTickTime=Number.MIN_VALUE,this.mScreenManager=null,this._mRegisteredScreens=[],this._mDeprecatedScreens=[],this._mPauseScreen=null,this.mMouseX=0,this.mMouseY=0,this.mMouseDown=!1,this.mKeysDown={},this._mGameStarted=!1,this._mTrackedFirstInteraction=!1,this.mDefaultLinkTarget="_blank",this._mUpdateRoot=null,this.canvasWidth=0,this.canvasHeight=0,this._isiFramed=window.self!=window.top,this.scaleToFitOnDesktop=this._isiFramed,this.horizontalAlignment="center",this.verticalAlignment=TGE.BrowserDetect.isMobileDevice||this.scaleToFitOnDesktop?"middle":"top",this.resizeCanvasToFit=!1,this.desktopMaxCanvasWidth=Number.MAX_VALUE,this.desktopMaxCanvasHeight=Number.MAX_VALUE,this._mNativeScaling=null,this._mViewportScale=1,this._mDivResized=!1,this._miOS5Scale=-1,this._mResizedForiOS7=!1,this._mRAFID=null;
var a=-1!==navigator.userAgent.toString().toLowerCase().indexOf("samsung");this._mUseRAFHack=TGE.BrowserDetect.onAndroid&&parseInt(TGE.BrowserDetect.OSversion.charAt(0))>=4&&a,this._mUpdatingEnabled=!0,this._mUpdateSkips=0,this._oniOS="iPhone"===TGE.BrowserDetect.platform||"iPad"===TGE.BrowserDetect.platform,this._onAndroid="Android"===TGE.BrowserDetect.platform,TGE.BrowserDetect.onWindowsMobile&&(window.devicePixelRatio=window.screen.deviceXDPI/window.screen.logicalXDPI,-1!==navigator.userAgent.indexOf("Lumia 920")&&(window.devicePixelRatio=2))},TGE.LoadingWindow=null,TGE.FirstGameWindow=null,TGE.GameReadyCallback=null,TGE.OnUnsupportedPlatform=null,TGE.DisableViewportResizing=!1,TGE.DisableLostFocusPause=!1,TGE.Game._sInstance=null,TGE.Game.GetInstance=function(){return TGE.Game._sInstance},TGE.Game.OpenURL=function(a){return"A0030"===getDistributionPartner()?void TGE.Debug.Log(TGE.Debug.LOG_WARNING,"Cannot open external URLs on Windows Phone"):void window.open(a,"_blank")},TGE.Game.GameDiv=function(){return TGE.Game.GetInstance().mCanvasDiv},TGE.Game.SetUpdateRoot=function(a){TGE.Game.GetInstance()._mUpdateRoot=a},TGE.Game.prototype={_mViewportScale:0,_mResizeTimeout:null,_oniOS:!1,_onAndroid:!1,onMobile:function(){return TGE.BrowserDetect.isMobileDevice},oniOS:function(){return this._oniOS},onAndroid:function(){return this._onAndroid},onPhoneGap:function(){return TGE.BrowserDetect.usingPhoneGap},registerScreen:function(a,b){this._mRegisteredScreens[a]=b},registerDeprecatedScreen:function(a,b){this._mDeprecatedScreens[a]=b},showManagedScreen:function(a){return this._mRegisteredScreens[a]?this.stage.addChild(this._mRegisteredScreens[a].call(this)):this._mDeprecatedScreens[a]?this.ShowScreen(this._mDeprecatedScreens[a]):null},IsPlatformAcceptable:function(){if(navigator.isCocoonJS)return!0;var a=!!window.CanvasRenderingContext2D;if(!a)return window.TGS&&TGS.Analytics._logErrorEvent("no canvas"),!1;if("iPhone"===TGE.BrowserDetect.platform||"iPad"===TGE.BrowserDetect.platform){var b=TGE.BrowserDetect.OSversion.charCodeAt(0)-48;return b>=5}if("Android"===TGE.BrowserDetect.Platform)return!0;if("Windows"===TGE.BrowserDetect.platform||"Mac"===TGE.BrowserDetect.platform){var c=TGE.BrowserDetect.browser.toLowerCase(),d=parseFloat(TGE.BrowserDetect.version);if("firefox"==c)return d>=8;if("explorer"==c)return d>=9;if("chrome"==c)return d>=14;if("safari"==c)return d>=5.1}return!0},launch:function(a){var b="string"==typeof a.gameDiv?a.gameDiv:null,c="string"==typeof a.reorientDiv?a.reorientDiv:null,d="number"==typeof a.width?a.width:-1,e="number"==typeof a.height?a.height:-1,f="number"==typeof a.initialWidth?parseInt(a.initialWidth):-1,g="number"==typeof a.initialHeight?parseInt(a.initialHeight):-1,h="undefined"==typeof a.resizeForNative?!1:a.resizeForNative;if(this._sConfig=a,this.onLoad="function"==typeof a.onLoad?a.onLoad:this.onLoad,this.mCanvasDiv=document.getElementById(b),null==this.mCanvasDiv)return TGE.Debug.Log(TGE.Debug.LOG_ERROR,"Could not find canvas div '"+b+"'"),!1;if(window.GameConfig&&GameConfig.PROD_ENV!==!0&&"1"===getQueryString().dump_assets){this.mCanvasDiv.style.display="none",document.body.style.backgroundColor="#fff",document.body.style.color="#000",document.body.style.backgroundImage="none";var i=document.createElement("div");return i.id="assets_dump",i.style.textAlign="left",i.style.fontSize="12px",i.style.fontFamily="Arial",i.style.padding="10px",i.innerHTML=this.assetManager.dumpAssetsToString("<br>"),document.body.insertBefore(i,document.body.firstChild),!0}var j=this.mCanvasDiv.getAttribute("style")||"";if(this.mCanvasDiv.setAttribute("style",j+" z-index: 1; overflow: hidden; -webkit-user-select: none; -ms-touch-action:none; -webkit-tap-highlight-color: transparent; -moz-tap-highlight-color: transparent; -webkit-transform: translateZ(0);"),h){var k=document.getElementById("viewporter");null!==k&&(k.align="left");var l=1;"iPad"===TGE.BrowserDetect.platform?(l=.75,d=this.mCanvasDiv.clientWidth,e=Math.round(l*d)):"iPhone"===TGE.BrowserDetect.platform&&(l=320/480,d=this.mCanvasDiv.clientWidth,e=Math.round(l*d),null!==k&&(window.innerWidth>480||window.innerHeight>480)&&(k.align="center")),1!==l&&(this._mNativeScaling={x:d/this.mCanvasDiv.clientWidth,y:e/this.mCanvasDiv.clientHeight})}d>0&&e>0&&(this.mCanvasDiv.style.width=d+"px",this.mCanvasDiv.style.height=e+"px"),this.canvasWidth=this.mCanvasDiv.clientWidth,this.canvasHeight=this.mCanvasDiv.clientHeight,TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"game launch calling _resizeViewport"),this._resizeViewport(),this.mReorientationDiv=document.getElementById(c),this._determineCanvasPosition(),window.addEventListener("resize",this._onResize.bind(this),!1);var m=this;window.addEventListener("message",function(a){try{var b=JSON.parse(a.data);"iframe:pause"==b?m._onDeactivate():"iframe:resize"==b&&m._onResize()}catch(c){-1===a.origin.indexOf("facebook")&&TGE.Debug.Log(TGE.Debug.LOG_ERROR,"Error with window message ("+a.data+"): "+c)}},!1);var n=!this.onMobile()&&this._isiFramed,o=this.onMobile()&&!(this._isiFramed&&TGE.BrowserDetect.oniOS);if(TGE.DisableLostFocusPause||!n&&!o||(window.addEventListener("blur",this._onDeactivate.bind(this),!1),window.addEventListener("pagehide",this._onDeactivate.bind(this),!1),this.onPhoneGap()&&document.addEventListener("pause",this._onDeactivate.bind(this),!1)),navigator.isCocoonJS?(window.addEventListener("touchstart",this._mouseDown.bind(this),!1),window.addEventListener("touchmove",this._mouseMove.bind(this),!1),window.addEventListener("touchend",this._mouseUp.bind(this),!1)):"ontouchstart"in document.documentElement&&TGE.BrowserDetect.isMobileDevice?(this.mCanvasDiv.addEventListener("touchstart",this._mouseDown.bind(this),!1),this.mCanvasDiv.addEventListener("touchmove",this._mouseMove.bind(this),!1),this.mCanvasDiv.addEventListener("touchend",this._mouseUp.bind(this),!1)):(this.mCanvasDiv.addEventListener("click",this._preventBehavior.bind(this),!1),this.mCanvasDiv.addEventListener("mousedown",this._mouseDown.bind(this),!1),this.mCanvasDiv.addEventListener("mouseup",this._mouseUp.bind(this),!1),this.mCanvasDiv.addEventListener("mousemove",this._mouseMove.bind(this),!1)),document.addEventListener("keydown",this._keyDown.bind(this),!1),document.addEventListener("keyup",this._keyUp.bind(this),!1),getQueryString().tgedebug||"undefined"!=typeof window.CordovaConfig&&1==CordovaConfig.SHOW_FPS){var p=document.createElement("div");p.id="debug_widget",p.style.backgroundColor="#0c0",p.style.position="absolute",p.style.display="block",p.style.top=0,p.style.padding="6px",p.style.zIndex=200,document.body.insertBefore(p,document.body.firstChild),"2"===getQueryString().tgedebug&&(TGE.Window._sTrackWindows=!0);var q=function(){var a=TGE.Game.GetInstance(),b="<div style='font-weight: bold; font-size: 14px; padding-bottom: 3px;'>"+a._mCurrentFPS+" fps</div>";if("2"===getQueryString().tgedebug){b+=(a.stage?a.stage.numChildren(!0):0)+" scene objects<br>"+(a.stage?a.stage.numDrawnObjects():0)+" drawn objects<br>"+(a.stage?a.stage._mUpdateGroup.length:0)+" updating objects<br>",b+="<div style='font-weight: bold; font-size: 14px; padding-top: 4px; padding-bottom: 2px;'>Active Windows:</div>";for(var c=0;c<TGE.Window._sActiveWindows.length;c++)b+=TGE.Window._sActiveWindows[c]+"<br>"}p.innerHTML=b};q(),setInterval(q,500)}return f>0&&g>0?this._initializeRenderer(f,g):this._initializeRenderer(),window.addEventListener("orientationchange",this._onOrientationChanged),window.viewporter&&"function"==typeof viewporter.preventPageScroll&&(viewporter.preventPageScroll=!0),this.canvasWidth>this.canvasHeight&&TGE.BrowserDetect.oniOS&&parseFloat(TGE.BrowserDetect.OSversion)>=7&&-1!==navigator.userAgent.toString().toLowerCase().indexOf("safari")&&-1===navigator.userAgent.toString().toLowerCase().indexOf("crios")&&!navigator.isCocoonJS&&setInterval(this._iOS7FullscreenCheck.bind(this),100),"undefined"!=typeof window.TGS&&TGS.IsReady()&&this._onTGSReady(),this._beginLoad(),!0},_determineCanvasPosition:function(){TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"_determineCanvasPosition"),this.mCanvasPosition=getElementPosition(this.mCanvasDiv)},_onOrientationChanged:function(){TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"_onOrientationChanged called"),window.viewporter&&"function"==typeof viewporter.refresh&&viewporter.refresh()},_onResize:function(){TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"_onResize::_mResizeTimeout: "+this._mResizeTimeout),null!==this._mResizeTimeout&&(clearTimeout(this._mResizeTimeout),this._mResizeTimeout=null),this.onAndroid()?this._mResizeTimeout=setTimeout(this._resizeViewport.bind(this),500):this._resizeViewport()},_iOS7FullscreenCheck:function(){window.innerHeight<320?this._mResizedForiOS7||90!=window.orientation&&-90!=window.orientation||(TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"iOS7 browser chrome appeared - initiating manual resize..."),this._ios7Image=document.createElement("img"),this._ios7Image.src="//sdk.tresensa.com/tge/images/ios7_fullscreen@2x.png",this._ios7Image.style.display="block",this._ios7Image.style.position="absolute",this._ios7Image.style.right=0,this._ios7Image.style.top=0,this._ios7Image.style.width="52px",this._ios7Image.style.height="350px",document.body.insertBefore(this._ios7Image,document.body.firstChild),this._mResizedForiOS7=!0,this._resizeViewport()):this._iOS7HackRemove()},_iOS7HackRemove:function(){this._ios7Image&&(TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"removing iOS7 fullscreen prompt"),this._ios7Image.parentNode.removeChild(this._ios7Image),this._ios7Image=null,this._mResizedForiOS7=!1,this._resizeViewport())},_scaleByResizing:function(a){if(null!==this.stage){TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"resizing game by resizing game div");var b=Math.round(this.stage.width*a*1e3)/1e3,c=Math.round(this.stage.height*a*1e3)/1e3;this.mCanvasDiv.style.width=b+"px",this.mCanvasDiv.style.height=c+"px",this._scaleStage(a)}},_scaleByCSS2D:function(a){TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"resizing game using a 2D CSS transform"),this._mViewportScale=a;var b=this.mCanvasDiv.getAttribute("style")||"";this.mCanvasDiv.setAttribute("style",b+" -ms-transform-origin: 0% 0%; -webkit-transform-origin: 0% 0%; -moz-transform-origin: 0% 0%; -o-transform-origin: 0% 0%; transform-origin: 0% 0%; -ms-transform: scale("+a+"); -webkit-transform: scale("+a+"); -moz-transform: scale("+a+"); -o-transform: scale("+a+"); transform: scale("+a+");"),this._mDivResized=!1},_scaleByCSS3D:function(a){TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"resizing game using a 3D CSS transform");var b=a+","+a;this._mViewportScale=a;var c=this.mCanvasDiv.getAttribute("style")||"";this.mCanvasDiv.setAttribute("style",c+" -webkit-transform: rotateZ(360deg); -ms-transform-origin: left top; -webkit-transform-origin: left top; -moz-transform-origin: left top; -o-transform-origin: left top; transform-origin: left top; -ms-transform: scale("+b+"); -webkit-transform: scale3d("+b+", 1); -moz-transform: scale("+b+"); -o-transform: scale("+b+"); transform: scale("+b+");"),this._mDivResized=!1},_scaleByViewportTag:function(a){if(TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"resizing game by scaling the viewport meta-tag"),!navigator.isCocoonJS){var b=document.querySelector("meta[name=viewport]");b&&b.setAttribute("content","maximum-scale="+a+", minimum-scale="+a+", initial-scale="+a+", user-scalable=no"),this._mDivResized=!1}},_getBrowserWidth:function(){return window.innerWidth?window.innerWidth:document.documentElement&&0!=document.documentElement.clientWidth?document.documentElement.clientWidth:document.body?document.body.clientWidth:0},_getBrowserHeight:function(){return window.innerHeight?window.innerHeight:document.documentElement&&0!=document.documentElement.clientHeight?document.documentElement.clientHeight:document.body?document.body.clientHeight:0},_scaleStage:function(a){this._mViewportScale=a,this._mDivResized=!0,null!==this.stage&&this.stage.setScale(this._mViewportScale),this._determineCanvasPosition()},_centerCanvasDiv:function(a,b,c,d){var e=c?c:this.horizontalAlignment,f=d?d:this.verticalAlignment,g=0;if("center"===e?g=Math.floor(this._getBrowserWidth()/2-a/2):"right"===e&&(g=Math.floor(this._getBrowserWidth()-a)),"none"!==e){this.mCanvasDiv.style.position="absolute",this.mCanvasDiv.style.align="left",this.mCanvasDiv.style.left=g+"px";var h=document.getElementById("viewporter");h&&(h.style.align="left")}var i=0;"middle"===f?i=Math.floor(this._getBrowserHeight()/2-b/2):"bottom"===f&&(i=Math.floor(this._getBrowserHeight()-b)),"none"!==f&&(this.mCanvasDiv.style.position="absolute",this.mCanvasDiv.style.top=i+"px")},_resizeToFit:function(a,b){var c=this.canvasWidth,d=this.canvasHeight,e=a,f=b,g=d>=c,h=f>=e,i=h===g,j=this._determineViewportScale(c,d,e,f);this._scaleByResizing(j);var k=c*j,l=d*j;this._centerCanvasDiv(k,l,"center","top"),this._handleOrientation(i),this._determineCanvasPosition()},_resizeViewport:function(){if(TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"_resizeViewport"),!TGE.DisableViewportResizing){if("undefined"!=typeof window.canvasScale)return TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"_resizeViewport for JSEmbed using stage scaling"),void this._scaleStage(window.canvasScale);var a=this.mCanvasDiv,b=(a.getAttribute("style")||"",this.canvasWidth),c=this.canvasHeight,d=window.innerWidth,e=window.innerHeight;if(this.resizeCanvasToFit){var f=b,g=c,h=TGE.BrowserDetect.isMobileDevice?Number.MAX_VALUE:this.desktopMaxCanvasWidth,i=0,j=TGE.BrowserDetect.isMobileDevice?Number.MAX_VALUE:this.desktopMaxCanvasHeight,k=0,l=TGE.BrowserDetect.isMobileDevice?window.devicePixelRatio:1;b=Math.min(Math.max(d*l,i),h),c=Math.min(Math.max(e*l,k),j),(b!==f||c!==g)&&(TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"resizing canvas to: "+b+"x"+c+"..."),this.mCanvasDiv.style.width=b+"px",this.mCanvasDiv.style.height=c+"px",this.canvasWidth=b,this.canvasHeight=c,this.stage&&(this.stage.setSize(b,c),this.stage.dispatchEvent({type:"resize",width:b,height:c}))),this._mDivResized=!0}TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"_resizeViewport::game size: "+b+"x"+c+", \nscreen size: "+d+"x"+e);var m=c>=b,n=e>=d,o=n===m,p=this._determineViewportScale(b,c,d,e),q=b*p,r=c*p;TGE.BrowserDetect.isMobileDevice?navigator.isCocoonJS?(this._scaleByResizing(p),this._centerCanvasDiv(q,r)):"Kindle Fire"===TGE.BrowserDetect.platform&&"Silk"===TGE.BrowserDetect.browser&&TGE.BrowserDetect.version<=1||"Amazon Web App"===TGE.BrowserDetect.browser&&Math.floor(TGE.BrowserDetect.version)<=533?(this._scaleByResizing(p),this._centerCanvasDiv(q,r)):!this.resizeCanvasToFit&&!this._isiFramed&&"iPhone"===TGE.BrowserDetect.platform&&parseInt(TGE.BrowserDetect.OSversion.charAt(0))<6?(o?(-1===this._miOS5Scale&&(this._miOS5Scale=p),this._scaleByViewportTag(this._miOS5Scale)):this._scaleByViewportTag(1),this._centerCanvasDiv(q,r)):TGE.BrowserDetect.onAndroid&&parseInt(TGE.BrowserDetect.OSversion.charAt(0))<4?(this._scaleByCSS2D(p),this._centerCanvasDiv(q,r)):(this._scaleByCSS3D(p),this._centerCanvasDiv(q,r)):this.scaleToFitOnDesktop?(this._scaleByCSS2D(p),this._centerCanvasDiv(q,r)):this._centerCanvasDiv(b,c),this._handleOrientation(o),this._determineCanvasPosition(),window.viewporter&&"function"==typeof viewporter.refresh&&viewporter.refresh()}},_determineViewportScale:function(a,b,c,d){var e={x:1,y:1};e.x=c/a,e.y=d/b,e.x=Math.ceil(1e3*e.x)/1e3,e.y=Math.ceil(1e3*e.y)/1e3;var f=1;return f=e.x<e.y?e.x:e.y,Math.abs(1-f)<=.01&&(f=1),f},_handleOrientation:function(a){null!==this.mReorientationDiv&&(!TGE.BrowserDetect.isMobileDevice||a?(this.mReorientationDiv.style.display="none",this.mCanvasDiv.style.display="block"):(this.mCanvasDiv.style.display="none",this.mReorientationDiv.style.display="block",this.PauseGame(!0),this.stage.dispatchEvent({type:"deactivate"})))},_onDeactivate:function(){this.PauseGame(!0),this.stage.dispatchEvent({type:"deactivate"}),this.audioManager.Mute()},_initializeRenderer:function(a,b){this.stage=new TGE.Stage(this.mCanvasDiv,a,b)},_beginLoad:function(){this.assetManager.loadAssetList("loading",null,this._loadRequiredAssets.bind(this))},_loadRequiredAssets:function(){null!==this.mScreenManager&&this.mScreenManager.Initialize(this),this._resizeViewport();var a=null;TGE.LoadingWindow?(this.mLoadingScreen=new TGE.LoadingWindow(this.stage.width,this.stage.height),this.mLoadingScreen.show(this.stage)):this.mLoadingScreen=this.showManagedScreen("loading"),null!==this.mLoadingScreen&&(a=this._loadRequiredAssetsCallback.bind(this)),this._update(),this.assetManager.loadAssetList("required",a,this._finishedLoadingRequiredAssets.bind(this))},_loadRequiredAssetsCallback:function(a){null!==this.mLoadingScreen&&(this.mLoadingScreen.handleEvent({type:"progress",percentComplete:a}),"function"==typeof this.mLoadingScreen.UpdateProgress&&this.mLoadingScreen.UpdateProgress(a))},_finishedLoadingRequiredAssets:function(){TGE.Debug.Log(TGE.Debug.LOG_INFO,"finished loading required game assets"),null!==TGE.GameReadyCallback?TGE.GameReadyCallback.call():this.StartGame()},StartGame:function(){TGE.Debug.Log(TGE.Debug.LOG_INFO,"starting game...");var a=Math.round(((new Date).getTime()-this.mLoadingStartTime)/1e3);window.TGS&&TGS.Analytics.logGameEvent("load",a),this._resizeViewport(),this.launchGame()},_update:function(){if(this._mUpdateSkips>0&&this._mUpdateSkips--,!this._mUpdatingEnabled||this._mUpdateSkips>0)return this._mUseRAFHack&&this._mRAFID&&(cancelAnimationFrame(this._mRAFID),this._mRAFID=null),void(this._mRAFID=requestAnimationFrame(this._update.bind(this)));var a=(this._mThisLoop=new Date)-this._mLastLoop;this._mFrameTime+=(a-this._mFrameTime)/this._mFilterStrength,this._mLastLoop=this._mThisLoop,this.updateFPS(),a/=1e3,a=Math.max(this.mMinTickTime,a),a=Math.min(this.mMaxTickTime,a),this.mPaused||(this.mGameTime+=a),null!==this.mScreenManager&&this.mScreenManager.Update(a),this.stage._updateObjectMouseOverStates(this.mMouseX,this.mMouseY);var b={type:"update",elapsedTime:a};if(this.mPaused?null!==this._mPauseScreen&&this._mPauseScreen.dispatchEvent(b):((!this._mUpdateRoot||this._mUpdateRoot.markedForRemoval()||null===this._mUpdateRoot.parent)&&(this._mUpdateRoot=this.stage),this._mUpdateRoot.dispatchEvent(b)),this.stage._emptyTrash(),this.mPlaying&&!this.mPaused&&this.subclassUpdateGame(a),null!==this.mCameraLocation){var c={type:"camerachange",cx:this.mCameraLocation.x,cy:this.mCameraLocation.y};this.stage.dispatchEvent(c)}this._mUseRAFHack&&this._mRAFID&&(cancelAnimationFrame(this._mRAFID),this._mRAFID=null),this._mRAFID=requestAnimationFrame(this._update.bind(this)),this.stage.draw()},launchGame:function(){if(this.stage.removeChildren(),null!==this.onLoad&&this.onLoad.call(this),TGE.FirstGameWindow){var a=new TGE.FirstGameWindow(this.stage.width,this.stage.height);a.setup({}),a.show(this.stage)}else"function"==typeof this.GotoMainMenu&&this.GotoMainMenu(null!==this.onLoad?!1:!0);this._mGameStarted=!0},_onTGSDatastoreUpdated:function(){this.onTGSDatastoreUpdated(),this.stage.dispatchEvent({type:"tgs_data_updated"})},_onTGSUserChanged:function(){this.onTGSUserChanged(),this.stage.dispatchEvent({type:"tgs_user_changed"})},_onTGSReady:function(){this.onTGSReady(),this._onTGSDatastoreUpdated()},onTGSReady:function(){},onTGSDatastoreUpdated:function(){},onTGSUserChanged:function(){},Launch:function(a,b){null===this.analytics&&null!=this.mAnalytics&&(this.analytics=this.mAnalytics),this.launch("string"==typeof a?{gameDiv:a,reorientDiv:b}:a)},LoadLevelAssets:function(a,b,c){this.assetManager.loadAssetList("level_"+a.toString(),b,c)},StartLevel:function(a){a==this.mCurrentLevel;this.mCurrentLevel=a,this.subclassSetupLevel(this.mCurrentLevel),(!this.mPlaying||this.mPaused)&&this.StartPlaying()},FinishLevel:function(){this.subclassFinishLevel()},Replay:function(){this.StartLevel(this.mCurrentLevel)},StartPlaying:function(){this.mGameTime=0,this.mPaused=!1,this.mPlaying=!0,"undefined"!=typeof window.TGS&&TGS.EnablePartnerUI(!1),this.subclassStartPlaying()},clearScene:function(){this.mCameraLocation=new TGE.Point,this.stage.removeChildren(),this.SetupLayers(),null!==this.mScreenManager&&this.mScreenManager.Initialize(this);var a=this.assetManager.getImage("pause_button",!1);if(null!=a&&a.width>0){var b=Math.max(a.width,a.height);this.pauseButton=(new TGE.Button).setup({x:this.Width()-b/2,y:b/2,image:"pause_button"}),this.getLayer("ScreenManager").addChild(this.pauseButton),this.EnableUserPause()}},SetupLayers:function(){this.mLayers={},this.CreateLayer("TGE_default"),this.subclassSetupLayers()},ShowScreen:function(a){return null!==this.mScreenManager?this.mScreenManager.ShowScreen(a):null},GotoMainMenu:function(a){a="undefined"==typeof a?!0:a,this.mPaused=!1,this.mPlaying=!1,a&&this.clearScene(),TGE.FirstGameWindow?this.stage.addChild(new TGE.FirstGameWindow(this.stage.width,this.stage.height).setup({})):null===this.showManagedScreen("mainmenu")&&this.StartPlaying(),"undefined"!=typeof window.TGS&&TGS.IsOn()&&!TGS.IsReady()&&this.showManagedScreen("tgsconnect")},PauseGame:function(a){var b=null!=this._mDeprecatedScreens.pause||null!=this._mRegisteredScreens.pause;this.mPlaying&&a!==this.mPaused&&b&&(this.mPaused=a,this._determineCanvasPosition(),this.mPaused?(this._mDeprecatedScreens.pause&&null!==this.mScreenManager?this.ShowScreen(this._mDeprecatedScreens.pause,!1):null!=this._mRegisteredScreens.pause&&(this._mPauseScreen=this.showManagedScreen("pause")),this.DisableUserPause()):(this._mDeprecatedScreens.pause&&null!==this.mScreenManager?this.mScreenManager.CloseScreen(this._mDeprecatedScreens.pause):null!==this._mPauseScreen&&this._mPauseScreen.close(),this.EnableUserPause()),"undefined"!=typeof window.TGS&&TGS.EnablePartnerUI(this.mPaused))},DisableUserPause:function(){this._mUserPauseEnabled=!1,null!==this.pauseButton&&(this.pauseButton.visible=!1)},EnableUserPause:function(){this._mUserPauseEnabled=!0,null!==this.pauseButton&&(this.pauseButton.visible=!0)},SetConstantTickTime:function(a){this.mMinTickTime=this.mMaxTickTime=a},setBackgroundColor:function(a){this.stage.backgroundColor=a},CreateLayer:function(a){var b=new TGE.DisplayObjectContainer;this.mLayers[a]=b,b.registrationX=0,b.registrationY=0,b.width=this.stage.width,b.height=this.stage.height,b.instanceName=a,this.stage.addChild(b)},getLayer:function(a){var b="TGE_default"in this.mLayers?this.mLayers.TGE_default:this.stage;return null!=a&&a in this.mLayers&&(b=this.mLayers[a]),b},ShowFramerateDisplay:function(){},updateFPS:function(){var a=this._mThisLoop-this._mLastDisplay;500>a||(this._mLastDisplay=this._mThisLoop,this._mFrameTime>0&&(this._mCurrentFPS=Math.floor(1e3/this._mFrameTime).toFixed(0)))},EndGame:function(){this.mPlaying&&(this.mPlaying=!1,"undefined"!=typeof window.TGS&&TGS.EnablePartnerUI(!0),this.DisableUserPause(),this.subclassEndGame(),this.showManagedScreen("gameover"))},CurrentLevel:function(){return this.mCurrentLevel},_reactivateGame:function(){null===this._mRAFID&&(this._mRAFID=requestAnimationFrame(this._update.bind(this))),this._mUpdatingEnabled=!0},_processMousePosition:function(a){null===this.mCanvasPosition&&this._determineCanvasPosition(),this.mMouseX=a.pageX,this.mMouseY=a.pageY,a.touches&&(this.mMouseX=a.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.mMouseY=a.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop),this.mMouseX-=this.mCanvasPosition.x,this.mMouseY-=this.mCanvasPosition.y,this.mMouseX/=this._mViewportScale,this.mMouseY/=this._mViewportScale},_preventBehavior:function(a){a.stopPropagation(),a.preventDefault()},_mouseDown:function(a){return navigator.isCocoonJS||window.focus(),this._reactivateGame(),!this._mTrackedFirstInteraction&&this._mGameStarted&&(window.TGS&&TGS.Analytics.logScreen("first-interaction"),this._mTrackedFirstInteraction=!0),this._processMousePosition(a),this.mMouseDown=!0,this._mUserPauseEnabled&&null!==this.pauseButton&&this.mGameTime>.5&&Math.abs(this.mMouseX-this.pauseButton.x)<this.pauseButton.width/2&&Math.abs(this.mMouseY-this.pauseButton.y)<this.pauseButton.height/2?void this.PauseGame(!0):(this.stage._notifyObjectsOfMouseEvent("down",this.mMouseX,this.mMouseY),this.mPaused||this.subclassMouseDown(),a.stopPropagation(),void a.preventDefault())},_mouseUp:function(a){this.mMouseDown=!1,this.stage._notifyObjectsOfMouseEvent("up",this.mMouseX,this.mMouseY),this.mPaused||this.subclassMouseUp(),a.stopPropagation(),a.preventDefault()},_mouseMove:function(a){this._processMousePosition(a),this.stage._notifyObjectsOfMouseEvent("move",this.mMouseX,this.mMouseY),this.mPaused||this.subclassMouseMove(),a.stopPropagation(),a.preventDefault()},MouseX:function(){return this.mMouseX},MouseY:function(){return this.mMouseY},isMouseDown:function(){return this.mMouseDown},_keyDown:function(a){this.mKeysDown[a.keyCode]=!0,this.stage._notifyObjectsOfKeyEvent("keydown",a.keyCode),this.subclassKeyDown(a.keyCode),[8,32,37,38,39,40].indexOf(a.keyCode)>-1&&a.preventDefault()},_keyUp:function(a){this.mKeysDown[a.keyCode]=!1,this.stage._notifyObjectsOfKeyEvent("keyup",a.keyCode),this.subclassKeyUp(a.keyCode),[8,32,37,38,39,40].indexOf(a.keyCode)>-1&&a.preventDefault()},isKeyDown:function(a){return this.mKeysDown[a]===!0},Width:function(){return this.stage.width},Height:function(){return this.stage.height},GameTime:function(){return this.mGameTime},CameraLocation:function(){return this.mCameraLocation},ScreenX:function(a){return this.stage.width/2+(a-this.mCameraLocation.x)},ScreenY:function(a){return this.stage.height/2-(a-this.mCameraLocation.y)},GetImage:function(a){return this.assetManager.getImage(a)},OpenURL:function(a){TGE.Game.OpenURL(a)},PlayGame:function(){this.subclassPlayGame()},subclassSetupLayers:function(){},subclassPlayGame:function(){this.StartLevel(-1)},subclassSetupLevel:function(){},subclassStartPlaying:function(){},subclassFinishLevel:function(){},subclassUpdateGame:function(){},subclassEndGame:function(){},subclassMouseMove:function(){},subclassMouseDown:function(){},subclassMouseUp:function(){},subclassKeyDown:function(){},subclassKeyUp:function(){},AnalyticGameEvent:function(a,b){null!==this.analytics&&this.analytics.logGameEvent(a,this.mCurrentLevel,b)},AnalyticShareEvent:function(a){null!==this.analytics&&this.analytics.logShareEvent(a,this.mCurrentLevel)},AnalyticLevelEvent:function(a){null!==this.analytics&&this.analytics.logLevelEvent(a,this.mCurrentLevel,Math.floor(this.mGameTime))},AnalyticAchievementEvent:function(a,b){null!==this.analytics&&this.analytics.logAchievementEvent(a,this.mCurrentLevel,b)},AnalyticErrorEvent:function(a){null!==this.analytics&&this.analytics.logErrorEvent(a)},AnalyticClickThruEvent:function(a){null!==this.analytics&&this.analytics.logClickThruEvent(a,this.mCurrentLevel)},AnalyticMoreGamesEvent:function(a){null!==this.analytics&&this.analytics.logMoreGamesEvent(a,this.mCurrentLevel)},AnalyticCustomEvent:function(a,b){null!==this.analytics&&this.analytics.logCustomEvent(a,this.mCurrentLevel,b)},AnalyticVirtualPageView:function(a){null!==this.analytics&&this.analytics.logVirtualPageView(a)},ClearScene:function(){this.clearScene()},IsMouseDown:function(){return this.mMouseDown},CreateWorldEntity:function(a){var b=new a;return a.prototype.constructor.apply(b,[this]),b.stage=this.stage,b},CreateUIEntity:function(a){var b=new a;return a.prototype.constructor.apply(b,[this]),b.stage=this.stage,b},SetBackgroundColor:function(a){this.stage.backgroundColor=a}},TGE.KEY_ARROW_LEFT=37,TGE.KEY_ARROW_RIGHT=39,TGE.KEY_ARROW_UP=38,TGE.KEY_ARROW_DOWN=40,TGE.KEY_SPACEBAR=32,TGE.AssetLoader=function(){return this.mAssetList=null,this.mUpdateCallback=null,this.mCompleteCallback=null,this},TGE.AssetLoader.prototype={loadAssetList:function(a,b,c,d,e){if(0===b.list.length)return null!==d&&d(1),void(null!==e&&e.call());if(!window.PxLoader)return void TGE.Debug.Log(TGE.Debug.LOG_ERROR,"the PxLoader libraries must be included to use TGE.AssetLoader");c="string"==typeof c?c:"",c.length>0&&"/"!==c.charAt(c.length-1)&&(c=c.concat("/"));var f=TGE.Game.GetInstance();f._sConfig||TGE.Debug.Log(TGE.Debug.LOG_WARNING,"attempting to call TGE.AssetLoader.loadAssets before game is launched - could cause problems with native builds");var g=f._sConfig&&f._sConfig.imageRoot||c,h=f._sConfig&&f._sConfig.audioRoot||c;this.mAssetList=b,this.mUpdateCallback=d,this.mCompleteCallback=e;var j=new PxLoader({statusInterval:3e3}),k=0,l=TGE.BrowserDetect.onAndroid&&(-1!==navigator.userAgent.toString().indexOf("HTC_PN07120")||-1!==navigator.userAgent.toString().indexOf("HTC One")),m=a.loadAudio&&!l;if(l&&TGE.Debug.Log(TGE.Debug.LOG_WARNING,"ignoring audio assets on HTC One"),null!==b&&b.list.length>0&&b.loaded===!1){for(i=0;i<b.list.length;i++)if(!a._mImageCache[b.list[i].id]){var n=!(b.list[i].absolutePath===!0),o=null;if("script"===b.list[i].assetType)j.addScript(b.list[i].url);else if("audio"===b.list[i].assetType){if(m){var p=n?h:"";o=j.addAudio(b.list[i].id,p+b.list[i].url,p+b.list[i].backup_url,null,null),k++}}else if("audio_sprite"===b.list[i].assetType)m&&(o={assetType:"audio_sprite",id:b.list[i].sprite,startTime:b.list[i].startTime,endTime:b.list[i].endTime});else{var p=n?g:"";if(a.useSpriteSheets&&b.list[i].sheet){var q=b.list[i].sheet,r=a._mSpriteSheets[q];r||(r=j.addImage(p+b.list[i].sheet),null!==r&&a.addImage(b.list[i].id,r),a._mSpriteSheets[b.list[i].sheet]=r);var s=TGE.AssetManager.SpriteSheets[trimmedFilename(q)];if(s){var t=s[trimmedFilename(b.list[i].url)];t&&(o={spriteSheet:r,x:t[0],y:t[1],width:t[2],height:t[3]},t.length>4&&(o.offsetX=t[4],o.offsetY=t[5],o.drawWidth=o.width,o.drawHeight=o.height,t.length>6&&(o.width=t[6],o.height=t[7])))}}else o=j.addImage(p+b.list[i].url)}null!==o&&a.addImage(b.list[i].id,o)}j.addProgressListener(TGE.AssetLoader.prototype._loaderCallback.bind(this)),j.addCompletionListener(TGE.AssetLoader.prototype._completeCallback.bind(this)),j.start()}else null!==this.mUpdateCallback&&this.mUpdateCallback(1),null!==this.mCompleteCallback&&this.mCompleteCallback.call()},_loaderCallback:function(a){if(a.error&&TGE.Debug.Log(TGE.Debug.LOG_ERROR,"could not load image '"+a.resource.getName()+"'"),null!==this.mUpdateCallback){var b=a.completedCount/a.totalCount;this.mUpdateCallback(b)}},_completeCallback:function(){null!==this.mAssetList&&(this.mAssetList.loaded=!0,this.mAssetList=null),null!==this.mCompleteCallback&&this.mCompleteCallback()}},TGE.AssetManager=function(a){return null!==TGE.AssetManager.sAssetManagerInstance?TGE.AssetManager.sAssetManagerInstance:(TGE.AssetManager.sAssetManagerInstance=this,void 0===a&&(a=!0),this._rootLocation=window.GameConfig&&GameConfig.CDN_ROOT?GameConfig.CDN_ROOT:"",this.useSpriteSheets=!0,this.loadAudio=a,this._mSpriteSheets={},this.assignImageAssetList("loading",[]),this.assignImageAssetList("required",[]),this)},TGE.AssetManager.SpriteSheets={},TGE.AssetManager.sAssetManagerInstance=null,TGE.AssetManager.GetImage=function(a){return null===TGE.AssetManager.sAssetManagerInstance?null:TGE.AssetManager.sAssetManagerInstance.getImage(a)},TGE.AssetManager.Exists=function(a){return null===TGE.AssetManager.sAssetManagerInstance?!1:null!==TGE.AssetManager.sAssetManagerInstance.getImage(a,!1)},TGE.AssetManager.prototype={_mImageAssetLists:[],_mImageCache:[],assignImageAssetList:function(a,b){this._mImageAssetLists[a]={loaded:!1,list:b}},addAssets:function(a,b){this._mImageAssetLists.hasOwnProperty(a)||(this._mImageAssetLists[a]={loaded:!1,list:[]}),this._mImageAssetLists[a].list=this._mImageAssetLists[a].list.concat(b)},addAsset:function(a,b){this._mImageAssetLists.hasOwnProperty(a)||(this._mImageAssetLists[a]={loaded:!1,list:[]}),this._mImageAssetLists[a].list.push(b)},loadAssetList:function(a,b,c){var d=new TGE.AssetLoader,e=this._mImageAssetLists[a];e?e.loaded===!0?(b&&b.call(1),c&&c.call()):d.loadAssetList(this,e,this._rootLocation,b,c):(TGE.Debug.Log(TGE.Debug.LOG_VERBOSE,"TGE.AssetManager could not locate asset list '"+a+"'"),c&&c.call())},addImage:function(a,b){this._mImageCache[a]=b},getImage:function(a,b){b="undefined"==typeof b?!0:b;var c=this._mImageCache[a];return b&&null!=a&&!c&&TGE.Debug.Log(TGE.Debug.LOG_ERROR,"TGE.AssetManager.getImage could not find the asset '"+a+"'"),c||null
},addSheetImagesToAssetList:function(a,b){var c=TGE.AssetManager.SpriteSheets[trimmedFilename(b)];if(!c)return void TGE.Debug.Log(TGE.Debug.LOG_ERROR,"TGE.AssetManager.AddSheetImagesToAssetList could not locate sheet '"+b+"'");var d=this._mImageAssetLists[a];if(!d)return void TGE.Debug.Log(TGE.Debug.LOG_ERROR,"TGE.AssetManager.AddSheetImagesToAssetList could not locate asset list '"+a+"'");for(var e in c)c.hasOwnProperty(e)&&d.list.push({id:e,url:e+".png",sheet:b})},dumpAssetsToString:function(a){var b="",c=[];for(var d in this._mImageAssetLists)if(this._mImageAssetLists.hasOwnProperty(d)){var e=this._mImageAssetLists[d];for(i=0;i<e.list.length;i++){var f=e.list[i];if(f.absolutePath!==!0){var g="assets-"+GameConfig.VERSION+"/"+("string"==typeof f.sheet?f.sheet:f.url),h=!0;for(u=0;u<c.length&&h;u++)c[u]===g&&(h=!1);h&&(b+=g,b+=a,c.push(g),"audio"===f.assetType&&(g="assets-"+GameConfig.VERSION+"/"+f.backup_url,b+=g,b+=a))}}}return b}},function(){var a=function(a){TGE.Debug.Log(TGE.Debug.LOG_WARNING,"TGE.GoogleAnalytics is deprecated, use TGS.Analytics."+a+" instead.")};TGE.GoogleAnalytics=function(){},TGE.GoogleAnalytics.prototype={logGameEvent:function(b,c,d){a("logGameEvent"),window.TGS&&TGS.Analytics.logGameEvent(b,d)},logShareEvent:function(b){a("logShareEvent"),window.TGS&&TGS.Analytics.logShareEvent(b)},logLevelEvent:function(b,c,d){a("logLevelEvent"),window.TGS&&TGS.Analytics.logLevelEvent(b,c,d)},logAchievementEvent:function(b,c,d){a("logAchievementEvent"),window.TGS&&TGS.Analytics.logAchievementEvent(b,d)},logErrorEvent:function(b){a("_logErrorEvent"),window.TGS&&TGS.Analytics._logErrorEvent(b)},logClickThruEvent:function(b){a("_logClickThruEvent"),window.TGS&&TGS.Analytics._logClickThruEvent(b)},logMoreGamesEvent:function(b){a("_logMoreGamesEvent"),window.TGS&&TGS.Analytics._logMoreGamesEvent(b)},logCustomEvent:function(b,c,d){a("logCustomEvent"),window.TGS&&TGS.Analytics.logCustomEvent(b,d)},logVirtualPageView:function(b){a("logScreen"),window.TGS&&TGS.Analytics.logScreen(b)}},TGE.TGSAnalyticsBridge=TGE.GoogleAnalytics}(),function(){var a=function(){TGE.Debug.Log(TGE.Debug.LOG_WARNING,"TGE.Advertisement is deprecated, use TGS.Advertisement instead.")};TGE.Advertisement={DisplayAd:function(b){return a(),TGS.Advertisement.DisplayAd(b)},DisplayModalOverlayAd:function(b){return a(),TGS.Advertisement.DisplayInterstitialAd(b)},DisplayChildBrowserAd:function(b){return a(),TGS.Advertisement.DisplayInterstitialAd(b)}}}(),TGE.Tween=function(){this.target=null,this.duration=1,this.easing=TGE.Tween.Linear,this.delay=0,this.loop=!1,this.rewind=!1,this.onComplete=null,this.startFromEnd=!1,this._mAge=0,this._mForward=!0,this._mSetup=!1,this._mFinished=!1,this._mStartValues={},this._mEndValues={},this._mChainedTweens=[],this._mEaseParam=0,this._mRepeats=-1},TGE.Tween.prototype={setup:function(a){for(var b in a)this.hasOwnProperty(b)?this[b]=a[b]:this._mEndValues[b]=a[b];return this.easing===TGE.Tween.Back.In||this.easing===TGE.Tween.Back.Out||this.easing===TGE.Tween.Back.InOut?this._mEaseParam=a.easingParam?a.easingParam:1.70158:(this.easing===TGE.Tween.Elastic.In||this.easing===TGE.Tween.Elastic.Out||this.easing===TGE.Tween.Elastic.InOut)&&(this._mEaseParam=a.easingParam?a.easingParam:1),"number"==typeof a.loop&&(this._mRepeats=2*a.loop),this.startFromEnd&&this._setupValues(),this},finished:function(){return this._mFinished},thenTweenTo:function(a){a.target=this.target;var b=(new TGE.Tween).setup(a);return this._mChainedTweens.push(b),b},_setupValues:function(){if(!this._mSetup){for(var a in this._mEndValues)this.target.hasOwnProperty(a)&&(this._mStartValues[a]=this.target[a]);if(this.startFromEnd){var b=this._mStartValues;this._mStartValues=this._mEndValues,this._mEndValues=b;for(var a in this._mStartValues)this.target.hasOwnProperty(a)&&(this.target[a]=this._mStartValues[a])}this._mSetup=!0}},_lastTweenInChain:function(){return this._mChainedTweens.length>0&&!this._mChainedTweens[0].finished()?this._mChainedTweens[0]._lastTweenInChain():this},_update:function(a){if(!(this.finished()||(this._mAge+=a,this._mAge<this.delay))){this._mSetup||this._setupValues();var b=(this._mAge-this.delay)/this.duration;b>=1&&(this.loop===!0||this._mRepeats>=2?(this._mAge=this._mAge-this.duration,b-=1,this.rewind&&(this._mForward=!this._mForward),this._mRepeats--):(this._mFinished=!0,b=1));var c=this.easing(b,this._mEaseParam);c=this._mForward?c:1-c;for(var d in this._mStartValues)if(this.target.hasOwnProperty(d)){var e=this._mStartValues[d],f=this._mEndValues[d];this.target[d]=e+(f-e)*c}if(this._mFinished){if(this._mChainedTweens.length>0){for(var g=0;g<this._mChainedTweens.length;g++)this.target._injectTween(this._mChainedTweens[g]);this._mChainedTweens=null}null!==this.onComplete&&this.onComplete()}}}},TGE.Tween.Linear=function(a){return a},TGE.Tween.Quadratic={In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}},TGE.Tween.Cubic={In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}},TGE.Tween.Quartic={In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},TGE.Tween.Quintic={In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},TGE.Tween.Sine={In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},TGE.Tween.Exponential={In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},TGE.Tween.Circular={In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},TGE.Tween.Elastic={In:function(a,b){return-(b*Math.pow(2,10*(a-=1))*Math.sin(2*(a-.3/(2*Math.PI)*(Math.asin(1/b)||0))*Math.PI/.3))},Out:function(a,b){return b*Math.pow(2,-10*a)*Math.sin(2*(a-.3/(2*Math.PI)*(Math.asin(1/b)||0))*Math.PI/.3)+1},InOut:function(a,b){var c=.3/(2*Math.PI)*(Math.asin(1/b)||0),d=2*Math.PI;return(a*=2)<1?-.5*b*Math.pow(2,10*(a-=1))*Math.sin((a-c)*d/.45):b*Math.pow(2,-10*(a-=1))*Math.sin((a-c)*d/.45)*.5+1}},TGE.Tween.Back={In:function(a,b){return a*a*((b+1)*a-b)},Out:function(a,b){return(a-=1)*a*((b+1)*a+b)+1},InOut:function(a,b){var c=1.525*b;return(a*=2)<1?.5*a*a*((c+1)*a-c):.5*((a-=2)*a*((c+1)*a+c)+2)}},TGE.Tween.Bounce={In:function(a){return 1-TGE.Tween.Bounce.Out(1-a)},Out:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TGE.Tween.Bounce.In(2*a):.5*TGE.Tween.Bounce.Out(2*a-1)+.5}},TGE.CameraShake=function(){this.target=null,this.duration=1,this.delay=0,this.loop=!1,this.exclusionList=[],this.onComplete=null,this._mPreviousX=0,this._mPreviousY=0,this._mX=0,this._mY=0,this._mTimeElapsed=0,this._mFinished=!1},TGE.CameraShake.prototype={setup:function(a){return this.target=a.target,"number"==typeof a.duration?this.duration=a.duration:1,"number"==typeof a.delay?this.delay=a.delay:0,"boolean"==typeof a.loop?this.loop=a.loop:!1,Array.isArray(a.exclusionList)?this.exclusionList=a.exclusionList:[],"function"==typeof a.onComplete?this.onComplete=a.onComplete:null,this},finished:function(){return this._mFinished},updateMembers:function(){console.log("updateMembers should be overridden by a subclass")},stop:function(){if(this.target.x-=this._mX,this.target.y-=this._mY,null!=this.exclusionList&&this.exclusionList.length>0)for(var a=0;a<this.target.numChildren(!1);a++){var b=this.target.getChildAt(a);-1!=this.exclusionList.indexOf(b.cameraShakeTag)&&(b.x+=this._mX,b.y+=this._mY)}this._mFinished=!0},_update:function(a){if(!(this._mFinished||(this._mTimeElapsed+=a,this._mTimeElapsed<this.delay))){this.updateMembers(a);var b=this._mX-this._mPreviousX,c=this._mY-this._mPreviousY;if(this.target.x+=b,this.target.y+=c,null!=this.exclusionList&&this.exclusionList.length>0)for(var d=0;d<this.target.numChildren(!1);d++){var e=this.target.getChildAt(d);-1!=this.exclusionList.indexOf(e.cameraShakeTag)&&(e.x-=b,e.y-=c)}this._mFinished&&null!=this.onComplete&&this.onComplete()}}},TGE.NoiseShake=function(){TGE.NoiseShake.superclass.constructor.call(this),this.intensityX=0,this.intensityY=0,this.easeInTime=0,this.easeOutTime=0,this.period=-1,this._mPeriodsExecuted=0,this._mIntensityX=0,this._mIntensityY=0},TGE.NoiseShake.prototype={setup:function(a){return TGE.NoiseShake.superclass.setup.call(this,a),"number"==typeof a.intensity&&(this.intensityX=a.intensity,this.intensityY=a.intensity),"number"==typeof a.intensityX?this.intensityX=a.intensityX:this.intensityX,"number"==typeof a.intensityY?this.intensityY=a.intensityY:this.intensityY,"number"==typeof a.period?this.period=a.period:this.period,"number"==typeof a.easeInTime?this.easeInTime=a.easeInTime:this.easeInTime,"number"==typeof a.easeOutTime?this.easeOutTime=a.easeOutTime:this.easeOutTime,this},updateMembers:function(){if(this._mPreviousX=this._mX,this._mPreviousY=this._mY,this._mTimeElapsed>this.delay+this.duration)this._mX=0,this._mY=0,this.loop?this._mTimeElapsed=this.delay:this._mFinished=!0;else{if(this._mTimeElapsed-this.delay<this.easeInTime)this._mIntensityX=this.intensityX*((this._mTimeElapsed-this.delay)/this.easeInTime),this._mIntensityY=this.intensityY*((this._mTimeElapsed-this.delay)/this.easeInTime);else if(this._mTimeElapsed-this.delay>this.duration-this.easeOutTime){var a=this._mTimeElapsed-this.delay-(this.duration-this.easeOutTime);this._mIntensityX=this.intensityX-this.intensityX*(a/this.easeOutTime),this._mIntensityY=this.intensityY-this.intensityY*(a/this.easeOutTime)}else this._mIntensityX=this.intensityX,this._mIntensityY=this.intensityY;this._mTimeElapsed>this._mPeriodsExecuted*this.period&&(this._mX=Math.random()*this._mIntensityX*this.target.width*2-this._mIntensityX*this.target.width,this._mY=Math.random()*this._mIntensityY*this.target.width*2-this._mIntensityY*this.target.width,this._mPeriodsExecuted++)}}},extend(TGE.NoiseShake,TGE.CameraShake),TGE.SpringShake=function(){TGE.SpringShake.superclass.constructor.call(this),this.initialDeflectionX=0,this.initialDeflectionY=0,this.initialVelocityX=0,this.initialVelocityY=0,this.mass=0,this.springConstant=0,this.dampingConstant=0,this.finishThreshold=5,this._mAccelerationX=0,this._mAccelerationY=0,this._mVelocityX=0,this._mVelocityY=0,this._mInitiallyDeflected=!1},TGE.SpringShake.prototype={setup:function(a){return TGE.SpringShake.superclass.setup.call(this,a),"number"==typeof a.initialDeflection&&(this.initialDeflectionX=a.initialDeflection,this.initialDeflectionY=a.initialDeflection),"number"==typeof a.initialDeflectionX?this.initialDeflectionX=a.initialDeflectionX:this.initialDeflectionX,"number"==typeof a.initialDeflectionY?this.initialDeflectionY=a.initialDeflectionY:this.initialDeflectionY,"number"==typeof a.initialVelocity&&(this.initialVelocityX=a.initialVelocity,this.initialVelocityY=a.initialVelocity),"number"==typeof a.initialVelocityX?this.initialVelocityX=a.initialVelocityX:this.initialVelocityX,"number"==typeof a.initialVelocityY?this.initialVelocityY=a.initialVelocityY:this.initialVelocityY,"number"==typeof a.mass?this.mass=a.mass:this.mass,"number"==typeof a.springConstant?this.springConstant=a.springConstant:this.springConstant,"number"==typeof a.dampingConstant?this.dampingConstant=a.dampingConstant:this.dampingConstant,"number"==typeof a.finishThreshold?this.finishThreshold=a.finishThreshold:this.finishThreshold,this},updateMembers:function(a){a=Math.min(a,.03),this._mPreviousX=this._mX,this._mPreviousY=this._mY,0==this._mInitiallyDeflected?(this._mX=this.initialDeflectionX,this._mY=this.initialDeflectionY,this._mVelocityX=this.initialVelocityX,this._mVelocityY=this.initialVelocityY,this._mInitiallyDeflected=!0):(this._mVelocityX+=this._mAccelerationX*a,this._mVelocityY+=this._mAccelerationY*a,this._mX+=this._mVelocityX*a,this._mY+=this._mVelocityY*a,this._mAccelerationX=-(this.springConstant*this._mX+this.dampingConstant*this._mVelocityX)/this.mass,this._mAccelerationY=-(this.springConstant*this._mY+this.dampingConstant*this._mVelocityY)/this.mass),Math.abs(this._mAccelerationX)<=this.finishThreshold&&Math.abs(this._mAccelerationY)<=this.finishThreshold&&Math.abs(this._mVelocityX)<=this.finishThreshold&&Math.abs(this._mVelocityY)<=this.finishThreshold&&Math.abs(this._mX)<=this.finishThreshold&&Math.abs(this._mY)<=this.finishThreshold&&(this._mX=0,this._mY=0,this.loop?this._mInitiallyDeflected=!1:this._mFinished=!0)}},extend(TGE.SpringShake,TGE.CameraShake);TGE.version = '1.0.21';
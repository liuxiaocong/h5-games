// Generated by Construct 2, the HTML5 game and app creator :: http://www.scirra.com
var cr = {};
cr.plugins_ = {};
cr.behaviors = {};
if (typeof Object.getPrototypeOf !== "function") {
    if (typeof "test".__proto__ === "object") {
        Object.getPrototypeOf = function(object) {
            return object.__proto__;
        };
    } else {
        Object.getPrototypeOf = function(object) {
            return object.constructor.prototype;
        };
    }
}
(function() {
    cr.logexport = function(msg) {
        if (window.console && window.console.log)
            window.console.log(msg);
    };
    cr.seal = function(x) {
        return x;
    };
    cr.freeze = function(x) {
        return x;
    };
    cr.is_undefined = function(x) {
        return typeof x === "undefined";
    };
    cr.is_number = function(x) {
        return typeof x === "number";
    };
    cr.is_string = function(x) {
        return typeof x === "string";
    };
    cr.isPOT = function(x) {
        return x > 0 && ((x - 1) & x) === 0;
    };
    cr.nextHighestPowerOfTwo = function(x) {
        --x;
        for (var i = 1; i < 32; i <<= 1) {
            x = x | x >> i;
        }
        return x + 1;
    }
    cr.abs = function(x) {
        return (x < 0 ? -x : x);
    };
    cr.max = function(a, b) {
        return (a > b ? a : b);
    };
    cr.min = function(a, b) {
        return (a < b ? a : b);
    };
    cr.PI = Math.PI;
    cr.round = function(x) {
        return (x + 0.5) | 0;
    };
    cr.floor = function(x) {
        if (x >= 0)
            return x | 0;
        else
            return (x | 0) - 1; // correctly round down when negative
    };
    cr.ceil = function(x) {
        var f = x | 0;
        return (f === x ? f : f + 1);
    };

    function Vector2(x, y) {
        this.x = x;
        this.y = y;
        cr.seal(this);
    };
    Vector2.prototype.offset = function(px, py) {
        this.x += px;
        this.y += py;
        return this;
    };
    Vector2.prototype.mul = function(px, py) {
        this.x *= px;
        this.y *= py;
        return this;
    };
    cr.vector2 = Vector2;
    cr.segments_intersect = function(a1x, a1y, a2x, a2y, b1x, b1y, b2x, b2y) {
        var max_ax, min_ax, max_ay, min_ay, max_bx, min_bx, max_by, min_by;
        if (a1x < a2x) {
            min_ax = a1x;
            max_ax = a2x;
        } else {
            min_ax = a2x;
            max_ax = a1x;
        }
        if (b1x < b2x) {
            min_bx = b1x;
            max_bx = b2x;
        } else {
            min_bx = b2x;
            max_bx = b1x;
        }
        if (max_ax < min_bx || min_ax > max_bx)
            return false;
        if (a1y < a2y) {
            min_ay = a1y;
            max_ay = a2y;
        } else {
            min_ay = a2y;
            max_ay = a1y;
        }
        if (b1y < b2y) {
            min_by = b1y;
            max_by = b2y;
        } else {
            min_by = b2y;
            max_by = b1y;
        }
        if (max_ay < min_by || min_ay > max_by)
            return false;
        var dpx = b1x - a1x + b2x - a2x;
        var dpy = b1y - a1y + b2y - a2y;
        var qax = a2x - a1x;
        var qay = a2y - a1y;
        var qbx = b2x - b1x;
        var qby = b2y - b1y;
        var d = cr.abs(qay * qbx - qby * qax);
        var la = qbx * dpy - qby * dpx;
        if (cr.abs(la) > d)
            return false;
        var lb = qax * dpy - qay * dpx;
        return cr.abs(lb) <= d;
    };

    function Rect(left, top, right, bottom) {
        this.set(left, top, right, bottom);
        cr.seal(this);
    };
    Rect.prototype.set = function(left, top, right, bottom) {
        this.left = left;
        this.top = top;
        this.right = right;
        this.bottom = bottom;
    };
    Rect.prototype.copy = function(r) {
        this.left = r.left;
        this.top = r.top;
        this.right = r.right;
        this.bottom = r.bottom;
    };
    Rect.prototype.width = function() {
        return this.right - this.left;
    };
    Rect.prototype.height = function() {
        return this.bottom - this.top;
    };
    Rect.prototype.offset = function(px, py) {
        this.left += px;
        this.top += py;
        this.right += px;
        this.bottom += py;
        return this;
    };
    Rect.prototype.normalize = function() {
        var temp = 0;
        if (this.left > this.right) {
            temp = this.left;
            this.left = this.right;
            this.right = temp;
        }
        if (this.top > this.bottom) {
            temp = this.top;
            this.top = this.bottom;
            this.bottom = temp;
        }
    };
    Rect.prototype.intersects_rect = function(rc) {
        return !(rc.right < this.left || rc.bottom < this.top || rc.left > this.right || rc.top > this.bottom);
    };
    Rect.prototype.intersects_rect_off = function(rc, ox, oy) {
        return !(rc.right + ox < this.left || rc.bottom + oy < this.top || rc.left + ox > this.right || rc.top + oy > this.bottom);
    };
    Rect.prototype.contains_pt = function(x, y) {
        return (x >= this.left && x <= this.right) && (y >= this.top && y <= this.bottom);
    };
    Rect.prototype.equals = function(r) {
        return this.left === r.left && this.top === r.top && this.right === r.right && this.bottom === r.bottom;
    };
    cr.rect = Rect;

    function Quad() {
        this.tlx = 0;
        this.tly = 0;
        this.trx = 0;
        this.try_ = 0; // is a keyword otherwise!
        this.brx = 0;
        this.bry = 0;
        this.blx = 0;
        this.bly = 0;
        cr.seal(this);
    };
    Quad.prototype.set_from_rect = function(rc) {
        this.tlx = rc.left;
        this.tly = rc.top;
        this.trx = rc.right;
        this.try_ = rc.top;
        this.brx = rc.right;
        this.bry = rc.bottom;
        this.blx = rc.left;
        this.bly = rc.bottom;
    };
    Quad.prototype.set_from_rotated_rect = function(rc, a) {
        if (a === 0) {
            this.set_from_rect(rc);
        } else {
            var sin_a = Math.sin(a);
            var cos_a = Math.cos(a);
            var left_sin_a = rc.left * sin_a;
            var top_sin_a = rc.top * sin_a;
            var right_sin_a = rc.right * sin_a;
            var bottom_sin_a = rc.bottom * sin_a;
            var left_cos_a = rc.left * cos_a;
            var top_cos_a = rc.top * cos_a;
            var right_cos_a = rc.right * cos_a;
            var bottom_cos_a = rc.bottom * cos_a;
            this.tlx = left_cos_a - top_sin_a;
            this.tly = top_cos_a + left_sin_a;
            this.trx = right_cos_a - top_sin_a;
            this.try_ = top_cos_a + right_sin_a;
            this.brx = right_cos_a - bottom_sin_a;
            this.bry = bottom_cos_a + right_sin_a;
            this.blx = left_cos_a - bottom_sin_a;
            this.bly = bottom_cos_a + left_sin_a;
        }
    };
    Quad.prototype.offset = function(px, py) {
        this.tlx += px;
        this.tly += py;
        this.trx += px;
        this.try_ += py;
        this.brx += px;
        this.bry += py;
        this.blx += px;
        this.bly += py;
        return this;
    };
    var minresult = 0;
    var maxresult = 0;

    function minmax4(a, b, c, d) {
        if (a < b) {
            if (c < d) {
                if (a < c)
                    minresult = a;
                else
                    minresult = c;
                if (b > d)
                    maxresult = b;
                else
                    maxresult = d;
            } else {
                if (a < d)
                    minresult = a;
                else
                    minresult = d;
                if (b > c)
                    maxresult = b;
                else
                    maxresult = c;
            }
        } else {
            if (c < d) {
                if (b < c)
                    minresult = b;
                else
                    minresult = c;
                if (a > d)
                    maxresult = a;
                else
                    maxresult = d;
            } else {
                if (b < d)
                    minresult = b;
                else
                    minresult = d;
                if (a > c)
                    maxresult = a;
                else
                    maxresult = c;
            }
        }
    };
    Quad.prototype.bounding_box = function(rc) {
        minmax4(this.tlx, this.trx, this.brx, this.blx);
        rc.left = minresult;
        rc.right = maxresult;
        minmax4(this.tly, this.try_, this.bry, this.bly);
        rc.top = minresult;
        rc.bottom = maxresult;
    };
    Quad.prototype.contains_pt = function(x, y) {
        var v0x = this.trx - this.tlx;
        var v0y = this.try_ - this.tly;
        var v1x = this.brx - this.tlx;
        var v1y = this.bry - this.tly;
        var v2x = x - this.tlx;
        var v2y = y - this.tly;
        var dot00 = v0x * v0x + v0y * v0y
        var dot01 = v0x * v1x + v0y * v1y
        var dot02 = v0x * v2x + v0y * v2y
        var dot11 = v1x * v1x + v1y * v1y
        var dot12 = v1x * v2x + v1y * v2y
        var invDenom = 1.0 / (dot00 * dot11 - dot01 * dot01);
        var u = (dot11 * dot02 - dot01 * dot12) * invDenom;
        var v = (dot00 * dot12 - dot01 * dot02) * invDenom;
        if ((u >= 0.0) && (v > 0.0) && (u + v < 1))
            return true;
        v0x = this.blx - this.tlx;
        v0y = this.bly - this.tly;
        var dot00 = v0x * v0x + v0y * v0y
        var dot01 = v0x * v1x + v0y * v1y
        var dot02 = v0x * v2x + v0y * v2y
        invDenom = 1.0 / (dot00 * dot11 - dot01 * dot01);
        u = (dot11 * dot02 - dot01 * dot12) * invDenom;
        v = (dot00 * dot12 - dot01 * dot02) * invDenom;
        return (u >= 0.0) && (v > 0.0) && (u + v < 1);
    };
    Quad.prototype.at = function(i, xory) {
        if (xory) {
            switch (i) {
                case 0:
                    return this.tlx;
                case 1:
                    return this.trx;
                case 2:
                    return this.brx;
                case 3:
                    return this.blx;
                case 4:
                    return this.tlx;
                default:
                    return this.tlx;
            }
        } else {
            switch (i) {
                case 0:
                    return this.tly;
                case 1:
                    return this.try_;
                case 2:
                    return this.bry;
                case 3:
                    return this.bly;
                case 4:
                    return this.tly;
                default:
                    return this.tly;
            }
        }
    };
    Quad.prototype.midX = function() {
        return (this.tlx + this.trx + this.brx + this.blx) / 4;
    };
    Quad.prototype.midY = function() {
        return (this.tly + this.try_ + this.bry + this.bly) / 4;
    };
    Quad.prototype.intersects_segment = function(x1, y1, x2, y2) {
        if (this.contains_pt(x1, y1) || this.contains_pt(x2, y2))
            return true;
        var a1x, a1y, a2x, a2y;
        var i;
        for (i = 0; i < 4; i++) {
            a1x = this.at(i, true);
            a1y = this.at(i, false);
            a2x = this.at(i + 1, true);
            a2y = this.at(i + 1, false);
            if (cr.segments_intersect(x1, y1, x2, y2, a1x, a1y, a2x, a2y))
                return true;
        }
        return false;
    };
    Quad.prototype.intersects_quad = function(rhs) {
        var midx = rhs.midX();
        var midy = rhs.midY();
        if (this.contains_pt(midx, midy))
            return true;
        midx = this.midX();
        midy = this.midY();
        if (rhs.contains_pt(midx, midy))
            return true;
        var a1x, a1y, a2x, a2y, b1x, b1y, b2x, b2y;
        var i, j;
        for (i = 0; i < 4; i++) {
            for (j = 0; j < 4; j++) {
                a1x = this.at(i, true);
                a1y = this.at(i, false);
                a2x = this.at(i + 1, true);
                a2y = this.at(i + 1, false);
                b1x = rhs.at(j, true);
                b1y = rhs.at(j, false);
                b2x = rhs.at(j + 1, true);
                b2y = rhs.at(j + 1, false);
                if (cr.segments_intersect(a1x, a1y, a2x, a2y, b1x, b1y, b2x, b2y))
                    return true;
            }
        }
        return false;
    };
    cr.quad = Quad;
    cr.RGB = function(red, green, blue) {
        return Math.max(Math.min(red, 255), 0) | (Math.max(Math.min(green, 255), 0) << 8) | (Math.max(Math.min(blue, 255), 0) << 16);
    };
    cr.GetRValue = function(rgb) {
        return rgb & 0xFF;
    };
    cr.GetGValue = function(rgb) {
        return (rgb & 0xFF00) >> 8;
    };
    cr.GetBValue = function(rgb) {
        return (rgb & 0xFF0000) >> 16;
    };
    cr.shallowCopy = function(a, b, allowOverwrite) {
        var attr;
        for (attr in b) {
            if (b.hasOwnProperty(attr)) {;
                a[attr] = b[attr];
            }
        }
        return a;
    };
    cr.arrayRemove = function(arr, index) {
        var i, len;
        index = cr.floor(index);
        if (index < 0 || index >= arr.length)
            return; // index out of bounds
        if (index === 0) // removing first item
            arr.shift();
        else if (index === arr.length - 1) // removing last item
            arr.pop();
        else {
            for (i = index, len = arr.length - 1; i < len; i++)
                arr[i] = arr[i + 1];
            arr.length = len;
        }
    };
    cr.shallowAssignArray = function(dest, src) {
        dest.length = src.length;
        var i, len;
        for (i = 0, len = src.length; i < len; i++)
            dest[i] = src[i];
    };
    cr.appendArray = function(a, b) {
        a.push.apply(a, b);
    };
    cr.arrayFindRemove = function(arr, item) {
        var index = arr.indexOf(item);
        if (index !== -1)
            cr.arrayRemove(arr, index);
    };
    cr.clamp = function(x, a, b) {
        if (x < a)
            return a;
        else if (x > b)
            return b;
        else
            return x;
    };
    cr.to_radians = function(x) {
        return x / (180.0 / cr.PI);
    };
    cr.to_degrees = function(x) {
        return x * (180.0 / cr.PI);
    };
    cr.clamp_angle_degrees = function(a) {
        a %= 360; // now in (-360, 360) range
        if (a < 0)
            a += 360; // now in [0, 360) range
        return a;
    };
    cr.clamp_angle = function(a) {
        a %= 2 * cr.PI; // now in (-2pi, 2pi) range
        if (a < 0)
            a += 2 * cr.PI; // now in [0, 2pi) range
        return a;
    };
    cr.to_clamped_degrees = function(x) {
        return cr.clamp_angle_degrees(cr.to_degrees(x));
    };
    cr.to_clamped_radians = function(x) {
        return cr.clamp_angle(cr.to_radians(x));
    };
    cr.angleTo = function(x1, y1, x2, y2) {
        var dx = x2 - x1;
        var dy = y2 - y1;
        return Math.atan2(dy, dx);
    };
    cr.angleDiff = function(a1, a2) {
        if (a1 === a2)
            return 0;
        var s1 = Math.sin(a1);
        var c1 = Math.cos(a1);
        var s2 = Math.sin(a2);
        var c2 = Math.cos(a2);
        var n = s1 * s2 + c1 * c2;
        if (n >= 1)
            return 0;
        if (n <= -1)
            return cr.PI;
        return Math.acos(n);
    };
    cr.angleRotate = function(start, end, step) {
        var ss = Math.sin(start);
        var cs = Math.cos(start);
        var se = Math.sin(end);
        var ce = Math.cos(end);
        if (Math.acos(ss * se + cs * ce) > step) {
            if (cs * se - ss * ce > 0)
                return cr.clamp_angle(start + step);
            else
                return cr.clamp_angle(start - step);
        } else
            return cr.clamp_angle(end);
    };
    cr.angleClockwise = function(a1, a2) {
        var s1 = Math.sin(a1);
        var c1 = Math.cos(a1);
        var s2 = Math.sin(a2);
        var c2 = Math.cos(a2);
        return c1 * s2 - s1 * c2 <= 0;
    };
    cr.rotatePtAround = function(px, py, a, ox, oy, getx) {
        if (a === 0)
            return getx ? px : py;
        var sin_a = Math.sin(a);
        var cos_a = Math.cos(a);
        px -= ox;
        py -= oy;
        var left_sin_a = px * sin_a;
        var top_sin_a = py * sin_a;
        var left_cos_a = px * cos_a;
        var top_cos_a = py * cos_a;
        px = left_cos_a - top_sin_a;
        py = top_cos_a + left_sin_a;
        px += ox;
        py += oy;
        return getx ? px : py;
    }
    cr.distanceTo = function(x1, y1, x2, y2) {
        var dx = x2 - x1;
        var dy = y2 - y1;
        return Math.sqrt(dx * dx + dy * dy);
    };
    cr.xor = function(x, y) {
        return !x !== !y;
    };
    cr.lerp = function(a, b, x) {
        return a + (b - a) * x;
    };
    cr.unlerp = function(a, b, c) {
        if (a === b)
            return 0; // avoid divide by 0
        return (c - a) / (b - a);
    };
    cr.anglelerp = function(a, b, x) {
        var diff = cr.angleDiff(a, b);
        if (cr.angleClockwise(b, a)) {
            return a + diff * x;
        } else {
            return a - diff * x;
        }
    };
    cr.qarp = function(a, b, c, x) {
        return cr.lerp(cr.lerp(a, b, x), cr.lerp(b, c, x), x);
    };
    cr.cubic = function(a, b, c, d, x) {
        return cr.lerp(cr.qarp(a, b, c, x), cr.qarp(b, c, d, x), x);
    };
    cr.cosp = function(a, b, x) {
        return (a + b + (a - b) * Math.cos(x * Math.PI)) / 2;
    };
    cr.hasAnyOwnProperty = function(o) {
        var p;
        for (p in o) {
            if (o.hasOwnProperty(p))
                return true;
        }
        return false;
    };
    cr.wipe = function(obj) {
        var p;
        for (p in obj) {
            if (obj.hasOwnProperty(p))
                delete obj[p];
        }
    };
    var startup_time = +(new Date());
    cr.performance_now = function() {
        if (typeof window["performance"] !== "undefined") {
            var winperf = window["performance"];
            if (typeof winperf.now !== "undefined")
                return winperf.now();
            else if (typeof winperf["webkitNow"] !== "undefined")
                return winperf["webkitNow"]();
            else if (typeof winperf["mozNow"] !== "undefined")
                return winperf["mozNow"]();
            else if (typeof winperf["msNow"] !== "undefined")
                return winperf["msNow"]();
        }
        return Date.now() - startup_time;
    };
    var isChrome = false;
    var isSafari = false;
    var isEjecta = false;
    if (typeof window !== "undefined") // not c2 editor
    {
        isChrome = /chrome/i.test(navigator.userAgent) || /chromium/i.test(navigator.userAgent);
        isSafari = !isChrome && /safari/i.test(navigator.userAgent);
        isEjecta = window["c2ejecta"];
    }
    var supports_set = ((!isSafari && !isEjecta) && (typeof Set !== "undefined" && typeof Set.prototype["forEach"] !== "undefined"));

    function ObjectSet_() {
        this.s = null;
        this.items = null; // lazy allocated (hopefully results in better GC performance)
        this.item_count = 0;
        if (supports_set) {
            this.s = new Set();
        }
        this.values_cache = [];
        this.cache_valid = true;
        cr.seal(this);
    };
    ObjectSet_.prototype.contains = function(x) {
        if (this.isEmpty())
            return false;
        if (supports_set)
            return this.s["has"](x);
        else
            return (this.items && this.items.hasOwnProperty(x));
    };
    ObjectSet_.prototype.add = function(x) {
        if (supports_set) {
            if (!this.s["has"](x)) {
                this.s["add"](x);
                this.cache_valid = false;
            }
        } else {
            var str = x.toString();
            var items = this.items;
            if (!items) {
                this.items = {};
                this.items[str] = x;
                this.item_count = 1;
                this.cache_valid = false;
            } else if (!items.hasOwnProperty(str)) {
                items[str] = x;
                this.item_count++;
                this.cache_valid = false;
            }
        }
    };
    ObjectSet_.prototype.remove = function(x) {
        if (this.isEmpty())
            return;
        if (supports_set) {
            if (this.s["has"](x)) {
                this.s["delete"](x);
                this.cache_valid = false;
            }
        } else if (this.items) {
            var str = x.toString();
            var items = this.items;
            if (items.hasOwnProperty(str)) {
                delete items[str];
                this.item_count--;
                this.cache_valid = false;
            }
        }
    };
    ObjectSet_.prototype.clear = function( /*wipe_*/ ) {
        if (this.isEmpty())
            return;
        if (supports_set) {
            this.s["clear"](); // best!
        } else {
            this.items = null; // creates garbage; will lazy allocate on next add()
            this.item_count = 0;
        }
        this.values_cache.length = 0;
        this.cache_valid = true;
    };
    ObjectSet_.prototype.isEmpty = function() {
        return this.count() === 0;
    };
    ObjectSet_.prototype.count = function() {
        if (supports_set)
            return this.s["size"];
        else
            return this.item_count;
    };
    var current_arr = null;
    var current_index = 0;

    function set_append_to_arr(x) {
        current_arr[current_index++] = x;
    };
    ObjectSet_.prototype.update_cache = function() {
        if (this.cache_valid)
            return;
        if (supports_set) {
            this.values_cache.length = this.s["size"];
            current_arr = this.values_cache;
            current_index = 0;
            this.s["forEach"](set_append_to_arr);;
            current_arr = null;
            current_index = 0;
        } else {
            var values_cache = this.values_cache;
            values_cache.length = this.item_count;
            var p, n = 0,
                items = this.items;
            if (items) {
                for (p in items) {
                    if (items.hasOwnProperty(p))
                        values_cache[n++] = items[p];
                }
            };
        }
        this.cache_valid = true;
    };
    ObjectSet_.prototype.valuesRef = function() {
        this.update_cache();
        return this.values_cache;
    };
    cr.ObjectSet = ObjectSet_;
    var tmpSet = new cr.ObjectSet();
    cr.removeArrayDuplicates = function(arr) {
        var i, len;
        for (i = 0, len = arr.length; i < len; ++i) {
            tmpSet.add(arr[i]);
        }
        cr.shallowAssignArray(arr, tmpSet.valuesRef());
        tmpSet.clear();
    };

    function KahanAdder_() {
        this.c = 0;
        this.y = 0;
        this.t = 0;
        this.sum = 0;
        cr.seal(this);
    };
    KahanAdder_.prototype.add = function(v) {
        this.y = v - this.c;
        this.t = this.sum + this.y;
        this.c = (this.t - this.sum) - this.y;
        this.sum = this.t;
    };
    KahanAdder_.prototype.reset = function() {
        this.c = 0;
        this.y = 0;
        this.t = 0;
        this.sum = 0;
    };
    cr.KahanAdder = KahanAdder_;
    cr.regexp_escape = function(text) {
        return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");
    };

    function CollisionPoly_(pts_array_) {
        this.pts_cache = [];
        this.bboxLeft = 0;
        this.bboxTop = 0;
        this.bboxRight = 0;
        this.bboxBottom = 0;
        this.convexpolys = null; // for physics behavior to cache separated polys
        this.set_pts(pts_array_);
        cr.seal(this);
    };
    CollisionPoly_.prototype.set_pts = function(pts_array_) {
        this.pts_array = pts_array_;
        this.pts_count = pts_array_.length / 2; // x, y, x, y... in array
        this.pts_cache.length = pts_array_.length;
        this.cache_width = -1;
        this.cache_height = -1;
        this.cache_angle = 0;
    };
    CollisionPoly_.prototype.is_empty = function() {
        return !this.pts_array.length;
    };
    CollisionPoly_.prototype.update_bbox = function() {
        var myptscache = this.pts_cache;
        var bboxLeft_ = myptscache[0];
        var bboxRight_ = bboxLeft_;
        var bboxTop_ = myptscache[1];
        var bboxBottom_ = bboxTop_;
        var x, y, i = 1,
            i2, len = this.pts_count;
        for (; i < len; ++i) {
            i2 = i * 2;
            x = myptscache[i2];
            y = myptscache[i2 + 1];
            if (x < bboxLeft_)
                bboxLeft_ = x;
            if (x > bboxRight_)
                bboxRight_ = x;
            if (y < bboxTop_)
                bboxTop_ = y;
            if (y > bboxBottom_)
                bboxBottom_ = y;
        }
        this.bboxLeft = bboxLeft_;
        this.bboxRight = bboxRight_;
        this.bboxTop = bboxTop_;
        this.bboxBottom = bboxBottom_;
    };
    CollisionPoly_.prototype.set_from_rect = function(rc, offx, offy) {
        this.pts_cache.length = 8;
        this.pts_count = 4;
        var myptscache = this.pts_cache;
        myptscache[0] = rc.left - offx;
        myptscache[1] = rc.top - offy;
        myptscache[2] = rc.right - offx;
        myptscache[3] = rc.top - offy;
        myptscache[4] = rc.right - offx;
        myptscache[5] = rc.bottom - offy;
        myptscache[6] = rc.left - offx;
        myptscache[7] = rc.bottom - offy;
        this.cache_width = rc.right - rc.left;
        this.cache_height = rc.bottom - rc.top;
        this.update_bbox();
    };
    CollisionPoly_.prototype.set_from_quad = function(q, offx, offy, w, h) {
        this.pts_cache.length = 8;
        this.pts_count = 4;
        var myptscache = this.pts_cache;
        myptscache[0] = q.tlx - offx;
        myptscache[1] = q.tly - offy;
        myptscache[2] = q.trx - offx;
        myptscache[3] = q.try_ - offy;
        myptscache[4] = q.brx - offx;
        myptscache[5] = q.bry - offy;
        myptscache[6] = q.blx - offx;
        myptscache[7] = q.bly - offy;
        this.cache_width = w;
        this.cache_height = h;
        this.update_bbox();
    };
    CollisionPoly_.prototype.set_from_poly = function(r) {
        this.pts_count = r.pts_count;
        cr.shallowAssignArray(this.pts_cache, r.pts_cache);
        this.bboxLeft = r.bboxLeft;
        this.bboxTop - r.bboxTop;
        this.bboxRight = r.bboxRight;
        this.bboxBottom = r.bboxBottom;
    };
    CollisionPoly_.prototype.cache_poly = function(w, h, a) {
        if (this.cache_width === w && this.cache_height === h && this.cache_angle === a)
            return; // cache up-to-date
        this.cache_width = w;
        this.cache_height = h;
        this.cache_angle = a;
        var i, i2, i21, len, x, y;
        var sina = 0;
        var cosa = 1;
        var myptsarray = this.pts_array;
        var myptscache = this.pts_cache;
        if (a !== 0) {
            sina = Math.sin(a);
            cosa = Math.cos(a);
        }
        for (i = 0, len = this.pts_count; i < len; i++) {
            i2 = i * 2;
            i21 = i2 + 1;
            x = myptsarray[i2] * w;
            y = myptsarray[i21] * h;
            myptscache[i2] = (x * cosa) - (y * sina);
            myptscache[i21] = (y * cosa) + (x * sina);
        }
        this.update_bbox();
    };
    CollisionPoly_.prototype.contains_pt = function(a2x, a2y) {
        var myptscache = this.pts_cache;
        if (a2x === myptscache[0] && a2y === myptscache[1])
            return true;
        var i, i2, imod, len = this.pts_count;
        var a1x = this.bboxLeft - 110;
        var a1y = this.bboxTop - 101;
        var a3x = this.bboxRight + 131
        var a3y = this.bboxBottom + 120;
        var b1x, b1y, b2x, b2y;
        var count1 = 0,
            count2 = 0;
        for (i = 0; i < len; i++) {
            i2 = i * 2;
            imod = ((i + 1) % len) * 2;
            b1x = myptscache[i2];
            b1y = myptscache[i2 + 1];
            b2x = myptscache[imod];
            b2y = myptscache[imod + 1];
            if (cr.segments_intersect(a1x, a1y, a2x, a2y, b1x, b1y, b2x, b2y))
                count1++;
            if (cr.segments_intersect(a3x, a3y, a2x, a2y, b1x, b1y, b2x, b2y))
                count2++;
        }
        return (count1 % 2 === 1) || (count2 % 2 === 1);
    };
    CollisionPoly_.prototype.intersects_poly = function(rhs, offx, offy) {
        var rhspts = rhs.pts_cache;
        var mypts = this.pts_cache;
        if (this.contains_pt(rhspts[0] + offx, rhspts[1] + offy))
            return true;
        if (rhs.contains_pt(mypts[0] - offx, mypts[1] - offy))
            return true;
        var i, i2, imod, leni, j, j2, jmod, lenj;
        var a1x, a1y, a2x, a2y, b1x, b1y, b2x, b2y;
        for (i = 0, leni = this.pts_count; i < leni; i++) {
            i2 = i * 2;
            imod = ((i + 1) % leni) * 2;
            a1x = mypts[i2];
            a1y = mypts[i2 + 1];
            a2x = mypts[imod];
            a2y = mypts[imod + 1];
            for (j = 0, lenj = rhs.pts_count; j < lenj; j++) {
                j2 = j * 2;
                jmod = ((j + 1) % lenj) * 2;
                b1x = rhspts[j2] + offx;
                b1y = rhspts[j2 + 1] + offy;
                b2x = rhspts[jmod] + offx;
                b2y = rhspts[jmod + 1] + offy;
                if (cr.segments_intersect(a1x, a1y, a2x, a2y, b1x, b1y, b2x, b2y))
                    return true;
            }
        }
        return false;
    };
    CollisionPoly_.prototype.intersects_segment = function(offx, offy, x1, y1, x2, y2) {
        var mypts = this.pts_cache;
        if (this.contains_pt(x1 - offx, y1 - offy))
            return true;
        var i, leni, i2, imod;
        var a1x, a1y, a2x, a2y;
        for (i = 0, leni = this.pts_count; i < leni; i++) {
            i2 = i * 2;
            imod = ((i + 1) % leni) * 2;
            a1x = mypts[i2] + offx;
            a1y = mypts[i2 + 1] + offy;
            a2x = mypts[imod] + offx;
            a2y = mypts[imod + 1] + offy;
            if (cr.segments_intersect(x1, y1, x2, y2, a1x, a1y, a2x, a2y))
                return true;
        }
        return false;
    };
    CollisionPoly_.prototype.mirror = function(px) {
        var i, leni, i2;
        for (i = 0, leni = this.pts_count; i < leni; ++i) {
            i2 = i * 2;
            this.pts_cache[i2] = px * 2 - this.pts_cache[i2];
        }
    };
    CollisionPoly_.prototype.flip = function(py) {
        var i, leni, i21;
        for (i = 0, leni = this.pts_count; i < leni; ++i) {
            i21 = i * 2 + 1;
            this.pts_cache[i21] = py * 2 - this.pts_cache[i21];
        }
    };
    CollisionPoly_.prototype.diag = function() {
        var i, leni, i2, i21, temp;
        for (i = 0, leni = this.pts_count; i < leni; ++i) {
            i2 = i * 2;
            i21 = i2 + 1;
            temp = this.pts_cache[i2];
            this.pts_cache[i2] = this.pts_cache[i21];
            this.pts_cache[i21] = temp;
        }
    };
    cr.CollisionPoly = CollisionPoly_;

    function SparseGrid_(cellwidth_, cellheight_) {
        this.cellwidth = cellwidth_;
        this.cellheight = cellheight_;
        this.cells = {};
    };
    SparseGrid_.prototype.totalCellCount = 0;
    SparseGrid_.prototype.getCell = function(x_, y_, create_if_missing) {
        var ret;
        var col = this.cells[x_];
        if (!col) {
            if (create_if_missing) {
                ret = allocGridCell(this, x_, y_);
                this.cells[x_] = {};
                this.cells[x_][y_] = ret;
                return ret;
            } else
                return null;
        }
        ret = col[y_];
        if (ret)
            return ret;
        else if (create_if_missing) {
            ret = allocGridCell(this, x_, y_);
            this.cells[x_][y_] = ret;
            return ret;
        } else
            return null;
    };
    SparseGrid_.prototype.XToCell = function(x_) {
        return cr.floor(x_ / this.cellwidth);
    };
    SparseGrid_.prototype.YToCell = function(y_) {
        return cr.floor(y_ / this.cellheight);
    };
    SparseGrid_.prototype.update = function(inst, oldrange, newrange) {
        var x, lenx, y, leny, cell;
        if (oldrange) {
            for (x = oldrange.left, lenx = oldrange.right; x <= lenx; ++x) {
                for (y = oldrange.top, leny = oldrange.bottom; y <= leny; ++y) {
                    if (newrange && newrange.contains_pt(x, y))
                        continue; // is still in this cell
                    cell = this.getCell(x, y, false); // don't create if missing
                    if (!cell)
                        continue; // cell does not exist yet
                    cell.remove(inst);
                    if (cell.isEmpty()) {
                        freeGridCell(cell);
                        this.cells[x][y] = null;
                    }
                }
            }
        }
        if (newrange) {
            for (x = newrange.left, lenx = newrange.right; x <= lenx; ++x) {
                for (y = newrange.top, leny = newrange.bottom; y <= leny; ++y) {
                    if (oldrange && oldrange.contains_pt(x, y))
                        continue; // is still in this cell
                    this.getCell(x, y, true).insert(inst);
                }
            }
        }
    };
    SparseGrid_.prototype.queryRange = function(rc, result) {
        var x, lenx, ystart, y, leny, cell;
        x = this.XToCell(rc.left);
        ystart = this.YToCell(rc.top);
        lenx = this.XToCell(rc.right);
        leny = this.YToCell(rc.bottom);
        for (; x <= lenx; ++x) {
            for (y = ystart; y <= leny; ++y) {
                cell = this.getCell(x, y, false);
                if (!cell)
                    continue;
                cell.dump(result);
            }
        }
    };
    cr.SparseGrid = SparseGrid_;
    var gridcellcache = [];

    function allocGridCell(grid_, x_, y_) {
        var ret;
        SparseGrid_.prototype.totalCellCount++;
        if (gridcellcache.length) {
            ret = gridcellcache.pop();
            ret.grid = grid_;
            ret.x = x_;
            ret.y = y_;
            return ret;
        } else
            return new cr.GridCell(grid_, x_, y_);
    };

    function freeGridCell(c) {
        SparseGrid_.prototype.totalCellCount--;
        c.objects.clear();
        if (gridcellcache.length < 1000)
            gridcellcache.push(c);
    };

    function GridCell_(grid_, x_, y_) {
        this.grid = grid_;
        this.x = x_;
        this.y = y_;
        this.objects = new cr.ObjectSet();
    };
    GridCell_.prototype.isEmpty = function() {
        return this.objects.isEmpty();
    };
    GridCell_.prototype.insert = function(inst) {
        this.objects.add(inst);
    };
    GridCell_.prototype.remove = function(inst) {
        this.objects.remove(inst);
    };
    GridCell_.prototype.dump = function(result) {
        cr.appendArray(result, this.objects.valuesRef());
    };
    cr.GridCell = GridCell_;
    var fxNames = ["lighter",
        "xor",
        "copy",
        "destination-over",
        "source-in",
        "destination-in",
        "source-out",
        "destination-out",
        "source-atop",
        "destination-atop"
    ];
    cr.effectToCompositeOp = function(effect) {
        if (effect <= 0 || effect >= 11)
            return "source-over";
        return fxNames[effect - 1]; // not including "none" so offset by 1
    };
    cr.setGLBlend = function(this_, effect, gl) {
        if (!gl)
            return;
        this_.srcBlend = gl.ONE;
        this_.destBlend = gl.ONE_MINUS_SRC_ALPHA;
        switch (effect) {
            case 1: // lighter (additive)
                this_.srcBlend = gl.ONE;
                this_.destBlend = gl.ONE;
                break;
            case 2: // xor
                break; // todo
            case 3: // copy
                this_.srcBlend = gl.ONE;
                this_.destBlend = gl.ZERO;
                break;
            case 4: // destination-over
                this_.srcBlend = gl.ONE_MINUS_DST_ALPHA;
                this_.destBlend = gl.ONE;
                break;
            case 5: // source-in
                this_.srcBlend = gl.DST_ALPHA;
                this_.destBlend = gl.ZERO;
                break;
            case 6: // destination-in
                this_.srcBlend = gl.ZERO;
                this_.destBlend = gl.SRC_ALPHA;
                break;
            case 7: // source-out
                this_.srcBlend = gl.ONE_MINUS_DST_ALPHA;
                this_.destBlend = gl.ZERO;
                break;
            case 8: // destination-out
                this_.srcBlend = gl.ZERO;
                this_.destBlend = gl.ONE_MINUS_SRC_ALPHA;
                break;
            case 9: // source-atop
                this_.srcBlend = gl.DST_ALPHA;
                this_.destBlend = gl.ONE_MINUS_SRC_ALPHA;
                break;
            case 10: // destination-atop
                this_.srcBlend = gl.ONE_MINUS_DST_ALPHA;
                this_.destBlend = gl.SRC_ALPHA;
                break;
        }
    };
    cr.round6dp = function(x) {
        return cr.round(x * 1000000) / 1000000;
    };
    /*
	var localeCompare_options = {
		"usage": "search",
		"sensitivity": "accent"
	};
	var has_localeCompare = !!"a".localeCompare;
	var localeCompare_works1 = (has_localeCompare && "a".localeCompare("A", undefined, localeCompare_options) === 0);
	var localeCompare_works2 = (has_localeCompare && "a".localeCompare("á", undefined, localeCompare_options) !== 0);
	var supports_localeCompare = (has_localeCompare && localeCompare_works1 && localeCompare_works2);
	*/
    cr.equals_nocase = function(a, b) {
        if (typeof a !== "string" || typeof b !== "string")
            return false;
        if (a.length !== b.length)
            return false;
        if (a === b)
            return true;
        /*
		if (supports_localeCompare)
		{
			return (a.localeCompare(b, undefined, localeCompare_options) === 0);
		}
		else
		{
		*/
        return a.toLowerCase() === b.toLowerCase();
    };
}());
var MatrixArray = typeof Float32Array !== "undefined" ? Float32Array : Array,
    glMatrixArrayType = MatrixArray,
    vec3 = {},
    mat3 = {},
    mat4 = {},
    quat4 = {};
vec3.create = function(a) {
    var b = new MatrixArray(3);
    a && (b[0] = a[0], b[1] = a[1], b[2] = a[2]);
    return b
};
vec3.set = function(a, b) {
    b[0] = a[0];
    b[1] = a[1];
    b[2] = a[2];
    return b
};
vec3.add = function(a, b, c) {
    if (!c || a === c) return a[0] += b[0], a[1] += b[1], a[2] += b[2], a;
    c[0] = a[0] + b[0];
    c[1] = a[1] + b[1];
    c[2] = a[2] + b[2];
    return c
};
vec3.subtract = function(a, b, c) {
    if (!c || a === c) return a[0] -= b[0], a[1] -= b[1], a[2] -= b[2], a;
    c[0] = a[0] - b[0];
    c[1] = a[1] - b[1];
    c[2] = a[2] - b[2];
    return c
};
vec3.negate = function(a, b) {
    b || (b = a);
    b[0] = -a[0];
    b[1] = -a[1];
    b[2] = -a[2];
    return b
};
vec3.scale = function(a, b, c) {
    if (!c || a === c) return a[0] *= b, a[1] *= b, a[2] *= b, a;
    c[0] = a[0] * b;
    c[1] = a[1] * b;
    c[2] = a[2] * b;
    return c
};
vec3.normalize = function(a, b) {
    b || (b = a);
    var c = a[0],
        d = a[1],
        e = a[2],
        g = Math.sqrt(c * c + d * d + e * e);
    if (g) {
        if (g === 1) return b[0] = c, b[1] = d, b[2] = e, b
    } else return b[0] = 0, b[1] = 0, b[2] = 0, b;
    g = 1 / g;
    b[0] = c * g;
    b[1] = d * g;
    b[2] = e * g;
    return b
};
vec3.cross = function(a, b, c) {
    c || (c = a);
    var d = a[0],
        e = a[1],
        a = a[2],
        g = b[0],
        f = b[1],
        b = b[2];
    c[0] = e * b - a * f;
    c[1] = a * g - d * b;
    c[2] = d * f - e * g;
    return c
};
vec3.length = function(a) {
    var b = a[0],
        c = a[1],
        a = a[2];
    return Math.sqrt(b * b + c * c + a * a)
};
vec3.dot = function(a, b) {
    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2]
};
vec3.direction = function(a, b, c) {
    c || (c = a);
    var d = a[0] - b[0],
        e = a[1] - b[1],
        a = a[2] - b[2],
        b = Math.sqrt(d * d + e * e + a * a);
    if (!b) return c[0] = 0, c[1] = 0, c[2] = 0, c;
    b = 1 / b;
    c[0] = d * b;
    c[1] = e * b;
    c[2] = a * b;
    return c
};
vec3.lerp = function(a, b, c, d) {
    d || (d = a);
    d[0] = a[0] + c * (b[0] - a[0]);
    d[1] = a[1] + c * (b[1] - a[1]);
    d[2] = a[2] + c * (b[2] - a[2]);
    return d
};
vec3.str = function(a) {
    return "[" + a[0] + ", " + a[1] + ", " + a[2] + "]"
};
mat3.create = function(a) {
    var b = new MatrixArray(9);
    a && (b[0] = a[0], b[1] = a[1], b[2] = a[2], b[3] = a[3], b[4] = a[4], b[5] = a[5], b[6] = a[6], b[7] = a[7], b[8] = a[8]);
    return b
};
mat3.set = function(a, b) {
    b[0] = a[0];
    b[1] = a[1];
    b[2] = a[2];
    b[3] = a[3];
    b[4] = a[4];
    b[5] = a[5];
    b[6] = a[6];
    b[7] = a[7];
    b[8] = a[8];
    return b
};
mat3.identity = function(a) {
    a[0] = 1;
    a[1] = 0;
    a[2] = 0;
    a[3] = 0;
    a[4] = 1;
    a[5] = 0;
    a[6] = 0;
    a[7] = 0;
    a[8] = 1;
    return a
};
mat3.transpose = function(a, b) {
    if (!b || a === b) {
        var c = a[1],
            d = a[2],
            e = a[5];
        a[1] = a[3];
        a[2] = a[6];
        a[3] = c;
        a[5] = a[7];
        a[6] = d;
        a[7] = e;
        return a
    }
    b[0] = a[0];
    b[1] = a[3];
    b[2] = a[6];
    b[3] = a[1];
    b[4] = a[4];
    b[5] = a[7];
    b[6] = a[2];
    b[7] = a[5];
    b[8] = a[8];
    return b
};
mat3.toMat4 = function(a, b) {
    b || (b = mat4.create());
    b[15] = 1;
    b[14] = 0;
    b[13] = 0;
    b[12] = 0;
    b[11] = 0;
    b[10] = a[8];
    b[9] = a[7];
    b[8] = a[6];
    b[7] = 0;
    b[6] = a[5];
    b[5] = a[4];
    b[4] = a[3];
    b[3] = 0;
    b[2] = a[2];
    b[1] = a[1];
    b[0] = a[0];
    return b
};
mat3.str = function(a) {
    return "[" + a[0] + ", " + a[1] + ", " + a[2] + ", " + a[3] + ", " + a[4] + ", " + a[5] + ", " + a[6] + ", " + a[7] + ", " + a[8] + "]"
};
mat4.create = function(a) {
    var b = new MatrixArray(16);
    a && (b[0] = a[0], b[1] = a[1], b[2] = a[2], b[3] = a[3], b[4] = a[4], b[5] = a[5], b[6] = a[6], b[7] = a[7], b[8] = a[8], b[9] = a[9], b[10] = a[10], b[11] = a[11], b[12] = a[12], b[13] = a[13], b[14] = a[14], b[15] = a[15]);
    return b
};
mat4.set = function(a, b) {
    b[0] = a[0];
    b[1] = a[1];
    b[2] = a[2];
    b[3] = a[3];
    b[4] = a[4];
    b[5] = a[5];
    b[6] = a[6];
    b[7] = a[7];
    b[8] = a[8];
    b[9] = a[9];
    b[10] = a[10];
    b[11] = a[11];
    b[12] = a[12];
    b[13] = a[13];
    b[14] = a[14];
    b[15] = a[15];
    return b
};
mat4.identity = function(a) {
    a[0] = 1;
    a[1] = 0;
    a[2] = 0;
    a[3] = 0;
    a[4] = 0;
    a[5] = 1;
    a[6] = 0;
    a[7] = 0;
    a[8] = 0;
    a[9] = 0;
    a[10] = 1;
    a[11] = 0;
    a[12] = 0;
    a[13] = 0;
    a[14] = 0;
    a[15] = 1;
    return a
};
mat4.transpose = function(a, b) {
    if (!b || a === b) {
        var c = a[1],
            d = a[2],
            e = a[3],
            g = a[6],
            f = a[7],
            h = a[11];
        a[1] = a[4];
        a[2] = a[8];
        a[3] = a[12];
        a[4] = c;
        a[6] = a[9];
        a[7] = a[13];
        a[8] = d;
        a[9] = g;
        a[11] = a[14];
        a[12] = e;
        a[13] = f;
        a[14] = h;
        return a
    }
    b[0] = a[0];
    b[1] = a[4];
    b[2] = a[8];
    b[3] = a[12];
    b[4] = a[1];
    b[5] = a[5];
    b[6] = a[9];
    b[7] = a[13];
    b[8] = a[2];
    b[9] = a[6];
    b[10] = a[10];
    b[11] = a[14];
    b[12] = a[3];
    b[13] = a[7];
    b[14] = a[11];
    b[15] = a[15];
    return b
};
mat4.determinant = function(a) {
    var b = a[0],
        c = a[1],
        d = a[2],
        e = a[3],
        g = a[4],
        f = a[5],
        h = a[6],
        i = a[7],
        j = a[8],
        k = a[9],
        l = a[10],
        n = a[11],
        o = a[12],
        m = a[13],
        p = a[14],
        a = a[15];
    return o * k * h * e - j * m * h * e - o * f * l * e + g * m * l * e + j * f * p * e - g * k * p * e - o * k * d * i + j * m * d * i + o * c * l * i - b * m * l * i - j * c * p * i + b * k * p * i + o * f * d * n - g * m * d * n - o * c * h * n + b * m * h * n + g * c * p * n - b * f * p * n - j * f * d * a + g * k * d * a + j * c * h * a - b * k * h * a - g * c * l * a + b * f * l * a
};
mat4.inverse = function(a, b) {
    b || (b = a);
    var c = a[0],
        d = a[1],
        e = a[2],
        g = a[3],
        f = a[4],
        h = a[5],
        i = a[6],
        j = a[7],
        k = a[8],
        l = a[9],
        n = a[10],
        o = a[11],
        m = a[12],
        p = a[13],
        r = a[14],
        s = a[15],
        A = c * h - d * f,
        B = c * i - e * f,
        t = c * j - g * f,
        u = d * i - e * h,
        v = d * j - g * h,
        w = e * j - g * i,
        x = k * p - l * m,
        y = k * r - n * m,
        z = k * s - o * m,
        C = l * r - n * p,
        D = l * s - o * p,
        E = n * s - o * r,
        q = 1 / (A * E - B * D + t * C + u * z - v * y + w * x);
    b[0] = (h * E - i * D + j * C) * q;
    b[1] = (-d * E + e * D - g * C) * q;
    b[2] = (p * w - r * v + s * u) * q;
    b[3] = (-l * w + n * v - o * u) * q;
    b[4] = (-f * E + i * z - j * y) * q;
    b[5] = (c * E - e * z + g * y) * q;
    b[6] = (-m * w + r * t - s * B) * q;
    b[7] = (k * w - n * t + o * B) * q;
    b[8] = (f * D - h * z + j * x) * q;
    b[9] = (-c * D + d * z - g * x) * q;
    b[10] = (m * v - p * t + s * A) * q;
    b[11] = (-k * v + l * t - o * A) * q;
    b[12] = (-f * C + h * y - i * x) * q;
    b[13] = (c * C - d * y + e * x) * q;
    b[14] = (-m * u + p * B - r * A) * q;
    b[15] = (k * u - l * B + n * A) * q;
    return b
};
mat4.toRotationMat = function(a, b) {
    b || (b = mat4.create());
    b[0] = a[0];
    b[1] = a[1];
    b[2] = a[2];
    b[3] = a[3];
    b[4] = a[4];
    b[5] = a[5];
    b[6] = a[6];
    b[7] = a[7];
    b[8] = a[8];
    b[9] = a[9];
    b[10] = a[10];
    b[11] = a[11];
    b[12] = 0;
    b[13] = 0;
    b[14] = 0;
    b[15] = 1;
    return b
};
mat4.toMat3 = function(a, b) {
    b || (b = mat3.create());
    b[0] = a[0];
    b[1] = a[1];
    b[2] = a[2];
    b[3] = a[4];
    b[4] = a[5];
    b[5] = a[6];
    b[6] = a[8];
    b[7] = a[9];
    b[8] = a[10];
    return b
};
mat4.toInverseMat3 = function(a, b) {
    var c = a[0],
        d = a[1],
        e = a[2],
        g = a[4],
        f = a[5],
        h = a[6],
        i = a[8],
        j = a[9],
        k = a[10],
        l = k * f - h * j,
        n = -k * g + h * i,
        o = j * g - f * i,
        m = c * l + d * n + e * o;
    if (!m) return null;
    m = 1 / m;
    b || (b = mat3.create());
    b[0] = l * m;
    b[1] = (-k * d + e * j) * m;
    b[2] = (h * d - e * f) * m;
    b[3] = n * m;
    b[4] = (k * c - e * i) * m;
    b[5] = (-h * c + e * g) * m;
    b[6] = o * m;
    b[7] = (-j * c + d * i) * m;
    b[8] = (f * c - d * g) * m;
    return b
};
mat4.multiply = function(a, b, c) {
    c || (c = a);
    var d = a[0],
        e = a[1],
        g = a[2],
        f = a[3],
        h = a[4],
        i = a[5],
        j = a[6],
        k = a[7],
        l = a[8],
        n = a[9],
        o = a[10],
        m = a[11],
        p = a[12],
        r = a[13],
        s = a[14],
        a = a[15],
        A = b[0],
        B = b[1],
        t = b[2],
        u = b[3],
        v = b[4],
        w = b[5],
        x = b[6],
        y = b[7],
        z = b[8],
        C = b[9],
        D = b[10],
        E = b[11],
        q = b[12],
        F = b[13],
        G = b[14],
        b = b[15];
    c[0] = A * d + B * h + t * l + u * p;
    c[1] = A * e + B * i + t * n + u * r;
    c[2] = A * g + B * j + t * o + u * s;
    c[3] = A * f + B * k + t * m + u * a;
    c[4] = v * d + w * h + x * l + y * p;
    c[5] = v * e + w * i + x * n + y * r;
    c[6] = v * g + w * j + x * o + y * s;
    c[7] = v * f + w * k + x * m + y * a;
    c[8] = z * d + C * h + D * l + E * p;
    c[9] = z * e + C * i + D * n + E * r;
    c[10] = z * g + C *
        j + D * o + E * s;
    c[11] = z * f + C * k + D * m + E * a;
    c[12] = q * d + F * h + G * l + b * p;
    c[13] = q * e + F * i + G * n + b * r;
    c[14] = q * g + F * j + G * o + b * s;
    c[15] = q * f + F * k + G * m + b * a;
    return c
};
mat4.multiplyVec3 = function(a, b, c) {
    c || (c = b);
    var d = b[0],
        e = b[1],
        b = b[2];
    c[0] = a[0] * d + a[4] * e + a[8] * b + a[12];
    c[1] = a[1] * d + a[5] * e + a[9] * b + a[13];
    c[2] = a[2] * d + a[6] * e + a[10] * b + a[14];
    return c
};
mat4.multiplyVec4 = function(a, b, c) {
    c || (c = b);
    var d = b[0],
        e = b[1],
        g = b[2],
        b = b[3];
    c[0] = a[0] * d + a[4] * e + a[8] * g + a[12] * b;
    c[1] = a[1] * d + a[5] * e + a[9] * g + a[13] * b;
    c[2] = a[2] * d + a[6] * e + a[10] * g + a[14] * b;
    c[3] = a[3] * d + a[7] * e + a[11] * g + a[15] * b;
    return c
};
mat4.translate = function(a, b, c) {
    var d = b[0],
        e = b[1],
        b = b[2],
        g, f, h, i, j, k, l, n, o, m, p, r;
    if (!c || a === c) return a[12] = a[0] * d + a[4] * e + a[8] * b + a[12], a[13] = a[1] * d + a[5] * e + a[9] * b + a[13], a[14] = a[2] * d + a[6] * e + a[10] * b + a[14], a[15] = a[3] * d + a[7] * e + a[11] * b + a[15], a;
    g = a[0];
    f = a[1];
    h = a[2];
    i = a[3];
    j = a[4];
    k = a[5];
    l = a[6];
    n = a[7];
    o = a[8];
    m = a[9];
    p = a[10];
    r = a[11];
    c[0] = g;
    c[1] = f;
    c[2] = h;
    c[3] = i;
    c[4] = j;
    c[5] = k;
    c[6] = l;
    c[7] = n;
    c[8] = o;
    c[9] = m;
    c[10] = p;
    c[11] = r;
    c[12] = g * d + j * e + o * b + a[12];
    c[13] = f * d + k * e + m * b + a[13];
    c[14] = h * d + l * e + p * b + a[14];
    c[15] = i * d + n * e + r * b + a[15];
    return c
};
mat4.scale = function(a, b, c) {
    var d = b[0],
        e = b[1],
        b = b[2];
    if (!c || a === c) return a[0] *= d, a[1] *= d, a[2] *= d, a[3] *= d, a[4] *= e, a[5] *= e, a[6] *= e, a[7] *= e, a[8] *= b, a[9] *= b, a[10] *= b, a[11] *= b, a;
    c[0] = a[0] * d;
    c[1] = a[1] * d;
    c[2] = a[2] * d;
    c[3] = a[3] * d;
    c[4] = a[4] * e;
    c[5] = a[5] * e;
    c[6] = a[6] * e;
    c[7] = a[7] * e;
    c[8] = a[8] * b;
    c[9] = a[9] * b;
    c[10] = a[10] * b;
    c[11] = a[11] * b;
    c[12] = a[12];
    c[13] = a[13];
    c[14] = a[14];
    c[15] = a[15];
    return c
};
mat4.rotate = function(a, b, c, d) {
    var e = c[0],
        g = c[1],
        c = c[2],
        f = Math.sqrt(e * e + g * g + c * c),
        h, i, j, k, l, n, o, m, p, r, s, A, B, t, u, v, w, x, y, z;
    if (!f) return null;
    f !== 1 && (f = 1 / f, e *= f, g *= f, c *= f);
    h = Math.sin(b);
    i = Math.cos(b);
    j = 1 - i;
    b = a[0];
    f = a[1];
    k = a[2];
    l = a[3];
    n = a[4];
    o = a[5];
    m = a[6];
    p = a[7];
    r = a[8];
    s = a[9];
    A = a[10];
    B = a[11];
    t = e * e * j + i;
    u = g * e * j + c * h;
    v = c * e * j - g * h;
    w = e * g * j - c * h;
    x = g * g * j + i;
    y = c * g * j + e * h;
    z = e * c * j + g * h;
    e = g * c * j - e * h;
    g = c * c * j + i;
    d ? a !== d && (d[12] = a[12], d[13] = a[13], d[14] = a[14], d[15] = a[15]) : d = a;
    d[0] = b * t + n * u + r * v;
    d[1] = f * t + o * u + s * v;
    d[2] = k * t + m * u + A *
        v;
    d[3] = l * t + p * u + B * v;
    d[4] = b * w + n * x + r * y;
    d[5] = f * w + o * x + s * y;
    d[6] = k * w + m * x + A * y;
    d[7] = l * w + p * x + B * y;
    d[8] = b * z + n * e + r * g;
    d[9] = f * z + o * e + s * g;
    d[10] = k * z + m * e + A * g;
    d[11] = l * z + p * e + B * g;
    return d
};
mat4.rotateX = function(a, b, c) {
    var d = Math.sin(b),
        b = Math.cos(b),
        e = a[4],
        g = a[5],
        f = a[6],
        h = a[7],
        i = a[8],
        j = a[9],
        k = a[10],
        l = a[11];
    c ? a !== c && (c[0] = a[0], c[1] = a[1], c[2] = a[2], c[3] = a[3], c[12] = a[12], c[13] = a[13], c[14] = a[14], c[15] = a[15]) : c = a;
    c[4] = e * b + i * d;
    c[5] = g * b + j * d;
    c[6] = f * b + k * d;
    c[7] = h * b + l * d;
    c[8] = e * -d + i * b;
    c[9] = g * -d + j * b;
    c[10] = f * -d + k * b;
    c[11] = h * -d + l * b;
    return c
};
mat4.rotateY = function(a, b, c) {
    var d = Math.sin(b),
        b = Math.cos(b),
        e = a[0],
        g = a[1],
        f = a[2],
        h = a[3],
        i = a[8],
        j = a[9],
        k = a[10],
        l = a[11];
    c ? a !== c && (c[4] = a[4], c[5] = a[5], c[6] = a[6], c[7] = a[7], c[12] = a[12], c[13] = a[13], c[14] = a[14], c[15] = a[15]) : c = a;
    c[0] = e * b + i * -d;
    c[1] = g * b + j * -d;
    c[2] = f * b + k * -d;
    c[3] = h * b + l * -d;
    c[8] = e * d + i * b;
    c[9] = g * d + j * b;
    c[10] = f * d + k * b;
    c[11] = h * d + l * b;
    return c
};
mat4.rotateZ = function(a, b, c) {
    var d = Math.sin(b),
        b = Math.cos(b),
        e = a[0],
        g = a[1],
        f = a[2],
        h = a[3],
        i = a[4],
        j = a[5],
        k = a[6],
        l = a[7];
    c ? a !== c && (c[8] = a[8], c[9] = a[9], c[10] = a[10], c[11] = a[11], c[12] = a[12], c[13] = a[13], c[14] = a[14], c[15] = a[15]) : c = a;
    c[0] = e * b + i * d;
    c[1] = g * b + j * d;
    c[2] = f * b + k * d;
    c[3] = h * b + l * d;
    c[4] = e * -d + i * b;
    c[5] = g * -d + j * b;
    c[6] = f * -d + k * b;
    c[7] = h * -d + l * b;
    return c
};
mat4.frustum = function(a, b, c, d, e, g, f) {
    f || (f = mat4.create());
    var h = b - a,
        i = d - c,
        j = g - e;
    f[0] = e * 2 / h;
    f[1] = 0;
    f[2] = 0;
    f[3] = 0;
    f[4] = 0;
    f[5] = e * 2 / i;
    f[6] = 0;
    f[7] = 0;
    f[8] = (b + a) / h;
    f[9] = (d + c) / i;
    f[10] = -(g + e) / j;
    f[11] = -1;
    f[12] = 0;
    f[13] = 0;
    f[14] = -(g * e * 2) / j;
    f[15] = 0;
    return f
};
mat4.perspective = function(a, b, c, d, e) {
    a = c * Math.tan(a * Math.PI / 360);
    b *= a;
    return mat4.frustum(-b, b, -a, a, c, d, e)
};
mat4.ortho = function(a, b, c, d, e, g, f) {
    f || (f = mat4.create());
    var h = b - a,
        i = d - c,
        j = g - e;
    f[0] = 2 / h;
    f[1] = 0;
    f[2] = 0;
    f[3] = 0;
    f[4] = 0;
    f[5] = 2 / i;
    f[6] = 0;
    f[7] = 0;
    f[8] = 0;
    f[9] = 0;
    f[10] = -2 / j;
    f[11] = 0;
    f[12] = -(a + b) / h;
    f[13] = -(d + c) / i;
    f[14] = -(g + e) / j;
    f[15] = 1;
    return f
};
mat4.lookAt = function(a, b, c, d) {
    d || (d = mat4.create());
    var e, g, f, h, i, j, k, l, n = a[0],
        o = a[1],
        a = a[2];
    g = c[0];
    f = c[1];
    e = c[2];
    c = b[1];
    j = b[2];
    if (n === b[0] && o === c && a === j) return mat4.identity(d);
    c = n - b[0];
    j = o - b[1];
    k = a - b[2];
    l = 1 / Math.sqrt(c * c + j * j + k * k);
    c *= l;
    j *= l;
    k *= l;
    b = f * k - e * j;
    e = e * c - g * k;
    g = g * j - f * c;
    (l = Math.sqrt(b * b + e * e + g * g)) ? (l = 1 / l, b *= l, e *= l, g *= l) : g = e = b = 0;
    f = j * g - k * e;
    h = k * b - c * g;
    i = c * e - j * b;
    (l = Math.sqrt(f * f + h * h + i * i)) ? (l = 1 / l, f *= l, h *= l, i *= l) : i = h = f = 0;
    d[0] = b;
    d[1] = f;
    d[2] = c;
    d[3] = 0;
    d[4] = e;
    d[5] = h;
    d[6] = j;
    d[7] = 0;
    d[8] = g;
    d[9] = i;
    d[10] = k;
    d[11] =
        0;
    d[12] = -(b * n + e * o + g * a);
    d[13] = -(f * n + h * o + i * a);
    d[14] = -(c * n + j * o + k * a);
    d[15] = 1;
    return d
};
mat4.fromRotationTranslation = function(a, b, c) {
    c || (c = mat4.create());
    var d = a[0],
        e = a[1],
        g = a[2],
        f = a[3],
        h = d + d,
        i = e + e,
        j = g + g,
        a = d * h,
        k = d * i;
    d *= j;
    var l = e * i;
    e *= j;
    g *= j;
    h *= f;
    i *= f;
    f *= j;
    c[0] = 1 - (l + g);
    c[1] = k + f;
    c[2] = d - i;
    c[3] = 0;
    c[4] = k - f;
    c[5] = 1 - (a + g);
    c[6] = e + h;
    c[7] = 0;
    c[8] = d + i;
    c[9] = e - h;
    c[10] = 1 - (a + l);
    c[11] = 0;
    c[12] = b[0];
    c[13] = b[1];
    c[14] = b[2];
    c[15] = 1;
    return c
};
mat4.str = function(a) {
    return "[" + a[0] + ", " + a[1] + ", " + a[2] + ", " + a[3] + ", " + a[4] + ", " + a[5] + ", " + a[6] + ", " + a[7] + ", " + a[8] + ", " + a[9] + ", " + a[10] + ", " + a[11] + ", " + a[12] + ", " + a[13] + ", " + a[14] + ", " + a[15] + "]"
};
quat4.create = function(a) {
    var b = new MatrixArray(4);
    a && (b[0] = a[0], b[1] = a[1], b[2] = a[2], b[3] = a[3]);
    return b
};
quat4.set = function(a, b) {
    b[0] = a[0];
    b[1] = a[1];
    b[2] = a[2];
    b[3] = a[3];
    return b
};
quat4.calculateW = function(a, b) {
    var c = a[0],
        d = a[1],
        e = a[2];
    if (!b || a === b) return a[3] = -Math.sqrt(Math.abs(1 - c * c - d * d - e * e)), a;
    b[0] = c;
    b[1] = d;
    b[2] = e;
    b[3] = -Math.sqrt(Math.abs(1 - c * c - d * d - e * e));
    return b
};
quat4.inverse = function(a, b) {
    if (!b || a === b) return a[0] *= -1, a[1] *= -1, a[2] *= -1, a;
    b[0] = -a[0];
    b[1] = -a[1];
    b[2] = -a[2];
    b[3] = a[3];
    return b
};
quat4.length = function(a) {
    var b = a[0],
        c = a[1],
        d = a[2],
        a = a[3];
    return Math.sqrt(b * b + c * c + d * d + a * a)
};
quat4.normalize = function(a, b) {
    b || (b = a);
    var c = a[0],
        d = a[1],
        e = a[2],
        g = a[3],
        f = Math.sqrt(c * c + d * d + e * e + g * g);
    if (f === 0) return b[0] = 0, b[1] = 0, b[2] = 0, b[3] = 0, b;
    f = 1 / f;
    b[0] = c * f;
    b[1] = d * f;
    b[2] = e * f;
    b[3] = g * f;
    return b
};
quat4.multiply = function(a, b, c) {
    c || (c = a);
    var d = a[0],
        e = a[1],
        g = a[2],
        a = a[3],
        f = b[0],
        h = b[1],
        i = b[2],
        b = b[3];
    c[0] = d * b + a * f + e * i - g * h;
    c[1] = e * b + a * h + g * f - d * i;
    c[2] = g * b + a * i + d * h - e * f;
    c[3] = a * b - d * f - e * h - g * i;
    return c
};
quat4.multiplyVec3 = function(a, b, c) {
    c || (c = b);
    var d = b[0],
        e = b[1],
        g = b[2],
        b = a[0],
        f = a[1],
        h = a[2],
        a = a[3],
        i = a * d + f * g - h * e,
        j = a * e + h * d - b * g,
        k = a * g + b * e - f * d,
        d = -b * d - f * e - h * g;
    c[0] = i * a + d * -b + j * -h - k * -f;
    c[1] = j * a + d * -f + k * -b - i * -h;
    c[2] = k * a + d * -h + i * -f - j * -b;
    return c
};
quat4.toMat3 = function(a, b) {
    b || (b = mat3.create());
    var c = a[0],
        d = a[1],
        e = a[2],
        g = a[3],
        f = c + c,
        h = d + d,
        i = e + e,
        j = c * f,
        k = c * h;
    c *= i;
    var l = d * h;
    d *= i;
    e *= i;
    f *= g;
    h *= g;
    g *= i;
    b[0] = 1 - (l + e);
    b[1] = k + g;
    b[2] = c - h;
    b[3] = k - g;
    b[4] = 1 - (j + e);
    b[5] = d + f;
    b[6] = c + h;
    b[7] = d - f;
    b[8] = 1 - (j + l);
    return b
};
quat4.toMat4 = function(a, b) {
    b || (b = mat4.create());
    var c = a[0],
        d = a[1],
        e = a[2],
        g = a[3],
        f = c + c,
        h = d + d,
        i = e + e,
        j = c * f,
        k = c * h;
    c *= i;
    var l = d * h;
    d *= i;
    e *= i;
    f *= g;
    h *= g;
    g *= i;
    b[0] = 1 - (l + e);
    b[1] = k + g;
    b[2] = c - h;
    b[3] = 0;
    b[4] = k - g;
    b[5] = 1 - (j + e);
    b[6] = d + f;
    b[7] = 0;
    b[8] = c + h;
    b[9] = d - f;
    b[10] = 1 - (j + l);
    b[11] = 0;
    b[12] = 0;
    b[13] = 0;
    b[14] = 0;
    b[15] = 1;
    return b
};
quat4.slerp = function(a, b, c, d) {
    d || (d = a);
    var e = a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3],
        g, f;
    if (Math.abs(e) >= 1) return d !== a && (d[0] = a[0], d[1] = a[1], d[2] = a[2], d[3] = a[3]), d;
    g = Math.acos(e);
    f = Math.sqrt(1 - e * e);
    if (Math.abs(f) < 0.001) return d[0] = a[0] * 0.5 + b[0] * 0.5, d[1] = a[1] * 0.5 + b[1] * 0.5, d[2] = a[2] * 0.5 + b[2] * 0.5, d[3] = a[3] * 0.5 + b[3] * 0.5, d;
    e = Math.sin((1 - c) * g) / f;
    c = Math.sin(c * g) / f;
    d[0] = a[0] * e + b[0] * c;
    d[1] = a[1] * e + b[1] * c;
    d[2] = a[2] * e + b[2] * c;
    d[3] = a[3] * e + b[3] * c;
    return d
};
quat4.str = function(a) {
    return "[" + a[0] + ", " + a[1] + ", " + a[2] + ", " + a[3] + "]"
};
(function() {
    var MAX_VERTICES = 8000; // equates to 2500 objects being drawn
    var MAX_INDICES = (MAX_VERTICES / 2) * 3; // 6 indices for every 4 vertices
    var MAX_POINTS = 8000;
    var MULTI_BUFFERS = 4; // cycle 4 buffers to try and avoid blocking
    var BATCH_NULL = 0;
    var BATCH_QUAD = 1;
    var BATCH_SETTEXTURE = 2;
    var BATCH_SETOPACITY = 3;
    var BATCH_SETBLEND = 4;
    var BATCH_UPDATEMODELVIEW = 5;
    var BATCH_RENDERTOTEXTURE = 6;
    var BATCH_CLEAR = 7;
    var BATCH_POINTS = 8;
    var BATCH_SETPROGRAM = 9;
    var BATCH_SETPROGRAMPARAMETERS = 10;
    var BATCH_SETTEXTURE1 = 11;

    function GLWrap_(gl, isMobile) {
        this.isIE = /msie/i.test(navigator.userAgent) || /trident/i.test(navigator.userAgent);
        this.width = 0; // not yet known, wait for call to setSize()
        this.height = 0;
        this.cam = vec3.create([0, 0, 100]); // camera position
        this.look = vec3.create([0, 0, 0]); // lookat position
        this.up = vec3.create([0, 1, 0]); // up vector
        this.worldScale = vec3.create([1, 1, 1]); // world scaling factor
        this.enable_mipmaps = true;
        this.matP = mat4.create(); // perspective matrix
        this.matMV = mat4.create(); // model view matrix
        this.lastMV = mat4.create();
        this.currentMV = mat4.create();
        this.gl = gl;
        this.initState();
    };
    GLWrap_.prototype.initState = function() {
        var gl = this.gl;
        var i, len;
        this.lastOpacity = 1;
        this.lastTexture0 = null; // last bound to TEXTURE0
        this.lastTexture1 = null; // last bound to TEXTURE1
        this.currentOpacity = 1;
        gl.clearColor(0, 0, 0, 0);
        gl.clear(gl.COLOR_BUFFER_BIT);
        gl.enable(gl.BLEND);
        gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);
        gl.disable(gl.CULL_FACE);
        gl.disable(gl.DEPTH_TEST);
        this.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);
        this.lastSrcBlend = gl.ONE;
        this.lastDestBlend = gl.ONE_MINUS_SRC_ALPHA;
        this.pointBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this.pointBuffer);
        this.vertexBuffers = new Array(MULTI_BUFFERS);
        this.texcoordBuffers = new Array(MULTI_BUFFERS);
        for (i = 0; i < MULTI_BUFFERS; i++) {
            this.vertexBuffers[i] = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffers[i]);
            this.texcoordBuffers[i] = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, this.texcoordBuffers[i]);
        }
        this.curBuffer = 0;
        this.indexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);
        this.vertexData = new Float32Array(MAX_VERTICES * 2);
        this.texcoordData = new Float32Array(MAX_VERTICES * 2);
        this.pointData = new Float32Array(MAX_POINTS * 4);
        var indexData = new Uint16Array(MAX_INDICES);
        i = 0, len = MAX_INDICES;
        var fv = 0;
        while (i < len) {
            indexData[i++] = fv; // top left
            indexData[i++] = fv + 1; // top right
            indexData[i++] = fv + 2; // bottom right (first tri)
            indexData[i++] = fv; // top left
            indexData[i++] = fv + 2; // bottom right
            indexData[i++] = fv + 3; // bottom left
            fv += 4;
        }
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indexData, gl.STATIC_DRAW);
        this.vertexPtr = 0;
        this.pointPtr = 0;
        var fsSource, vsSource;
        this.shaderPrograms = [];
        fsSource = [
            "varying mediump vec2 vTex;",
            "uniform lowp float opacity;",
            "uniform lowp sampler2D samplerFront;",
            "void main(void) {",
            "	gl_FragColor = texture2D(samplerFront, vTex);",
            "	gl_FragColor *= opacity;",
            "}"
        ].join("\n");
        vsSource = [
            "attribute highp vec2 aPos;",
            "attribute mediump vec2 aTex;",
            "varying mediump vec2 vTex;",
            "uniform highp mat4 matP;",
            "uniform highp mat4 matMV;",
            "void main(void) {",
            "	gl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);",
            "	vTex = aTex;",
            "}"
        ].join("\n");
        var shaderProg = this.createShaderProgram({
            src: fsSource
        }, vsSource, "<default>");;
        this.shaderPrograms.push(shaderProg); // Default shader is always shader 0
        fsSource = [
            "uniform mediump sampler2D samplerFront;",
            "varying lowp float opacity;",
            "void main(void) {",
            "	gl_FragColor = texture2D(samplerFront, gl_PointCoord);",
            "	gl_FragColor *= opacity;",
            "}"
        ].join("\n");
        var pointVsSource = [
            "attribute vec4 aPos;",
            "varying float opacity;",
            "uniform mat4 matP;",
            "uniform mat4 matMV;",
            "void main(void) {",
            "	gl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);",
            "	gl_PointSize = aPos.z;",
            "	opacity = aPos.w;",
            "}"
        ].join("\n");
        shaderProg = this.createShaderProgram({
            src: fsSource
        }, pointVsSource, "<point>");;
        this.shaderPrograms.push(shaderProg); // Point shader is always shader 1
        for (var shader_name in cr.shaders) {
            if (cr.shaders.hasOwnProperty(shader_name))
                this.shaderPrograms.push(this.createShaderProgram(cr.shaders[shader_name], vsSource, shader_name));
        }
        gl.activeTexture(gl.TEXTURE0);
        gl.bindTexture(gl.TEXTURE_2D, null);
        this.batch = [];
        this.batchPtr = 0;
        this.hasQuadBatchTop = false;
        this.hasPointBatchTop = false;
        this.lastProgram = -1; // start -1 so first switchProgram can do work
        this.currentProgram = -1; // current program during batch execution
        this.currentShader = null;
        this.fbo = gl.createFramebuffer();
        this.renderToTex = null;
        this.tmpVec3 = vec3.create([0, 0, 0]);;;
        var pointsizes = gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE);
        this.minPointSize = pointsizes[0];
        this.maxPointSize = pointsizes[1];
        if (this.maxPointSize > 2048)
            this.maxPointSize = 2048;;
        this.switchProgram(0);
        cr.seal(this);
    };

    function GLShaderProgram(gl, shaderProgram, name) {
        this.gl = gl;
        this.shaderProgram = shaderProgram;
        this.name = name;
        this.locAPos = gl.getAttribLocation(shaderProgram, "aPos");
        this.locATex = gl.getAttribLocation(shaderProgram, "aTex");
        this.locMatP = gl.getUniformLocation(shaderProgram, "matP");
        this.locMatMV = gl.getUniformLocation(shaderProgram, "matMV");
        this.locOpacity = gl.getUniformLocation(shaderProgram, "opacity");
        this.locSamplerFront = gl.getUniformLocation(shaderProgram, "samplerFront");
        this.locSamplerBack = gl.getUniformLocation(shaderProgram, "samplerBack");
        this.locDestStart = gl.getUniformLocation(shaderProgram, "destStart");
        this.locDestEnd = gl.getUniformLocation(shaderProgram, "destEnd");
        this.locSeconds = gl.getUniformLocation(shaderProgram, "seconds");
        this.locPixelWidth = gl.getUniformLocation(shaderProgram, "pixelWidth");
        this.locPixelHeight = gl.getUniformLocation(shaderProgram, "pixelHeight");
        this.locLayerScale = gl.getUniformLocation(shaderProgram, "layerScale");
        this.locLayerAngle = gl.getUniformLocation(shaderProgram, "layerAngle");
        this.locViewOrigin = gl.getUniformLocation(shaderProgram, "viewOrigin");
        this.hasAnyOptionalUniforms = !!(this.locPixelWidth || this.locPixelHeight || this.locSeconds || this.locSamplerBack || this.locDestStart || this.locDestEnd || this.locLayerScale || this.locLayerAngle || this.locViewOrigin);
        if (this.locOpacity)
            gl.uniform1f(this.locOpacity, 1);
        if (this.locSamplerFront)
            gl.uniform1i(this.locSamplerFront, 0);
        if (this.locSamplerBack)
            gl.uniform1i(this.locSamplerBack, 1);
        if (this.locDestStart)
            gl.uniform2f(this.locDestStart, 0.0, 0.0);
        if (this.locDestEnd)
            gl.uniform2f(this.locDestEnd, 1.0, 1.0);
        if (this.locLayerScale)
            gl.uniform1f(this.locLayerScale, 1.0);
        if (this.locLayerAngle)
            gl.uniform1f(this.locLayerAngle, 0.0);
        if (this.locViewOrigin)
            gl.uniform2f(this.locViewOrigin, 0.0, 0.0);
        this.hasCurrentMatMV = false; // matMV needs updating
    };
    GLWrap_.prototype.createShaderProgram = function(shaderEntry, vsSource, name) {
        var gl = this.gl;
        var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fragmentShader, shaderEntry.src);
        gl.compileShader(fragmentShader);
        if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {;
            gl.deleteShader(fragmentShader);
            return null;
        }
        var vertexShader = gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vertexShader, vsSource);
        gl.compileShader(vertexShader);
        if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {;
            gl.deleteShader(fragmentShader);
            gl.deleteShader(vertexShader);
            return null;
        }
        var shaderProgram = gl.createProgram();
        gl.attachShader(shaderProgram, fragmentShader);
        gl.attachShader(shaderProgram, vertexShader);
        gl.linkProgram(shaderProgram);
        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {;
            gl.deleteShader(fragmentShader);
            gl.deleteShader(vertexShader);
            gl.deleteProgram(shaderProgram);
            return null;
        }
        gl.useProgram(shaderProgram);;
        gl.deleteShader(fragmentShader);
        gl.deleteShader(vertexShader);
        var ret = new GLShaderProgram(gl, shaderProgram, name);
        ret.extendBoxHorizontal = shaderEntry.extendBoxHorizontal || 0;
        ret.extendBoxVertical = shaderEntry.extendBoxVertical || 0;
        ret.crossSampling = !!shaderEntry.crossSampling;
        ret.animated = !!shaderEntry.animated;
        ret.parameters = shaderEntry.parameters || [];
        var i, len;
        for (i = 0, len = ret.parameters.length; i < len; i++) {
            ret.parameters[i][1] = gl.getUniformLocation(shaderProgram, ret.parameters[i][0]);
            gl.uniform1f(ret.parameters[i][1], 0);
        }
        cr.seal(ret);
        return ret;
    };
    GLWrap_.prototype.getShaderIndex = function(name_) {
        var i, len;
        for (i = 0, len = this.shaderPrograms.length; i < len; i++) {
            if (this.shaderPrograms[i].name === name_)
                return i;
        }
        return -1;
    };
    GLWrap_.prototype.project = function(x, y, out) {
        var mv = this.matMV;
        var proj = this.matP;
        var fTempo = [0, 0, 0, 0, 0, 0, 0, 0];
        fTempo[0] = mv[0] * x + mv[4] * y + mv[12];
        fTempo[1] = mv[1] * x + mv[5] * y + mv[13];
        fTempo[2] = mv[2] * x + mv[6] * y + mv[14];
        fTempo[3] = mv[3] * x + mv[7] * y + mv[15];
        fTempo[4] = proj[0] * fTempo[0] + proj[4] * fTempo[1] + proj[8] * fTempo[2] + proj[12] * fTempo[3];
        fTempo[5] = proj[1] * fTempo[0] + proj[5] * fTempo[1] + proj[9] * fTempo[2] + proj[13] * fTempo[3];
        fTempo[6] = proj[2] * fTempo[0] + proj[6] * fTempo[1] + proj[10] * fTempo[2] + proj[14] * fTempo[3];
        fTempo[7] = -fTempo[2];
        if (fTempo[7] === 0.0) //The w value
            return;
        fTempo[7] = 1.0 / fTempo[7];
        fTempo[4] *= fTempo[7];
        fTempo[5] *= fTempo[7];
        fTempo[6] *= fTempo[7];
        out[0] = (fTempo[4] * 0.5 + 0.5) * this.width;
        out[1] = (fTempo[5] * 0.5 + 0.5) * this.height;
    };
    GLWrap_.prototype.setSize = function(w, h, force) {
        if (this.width === w && this.height === h && !force)
            return;
        this.endBatch();
        this.width = w;
        this.height = h;
        this.gl.viewport(0, 0, w, h);
        mat4.perspective(45, w / h, 1, 1000, this.matP);
        mat4.lookAt(this.cam, this.look, this.up, this.matMV);
        var tl = [0, 0];
        var br = [0, 0];
        this.project(0, 0, tl);
        this.project(1, 1, br);
        this.worldScale[0] = 1 / (br[0] - tl[0]);
        this.worldScale[1] = -1 / (br[1] - tl[1]);
        var i, len, s;
        for (i = 0, len = this.shaderPrograms.length; i < len; i++) {
            s = this.shaderPrograms[i];
            s.hasCurrentMatMV = false;
            if (s.locMatP) {
                this.gl.useProgram(s.shaderProgram);
                this.gl.uniformMatrix4fv(s.locMatP, false, this.matP);
            }
        }
        this.gl.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram);
        this.gl.bindTexture(this.gl.TEXTURE_2D, null);
        this.gl.activeTexture(this.gl.TEXTURE1);
        this.gl.bindTexture(this.gl.TEXTURE_2D, null);
        this.gl.activeTexture(this.gl.TEXTURE0);
        this.lastTexture0 = null;
        this.lastTexture1 = null;
    };
    GLWrap_.prototype.resetModelView = function() {
        mat4.lookAt(this.cam, this.look, this.up, this.matMV);
        mat4.scale(this.matMV, this.worldScale);
    };
    GLWrap_.prototype.translate = function(x, y) {
        if (x === 0 && y === 0)
            return;
        this.tmpVec3[0] = x; // * this.worldScale[0];
        this.tmpVec3[1] = y; // * this.worldScale[1];
        this.tmpVec3[2] = 0;
        mat4.translate(this.matMV, this.tmpVec3);
    };
    GLWrap_.prototype.scale = function(x, y) {
        if (x === 1 && y === 1)
            return;
        this.tmpVec3[0] = x;
        this.tmpVec3[1] = y;
        this.tmpVec3[2] = 1;
        mat4.scale(this.matMV, this.tmpVec3);
    };
    GLWrap_.prototype.rotateZ = function(a) {
        if (a === 0)
            return;
        mat4.rotateZ(this.matMV, a);
    };
    GLWrap_.prototype.updateModelView = function() {
        var anydiff = false;
        for (var i = 0; i < 16; i++) {
            if (this.lastMV[i] !== this.matMV[i]) {
                anydiff = true;
                break;
            }
        }
        if (!anydiff)
            return;
        var b = this.pushBatch();
        b.type = BATCH_UPDATEMODELVIEW;
        if (b.mat4param)
            mat4.set(this.matMV, b.mat4param);
        else
            b.mat4param = mat4.create(this.matMV);
        mat4.set(this.matMV, this.lastMV);
        this.hasQuadBatchTop = false;
        this.hasPointBatchTop = false;
    };
    /*
	var debugBatch = false;
	jQuery(document).mousedown(
		function(info) {
			if (info.which === 2)
				debugBatch = true;
		}
	);
	*/
    function GLBatchJob(type_, glwrap_) {
        this.type = type_;
        this.glwrap = glwrap_;
        this.gl = glwrap_.gl;
        this.opacityParam = 0; // for setOpacity()
        this.startIndex = 0; // for quad()
        this.indexCount = 0; // "
        this.texParam = null; // for setTexture()
        this.mat4param = null; // for updateModelView()
        this.shaderParams = []; // for user parameters
        cr.seal(this);
    };
    GLBatchJob.prototype.doSetTexture = function() {
        this.gl.bindTexture(this.gl.TEXTURE_2D, this.texParam);
    };
    GLBatchJob.prototype.doSetTexture1 = function() {
        var gl = this.gl;
        gl.activeTexture(gl.TEXTURE1);
        gl.bindTexture(gl.TEXTURE_2D, this.texParam);
        gl.activeTexture(gl.TEXTURE0);
    };
    GLBatchJob.prototype.doSetOpacity = function() {
        var o = this.opacityParam;
        var glwrap = this.glwrap;
        glwrap.currentOpacity = o;
        var curProg = glwrap.currentShader;
        if (curProg.locOpacity)
            this.gl.uniform1f(curProg.locOpacity, o);
    };
    GLBatchJob.prototype.doQuad = function() {
        this.gl.drawElements(this.gl.TRIANGLES, this.indexCount, this.gl.UNSIGNED_SHORT, this.startIndex * 2);
    };
    GLBatchJob.prototype.doSetBlend = function() {
        this.gl.blendFunc(this.startIndex, this.indexCount);
    };
    GLBatchJob.prototype.doUpdateModelView = function() {
        var i, len, s, shaderPrograms = this.glwrap.shaderPrograms,
            currentProgram = this.glwrap.currentProgram;
        for (i = 0, len = shaderPrograms.length; i < len; i++) {
            s = shaderPrograms[i];
            if (i === currentProgram && s.locMatMV) {
                this.gl.uniformMatrix4fv(s.locMatMV, false, this.mat4param);
                s.hasCurrentMatMV = true;
            } else
                s.hasCurrentMatMV = false;
        }
        mat4.set(this.mat4param, this.glwrap.currentMV);
    };
    GLBatchJob.prototype.doRenderToTexture = function() {
        var gl = this.gl;
        var glwrap = this.glwrap;
        if (this.texParam) {
            if (glwrap.lastTexture1 === this.texParam) {
                gl.activeTexture(gl.TEXTURE1);
                gl.bindTexture(gl.TEXTURE_2D, null);
                glwrap.lastTexture1 = null;
                gl.activeTexture(gl.TEXTURE0);
            }
            gl.bindFramebuffer(gl.FRAMEBUFFER, glwrap.fbo);
            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.texParam, 0);
        } else {
            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, null, 0);
            gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        }
    };
    GLBatchJob.prototype.doClear = function() {
        var gl = this.gl;
        if (this.startIndex === 0) // clear whole surface
        {
            gl.clearColor(this.mat4param[0], this.mat4param[1], this.mat4param[2], this.mat4param[3]);
            gl.clear(gl.COLOR_BUFFER_BIT);
        } else // clear rectangle
        {
            gl.enable(gl.SCISSOR_TEST);
            gl.scissor(this.mat4param[0], this.mat4param[1], this.mat4param[2], this.mat4param[3]);
            gl.clearColor(0, 0, 0, 0);
            gl.clear(this.gl.COLOR_BUFFER_BIT);
            gl.disable(gl.SCISSOR_TEST);
        }
    };
    GLBatchJob.prototype.doPoints = function() {
        var gl = this.gl;
        var glwrap = this.glwrap;
        var s = glwrap.shaderPrograms[1];
        gl.useProgram(s.shaderProgram);
        if (!s.hasCurrentMatMV && s.locMatMV) {
            gl.uniformMatrix4fv(s.locMatMV, false, glwrap.currentMV);
            s.hasCurrentMatMV = true;
        }
        gl.enableVertexAttribArray(s.locAPos);
        gl.bindBuffer(gl.ARRAY_BUFFER, glwrap.pointBuffer);
        gl.vertexAttribPointer(s.locAPos, 4, gl.FLOAT, false, 0, 0);
        gl.drawArrays(gl.POINTS, this.startIndex / 4, this.indexCount);
        s = glwrap.currentShader;
        gl.useProgram(s.shaderProgram);
        if (s.locAPos >= 0) {
            gl.enableVertexAttribArray(s.locAPos);
            gl.bindBuffer(gl.ARRAY_BUFFER, glwrap.vertexBuffers[glwrap.curBuffer]);
            gl.vertexAttribPointer(s.locAPos, 2, gl.FLOAT, false, 0, 0);
        }
        if (s.locATex >= 0) {
            gl.enableVertexAttribArray(s.locATex);
            gl.bindBuffer(gl.ARRAY_BUFFER, glwrap.texcoordBuffers[glwrap.curBuffer]);
            gl.vertexAttribPointer(s.locATex, 2, gl.FLOAT, false, 0, 0);
        }
    };
    GLBatchJob.prototype.doSetProgram = function() {
        var gl = this.gl;
        var glwrap = this.glwrap;
        var s = glwrap.shaderPrograms[this.startIndex]; // recycled param to save memory
        glwrap.currentProgram = this.startIndex; // current batch program
        glwrap.currentShader = s;
        gl.useProgram(s.shaderProgram); // switch to
        if (!s.hasCurrentMatMV && s.locMatMV) {
            gl.uniformMatrix4fv(s.locMatMV, false, glwrap.currentMV);
            s.hasCurrentMatMV = true;
        }
        if (s.locOpacity)
            gl.uniform1f(s.locOpacity, glwrap.currentOpacity);
        if (s.locAPos >= 0) {
            gl.enableVertexAttribArray(s.locAPos);
            gl.bindBuffer(gl.ARRAY_BUFFER, glwrap.vertexBuffers[glwrap.curBuffer]);
            gl.vertexAttribPointer(s.locAPos, 2, gl.FLOAT, false, 0, 0);
        }
        if (s.locATex >= 0) {
            gl.enableVertexAttribArray(s.locATex);
            gl.bindBuffer(gl.ARRAY_BUFFER, glwrap.texcoordBuffers[glwrap.curBuffer]);
            gl.vertexAttribPointer(s.locATex, 2, gl.FLOAT, false, 0, 0);
        }
    }
    GLBatchJob.prototype.doSetProgramParameters = function() {
        var i, len, s = this.glwrap.currentShader;
        var gl = this.gl;
        var mat4param = this.mat4param;
        if (s.locSamplerBack && this.glwrap.lastTexture1 !== this.texParam) {
            gl.activeTexture(gl.TEXTURE1);
            gl.bindTexture(gl.TEXTURE_2D, this.texParam);
            this.glwrap.lastTexture1 = this.texParam;
            gl.activeTexture(gl.TEXTURE0);
        }
        if (s.locPixelWidth)
            gl.uniform1f(s.locPixelWidth, mat4param[0]);
        if (s.locPixelHeight)
            gl.uniform1f(s.locPixelHeight, mat4param[1]);
        if (s.locDestStart)
            gl.uniform2f(s.locDestStart, mat4param[2], mat4param[3]);
        if (s.locDestEnd)
            gl.uniform2f(s.locDestEnd, mat4param[4], mat4param[5]);
        if (s.locLayerScale)
            gl.uniform1f(s.locLayerScale, mat4param[6]);
        if (s.locLayerAngle)
            gl.uniform1f(s.locLayerAngle, mat4param[7]);
        if (s.locViewOrigin)
            gl.uniform2f(s.locViewOrigin, mat4param[8], mat4param[9]);
        if (s.locSeconds)
            gl.uniform1f(s.locSeconds, cr.performance_now() / 1000.0);
        if (s.parameters.length) {
            for (i = 0, len = s.parameters.length; i < len; i++) {
                gl.uniform1f(s.parameters[i][1], this.shaderParams[i]);
            }
        }
    };
    GLWrap_.prototype.pushBatch = function() {
        if (this.batchPtr === this.batch.length)
            this.batch.push(new GLBatchJob(BATCH_NULL, this));
        return this.batch[this.batchPtr++];
    };
    GLWrap_.prototype.endBatch = function() {
        if (this.batchPtr === 0)
            return;
        if (this.gl.isContextLost())
            return;
        var gl = this.gl;
        if (this.pointPtr > 0) {
            gl.bindBuffer(gl.ARRAY_BUFFER, this.pointBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, this.pointData.subarray(0, this.pointPtr), gl.STREAM_DRAW);
            if (s && s.locAPos >= 0 && s.name === "<point>")
                gl.vertexAttribPointer(s.locAPos, 4, gl.FLOAT, false, 0, 0);
        }
        if (this.vertexPtr > 0) {
            var s = this.currentShader;
            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffers[this.curBuffer]);
            gl.bufferData(gl.ARRAY_BUFFER, this.vertexData.subarray(0, this.vertexPtr), gl.STREAM_DRAW);
            if (s && s.locAPos >= 0 && s.name !== "<point>")
                gl.vertexAttribPointer(s.locAPos, 2, gl.FLOAT, false, 0, 0);
            gl.bindBuffer(gl.ARRAY_BUFFER, this.texcoordBuffers[this.curBuffer]);
            gl.bufferData(gl.ARRAY_BUFFER, this.texcoordData.subarray(0, this.vertexPtr), gl.STREAM_DRAW);
            if (s && s.locATex >= 0 && s.name !== "<point>")
                gl.vertexAttribPointer(s.locATex, 2, gl.FLOAT, false, 0, 0);
        }
        var i, len, b;
        for (i = 0, len = this.batchPtr; i < len; i++) {
            b = this.batch[i];
            switch (b.type) {
                case 1:
                    b.doQuad();
                    break;
                case 2:
                    b.doSetTexture();
                    break;
                case 3:
                    b.doSetOpacity();
                    break;
                case 4:
                    b.doSetBlend();
                    break;
                case 5:
                    b.doUpdateModelView();
                    break;
                case 6:
                    b.doRenderToTexture();
                    break;
                case 7:
                    b.doClear();
                    break;
                case 8:
                    b.doPoints();
                    break;
                case 9:
                    b.doSetProgram();
                    break;
                case 10:
                    b.doSetProgramParameters();
                    break;
                case 11:
                    b.doSetTexture1();
                    break;
            }
        }
        this.batchPtr = 0;
        this.vertexPtr = 0;
        this.pointPtr = 0;
        this.hasQuadBatchTop = false;
        this.hasPointBatchTop = false;
        this.curBuffer++;
        if (this.curBuffer >= MULTI_BUFFERS)
            this.curBuffer = 0;
    };
    GLWrap_.prototype.setOpacity = function(op) {
        if (op === this.lastOpacity)
            return;
        var b = this.pushBatch();
        b.type = BATCH_SETOPACITY;
        b.opacityParam = op;
        this.lastOpacity = op;
        this.hasQuadBatchTop = false;
        this.hasPointBatchTop = false;
    };
    GLWrap_.prototype.setTexture = function(tex) {
        if (tex === this.lastTexture0)
            return;;
        var b = this.pushBatch();
        b.type = BATCH_SETTEXTURE;
        b.texParam = tex;
        this.lastTexture0 = tex;
        this.hasQuadBatchTop = false;
        this.hasPointBatchTop = false;
    };
    GLWrap_.prototype.setBlend = function(s, d) {
        if (s === this.lastSrcBlend && d === this.lastDestBlend)
            return;
        var b = this.pushBatch();
        b.type = BATCH_SETBLEND;
        b.startIndex = s; // recycle params to save memory
        b.indexCount = d;
        this.lastSrcBlend = s;
        this.lastDestBlend = d;
        this.hasQuadBatchTop = false;
        this.hasPointBatchTop = false;
    };
    GLWrap_.prototype.isPremultipliedAlphaBlend = function() {
        return (this.lastSrcBlend === this.gl.ONE && this.lastDestBlend === this.gl.ONE_MINUS_SRC_ALPHA);
    };
    GLWrap_.prototype.setAlphaBlend = function() {
        this.setBlend(this.gl.ONE, this.gl.ONE_MINUS_SRC_ALPHA);
    };
    GLWrap_.prototype.setNoPremultiplyAlphaBlend = function() {
        this.setBlend(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);
    };
    var LAST_VERTEX = MAX_VERTICES * 2 - 8;
    GLWrap_.prototype.quad = function(tlx, tly, trx, try_, brx, bry, blx, bly) {
        if (this.vertexPtr >= LAST_VERTEX)
            this.endBatch();
        var v = this.vertexPtr; // vertex cursor
        var vd = this.vertexData; // vertex data array
        var td = this.texcoordData; // texture coord data array
        if (this.hasQuadBatchTop) {
            this.batch[this.batchPtr - 1].indexCount += 6;
        } else {
            var b = this.pushBatch();
            b.type = BATCH_QUAD;
            b.startIndex = (v / 4) * 3;
            b.indexCount = 6;
            this.hasQuadBatchTop = true;
            this.hasPointBatchTop = false;
        }
        vd[v] = tlx;
        td[v++] = 0;
        vd[v] = tly;
        td[v++] = 0;
        vd[v] = trx;
        td[v++] = 1;
        vd[v] = try_;
        td[v++] = 0;
        vd[v] = brx;
        td[v++] = 1;
        vd[v] = bry;
        td[v++] = 1;
        vd[v] = blx;
        td[v++] = 0;
        vd[v] = bly;
        td[v++] = 1;
        this.vertexPtr = v;
    };
    GLWrap_.prototype.quadTex = function(tlx, tly, trx, try_, brx, bry, blx, bly, rcTex) {
        if (this.vertexPtr >= LAST_VERTEX)
            this.endBatch();
        var v = this.vertexPtr; // vertex cursor
        var vd = this.vertexData; // vertex data array
        var td = this.texcoordData; // texture coord data array
        if (this.hasQuadBatchTop) {
            this.batch[this.batchPtr - 1].indexCount += 6;
        } else {
            var b = this.pushBatch();
            b.type = BATCH_QUAD;
            b.startIndex = (v / 4) * 3;
            b.indexCount = 6;
            this.hasQuadBatchTop = true;
            this.hasPointBatchTop = false;
        }
        var rc_left = rcTex.left;
        var rc_top = rcTex.top;
        var rc_right = rcTex.right;
        var rc_bottom = rcTex.bottom;
        vd[v] = tlx;
        td[v++] = rc_left;
        vd[v] = tly;
        td[v++] = rc_top;
        vd[v] = trx;
        td[v++] = rc_right;
        vd[v] = try_;
        td[v++] = rc_top;
        vd[v] = brx;
        td[v++] = rc_right;
        vd[v] = bry;
        td[v++] = rc_bottom;
        vd[v] = blx;
        td[v++] = rc_left;
        vd[v] = bly;
        td[v++] = rc_bottom;
        this.vertexPtr = v;
    };
    GLWrap_.prototype.quadTexUV = function(tlx, tly, trx, try_, brx, bry, blx, bly, tlu, tlv, tru, trv, bru, brv, blu, blv) {
        if (this.vertexPtr >= LAST_VERTEX)
            this.endBatch();
        var v = this.vertexPtr; // vertex cursor
        var vd = this.vertexData; // vertex data array
        var td = this.texcoordData; // texture coord data array
        if (this.hasQuadBatchTop) {
            this.batch[this.batchPtr - 1].indexCount += 6;
        } else {
            var b = this.pushBatch();
            b.type = BATCH_QUAD;
            b.startIndex = (v / 4) * 3;
            b.indexCount = 6;
            this.hasQuadBatchTop = true;
            this.hasPointBatchTop = false;
        }
        vd[v] = tlx;
        td[v++] = tlu;
        vd[v] = tly;
        td[v++] = tlv;
        vd[v] = trx;
        td[v++] = tru;
        vd[v] = try_;
        td[v++] = trv;
        vd[v] = brx;
        td[v++] = bru;
        vd[v] = bry;
        td[v++] = brv;
        vd[v] = blx;
        td[v++] = blu;
        vd[v] = bly;
        td[v++] = blv;
        this.vertexPtr = v;
    };
    GLWrap_.prototype.convexPoly = function(pts) {
        var pts_count = pts.length / 2;;
        var tris = pts_count - 2; // 3 points = 1 tri, 4 points = 2 tris, 5 points = 3 tris etc.
        var last_tri = tris - 1;
        var p0x = pts[0];
        var p0y = pts[1];
        var i, i2, p1x, p1y, p2x, p2y, p3x, p3y;
        for (i = 0; i < tris; i += 2) // draw 2 triangles at a time
        {
            i2 = i * 2;
            p1x = pts[i2 + 2];
            p1y = pts[i2 + 3];
            p2x = pts[i2 + 4];
            p2y = pts[i2 + 5];
            if (i === last_tri) {
                this.quad(p0x, p0y, p1x, p1y, p2x, p2y, p2x, p2y);
            } else {
                p3x = pts[i2 + 6];
                p3y = pts[i2 + 7];
                this.quad(p0x, p0y, p1x, p1y, p2x, p2y, p3x, p3y);
            }
        }
    };
    var LAST_POINT = MAX_POINTS - 4;
    GLWrap_.prototype.point = function(x_, y_, size_, opacity_) {
        if (this.pointPtr >= LAST_POINT)
            this.endBatch();
        var p = this.pointPtr; // point cursor
        var pd = this.pointData; // point data array
        if (this.hasPointBatchTop) {
            this.batch[this.batchPtr - 1].indexCount++;
        } else {
            var b = this.pushBatch();
            b.type = BATCH_POINTS;
            b.startIndex = p;
            b.indexCount = 1;
            this.hasPointBatchTop = true;
            this.hasQuadBatchTop = false;
        }
        pd[p++] = x_;
        pd[p++] = y_;
        pd[p++] = size_;
        pd[p++] = opacity_;
        this.pointPtr = p;
    };
    GLWrap_.prototype.switchProgram = function(progIndex) {
        if (this.lastProgram === progIndex)
            return; // no change
        var shaderProg = this.shaderPrograms[progIndex];
        if (!shaderProg) {
            if (this.lastProgram === 0)
                return; // already on default shader
            progIndex = 0;
            shaderProg = this.shaderPrograms[0];
        }
        var b = this.pushBatch();
        b.type = BATCH_SETPROGRAM;
        b.startIndex = progIndex;
        this.lastProgram = progIndex;
        this.hasQuadBatchTop = false;
        this.hasPointBatchTop = false;
    };
    GLWrap_.prototype.programUsesDest = function(progIndex) {
        var s = this.shaderPrograms[progIndex];
        return !!(s.locDestStart || s.locDestEnd);
    };
    GLWrap_.prototype.programUsesCrossSampling = function(progIndex) {
        var s = this.shaderPrograms[progIndex];
        return !!(s.locDestStart || s.locDestEnd || s.crossSampling);
    };
    GLWrap_.prototype.programExtendsBox = function(progIndex) {
        var s = this.shaderPrograms[progIndex];
        return s.extendBoxHorizontal !== 0 || s.extendBoxVertical !== 0;
    };
    GLWrap_.prototype.getProgramBoxExtendHorizontal = function(progIndex) {
        return this.shaderPrograms[progIndex].extendBoxHorizontal;
    };
    GLWrap_.prototype.getProgramBoxExtendVertical = function(progIndex) {
        return this.shaderPrograms[progIndex].extendBoxVertical;
    };
    GLWrap_.prototype.getProgramParameterType = function(progIndex, paramIndex) {
        return this.shaderPrograms[progIndex].parameters[paramIndex][2];
    };
    GLWrap_.prototype.programIsAnimated = function(progIndex) {
        return this.shaderPrograms[progIndex].animated;
    };
    GLWrap_.prototype.setProgramParameters = function(backTex, pixelWidth, pixelHeight, destStartX, destStartY, destEndX, destEndY, layerScale, layerAngle, viewOriginLeft, viewOriginTop, params) {
        var i, len;
        var s = this.shaderPrograms[this.lastProgram];
        var b, mat4param, shaderParams;
        if (s.hasAnyOptionalUniforms || params.length) {
            b = this.pushBatch();
            b.type = BATCH_SETPROGRAMPARAMETERS;
            if (b.mat4param)
                mat4.set(this.matMV, b.mat4param);
            else
                b.mat4param = mat4.create();
            mat4param = b.mat4param;
            mat4param[0] = pixelWidth;
            mat4param[1] = pixelHeight;
            mat4param[2] = destStartX;
            mat4param[3] = destStartY;
            mat4param[4] = destEndX;
            mat4param[5] = destEndY;
            mat4param[6] = layerScale;
            mat4param[7] = layerAngle;
            mat4param[8] = viewOriginLeft;
            mat4param[9] = viewOriginTop;
            if (s.locSamplerBack) {;
                b.texParam = backTex;
            } else
                b.texParam = null;
            if (params.length) {
                shaderParams = b.shaderParams;
                shaderParams.length = params.length;
                for (i = 0, len = params.length; i < len; i++)
                    shaderParams[i] = params[i];
            }
            this.hasQuadBatchTop = false;
            this.hasPointBatchTop = false;
        }
    };
    GLWrap_.prototype.clear = function(r, g, b_, a) {
        var b = this.pushBatch();
        b.type = BATCH_CLEAR;
        b.startIndex = 0; // clear all mode
        if (!b.mat4param)
            b.mat4param = mat4.create();
        b.mat4param[0] = r;
        b.mat4param[1] = g;
        b.mat4param[2] = b_;
        b.mat4param[3] = a;
        this.hasQuadBatchTop = false;
        this.hasPointBatchTop = false;
    };
    GLWrap_.prototype.clearRect = function(x, y, w, h) {
        if (w < 0 || h < 0)
            return; // invalid clear area
        var b = this.pushBatch();
        b.type = BATCH_CLEAR;
        b.startIndex = 1; // clear rect mode
        if (!b.mat4param)
            b.mat4param = mat4.create();
        b.mat4param[0] = x;
        b.mat4param[1] = y;
        b.mat4param[2] = w;
        b.mat4param[3] = h;
        this.hasQuadBatchTop = false;
        this.hasPointBatchTop = false;
    };
    GLWrap_.prototype.present = function() {
        this.endBatch();
        this.gl.flush();
        /*
		if (debugBatch)
		{
;
			debugBatch = false;
		}
		*/
    };

    function nextHighestPowerOfTwo(x) {
        --x;
        for (var i = 1; i < 32; i <<= 1) {
            x = x | x >> i;
        }
        return x + 1;
    }
    var all_textures = [];
    var textures_by_src = {};
    var BF_RGBA8 = 0;
    var BF_RGB8 = 1;
    var BF_RGBA4 = 2;
    var BF_RGB5_A1 = 3;
    var BF_RGB565 = 4;
    GLWrap_.prototype.loadTexture = function(img, tiling, linearsampling, pixelformat, tiletype, nomip) {
        tiling = !!tiling;
        linearsampling = !!linearsampling;
        var tex_key = img.src + "," + tiling + "," + linearsampling + (tiling ? ("," + tiletype) : "");
        var webGL_texture = null;
        if (typeof img.src !== "undefined" && textures_by_src.hasOwnProperty(tex_key)) {
            webGL_texture = textures_by_src[tex_key];
            webGL_texture.c2refcount++;
            return webGL_texture;
        }
        this.endBatch();;
        var gl = this.gl;
        var isPOT = (cr.isPOT(img.width) && cr.isPOT(img.height));
        webGL_texture = gl.createTexture();
        gl.bindTexture(gl.TEXTURE_2D, webGL_texture);
        gl.pixelStorei(gl["UNPACK_PREMULTIPLY_ALPHA_WEBGL"], true);
        var internalformat = gl.RGBA;
        var format = gl.RGBA;
        var type = gl.UNSIGNED_BYTE;
        if (pixelformat && !this.isIE) {
            switch (pixelformat) {
                case BF_RGB8:
                    internalformat = gl.RGB;
                    format = gl.RGB;
                    break;
                case BF_RGBA4:
                    type = gl.UNSIGNED_SHORT_4_4_4_4;
                    break;
                case BF_RGB5_A1:
                    type = gl.UNSIGNED_SHORT_5_5_5_1;
                    break;
                case BF_RGB565:
                    internalformat = gl.RGB;
                    format = gl.RGB;
                    type = gl.UNSIGNED_SHORT_5_6_5;
                    break;
            }
        }
        if (!isPOT && tiling) {
            var canvas = document.createElement("canvas");
            canvas.width = cr.nextHighestPowerOfTwo(img.width);
            canvas.height = cr.nextHighestPowerOfTwo(img.height);
            var ctx = canvas.getContext("2d");
            ctx["webkitImageSmoothingEnabled"] = linearsampling;
            ctx["mozImageSmoothingEnabled"] = linearsampling;
            ctx["msImageSmoothingEnabled"] = linearsampling;
            ctx["imageSmoothingEnabled"] = linearsampling;
            ctx.drawImage(img,
                0, 0, img.width, img.height,
                0, 0, canvas.width, canvas.height);
            gl.texImage2D(gl.TEXTURE_2D, 0, internalformat, format, type, canvas);
        } else
            gl.texImage2D(gl.TEXTURE_2D, 0, internalformat, format, type, img);
        if (tiling) {
            if (tiletype === "repeat-x") {
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
            } else if (tiletype === "repeat-y") {
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
            } else {
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
            }
        } else {
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        }
        if (linearsampling) {
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
            if (isPOT && this.enable_mipmaps && !nomip) {
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
                gl.generateMipmap(gl.TEXTURE_2D);
            } else
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
        } else {
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
        }
        gl.bindTexture(gl.TEXTURE_2D, null);
        this.lastTexture0 = null;
        webGL_texture.c2width = img.width;
        webGL_texture.c2height = img.height;
        webGL_texture.c2refcount = 1;
        webGL_texture.c2texkey = tex_key;
        all_textures.push(webGL_texture);
        textures_by_src[tex_key] = webGL_texture;
        return webGL_texture;
    };
    GLWrap_.prototype.createEmptyTexture = function(w, h, linearsampling, _16bit, tiling) {
        this.endBatch();
        var gl = this.gl;
        if (this.isIE)
            _16bit = false;
        var webGL_texture = gl.createTexture();
        gl.bindTexture(gl.TEXTURE_2D, webGL_texture);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, w, h, 0, gl.RGBA, _16bit ? gl.UNSIGNED_SHORT_4_4_4_4 : gl.UNSIGNED_BYTE, null);
        if (tiling) {
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
        } else {
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        }
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, linearsampling ? gl.LINEAR : gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, linearsampling ? gl.LINEAR : gl.NEAREST);
        gl.bindTexture(gl.TEXTURE_2D, null);
        this.lastTexture0 = null;
        webGL_texture.c2width = w;
        webGL_texture.c2height = h;
        all_textures.push(webGL_texture);
        return webGL_texture;
    };
    GLWrap_.prototype.videoToTexture = function(video_, texture_, _16bit) {
        this.endBatch();
        var gl = this.gl;
        if (this.isIE)
            _16bit = false;
        gl.bindTexture(gl.TEXTURE_2D, texture_);
        gl.pixelStorei(gl["UNPACK_PREMULTIPLY_ALPHA_WEBGL"], true);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, _16bit ? gl.UNSIGNED_SHORT_4_4_4_4 : gl.UNSIGNED_BYTE, video_);
        gl.bindTexture(gl.TEXTURE_2D, null);
        this.lastTexture0 = null;
    };
    GLWrap_.prototype.deleteTexture = function(tex) {
        if (!tex)
            return;
        if (typeof tex.c2refcount !== "undefined" && tex.c2refcount > 1) {
            tex.c2refcount--;
            return;
        }
        this.endBatch();
        if (tex === this.lastTexture0) {
            this.gl.bindTexture(this.gl.TEXTURE_2D, null);
            this.lastTexture0 = null;
        }
        if (tex === this.lastTexture1) {
            this.gl.activeTexture(this.gl.TEXTURE1);
            this.gl.bindTexture(this.gl.TEXTURE_2D, null);
            this.gl.activeTexture(this.gl.TEXTURE0);
            this.lastTexture1 = null;
        }
        cr.arrayFindRemove(all_textures, tex);
        if (typeof tex.c2texkey !== "undefined")
            delete textures_by_src[tex.c2texkey];
        this.gl.deleteTexture(tex);
    };
    GLWrap_.prototype.estimateVRAM = function() {
        var total = this.width * this.height * 4 * 2;
        var i, len, t;
        for (i = 0, len = all_textures.length; i < len; i++) {
            t = all_textures[i];
            total += (t.c2width * t.c2height * 4);
        }
        return total;
    };
    GLWrap_.prototype.textureCount = function() {
        return all_textures.length;
    };
    GLWrap_.prototype.setRenderingToTexture = function(tex) {
        if (tex === this.renderToTex)
            return;;
        var b = this.pushBatch();
        b.type = BATCH_RENDERTOTEXTURE;
        b.texParam = tex;
        this.renderToTex = tex;
        this.hasQuadBatchTop = false;
        this.hasPointBatchTop = false;
    };
    cr.GLWrap = GLWrap_;
}());;
(function() {
    function Runtime(canvas) {
        if (!canvas || (!canvas.getContext && !canvas["dc"]))
            return;
        if (canvas["c2runtime"])
            return;
        else
            canvas["c2runtime"] = this;
        var self = this;
        this.isCrosswalk = /crosswalk/i.test(navigator.userAgent) || /xwalk/i.test(navigator.userAgent) || !!(typeof window["c2isCrosswalk"] !== "undefined" && window["c2isCrosswalk"]);
        this.isPhoneGap = (!this.isCrosswalk && (typeof window["device"] !== "undefined" && (typeof window["device"]["cordova"] !== "undefined" || typeof window["device"]["phonegap"] !== "undefined"))) || (typeof window["c2isphonegap"] !== "undefined" && window["c2isphonegap"]);
        this.isDirectCanvas = !!canvas["dc"];
        this.isAppMobi = (typeof window["AppMobi"] !== "undefined" || this.isDirectCanvas);
        this.isCocoonJs = !!window["c2cocoonjs"];
        this.isEjecta = !!window["c2ejecta"];
        if (this.isCocoonJs) {
            CocoonJS["App"]["onSuspended"].addEventListener(function() {
                self["setSuspended"](true);
            });
            CocoonJS["App"]["onActivated"].addEventListener(function() {
                self["setSuspended"](false);
            });
        }
        if (this.isEjecta) {
            document.addEventListener("pagehide", function() {
                self["setSuspended"](true);
            });
            document.addEventListener("pageshow", function() {
                self["setSuspended"](false);
            });
            document.addEventListener("resize", function() {
                self["setSize"](window.innerWidth, window.innerHeight);
            });
        }
        this.isDomFree = (this.isDirectCanvas || this.isCocoonJs || this.isEjecta);
        this.isTizen = /tizen/i.test(navigator.userAgent);
        this.isAndroid = /android/i.test(navigator.userAgent) && !this.isTizen; // tizen says "like Android"
        this.isIE = /msie/i.test(navigator.userAgent) || /trident/i.test(navigator.userAgent);
        this.isiPhone = /iphone/i.test(navigator.userAgent) || /ipod/i.test(navigator.userAgent); // treat ipod as an iphone
        this.isiPad = /ipad/i.test(navigator.userAgent);
        this.isiOS = this.isiPhone || this.isiPad || this.isEjecta;
        this.isiPhoneiOS6 = (this.isiPhone && /os\s6/i.test(navigator.userAgent));
        this.isChrome = /chrome/i.test(navigator.userAgent) || /chromium/i.test(navigator.userAgent);
        this.isAmazonWebApp = /amazonwebappplatform/i.test(navigator.userAgent);
        this.isFirefox = /firefox/i.test(navigator.userAgent);
        this.isSafari = !this.isChrome && /safari/i.test(navigator.userAgent); // Chrome includes Safari in UA
        this.isWindows = /windows/i.test(navigator.userAgent);
        this.isNodeWebkit = (typeof window["c2nodewebkit"] !== "undefined" || /nodewebkit/i.test(navigator.userAgent));
        this.isArcade = (typeof window["is_scirra_arcade"] !== "undefined");
        this.isWindows8App = !!(typeof window["c2isWindows8"] !== "undefined" && window["c2isWindows8"]);
        this.isWindows8Capable = !!(typeof window["c2isWindows8Capable"] !== "undefined" && window["c2isWindows8Capable"]);
        this.isWindowsPhone8 = !!(typeof window["c2isWindowsPhone8"] !== "undefined" && window["c2isWindowsPhone8"]);
        this.isWindowsPhone81 = !!(typeof window["c2isWindowsPhone81"] !== "undefined" && window["c2isWindowsPhone81"]);
        this.isWinJS = (this.isWindows8App || this.isWindows8Capable || this.isWindowsPhone81); // note not WP8.0
        this.isBlackberry10 = !!(typeof window["c2isBlackberry10"] !== "undefined" && window["c2isBlackberry10"]);
        this.isAndroidStockBrowser = (this.isAndroid && !this.isChrome && !this.isFirefox && !this.isAmazonWebApp && !this.isDomFree);
        this.devicePixelRatio = 1;
        this.isMobile = (this.isPhoneGap || this.isCrosswalk || this.isAppMobi || this.isCocoonJs || this.isAndroid || this.isiOS || this.isWindowsPhone8 || this.isWindowsPhone81 || this.isBlackberry10 || this.isTizen || this.isEjecta);
        if (!this.isMobile) {
            this.isMobile = /(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent);
        }
        if (typeof cr_is_preview !== "undefined" && !this.isNodeWebkit && (window.location.search === "?nw" || /nodewebkit/i.test(navigator.userAgent))) {
            this.isNodeWebkit = true;
        }
        this.isDebug = (typeof cr_is_preview !== "undefined" && window.location.search.indexOf("debug") > -1);
        this.canvas = canvas;
        this.canvasdiv = document.getElementById("c2canvasdiv");
        this.gl = null;
        this.glwrap = null;
        this.ctx = null;
        this.fullscreenOldMarginCss = "";
        this.firstInFullscreen = false;
        this.oldWidth = 0; // for restoring non-fullscreen canvas after fullscreen
        this.oldHeight = 0;
        this.canvas.oncontextmenu = function(e) {
            if (e.preventDefault) e.preventDefault();
            return false;
        };
        this.canvas.onselectstart = function(e) {
            if (e.preventDefault) e.preventDefault();
            return false;
        };
        if (this.isDirectCanvas)
            window["c2runtime"] = this;
        if (this.isNodeWebkit) {
            window["ondragover"] = function(e) {
                e.preventDefault();
                return false;
            };
            window["ondrop"] = function(e) {
                e.preventDefault();
                return false;
            };
            require("nw.gui")["App"]["clearCache"]();
        }
        this.width = canvas.width;
        this.height = canvas.height;
        this.draw_width = this.width;
        this.draw_height = this.height;
        this.cssWidth = this.width;
        this.cssHeight = this.height;
        this.lastWindowWidth = window.innerWidth;
        this.lastWindowHeight = window.innerHeight;
        this.redraw = true;
        this.isSuspended = false;
        if (!Date.now) {
            Date.now = function now() {
                return +new Date();
            };
        }
        this.plugins = [];
        this.types = {};
        this.types_by_index = [];
        this.behaviors = [];
        this.layouts = {};
        this.layouts_by_index = [];
        this.eventsheets = {};
        this.eventsheets_by_index = [];
        this.wait_for_textures = []; // for blocking until textures loaded
        this.triggers_to_postinit = [];
        this.all_global_vars = [];
        this.all_local_vars = [];
        this.solidBehavior = null;
        this.jumpthruBehavior = null;
        this.shadowcasterBehavior = null;
        this.deathRow = new cr.ObjectSet();
        this.isInClearDeathRow = false;
        this.isInOnDestroy = 0; // needs to support recursion so increments and decrements and is true if > 0
        this.isRunningEvents = false;
        this.createRow = [];
        this.isLoadingState = false;
        this.saveToSlot = "";
        this.loadFromSlot = "";
        this.loadFromJson = "";
        this.lastSaveJson = "";
        this.signalledContinuousPreview = false;
        this.suspendDrawing = false; // for hiding display until continuous preview loads
        this.dt = 0;
        this.dt1 = 0;
        this.logictime = 0; // used to calculate CPUUtilisation
        this.cpuutilisation = 0;
        this.zeroDtCount = 0;
        this.timescale = 1.0;
        this.kahanTime = new cr.KahanAdder();
        this.last_tick_time = 0;
        this.measuring_dt = true;
        this.fps = 0;
        this.last_fps_time = 0;
        this.tickcount = 0;
        this.execcount = 0;
        this.framecount = 0; // for fps
        this.objectcount = 0;
        this.changelayout = null;
        this.destroycallbacks = [];
        this.event_stack = [];
        this.event_stack_index = -1;
        this.localvar_stack = [
            []
        ];
        this.localvar_stack_index = 0;
        this.trigger_depth = 0; // recursion depth for triggers
        this.pushEventStack(null);
        this.loop_stack = [];
        this.loop_stack_index = -1;
        this.next_uid = 0;
        this.next_puid = 0; // permanent unique ids
        this.layout_first_tick = true;
        this.family_count = 0;
        this.suspend_events = [];
        this.raf_id = -1;
        this.timeout_id = -1;
        this.isloading = true;
        this.loadingprogress = 0;
        this.isNodeFullscreen = false;
        this.stackLocalCount = 0; // number of stack-based local vars for recursion
        this.halfFramerateMode = false;
        this.lastRafTime = 0; // time of last requestAnimationFrame call
        this.ranLastRaf = false; // false if last requestAnimationFrame was skipped for half framerate mode
        this.had_a_click = false;
        this.isInUserInputEvent = false;
        this.objects_to_tick = new cr.ObjectSet();
        this.objects_to_tick2 = new cr.ObjectSet();
        this.registered_collisions = [];
        this.temp_poly = new cr.CollisionPoly([]);
        this.temp_poly2 = new cr.CollisionPoly([]);
        this.allGroups = []; // array of all event groups
        this.groups_by_name = {};
        this.cndsBySid = {};
        this.actsBySid = {};
        this.varsBySid = {};
        this.blocksBySid = {};
        this.running_layout = null; // currently running layout
        this.layer_canvas = null; // for layers "render-to-texture"
        this.layer_ctx = null;
        this.layer_tex = null;
        this.layout_tex = null;
        this.layout_canvas = null;
        this.layout_ctx = null;
        this.is_WebGL_context_lost = false;
        this.uses_background_blending = false; // if any shader uses background blending, so entire layout renders to texture
        this.fx_tex = [null, null];
        this.fullscreen_scaling = 0;
        this.files_subfolder = ""; // path with project files
        this.objectsByUid = {}; // maps every in-use UID (as a string) to its instance
        this.loaderlogo = null;
        this.snapshotCanvas = null;
        this.snapshotData = "";
        this.load();
        this.isRetina = ((!this.isDomFree || this.isEjecta) && this.useHighDpi && !this.isAndroidStockBrowser);
        this.devicePixelRatio = (this.isRetina ? (window["devicePixelRatio"] || window["webkitDevicePixelRatio"] || window["mozDevicePixelRatio"] || window["msDevicePixelRatio"] || 1) : 1);
        this.ClearDeathRow();
        var attribs;
        var alpha_canvas = this.alphaBackground && !(this.isNodeWebkit || this.isWinJS || this.isWindowsPhone8 || this.isCrosswalk);
        if (this.fullscreen_mode > 0)
            this["setSize"](window.innerWidth, window.innerHeight, true);
        try {
            if (this.enableWebGL && (this.isCocoonJs || this.isEjecta || !this.isDomFree)) {
                attribs = {
                    "alpha": alpha_canvas,
                    "depth": false,
                    "antialias": false,
                    "failIfMajorPerformanceCaveat": true
                };
                this.gl = (canvas.getContext("webgl", attribs) || canvas.getContext("experimental-webgl", attribs));
            }
        } catch (e) {}
        if (this.gl) {;
            if (!this.isDomFree) {
                this.overlay_canvas = document.createElement("canvas");
                jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode);
                this.overlay_canvas.oncontextmenu = function(e) {
                    return false;
                };
                this.overlay_canvas.onselectstart = function(e) {
                    return false;
                };
                this.overlay_canvas.width = this.cssWidth;
                this.overlay_canvas.height = this.cssHeight;
                jQuery(this.overlay_canvas).css({
                    "width": this.cssWidth + "px",
                    "height": this.cssHeight + "px"
                });
                this.positionOverlayCanvas();
                this.overlay_ctx = this.overlay_canvas.getContext("2d");
            }
            this.glwrap = new cr.GLWrap(this.gl, this.isMobile);
            this.glwrap.setSize(canvas.width, canvas.height);
            this.glwrap.enable_mipmaps = (this.downscalingQuality !== 0);
            this.ctx = null;
            this.canvas.addEventListener("webglcontextlost", function(ev) {
                ev.preventDefault();
                self.onContextLost();
                console.log("[Construct 2] WebGL context lost");
                window["cr_setSuspended"](true); // stop rendering
            }, false);
            this.canvas.addEventListener("webglcontextrestored", function(ev) {
                self.glwrap.initState();
                self.glwrap.setSize(self.glwrap.width, self.glwrap.height, true);
                self.layer_tex = null;
                self.layout_tex = null;
                self.fx_tex[0] = null;
                self.fx_tex[1] = null;
                self.onContextRestored();
                self.redraw = true;
                console.log("[Construct 2] WebGL context restored");
                window["cr_setSuspended"](false); // resume rendering
            }, false);
            var i, len, j, lenj, k, lenk, t, s, l, y;
            for (i = 0, len = this.types_by_index.length; i < len; i++) {
                t = this.types_by_index[i];
                for (j = 0, lenj = t.effect_types.length; j < lenj; j++) {
                    s = t.effect_types[j];
                    s.shaderindex = this.glwrap.getShaderIndex(s.id);
                    this.uses_background_blending = this.uses_background_blending || this.glwrap.programUsesDest(s.shaderindex);
                }
            }
            for (i = 0, len = this.layouts_by_index.length; i < len; i++) {
                l = this.layouts_by_index[i];
                for (j = 0, lenj = l.effect_types.length; j < lenj; j++) {
                    s = l.effect_types[j];
                    s.shaderindex = this.glwrap.getShaderIndex(s.id);
                }
                for (j = 0, lenj = l.layers.length; j < lenj; j++) {
                    y = l.layers[j];
                    for (k = 0, lenk = y.effect_types.length; k < lenk; k++) {
                        s = y.effect_types[k];
                        s.shaderindex = this.glwrap.getShaderIndex(s.id);
                        this.uses_background_blending = this.uses_background_blending || this.glwrap.programUsesDest(s.shaderindex);
                    }
                }
            }
        } else {
            if (this.fullscreen_mode > 0 && this.isDirectCanvas) {;
                this.canvas = null;
                document.oncontextmenu = function(e) {
                    return false;
                };
                document.onselectstart = function(e) {
                    return false;
                };
                this.ctx = AppMobi["canvas"]["getContext"]("2d");
                try {
                    this.ctx["samplingMode"] = this.linearSampling ? "smooth" : "sharp";
                    this.ctx["globalScale"] = 1;
                    this.ctx["HTML5CompatibilityMode"] = true;
                    this.ctx["imageSmoothingEnabled"] = this.linearSampling;
                } catch (e) {}
                if (this.width !== 0 && this.height !== 0) {
                    this.ctx.width = this.width;
                    this.ctx.height = this.height;
                }
            }
            if (!this.ctx) {;
                if (this.isCocoonJs) {
                    attribs = {
                        "antialias": !!this.linearSampling,
                        "alpha": alpha_canvas
                    };
                    this.ctx = canvas.getContext("2d", attribs);
                } else {
                    attribs = {
                        "alpha": alpha_canvas
                    };
                    this.ctx = canvas.getContext("2d", attribs);
                }
                this.ctx["webkitImageSmoothingEnabled"] = this.linearSampling;
                this.ctx["mozImageSmoothingEnabled"] = this.linearSampling;
                this.ctx["msImageSmoothingEnabled"] = this.linearSampling;
                this.ctx["imageSmoothingEnabled"] = this.linearSampling;
            }
            this.overlay_canvas = null;
            this.overlay_ctx = null;
        }
        this.tickFunc = function() {
            self.tick(false);
        };
        if (window != window.top && !this.isDomFree && !this.isWinJS && !this.isWindowsPhone8) {
            document.addEventListener("mousedown", function() {
                window.focus();
            }, true);
            document.addEventListener("touchstart", function() {
                window.focus();
            }, true);
        }
        if (typeof cr_is_preview !== "undefined") {
            if (this.isCocoonJs)
                console.log("[Construct 2] In preview-over-wifi via CocoonJS mode");
            if (window.location.search.indexOf("continuous") > -1) {
                cr.logexport("Reloading for continuous preview");
                this.loadFromSlot = "__c2_continuouspreview";
                this.suspendDrawing = true;
            }
            if (this.pauseOnBlur && !this.isMobile) {
                jQuery(window).focus(function() {
                    self["setSuspended"](false);
                });
                jQuery(window).blur(function() {
                    self["setSuspended"](true);
                });
            }
        }
        if (this.fullscreen_mode === 0 && this.isRetina && this.devicePixelRatio > 1) {
            this["setSize"](this.original_width, this.original_height, true);
        }
        this.tryLockOrientation();
        this.go(); // run loading screen
        this.extra = {};
        cr.seal(this);
    };
    var webkitRepaintFlag = false;
    Runtime.prototype["setSize"] = function(w, h, force) {
        var offx = 0,
            offy = 0;
        var neww = 0,
            newh = 0,
            intscale = 0;
        var tryHideAddressBar = (this.isiPhoneiOS6 && this.isSafari && !navigator["standalone"] && !this.isDomFree && !this.isPhoneGap);
        if (tryHideAddressBar)
            h += 60; // height of Safari iPhone iOS 6 address bar
        if (this.lastWindowWidth === w && this.lastWindowHeight === h && !force)
            return;
        this.lastWindowWidth = w;
        this.lastWindowHeight = h;
        var mode = this.fullscreen_mode;
        var orig_aspect, cur_aspect;
        var isfullscreen = (document["mozFullScreen"] || document["webkitIsFullScreen"] || !!document["msFullscreenElement"] || document["fullScreen"] || this.isNodeFullscreen) && !this.isPhoneGap;
        if (!isfullscreen && this.fullscreen_mode === 0 && !force)
            return; // ignore size events when not fullscreen and not using a fullscreen-in-browser mode
        if (isfullscreen && this.fullscreen_scaling > 0)
            mode = this.fullscreen_scaling;
        if (mode >= 4) {
            orig_aspect = this.original_width / this.original_height;
            cur_aspect = w / h;
            if (cur_aspect > orig_aspect) {
                neww = h * orig_aspect;
                if (mode === 5) // integer scaling
                {
                    intscale = neww / this.original_width;
                    if (intscale > 1)
                        intscale = Math.floor(intscale);
                    else if (intscale < 1)
                        intscale = 1 / Math.ceil(1 / intscale);
                    neww = this.original_width * intscale;
                    newh = this.original_height * intscale;
                    offx = (w - neww) / 2;
                    offy = (h - newh) / 2;
                    w = neww;
                    h = newh;
                } else {
                    offx = (w - neww) / 2;
                    w = neww;
                }
            } else {
                newh = w / orig_aspect;
                if (mode === 5) // integer scaling
                {
                    intscale = newh / this.original_height;
                    if (intscale > 1)
                        intscale = Math.floor(intscale);
                    else if (intscale < 1)
                        intscale = 1 / Math.ceil(1 / intscale);
                    neww = this.original_width * intscale;
                    newh = this.original_height * intscale;
                    offx = (w - neww) / 2;
                    offy = (h - newh) / 2;
                    w = neww;
                    h = newh;
                } else {
                    offy = (h - newh) / 2;
                    h = newh;
                }
            }
            if (isfullscreen && !this.isNodeWebkit) {
                offx = 0;
                offy = 0;
            }
            offx = Math.floor(offx);
            offy = Math.floor(offy);
            w = Math.floor(w);
            h = Math.floor(h);
        } else if (this.isNodeWebkit && this.isNodeFullscreen && this.fullscreen_mode_set === 0) {
            offx = Math.floor((w - this.original_width) / 2);
            offy = Math.floor((h - this.original_height) / 2);
            w = this.original_width;
            h = this.original_height;
        }
        if (mode < 2)
            this.aspect_scale = this.devicePixelRatio;
        if (this.isRetina && this.isiPad && this.devicePixelRatio > 1) // don't apply to iPad 1-2
        {
            if (w >= 1024)
                w = 1023; // 2046 retina pixels
            if (h >= 1024)
                h = 1023;
        }
        var multiplier = this.devicePixelRatio;
        this.cssWidth = w;
        this.cssHeight = h;
        this.width = Math.round(w * multiplier);
        this.height = Math.round(h * multiplier);
        this.redraw = true;
        if (this.wantFullscreenScalingQuality) {
            this.draw_width = this.width;
            this.draw_height = this.height;
            this.fullscreenScalingQuality = true;
        } else {
            if ((this.width < this.original_width && this.height < this.original_height) || mode === 1) {
                this.draw_width = this.width;
                this.draw_height = this.height;
                this.fullscreenScalingQuality = true;
            } else {
                this.draw_width = this.original_width;
                this.draw_height = this.original_height;
                this.fullscreenScalingQuality = false;
                /*var orig_aspect = this.original_width / this.original_height;
				var cur_aspect = this.width / this.height;
				if ((this.fullscreen_mode !== 2 && cur_aspect > orig_aspect) || (this.fullscreen_mode === 2 && cur_aspect < orig_aspect))
					this.aspect_scale = this.height / this.original_height;
				else
					this.aspect_scale = this.width / this.original_width;*/
                if (mode === 2) // scale inner
                {
                    orig_aspect = this.original_width / this.original_height;
                    cur_aspect = this.lastWindowWidth / this.lastWindowHeight;
                    if (cur_aspect < orig_aspect)
                        this.draw_width = this.draw_height * cur_aspect;
                    else if (cur_aspect > orig_aspect)
                        this.draw_height = this.draw_width / cur_aspect;
                } else if (mode === 3) {
                    orig_aspect = this.original_width / this.original_height;
                    cur_aspect = this.lastWindowWidth / this.lastWindowHeight;
                    if (cur_aspect > orig_aspect)
                        this.draw_width = this.draw_height * cur_aspect;
                    else if (cur_aspect < orig_aspect)
                        this.draw_height = this.draw_width / cur_aspect;
                }
            }
        }
        if (this.canvasdiv && !this.isDomFree) {
            jQuery(this.canvasdiv).css({
                "width": w + "px",
                "height": h + "px",
                "margin-left": offx,
                "margin-top": offy
            });
            if (typeof cr_is_preview !== "undefined") {
                jQuery("#borderwrap").css({
                    "width": w + "px",
                    "height": h + "px"
                });
            }
        }
        if (this.canvas) {
            this.canvas.width = Math.round(w * multiplier);
            this.canvas.height = Math.round(h * multiplier);
            if (this.isEjecta) {
                this.canvas.style.left = offx + "px";
                this.canvas.style.top = offy + "px";
                this.canvas.style.width = w + "px";
                this.canvas.style.height = h + "px";
            } else if (this.isRetina && !this.isDomFree) {
                jQuery(this.canvas).css({
                    "width": w + "px",
                    "height": h + "px"
                });
            }
        }
        if (this.overlay_canvas) {
            this.overlay_canvas.width = w;
            this.overlay_canvas.height = h;
            jQuery(this.overlay_canvas).css({
                "width": w + "px",
                "height": h + "px"
            });
        }
        if (this.glwrap) {
            this.glwrap.setSize(Math.round(w * multiplier), Math.round(h * multiplier));
        }
        if (this.isDirectCanvas && this.ctx) {
            this.ctx.width = w;
            this.ctx.height = h;
        }
        if (this.ctx) {
            this.ctx["webkitImageSmoothingEnabled"] = this.linearSampling;
            this.ctx["mozImageSmoothingEnabled"] = this.linearSampling;
            this.ctx["msImageSmoothingEnabled"] = this.linearSampling;
            this.ctx["imageSmoothingEnabled"] = this.linearSampling;
        }
        this.tryLockOrientation();
        if (!this.isDomFree && (tryHideAddressBar || this.isiPhone)) {
            window.setTimeout(function() {
                window.scrollTo(0, 1);
            }, 100);
        }
    };
    Runtime.prototype.tryLockOrientation = function() {
        if (!this.autoLockOrientation || this.orientations === 0)
            return;
        var orientation = "portrait";
        if (this.orientations === 2)
            orientation = "landscape";
        if (screen["lockOrientation"])
            screen["lockOrientation"](orientation);
        else if (screen["webkitLockOrientation"])
            screen["webkitLockOrientation"](orientation);
        else if (screen["mozLockOrientation"])
            screen["mozLockOrientation"](orientation);
        else if (screen["msLockOrientation"])
            screen["msLockOrientation"](orientation);
    };
    Runtime.prototype.onContextLost = function() {
        this.is_WebGL_context_lost = true;
        var i, len, t;
        for (i = 0, len = this.types_by_index.length; i < len; i++) {
            t = this.types_by_index[i];
            if (t.onLostWebGLContext)
                t.onLostWebGLContext();
        }
    };
    Runtime.prototype.onContextRestored = function() {
        this.is_WebGL_context_lost = false;
        var i, len, t;
        for (i = 0, len = this.types_by_index.length; i < len; i++) {
            t = this.types_by_index[i];
            if (t.onRestoreWebGLContext)
                t.onRestoreWebGLContext();
        }
    };
    Runtime.prototype.positionOverlayCanvas = function() {
        if (this.isDomFree)
            return;
        var isfullscreen = (document["mozFullScreen"] || document["webkitIsFullScreen"] || document["fullScreen"] || !!document["msFullscreenElement"] || this.isNodeFullscreen) && !this.isPhoneGap;
        var overlay_position = isfullscreen ? jQuery(this.canvas).offset() : jQuery(this.canvas).position();
        overlay_position.position = "absolute";
        jQuery(this.overlay_canvas).css(overlay_position);
    };
    var caf = window["cancelAnimationFrame"] ||
        window["mozCancelAnimationFrame"] ||
        window["webkitCancelAnimationFrame"] ||
        window["msCancelAnimationFrame"] ||
        window["oCancelAnimationFrame"];
    Runtime.prototype["setSuspended"] = function(s) {
        var i, len;
        if (s && !this.isSuspended) {
            cr.logexport("[Construct 2] Suspending");
            this.isSuspended = true; // next tick will be last
            if (this.raf_id !== -1 && caf) // note: CocoonJS does not implement cancelAnimationFrame
                caf(this.raf_id);
            if (this.timeout_id !== -1)
                clearTimeout(this.timeout_id);
            for (i = 0, len = this.suspend_events.length; i < len; i++)
                this.suspend_events[i](true);
        } else if (!s && this.isSuspended) {
            cr.logexport("[Construct 2] Resuming");
            this.isSuspended = false;
            this.last_tick_time = cr.performance_now(); // ensure first tick is a zero-dt one
            this.last_fps_time = cr.performance_now(); // reset FPS counter
            this.framecount = 0;
            this.logictime = 0;
            for (i = 0, len = this.suspend_events.length; i < len; i++)
                this.suspend_events[i](false);
            this.tick(false); // kick off runtime again
        }
    };
    Runtime.prototype.addSuspendCallback = function(f) {
        this.suspend_events.push(f);
    };
    Runtime.prototype.load = function() {
        var pm = cr.getProjectModel();
        this.name = pm[0];
        this.first_layout = pm[1];
        this.fullscreen_mode = pm[11]; // 0 = off, 1 = crop, 2 = scale inner, 3 = scale outer, 4 = letterbox scale, 5 = integer letterbox scale
        this.fullscreen_mode_set = pm[11];

        this.original_width = pm[9];
        this.original_height = pm[10];
        this.parallax_x_origin = this.original_width / 2;
        this.parallax_y_origin = this.original_height / 2;


        if (this.isDomFree && !this.isEjecta && (pm[11] >= 4 || pm[11] === 0)) {
            cr.logexport("[Construct 2] Letterbox scale fullscreen modes are not supported on this platform - falling back to 'Scale outer'");
            this.fullscreen_mode = 3;
            this.fullscreen_mode_set = 3;
        }
        this.uses_loader_layout = pm[17];
        this.loaderstyle = pm[18];
        if (this.loaderstyle === 0) {
            this.loaderlogo = new Image();
            this.loaderlogo.src = "loading-logo.png";
        }
        this.next_uid = pm[20];
        this.system = new cr.system_object(this);
        var i, len, j, lenj, k, lenk, idstr, m, b, t, f;
        var plugin, plugin_ctor;
        for (i = 0, len = pm[2].length; i < len; i++) {
            m = pm[2][i];;
            cr.add_common_aces(m);
            plugin = new m[0](this);
            plugin.singleglobal = m[1];
            plugin.is_world = m[2];
            plugin.must_predraw = m[9];
            if (plugin.onCreate)
                plugin.onCreate(); // opportunity to override default ACEs
            cr.seal(plugin);
            this.plugins.push(plugin);
        }
        pm = cr.getProjectModel();
        for (i = 0, len = pm[3].length; i < len; i++) {
            m = pm[3][i];
            plugin_ctor = m[1];;
            plugin = null;
            for (j = 0, lenj = this.plugins.length; j < lenj; j++) {
                if (this.plugins[j] instanceof plugin_ctor) {
                    plugin = this.plugins[j];
                    break;
                }
            };;
            var type_inst = new plugin.Type(plugin);;
            type_inst.name = m[0];
            type_inst.is_family = m[2];
            type_inst.instvar_sids = m[3].slice(0);
            type_inst.vars_count = m[3].length;
            type_inst.behs_count = m[4];
            type_inst.fx_count = m[5];
            type_inst.sid = m[11];
            if (type_inst.is_family) {
                type_inst.members = []; // types in this family
                type_inst.family_index = this.family_count++;
                type_inst.families = null;
            } else {
                type_inst.members = null;
                type_inst.family_index = -1;
                type_inst.families = []; // families this type belongs to
            }
            type_inst.family_var_map = null;
            type_inst.family_beh_map = null;
            type_inst.family_fx_map = null;
            type_inst.is_contained = false;
            type_inst.container = null;
            if (m[6]) {
                type_inst.texture_file = m[6][0];
                type_inst.texture_filesize = m[6][1];
                type_inst.texture_pixelformat = m[6][2];
            } else {
                type_inst.texture_file = null;
                type_inst.texture_filesize = 0;
                type_inst.texture_pixelformat = 0; // rgba8
            }
            if (m[7]) {
                type_inst.animations = m[7];
            } else {
                type_inst.animations = null;
            }
            type_inst.index = i; // save index in to types array in type
            type_inst.instances = []; // all instances of this type
            type_inst.deadCache = []; // destroyed instances to recycle next create
            type_inst.solstack = [new cr.selection(type_inst)]; // initialise SOL stack with one empty SOL
            type_inst.cur_sol = 0;
            type_inst.default_instance = null;
            type_inst.default_layerindex = 0;
            type_inst.stale_iids = true;
            type_inst.updateIIDs = cr.type_updateIIDs;
            type_inst.getFirstPicked = cr.type_getFirstPicked;
            type_inst.getPairedInstance = cr.type_getPairedInstance;
            type_inst.getCurrentSol = cr.type_getCurrentSol;
            type_inst.pushCleanSol = cr.type_pushCleanSol;
            type_inst.pushCopySol = cr.type_pushCopySol;
            type_inst.popSol = cr.type_popSol;
            type_inst.getBehaviorByName = cr.type_getBehaviorByName;
            type_inst.getBehaviorIndexByName = cr.type_getBehaviorIndexByName;
            type_inst.getEffectIndexByName = cr.type_getEffectIndexByName;
            type_inst.applySolToContainer = cr.type_applySolToContainer;
            type_inst.getInstanceByIID = cr.type_getInstanceByIID;
            type_inst.collision_grid = new cr.SparseGrid(this.original_width, this.original_height);
            type_inst.any_cell_changed = true;
            type_inst.any_instance_parallaxed = false;
            type_inst.extra = {};
            type_inst.toString = cr.type_toString;
            type_inst.behaviors = [];
            for (j = 0, lenj = m[8].length; j < lenj; j++) {
                b = m[8][j];
                var behavior_ctor = b[1];
                var behavior_plugin = null;
                for (k = 0, lenk = this.behaviors.length; k < lenk; k++) {
                    if (this.behaviors[k] instanceof behavior_ctor) {
                        behavior_plugin = this.behaviors[k];
                        break;
                    }
                }
                if (!behavior_plugin) {
                    behavior_plugin = new behavior_ctor(this);
                    behavior_plugin.my_types = []; // types using this behavior
                    behavior_plugin.my_instances = new cr.ObjectSet(); // instances of this behavior
                    if (behavior_plugin.onCreate)
                        behavior_plugin.onCreate();
                    cr.seal(behavior_plugin);
                    this.behaviors.push(behavior_plugin);
                    if (cr.behaviors.solid && behavior_plugin instanceof cr.behaviors.solid)
                        this.solidBehavior = behavior_plugin;
                    if (cr.behaviors.jumpthru && behavior_plugin instanceof cr.behaviors.jumpthru)
                        this.jumpthruBehavior = behavior_plugin;
                    if (cr.behaviors.shadowcaster && behavior_plugin instanceof cr.behaviors.shadowcaster)
                        this.shadowcasterBehavior = behavior_plugin;
                }
                if (behavior_plugin.my_types.indexOf(type_inst) === -1)
                    behavior_plugin.my_types.push(type_inst);
                var behavior_type = new behavior_plugin.Type(behavior_plugin, type_inst);
                behavior_type.name = b[0];
                behavior_type.sid = b[2];
                behavior_type.onCreate();
                cr.seal(behavior_type);
                type_inst.behaviors.push(behavior_type);
            }
            type_inst.global = m[9];
            type_inst.isOnLoaderLayout = m[10];
            type_inst.effect_types = [];
            for (j = 0, lenj = m[12].length; j < lenj; j++) {
                type_inst.effect_types.push({
                    id: m[12][j][0],
                    name: m[12][j][1],
                    shaderindex: -1,
                    active: true,
                    index: j
                });
            }
            type_inst.tile_poly_data = m[13];
            if (!this.uses_loader_layout || type_inst.is_family || type_inst.isOnLoaderLayout || !plugin.is_world) {
                type_inst.onCreate();
                cr.seal(type_inst);
            }
            if (type_inst.name)
                this.types[type_inst.name] = type_inst;
            this.types_by_index.push(type_inst);
            if (plugin.singleglobal) {
                var instance = new plugin.Instance(type_inst);
                instance.uid = this.next_uid++;
                instance.puid = this.next_puid++;
                instance.iid = 0;
                instance.get_iid = cr.inst_get_iid;
                instance.toString = cr.inst_toString;
                instance.properties = m[14];
                instance.onCreate();
                cr.seal(instance);
                type_inst.instances.push(instance);
                this.objectsByUid[instance.uid.toString()] = instance;
            }
        }
        for (i = 0, len = pm[4].length; i < len; i++) {
            var familydata = pm[4][i];
            var familytype = this.types_by_index[familydata[0]];
            var familymember;
            for (j = 1, lenj = familydata.length; j < lenj; j++) {
                familymember = this.types_by_index[familydata[j]];
                familymember.families.push(familytype);
                familytype.members.push(familymember);
            }
        }
        for (i = 0, len = pm[24].length; i < len; i++) {
            var containerdata = pm[24][i];
            var containertypes = [];
            for (j = 0, lenj = containerdata.length; j < lenj; j++)
                containertypes.push(this.types_by_index[containerdata[j]]);
            for (j = 0, lenj = containertypes.length; j < lenj; j++) {
                containertypes[j].is_contained = true;
                containertypes[j].container = containertypes;
            }
        }
        if (this.family_count > 0) {
            for (i = 0, len = this.types_by_index.length; i < len; i++) {
                t = this.types_by_index[i];
                if (t.is_family || !t.families.length)
                    continue;
                t.family_var_map = new Array(this.family_count);
                t.family_beh_map = new Array(this.family_count);
                t.family_fx_map = new Array(this.family_count);
                var all_fx = [];
                var varsum = 0;
                var behsum = 0;
                var fxsum = 0;
                for (j = 0, lenj = t.families.length; j < lenj; j++) {
                    f = t.families[j];
                    t.family_var_map[f.family_index] = varsum;
                    varsum += f.vars_count;
                    t.family_beh_map[f.family_index] = behsum;
                    behsum += f.behs_count;
                    t.family_fx_map[f.family_index] = fxsum;
                    fxsum += f.fx_count;
                    for (k = 0, lenk = f.effect_types.length; k < lenk; k++)
                        all_fx.push(cr.shallowCopy({}, f.effect_types[k]));
                }
                t.effect_types = all_fx.concat(t.effect_types);
                for (j = 0, lenj = t.effect_types.length; j < lenj; j++)
                    t.effect_types[j].index = j;
            }
        }
        for (i = 0, len = pm[5].length; i < len; i++) {
            m = pm[5][i];
            var layout = new cr.layout(this, m);
            cr.seal(layout);
            this.layouts[layout.name] = layout;
            this.layouts_by_index.push(layout);
        }
        for (i = 0, len = pm[6].length; i < len; i++) {
            m = pm[6][i];
            var sheet = new cr.eventsheet(this, m);
            cr.seal(sheet);
            this.eventsheets[sheet.name] = sheet;
            this.eventsheets_by_index.push(sheet);
        }
        for (i = 0, len = this.eventsheets_by_index.length; i < len; i++)
            this.eventsheets_by_index[i].postInit();
        for (i = 0, len = this.eventsheets_by_index.length; i < len; i++)
            this.eventsheets_by_index[i].updateDeepIncludes();
        for (i = 0, len = this.triggers_to_postinit.length; i < len; i++)
            this.triggers_to_postinit[i].postInit();
        this.triggers_to_postinit.length = 0;
        this.files_subfolder = pm[7];
        this.pixel_rounding = pm[8];
        this.aspect_scale = 1.0;
        this.enableWebGL = pm[12];
        this.linearSampling = pm[13];
        this.alphaBackground = pm[14];
        this.versionstr = pm[15];
        this.useHighDpi = pm[16];
        this.orientations = pm[19]; // 0 = any, 1 = portrait, 2 = landscape
        this.autoLockOrientation = (this.orientations > 0);
        this.pauseOnBlur = pm[21];
        this.wantFullscreenScalingQuality = pm[22]; // false = low quality, true = high quality
        this.fullscreenScalingQuality = this.wantFullscreenScalingQuality;
        this.downscalingQuality = pm[23]; // 0 = low (mips off), 1 = medium (mips on, dense spritesheet), 2 = high (mips on, sparse spritesheet)
        this.start_time = Date.now();
    };
    var anyImageHadError = false;
    Runtime.prototype.waitForImageLoad = function(img_) {
        img_.onerror = function(e) {
            img_.c2error = true;
            anyImageHadError = true;
            if (console && console.error)
                console.error("Error loading image '" + img_.src + "': ", e);
        };
        this.wait_for_textures.push(img_);
    };
    Runtime.prototype.findWaitingTexture = function(src_) {
        var i, len;
        for (i = 0, len = this.wait_for_textures.length; i < len; i++) {
            if (this.wait_for_textures[i].cr_src === src_)
                return this.wait_for_textures[i];
        }
        return null;
    };
    Runtime.prototype.areAllTexturesLoaded = function() {
        var totalsize = 0;
        var completedsize = 0;
        var ret = true;
        var i, len, img;
        for (i = 0, len = this.wait_for_textures.length; i < len; i++) {
            img = this.wait_for_textures[i];
            var filesize = img.cr_filesize;
            if (!filesize || filesize <= 0)
                filesize = 50000;
            totalsize += filesize;
            if ((img.complete || img["loaded"]) && !img.c2error)
                completedsize += filesize;
            else
                ret = false; // not all textures loaded
        }
        if (totalsize == 0)
            this.progress = 0;
        else
            this.progress = (completedsize / totalsize);
        return ret;
    };
    Runtime.prototype.go = function() {
        if (!this.ctx && !this.glwrap)
            return;
        var ctx = this.ctx || this.overlay_ctx;
        if (this.overlay_canvas)
            this.positionOverlayCanvas();
        this.progress = 0;
        this.last_progress = -1;
        if (this.areAllTexturesLoaded())
            this.go_textures_done();
        else {
            var ms_elapsed = Date.now() - this.start_time;
            if (ctx) {
                var overlay_width = this.width;
                var overlay_height = this.height;
                var multiplier = this.devicePixelRatio;
                if (this.overlay_canvas) {
                    overlay_width = this.cssWidth;
                    overlay_height = this.cssHeight;
                    multiplier = 1;
                }
                if (this.loaderstyle !== 3 && (this.isCocoonJs || (ms_elapsed >= 500 && this.last_progress != this.progress))) {
                    ctx.clearRect(0, 0, overlay_width, overlay_height);
                    var mx = overlay_width / 2;
                    var my = overlay_height / 2;
                    var haslogo = (this.loaderstyle === 0 && this.loaderlogo.complete);
                    var hlw = 40 * multiplier;
                    var hlh = 0;
                    var logowidth = 80 * multiplier;
                    var logoheight;
                    if (haslogo) {
                        logowidth = this.loaderlogo.width * multiplier;
                        logoheight = this.loaderlogo.height * multiplier;
                        hlw = logowidth / 2;
                        hlh = logoheight / 2;
                        ctx.drawImage(this.loaderlogo, cr.floor(mx - hlw), cr.floor(my - hlh), logowidth, logoheight);
                    }
                    if (this.loaderstyle <= 1) {
                        my += hlh + (haslogo ? 12 * multiplier : 0);
                        mx -= hlw;
                        mx = cr.floor(mx) + 0.5;
                        my = cr.floor(my) + 0.5;
                        ctx.fillStyle = anyImageHadError ? "red" : "DodgerBlue";
                        ctx.fillRect(mx, my, Math.floor(logowidth * this.progress), 6 * multiplier);
                        ctx.strokeStyle = "black";
                        ctx.strokeRect(mx, my, logowidth, 6 * multiplier);
                        ctx.strokeStyle = "white";
                        ctx.strokeRect(mx - 1 * multiplier, my - 1 * multiplier, logowidth + 2 * multiplier, 8 * multiplier);
                    } else if (this.loaderstyle === 2) {
                        ctx.font = (this.isEjecta ? "12pt ArialMT" : "12pt Arial");
                        ctx.fillStyle = anyImageHadError ? "#f00" : "#999";
                        ctx.textBaseLine = "middle";
                        var percent_text = Math.round(this.progress * 100) + "%";
                        var text_dim = ctx.measureText ? ctx.measureText(percent_text) : null;
                        var text_width = text_dim ? text_dim.width : 0;
                        ctx.fillText(percent_text, mx - (text_width / 2), my);
                    }
                }
                this.last_progress = this.progress;
            }
            setTimeout((function(self) {
                return function() {
                    self.go();
                };
            })(this), (this.isCocoonJs ? 10 : 100));
        }
    };
    Runtime.prototype.go_textures_done = function() {
        if (this.overlay_canvas) {
            this.canvas.parentNode.removeChild(this.overlay_canvas);
            this.overlay_ctx = null;
            this.overlay_canvas = null;
        }
        this.start_time = Date.now();
        this.last_fps_time = cr.performance_now(); // for counting framerate
        var i, len, t;
        if (this.uses_loader_layout) {
            for (i = 0, len = this.types_by_index.length; i < len; i++) {
                t = this.types_by_index[i];
                if (!t.is_family && !t.isOnLoaderLayout && t.plugin.is_world) {
                    t.onCreate();
                    cr.seal(t);
                }
            }
        } else
            this.isloading = false;
        for (i = 0, len = this.layouts_by_index.length; i < len; i++) {
            this.layouts_by_index[i].createGlobalNonWorlds();
        }
        if (this.fullscreen_mode >= 2) {
            var orig_aspect = this.original_width / this.original_height;
            var cur_aspect = this.width / this.height;
            if ((this.fullscreen_mode !== 2 && cur_aspect > orig_aspect) || (this.fullscreen_mode === 2 && cur_aspect < orig_aspect))
                this.aspect_scale = this.height / this.original_height;
            else
                this.aspect_scale = this.width / this.original_width;
        }
        if (this.first_layout)
            this.layouts[this.first_layout].startRunning();
        else
            this.layouts_by_index[0].startRunning();;
        if (!this.uses_loader_layout) {
            this.loadingprogress = 1;
            this.trigger(cr.system_object.prototype.cnds.OnLoadFinished, null);
        }
        if (navigator["splashscreen"] && navigator["splashscreen"]["hide"])
            navigator["splashscreen"]["hide"]();
        for (i = 0, len = this.types_by_index.length; i < len; i++) {
            t = this.types_by_index[i];
            if (t.onAppBegin)
                t.onAppBegin();
        }
        this.tick(false);
        if (this.isDirectCanvas)
            AppMobi["webview"]["execute"]("onGameReady();");
    };
    var raf = window["requestAnimationFrame"] ||
        window["mozRequestAnimationFrame"] ||
        window["webkitRequestAnimationFrame"] ||
        window["msRequestAnimationFrame"] ||
        window["oRequestAnimationFrame"];
    Runtime.prototype.tick = function(background_wake) {
        if (!this.running_layout)
            return;
        var logic_start = cr.performance_now();
        if (this.halfFramerateMode && this.ranLastRaf) {
            if (logic_start - this.lastRafTime < 29) {
                this.ranLastRaf = false;
                this.lastRafTime = logic_start;
                if (raf)
                    this.raf_id = raf(this.tickFunc, this.canvas);
                else // no idea if this works without raf/hi res timers but let's hope for the best
                    this.timeout_id = setTimeout(this.tickFunc, this.isMobile ? 1 : 16);
                return; // skipped this frame
            }
        }
        this.ranLastRaf = true;
        this.lastRafTime = logic_start;
        var fsmode = this.fullscreen_mode;
        var isfullscreen = (document["mozFullScreen"] || document["webkitIsFullScreen"] || document["fullScreen"] || !!document["msFullscreenElement"]) && !this.isPhoneGap;
        if ((isfullscreen || this.isNodeFullscreen) && this.fullscreen_scaling > 0)
            fsmode = this.fullscreen_scaling;
        if (fsmode > 0 && (!this.isiOS || window.self !== window.top)) {
            var curwidth = window.innerWidth;
            var curheight = window.innerHeight;
            if (this.lastWindowWidth !== curwidth || this.lastWindowHeight !== curheight) {
                this["setSize"](curwidth, curheight);
            }
        }
        if (!this.isDomFree) {
            if (isfullscreen) {
                if (!this.firstInFullscreen) {
                    this.fullscreenOldMarginCss = jQuery(this.canvas).css("margin") || "0";
                    this.firstInFullscreen = true;
                }
                if (!this.isChrome && !this.isNodeWebkit) {
                    jQuery(this.canvas).css({
                        "margin-left": "" + Math.floor((screen.width - (this.width / this.devicePixelRatio)) / 2) + "px",
                        "margin-top": "" + Math.floor((screen.height - (this.height / this.devicePixelRatio)) / 2) + "px"
                    });
                }
            } else {
                if (this.firstInFullscreen) {
                    if (!this.isChrome && !this.isNodeWebkit) {
                        jQuery(this.canvas).css("margin", this.fullscreenOldMarginCss);
                    }
                    this.fullscreenOldMarginCss = "";
                    this.firstInFullscreen = false;
                    if (this.fullscreen_mode === 0) {
                        this["setSize"](Math.round(this.oldWidth / this.devicePixelRatio), Math.round(this.oldHeight / this.devicePixelRatio), true);
                    }
                } else {
                    this.oldWidth = this.width;
                    this.oldHeight = this.height;
                }
            }
        }
        if (this.isloading) {
            var done = this.areAllTexturesLoaded(); // updates this.progress
            this.loadingprogress = this.progress;
            if (done) {
                this.isloading = false;
                this.progress = 1;
                this.trigger(cr.system_object.prototype.cnds.OnLoadFinished, null);
            }
        }
        this.logic();
        if ((this.redraw || this.isCocoonJs) && !this.is_WebGL_context_lost && !this.suspendDrawing && !background_wake) {
            this.redraw = false;
            if (this.glwrap)
                this.drawGL();
            else
                this.draw();
            if (this.snapshotCanvas) {
                if (this.canvas && this.canvas.toDataURL) {
                    this.snapshotData = this.canvas.toDataURL(this.snapshotCanvas[0], this.snapshotCanvas[1]);
                    this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot, null);
                }
                this.snapshotCanvas = null;
            }
        }
        if (!this.hit_breakpoint) {
            this.tickcount++;
            this.execcount++;
            this.framecount++;
        }
        this.logictime += cr.performance_now() - logic_start;
        if (this.isSuspended || background_wake)
            return;
        if (raf)
            this.raf_id = raf(this.tickFunc, this.canvas);
        else {
            this.timeout_id = setTimeout(this.tickFunc, this.isMobile ? 1 : 16);
        }
    };
    Runtime.prototype.logic = function() {
        var i, leni, j, lenj, k, lenk, type, inst, binst;
        var cur_time = cr.performance_now();
        if (cur_time - this.last_fps_time >= 1000) // every 1 second
        {
            this.last_fps_time += 1000;
            this.fps = this.framecount;
            this.framecount = 0;
            this.cpuutilisation = this.logictime;
            this.logictime = 0;
        }
        if (this.measuring_dt) {
            if (this.last_tick_time !== 0) {
                var ms_diff = cur_time - this.last_tick_time;
                if (ms_diff === 0 && !this.isDebug) {
                    this.zeroDtCount++;
                    if (this.zeroDtCout >= 10)
                        this.measuring_dt = false;
                    this.dt1 = 1.0 / 60.0; // 60fps assumed (0.01666...)
                } else {
                    this.dt1 = ms_diff / 1000.0; // dt measured in seconds
                    if (this.dt1 > 0.5)
                        this.dt1 = 0;
                    else if (this.dt1 > 0.1)
                        this.dt1 = 0.1;
                }
            }
            this.last_tick_time = cur_time;
        }
        this.dt = this.dt1 * this.timescale;
        this.kahanTime.add(this.dt);
        var isfullscreen = (document["mozFullScreen"] || document["webkitIsFullScreen"] || document["fullScreen"] || !!document["msFullscreenElement"] || this.isNodeFullscreen) && !this.isPhoneGap;
        if (this.fullscreen_mode >= 2 /* scale */ || (isfullscreen && this.fullscreen_scaling > 0)) {
            var orig_aspect = this.original_width / this.original_height;
            var cur_aspect = this.width / this.height;
            var mode = this.fullscreen_mode;
            if (isfullscreen && this.fullscreen_scaling > 0)
                mode = this.fullscreen_scaling;
            if ((mode !== 2 && cur_aspect > orig_aspect) || (mode === 2 && cur_aspect < orig_aspect)) {
                this.aspect_scale = this.height / this.original_height;
            } else {
                this.aspect_scale = this.width / this.original_width;
            }
            if (this.running_layout) {
                this.running_layout.scrollToX(this.running_layout.scrollX);
                this.running_layout.scrollToY(this.running_layout.scrollY);
            }
        } else
            this.aspect_scale = (this.isRetina ? this.devicePixelRatio : 1);
        this.ClearDeathRow();
        this.isInOnDestroy++;
        this.system.runWaits(); // prevent instance list changing
        this.isInOnDestroy--;
        this.ClearDeathRow(); // allow instance list changing
        this.isInOnDestroy++;
        for (i = 0, leni = this.types_by_index.length; i < leni; i++) {
            type = this.types_by_index[i];
            if (type.is_family || (!type.behaviors.length && !type.families.length))
                continue;
            for (j = 0, lenj = type.instances.length; j < lenj; j++) {
                inst = type.instances[j];
                for (k = 0, lenk = inst.behavior_insts.length; k < lenk; k++) {
                    inst.behavior_insts[k].tick();
                }
            }
        }
        for (i = 0, leni = this.types_by_index.length; i < leni; i++) {
            type = this.types_by_index[i];
            if (type.is_family || (!type.behaviors.length && !type.families.length))
                continue; // type doesn't have any behaviors
            for (j = 0, lenj = type.instances.length; j < lenj; j++) {
                inst = type.instances[j];
                for (k = 0, lenk = inst.behavior_insts.length; k < lenk; k++) {
                    binst = inst.behavior_insts[k];
                    if (binst.posttick)
                        binst.posttick();
                }
            }
        }
        var tickarr = this.objects_to_tick.valuesRef();
        for (i = 0, leni = tickarr.length; i < leni; i++)
            tickarr[i].tick();
        this.isInOnDestroy--; // end preventing instance lists from being changed
        this.handleSaveLoad(); // save/load now if queued
        i = 0;
        while (this.changelayout && i++ < 10) {
            this.doChangeLayout(this.changelayout);
        }
        for (i = 0, leni = this.eventsheets_by_index.length; i < leni; i++)
            this.eventsheets_by_index[i].hasRun = false;
        if (this.running_layout.event_sheet)
            this.running_layout.event_sheet.run();
        this.registered_collisions.length = 0;
        this.layout_first_tick = false;
        this.isInOnDestroy++; // prevent instance lists from being changed
        for (i = 0, leni = this.types_by_index.length; i < leni; i++) {
            type = this.types_by_index[i];
            if (type.is_family || (!type.behaviors.length && !type.families.length))
                continue; // type doesn't have any behaviors
            for (j = 0, lenj = type.instances.length; j < lenj; j++) {
                var inst = type.instances[j];
                for (k = 0, lenk = inst.behavior_insts.length; k < lenk; k++) {
                    binst = inst.behavior_insts[k];
                    if (binst.tick2)
                        binst.tick2();
                }
            }
        }
        tickarr = this.objects_to_tick2.valuesRef();
        for (i = 0, leni = tickarr.length; i < leni; i++)
            tickarr[i].tick2();
        this.isInOnDestroy--; // end preventing instance lists from being changed
    };
    Runtime.prototype.doChangeLayout = function(changeToLayout) {;
        var prev_layout = this.running_layout;
        this.running_layout.stopRunning();
        var i, len, j, lenj, k, lenk, type, inst, binst;
        if (this.glwrap) {
            for (i = 0, len = this.types_by_index.length; i < len; i++) {
                type = this.types_by_index[i];
                if (type.is_family)
                    continue;
                if (type.unloadTextures && (!type.global || type.instances.length === 0) && changeToLayout.initial_types.indexOf(type) === -1) {
                    type.unloadTextures();
                }
            }
        }
        if (prev_layout == changeToLayout)
            this.system.waits.length = 0;
        changeToLayout.startRunning();
        for (i = 0, len = this.types_by_index.length; i < len; i++) {
            type = this.types_by_index[i];
            if (!type.global && !type.plugin.singleglobal)
                continue;
            for (j = 0, lenj = type.instances.length; j < lenj; j++) {
                inst = type.instances[j];
                if (inst.onLayoutChange)
                    inst.onLayoutChange();
                if (inst.behavior_insts) {
                    for (k = 0, lenk = inst.behavior_insts.length; k < lenk; k++) {
                        binst = inst.behavior_insts[k];
                        if (binst.onLayoutChange)
                            binst.onLayoutChange();
                    }
                }
            }
        }
        this.redraw = true;
        this.layout_first_tick = true;
        this.ClearDeathRow();
    };
    Runtime.prototype.tickMe = function(inst) {
        this.objects_to_tick.add(inst);
    };
    Runtime.prototype.untickMe = function(inst) {
        this.objects_to_tick.remove(inst);
    };
    Runtime.prototype.tick2Me = function(inst) {
        this.objects_to_tick2.add(inst);
    };
    Runtime.prototype.untick2Me = function(inst) {
        this.objects_to_tick2.remove(inst);
    };
    Runtime.prototype.getDt = function(inst) {
        if (!inst || inst.my_timescale === -1.0)
            return this.dt;
        return this.dt1 * inst.my_timescale;
    };
    Runtime.prototype.draw = function() {
        this.running_layout.draw(this.ctx);
        if (this.isDirectCanvas)
            this.ctx["present"]();
    };
    Runtime.prototype.drawGL = function() {
        this.running_layout.drawGL(this.glwrap);
        this.glwrap.present();
    };
    Runtime.prototype.addDestroyCallback = function(f) {
        if (f)
            this.destroycallbacks.push(f);
    };
    Runtime.prototype.removeDestroyCallback = function(f) {
        cr.arrayFindRemove(this.destroycallbacks, f);
    };
    Runtime.prototype.getObjectByUID = function(uid_) {;
        var uidstr = uid_.toString();
        if (this.objectsByUid.hasOwnProperty(uidstr))
            return this.objectsByUid[uidstr];
        else
            return null;
    };
    Runtime.prototype.DestroyInstance = function(inst) {
        var i, len;
        if (!this.deathRow.contains(inst)) {
            this.deathRow.add(inst);
            if (inst.is_contained) {
                for (i = 0, len = inst.siblings.length; i < len; i++) {
                    this.DestroyInstance(inst.siblings[i]);
                }
            }
            if (this.isInClearDeathRow)
                this.deathRow.values_cache.push(inst);
            this.isInOnDestroy++; // support recursion
            this.trigger(Object.getPrototypeOf(inst.type.plugin).cnds.OnDestroyed, inst);
            this.isInOnDestroy--;
        }
    };
    Runtime.prototype.ClearDeathRow = function() {
        var inst, index, type, instances, binst;
        var i, j, k, leni, lenj, lenk;
        var w, f;
        this.isInClearDeathRow = true;
        for (i = 0, leni = this.createRow.length; i < leni; i++) {
            inst = this.createRow[i];
            type = inst.type;
            type.instances.push(inst);
            for (j = 0, lenj = type.families.length; j < lenj; j++) {
                type.families[j].instances.push(inst);
                type.families[j].stale_iids = true;
            }
        }
        this.createRow.length = 0;
        var arr = this.deathRow.valuesRef(); // get array of items from set
        for (i = 0; i < arr.length; i++) // check array length every time in case it changes
        {
            inst = arr[i];
            type = inst.type;
            instances = type.instances;
            for (j = 0, lenj = this.destroycallbacks.length; j < lenj; j++)
                this.destroycallbacks[j](inst);
            cr.arrayFindRemove(instances, inst);
            if (instances.length === 0)
                type.any_instance_parallaxed = false;
            if (inst.collcells) {
                type.collision_grid.update(inst, inst.collcells, null);
            }
            if (inst.layer) {
                cr.arrayRemove(inst.layer.instances, inst.get_zindex());
                inst.layer.zindices_stale = true;
            }
            for (j = 0, lenj = type.families.length; j < lenj; j++) {
                cr.arrayFindRemove(type.families[j].instances, inst);
                type.families[j].stale_iids = true;
            }
            if (inst.behavior_insts) {
                for (j = 0, lenj = inst.behavior_insts.length; j < lenj; j++) {
                    binst = inst.behavior_insts[j];
                    if (binst.onDestroy)
                        binst.onDestroy();
                    binst.behavior.my_instances.remove(inst);
                }
            }
            this.objects_to_tick.remove(inst);
            this.objects_to_tick2.remove(inst);
            for (j = 0, lenj = this.system.waits.length; j < lenj; j++) {
                w = this.system.waits[j];
                if (w.sols.hasOwnProperty(type.index))
                    cr.arrayFindRemove(w.sols[type.index].insts, inst);
                if (!type.is_family) {
                    for (k = 0, lenk = type.families.length; k < lenk; k++) {
                        f = type.families[k];
                        if (w.sols.hasOwnProperty(f.index))
                            cr.arrayFindRemove(w.sols[f.index].insts, inst);
                    }
                }
            }
            if (inst.onDestroy)
                inst.onDestroy();
            if (this.objectsByUid.hasOwnProperty(inst.uid.toString()))
                delete this.objectsByUid[inst.uid.toString()];
            this.objectcount--;
            if (type.deadCache.length < 64)
                type.deadCache.push(inst);
            type.stale_iids = true;
        }
        if (!this.deathRow.isEmpty())
            this.redraw = true;
        this.deathRow.clear();
        this.isInClearDeathRow = false;
    };
    Runtime.prototype.createInstance = function(type, layer, sx, sy) {
        if (type.is_family) {
            var i = cr.floor(Math.random() * type.members.length);
            return this.createInstance(type.members[i], layer, sx, sy);
        }
        if (!type.default_instance) {
            return null;
        }
        return this.createInstanceFromInit(type.default_instance, layer, false, sx, sy, false);
    };
    var all_behaviors = [];
    Runtime.prototype.createInstanceFromInit = function(initial_inst, layer, is_startup_instance, sx, sy, skip_siblings) {
        var i, len, j, lenj, p, effect_fallback, x, y;
        if (!initial_inst)
            return null;
        var type = this.types_by_index[initial_inst[1]];;;
        var is_world = type.plugin.is_world;;
        if (this.isloading && is_world && !type.isOnLoaderLayout)
            return null;
        if (is_world && !this.glwrap && initial_inst[0][11] === 11)
            return null;
        var original_layer = layer;
        if (!is_world)
            layer = null;
        var inst;
        if (type.deadCache.length) {
            inst = type.deadCache.pop();
            inst.recycled = true;
            type.plugin.Instance.call(inst, type);
        } else {
            inst = new type.plugin.Instance(type);
            inst.recycled = false;
        }
        if (is_startup_instance && !skip_siblings)
            inst.uid = initial_inst[2];
        else
            inst.uid = this.next_uid++;
        this.objectsByUid[inst.uid.toString()] = inst;
        inst.puid = this.next_puid++;
        inst.iid = type.instances.length;
        for (i = 0, len = this.createRow.length; i < len; ++i) {
            if (this.createRow[i].type === type)
                inst.iid++;
        }
        inst.get_iid = cr.inst_get_iid;
        var initial_vars = initial_inst[3];
        if (inst.recycled) {
            cr.wipe(inst.extra);
        } else {
            inst.extra = {};
            if (typeof cr_is_preview !== "undefined") {
                inst.instance_var_names = [];
                inst.instance_var_names.length = initial_vars.length;
                for (i = 0, len = initial_vars.length; i < len; i++)
                    inst.instance_var_names[i] = initial_vars[i][1];
            }
            inst.instance_vars = [];
            inst.instance_vars.length = initial_vars.length;
        }
        for (i = 0, len = initial_vars.length; i < len; i++)
            inst.instance_vars[i] = initial_vars[i][0];
        if (is_world) {
            var wm = initial_inst[0];;
            inst.x = cr.is_undefined(sx) ? wm[0] : sx;
            inst.y = cr.is_undefined(sy) ? wm[1] : sy;
            inst.z = wm[2];
            inst.width = wm[3];
            inst.height = wm[4];
            inst.depth = wm[5];
            inst.angle = wm[6];
            inst.opacity = wm[7];
            inst.hotspotX = wm[8];
            inst.hotspotY = wm[9];
            inst.blend_mode = wm[10];
            effect_fallback = wm[11];
            if (!this.glwrap && type.effect_types.length) // no WebGL renderer and shaders used
                inst.blend_mode = effect_fallback; // use fallback blend mode - destroy mode was handled above
            inst.compositeOp = cr.effectToCompositeOp(inst.blend_mode);
            if (this.gl)
                cr.setGLBlend(inst, inst.blend_mode, this.gl);
            if (inst.recycled) {
                for (i = 0, len = wm[12].length; i < len; i++) {
                    for (j = 0, lenj = wm[12][i].length; j < lenj; j++)
                        inst.effect_params[i][j] = wm[12][i][j];
                }
                inst.bbox.set(0, 0, 0, 0);
                inst.collcells.set(0, 0, -1, -1);
                inst.bquad.set_from_rect(inst.bbox);
                inst.bbox_changed_callbacks.length = 0;
            } else {
                inst.effect_params = wm[12].slice(0);
                for (i = 0, len = inst.effect_params.length; i < len; i++)
                    inst.effect_params[i] = wm[12][i].slice(0);
                inst.active_effect_types = [];
                inst.active_effect_flags = [];
                inst.active_effect_flags.length = type.effect_types.length;
                inst.bbox = new cr.rect(0, 0, 0, 0);
                inst.collcells = new cr.rect(0, 0, -1, -1);
                inst.bquad = new cr.quad();
                inst.bbox_changed_callbacks = [];
                inst.set_bbox_changed = cr.set_bbox_changed;
                inst.add_bbox_changed_callback = cr.add_bbox_changed_callback;
                inst.contains_pt = cr.inst_contains_pt;
                inst.update_bbox = cr.update_bbox;
                inst.update_collision_cell = cr.update_collision_cell;
                inst.get_zindex = cr.inst_get_zindex;
            }
            inst.tilemap_exists = false;
            inst.tilemap_width = 0;
            inst.tilemap_height = 0;
            inst.tilemap_data = null;
            if (wm.length === 14) {
                inst.tilemap_exists = true;
                inst.tilemap_width = wm[13][0];
                inst.tilemap_height = wm[13][1];
                inst.tilemap_data = wm[13][2];
            }
            for (i = 0, len = type.effect_types.length; i < len; i++)
                inst.active_effect_flags[i] = true;
            inst.updateActiveEffects = cr.inst_updateActiveEffects;
            inst.updateActiveEffects();
            inst.uses_shaders = !!inst.active_effect_types.length;
            inst.bbox_changed = true;
            inst.cell_changed = true;
            type.any_cell_changed = true;
            inst.visible = true;
            inst.my_timescale = -1.0;
            inst.layer = layer;
            inst.zindex = layer.instances.length; // will be placed at top of current layer
            if (typeof inst.collision_poly === "undefined")
                inst.collision_poly = null;
            inst.collisionsEnabled = true;
            this.redraw = true;
        }
        inst.toString = cr.inst_toString;
        var initial_props, binst;
        all_behaviors.length = 0;
        for (i = 0, len = type.families.length; i < len; i++) {
            all_behaviors.push.apply(all_behaviors, type.families[i].behaviors);
        }
        all_behaviors.push.apply(all_behaviors, type.behaviors);
        if (inst.recycled) {
            for (i = 0, len = all_behaviors.length; i < len; i++) {
                var btype = all_behaviors[i];
                binst = inst.behavior_insts[i];
                binst.recycled = true;
                btype.behavior.Instance.call(binst, btype, inst);
                initial_props = initial_inst[4][i];
                for (j = 0, lenj = initial_props.length; j < lenj; j++)
                    binst.properties[j] = initial_props[j];
                binst.onCreate();
                btype.behavior.my_instances.add(inst);
            }
        } else {
            inst.behavior_insts = [];
            for (i = 0, len = all_behaviors.length; i < len; i++) {
                var btype = all_behaviors[i];
                var binst = new btype.behavior.Instance(btype, inst);
                binst.recycled = false;
                binst.properties = initial_inst[4][i].slice(0);
                binst.onCreate();
                cr.seal(binst);
                inst.behavior_insts.push(binst);
                btype.behavior.my_instances.add(inst);
            }
        }
        initial_props = initial_inst[5];
        if (inst.recycled) {
            for (i = 0, len = initial_props.length; i < len; i++)
                inst.properties[i] = initial_props[i];
        } else
            inst.properties = initial_props.slice(0);
        this.createRow.push(inst);
        if (layer) {;
            layer.instances.push(inst);
            if (layer.parallaxX !== 1 || layer.parallaxY !== 1)
                type.any_instance_parallaxed = true;
        }
        this.objectcount++;
        if (type.is_contained) {
            inst.is_contained = true;
            if (inst.recycled)
                inst.siblings.length = 0;
            else
                inst.siblings = []; // note: should not include self in siblings
            if (!is_startup_instance && !skip_siblings) // layout links initial instances
            {
                for (i = 0, len = type.container.length; i < len; i++) {
                    if (type.container[i] === type)
                        continue;
                    if (!type.container[i].default_instance) {
                        return null;
                    }
                    inst.siblings.push(this.createInstanceFromInit(type.container[i].default_instance, original_layer, false, is_world ? inst.x : sx, is_world ? inst.y : sy, true));
                }
                for (i = 0, len = inst.siblings.length; i < len; i++) {
                    inst.siblings[i].siblings.push(inst);
                    for (j = 0; j < len; j++) {
                        if (i !== j)
                            inst.siblings[i].siblings.push(inst.siblings[j]);
                    }
                }
            }
        } else {
            inst.is_contained = false;
            inst.siblings = null;
        }
        inst.onCreate();
        if (!inst.recycled)
            cr.seal(inst);
        for (i = 0, len = inst.behavior_insts.length; i < len; i++) {
            if (inst.behavior_insts[i].postCreate)
                inst.behavior_insts[i].postCreate();
        }
        return inst;
    };
    Runtime.prototype.getLayerByName = function(layer_name) {
        var i, len;
        for (i = 0, len = this.running_layout.layers.length; i < len; i++) {
            var layer = this.running_layout.layers[i];
            if (cr.equals_nocase(layer.name, layer_name))
                return layer;
        }
        return null;
    };
    Runtime.prototype.getLayerByNumber = function(index) {
        index = cr.floor(index);
        if (index < 0)
            index = 0;
        if (index >= this.running_layout.layers.length)
            index = this.running_layout.layers.length - 1;
        return this.running_layout.layers[index];
    };
    Runtime.prototype.getLayer = function(l) {
        if (cr.is_number(l))
            return this.getLayerByNumber(l);
        else
            return this.getLayerByName(l.toString());
    };
    Runtime.prototype.clearSol = function(solModifiers) {
        var i, len;
        for (i = 0, len = solModifiers.length; i < len; i++) {
            solModifiers[i].getCurrentSol().select_all = true;
        }
    };
    Runtime.prototype.pushCleanSol = function(solModifiers) {
        var i, len;
        for (i = 0, len = solModifiers.length; i < len; i++) {
            solModifiers[i].pushCleanSol();
        }
    };
    Runtime.prototype.pushCopySol = function(solModifiers) {
        var i, len;
        for (i = 0, len = solModifiers.length; i < len; i++) {
            solModifiers[i].pushCopySol();
        }
    };
    Runtime.prototype.popSol = function(solModifiers) {
        var i, len;
        for (i = 0, len = solModifiers.length; i < len; i++) {
            solModifiers[i].popSol();
        }
    };
    Runtime.prototype.updateAllCells = function(type) {
        if (!type.any_cell_changed)
            return; // all instances must already be up-to-date
        var i, len, instances = type.instances;
        for (i = 0, len = instances.length; i < len; ++i) {
            instances[i].update_collision_cell();
        }
        var createRow = this.createRow;
        for (i = 0, len = createRow.length; i < len; ++i) {
            if (createRow[i].type === type)
                createRow[i].update_collision_cell();
        }
        type.any_cell_changed = false;
    };
    Runtime.prototype.getCollisionCandidates = function(layer, rtype, bbox, candidates) {
        var i, len, t;
        var is_parallaxed = (layer ? (layer.parallaxX !== 1 || layer.parallaxY !== 1) : false);
        if (rtype.is_family) {
            for (i = 0, len = rtype.members.length; i < len; ++i) {
                t = rtype.members[i];
                if (is_parallaxed || t.any_instance_parallaxed) {
                    cr.appendArray(candidates, t.instances);
                } else {
                    this.updateAllCells(t);
                    t.collision_grid.queryRange(bbox, candidates);
                }
            }
        } else {
            if (is_parallaxed || rtype.any_instance_parallaxed) {
                cr.appendArray(candidates, rtype.instances);
            } else {
                this.updateAllCells(rtype);
                rtype.collision_grid.queryRange(bbox, candidates);
            }
        }
    };
    Runtime.prototype.getTypesCollisionCandidates = function(layer, types, bbox, candidates) {
        var i, len;
        for (i = 0, len = types.length; i < len; ++i) {
            this.getCollisionCandidates(layer, types[i], bbox, candidates);
        }
    };
    Runtime.prototype.getSolidCollisionCandidates = function(layer, bbox, candidates) {
        var solid = this.getSolidBehavior();
        if (!solid)
            return null;
        this.getTypesCollisionCandidates(layer, solid.my_types, bbox, candidates);
    };
    Runtime.prototype.getJumpthruCollisionCandidates = function(layer, bbox, candidates) {
        var jumpthru = this.getJumpthruBehavior();
        if (!jumpthru)
            return null;
        this.getTypesCollisionCandidates(layer, jumpthru.my_types, bbox, candidates);
    };
    Runtime.prototype.testAndSelectCanvasPointOverlap = function(type, ptx, pty, inverted) {
        var sol = type.getCurrentSol();
        var i, j, inst, len;
        var lx, ly;
        if (sol.select_all) {
            if (!inverted) {
                sol.select_all = false;
                sol.instances.length = 0; // clear contents
            }
            for (i = 0, len = type.instances.length; i < len; i++) {
                inst = type.instances[i];
                inst.update_bbox();
                lx = inst.layer.canvasToLayer(ptx, pty, true);
                ly = inst.layer.canvasToLayer(ptx, pty, false);
                if (inst.contains_pt(lx, ly)) {
                    if (inverted)
                        return false;
                    else
                        sol.instances.push(inst);
                }
            }
        } else {
            j = 0;
            for (i = 0, len = sol.instances.length; i < len; i++) {
                inst = sol.instances[i];
                inst.update_bbox();
                lx = inst.layer.canvasToLayer(ptx, pty, true);
                ly = inst.layer.canvasToLayer(ptx, pty, false);
                if (inst.contains_pt(lx, ly)) {
                    if (inverted)
                        return false;
                    else {
                        sol.instances[j] = sol.instances[i];
                        j++;
                    }
                }
            }
            if (!inverted)
                sol.instances.length = j;
        }
        type.applySolToContainer();
        if (inverted)
            return true; // did not find anything overlapping
        else
            return sol.hasObjects();
    };
    Runtime.prototype.testOverlap = function(a, b) {
        if (!a || !b || a === b || !a.collisionsEnabled || !b.collisionsEnabled)
            return false;
        a.update_bbox();
        b.update_bbox();
        var layera = a.layer;
        var layerb = b.layer;
        var different_layers = (layera !== layerb && (layera.parallaxX !== layerb.parallaxX || layerb.parallaxY !== layerb.parallaxY || layera.scale !== layerb.scale || layera.angle !== layerb.angle || layera.zoomRate !== layerb.zoomRate));
        var i, len, i2, i21, x, y, haspolya, haspolyb, polya, polyb;
        if (!different_layers) // same layers: easy check
        {
            if (!a.bbox.intersects_rect(b.bbox))
                return false;
            if (!a.bquad.intersects_quad(b.bquad))
                return false;
            if (a.tilemap_exists && b.tilemap_exists)
                return false;
            if (a.tilemap_exists)
                return this.testTilemapOverlap(a, b);
            if (b.tilemap_exists)
                return this.testTilemapOverlap(b, a);
            haspolya = (a.collision_poly && !a.collision_poly.is_empty());
            haspolyb = (b.collision_poly && !b.collision_poly.is_empty());
            if (!haspolya && !haspolyb)
                return true;
            if (haspolya) {
                a.collision_poly.cache_poly(a.width, a.height, a.angle);
                polya = a.collision_poly;
            } else {
                this.temp_poly.set_from_quad(a.bquad, a.x, a.y, a.width, a.height);
                polya = this.temp_poly;
            }
            if (haspolyb) {
                b.collision_poly.cache_poly(b.width, b.height, b.angle);
                polyb = b.collision_poly;
            } else {
                this.temp_poly.set_from_quad(b.bquad, b.x, b.y, b.width, b.height);
                polyb = this.temp_poly;
            }
            return polya.intersects_poly(polyb, b.x - a.x, b.y - a.y);
        } else // different layers: need to do full translated check
        {
            haspolya = (a.collision_poly && !a.collision_poly.is_empty());
            haspolyb = (b.collision_poly && !b.collision_poly.is_empty());
            if (haspolya) {
                a.collision_poly.cache_poly(a.width, a.height, a.angle);
                this.temp_poly.set_from_poly(a.collision_poly);
            } else {
                this.temp_poly.set_from_quad(a.bquad, a.x, a.y, a.width, a.height);
            }
            polya = this.temp_poly;
            if (haspolyb) {
                b.collision_poly.cache_poly(b.width, b.height, b.angle);
                this.temp_poly2.set_from_poly(b.collision_poly);
            } else {
                this.temp_poly2.set_from_quad(b.bquad, b.x, b.y, b.width, b.height);
            }
            polyb = this.temp_poly2;
            for (i = 0, len = polya.pts_count; i < len; i++) {
                i2 = i * 2;
                i21 = i2 + 1;
                x = polya.pts_cache[i2];
                y = polya.pts_cache[i21];
                polya.pts_cache[i2] = layera.layerToCanvas(x + a.x, y + a.y, true);
                polya.pts_cache[i21] = layera.layerToCanvas(x + a.x, y + a.y, false);
            }
            polya.update_bbox();
            for (i = 0, len = polyb.pts_count; i < len; i++) {
                i2 = i * 2;
                i21 = i2 + 1;
                x = polyb.pts_cache[i2];
                y = polyb.pts_cache[i21];
                polyb.pts_cache[i2] = layerb.layerToCanvas(x + b.x, y + b.y, true);
                polyb.pts_cache[i21] = layerb.layerToCanvas(x + b.x, y + b.y, false);
            }
            polyb.update_bbox();
            return polya.intersects_poly(polyb, 0, 0);
        }
    };
    var tmpQuad = new cr.quad();
    var tmpRect = new cr.rect(0, 0, 0, 0);
    var collrect_candidates = [];
    Runtime.prototype.testTilemapOverlap = function(tm, a) {
        var i, len, c, rc;
        var bbox = a.bbox;
        var tmx = tm.x;
        var tmy = tm.y;
        tm.getCollisionRectCandidates(bbox, collrect_candidates);
        var collrects = collrect_candidates;
        var haspolya = (a.collision_poly && !a.collision_poly.is_empty());
        for (i = 0, len = collrects.length; i < len; ++i) {
            c = collrects[i];
            rc = c.rc;
            if (bbox.intersects_rect_off(rc, tmx, tmy)) {
                tmpQuad.set_from_rect(rc);
                tmpQuad.offset(tmx, tmy);
                if (tmpQuad.intersects_quad(a.bquad)) {
                    if (haspolya) {
                        a.collision_poly.cache_poly(a.width, a.height, a.angle);
                        if (c.poly) {
                            if (c.poly.intersects_poly(a.collision_poly, a.x - (tmx + rc.left), a.y - (tmy + rc.top))) {
                                collrect_candidates.length = 0;
                                return true;
                            }
                        } else {
                            this.temp_poly.set_from_quad(tmpQuad, 0, 0, rc.right - rc.left, rc.bottom - rc.top);
                            if (this.temp_poly.intersects_poly(a.collision_poly, a.x, a.y)) {
                                collrect_candidates.length = 0;
                                return true;
                            }
                        }
                    } else {
                        if (c.poly) {
                            this.temp_poly.set_from_quad(a.bquad, 0, 0, a.width, a.height);
                            if (c.poly.intersects_poly(this.temp_poly, -(tmx + rc.left), -(tmy + rc.top))) {
                                collrect_candidates.length = 0;
                                return true;
                            }
                        } else {
                            collrect_candidates.length = 0;
                            return true;
                        }
                    }
                }
            }
        }
        collrect_candidates.length = 0;
        return false;
    };
    Runtime.prototype.testRectOverlap = function(r, b) {
        if (!b || !b.collisionsEnabled)
            return false;
        b.update_bbox();
        var layerb = b.layer;
        var haspolyb, polyb;
        if (!b.bbox.intersects_rect(r))
            return false;
        if (b.tilemap_exists) {
            b.getCollisionRectCandidates(r, collrect_candidates);
            var collrects = collrect_candidates;
            var i, len, c, tilerc;
            var tmx = b.x;
            var tmy = b.y;
            for (i = 0, len = collrects.length; i < len; ++i) {
                c = collrects[i];
                tilerc = c.rc;
                if (r.intersects_rect_off(tilerc, tmx, tmy)) {
                    if (c.poly) {
                        this.temp_poly.set_from_rect(r, 0, 0);
                        if (c.poly.intersects_poly(this.temp_poly, -(tmx + tilerc.left), -(tmy + tilerc.top))) {
                            collrect_candidates.length = 0;
                            return true;
                        }
                    } else {
                        collrect_candidates.length = 0;
                        return true;
                    }
                }
            }
            collrect_candidates.length = 0;
            return false;
        } else {
            tmpQuad.set_from_rect(r);
            if (!b.bquad.intersects_quad(tmpQuad))
                return false;
            haspolyb = (b.collision_poly && !b.collision_poly.is_empty());
            if (!haspolyb)
                return true;
            b.collision_poly.cache_poly(b.width, b.height, b.angle);
            tmpQuad.offset(-r.left, -r.top);
            this.temp_poly.set_from_quad(tmpQuad, 0, 0, 1, 1);
            return b.collision_poly.intersects_poly(this.temp_poly, r.left - b.x, r.top - b.y);
        }
    };
    Runtime.prototype.testSegmentOverlap = function(x1, y1, x2, y2, b) {
        if (!b || !b.collisionsEnabled)
            return false;
        b.update_bbox();
        var layerb = b.layer;
        var haspolyb, polyb;
        tmpRect.set(cr.min(x1, x2), cr.min(y1, y2), cr.max(x1, x2), cr.max(y1, y2));
        if (!b.bbox.intersects_rect(tmpRect))
            return false;
        if (b.tilemap_exists) {
            b.getCollisionRectCandidates(tmpRect, collrect_candidates);
            var collrects = collrect_candidates;
            var i, len, c, tilerc;
            var tmx = b.x;
            var tmy = b.y;
            for (i = 0, len = collrects.length; i < len; ++i) {
                c = collrects[i];
                tilerc = c.rc;
                if (tmpRect.intersects_rect_off(tilerc, tmx, tmy)) {
                    tmpQuad.set_from_rect(tilerc);
                    tmpQuad.offset(tmx, tmy);
                    if (tmpQuad.intersects_segment(x1, y1, x2, y2)) {
                        if (c.poly) {
                            if (c.poly.intersects_segment(tmx + tilerc.left, tmy + tilerc.top, x1, y1, x2, y2)) {
                                collrect_candidates.length = 0;
                                return true;
                            }
                        } else {
                            collrect_candidates.length = 0;
                            return true;
                        }
                    }
                }
            }
            collrect_candidates.length = 0;
            return false;
        } else {
            if (!b.bquad.intersects_segment(x1, y1, x2, y2))
                return false;
            haspolyb = (b.collision_poly && !b.collision_poly.is_empty());
            if (!haspolyb)
                return true;
            b.collision_poly.cache_poly(b.width, b.height, b.angle);
            return b.collision_poly.intersects_segment(b.x, b.y, x1, y1, x2, y2);
        }
    };
    Runtime.prototype.typeHasBehavior = function(t, b) {
        if (!b)
            return false;
        var i, len, j, lenj, f;
        for (i = 0, len = t.behaviors.length; i < len; i++) {
            if (t.behaviors[i].behavior instanceof b)
                return true;
        }
        if (!t.is_family) {
            for (i = 0, len = t.families.length; i < len; i++) {
                f = t.families[i];
                for (j = 0, lenj = f.behaviors.length; j < lenj; j++) {
                    if (f.behaviors[j].behavior instanceof b)
                        return true;
                }
            }
        }
        return false;
    };
    Runtime.prototype.typeHasNoSaveBehavior = function(t) {
        return this.typeHasBehavior(t, cr.behaviors.NoSave);
    };
    Runtime.prototype.typeHasPersistBehavior = function(t) {
        return this.typeHasBehavior(t, cr.behaviors.Persist);
    };
    Runtime.prototype.getSolidBehavior = function() {
        return this.solidBehavior;
    };
    Runtime.prototype.getJumpthruBehavior = function() {
        return this.jumpthruBehavior;
    };
    var candidates = [];
    Runtime.prototype.testOverlapSolid = function(inst) {
        var i, len, s;
        inst.update_bbox();
        this.getSolidCollisionCandidates(inst.layer, inst.bbox, candidates);
        for (i = 0, len = candidates.length; i < len; ++i) {
            s = candidates[i];
            if (!s.extra.solidEnabled)
                continue;
            if (this.testOverlap(inst, s)) {
                candidates.length = 0;
                return s;
            }
        }
        candidates.length = 0;
        return null;
    };
    Runtime.prototype.testRectOverlapSolid = function(r) {
        var i, len, s;
        this.getSolidCollisionCandidates(null, r, candidates);
        for (i = 0, len = candidates.length; i < len; ++i) {
            s = candidates[i];
            if (!s.extra.solidEnabled)
                continue;
            if (this.testRectOverlap(r, s)) {
                candidates.length = 0;
                return s;
            }
        }
        candidates.length = 0;
        return null;
    };
    var jumpthru_array_ret = [];
    Runtime.prototype.testOverlapJumpThru = function(inst, all) {
        var ret = null;
        if (all) {
            ret = jumpthru_array_ret;
            ret.length = 0;
        }
        inst.update_bbox();
        this.getJumpthruCollisionCandidates(inst.layer, inst.bbox, candidates);
        var i, len, j;
        for (i = 0, len = candidates.length; i < len; ++i) {
            j = candidates[i];
            if (!j.extra.jumpthruEnabled)
                continue;
            if (this.testOverlap(inst, j)) {
                if (all)
                    ret.push(j);
                else {
                    candidates.length = 0;
                    return j;
                }
            }
        }
        candidates.length = 0;
        return ret;
    };
    Runtime.prototype.pushOutSolid = function(inst, xdir, ydir, dist, include_jumpthrus, specific_jumpthru) {
        var push_dist = dist || 50;
        var oldx = inst.x
        var oldy = inst.y;
        var i;
        var last_overlapped = null,
            secondlast_overlapped = null;
        for (i = 0; i < push_dist; i++) {
            inst.x = (oldx + (xdir * i));
            inst.y = (oldy + (ydir * i));
            inst.set_bbox_changed();
            if (!this.testOverlap(inst, last_overlapped)) {
                last_overlapped = this.testOverlapSolid(inst);
                if (last_overlapped)
                    secondlast_overlapped = last_overlapped;
                if (!last_overlapped) {
                    if (include_jumpthrus) {
                        if (specific_jumpthru)
                            last_overlapped = (this.testOverlap(inst, specific_jumpthru) ? specific_jumpthru : null);
                        else
                            last_overlapped = this.testOverlapJumpThru(inst);
                        if (last_overlapped)
                            secondlast_overlapped = last_overlapped;
                    }
                    if (!last_overlapped) {
                        if (secondlast_overlapped)
                            this.pushInFractional(inst, xdir, ydir, secondlast_overlapped, 16);
                        return true;
                    }
                }
            }
        }
        inst.x = oldx;
        inst.y = oldy;
        inst.set_bbox_changed();
        return false;
    };
    Runtime.prototype.pushOut = function(inst, xdir, ydir, dist, otherinst) {
        var push_dist = dist || 50;
        var oldx = inst.x
        var oldy = inst.y;
        var i;
        for (i = 0; i < push_dist; i++) {
            inst.x = (oldx + (xdir * i));
            inst.y = (oldy + (ydir * i));
            inst.set_bbox_changed();
            if (!this.testOverlap(inst, otherinst))
                return true;
        }
        inst.x = oldx;
        inst.y = oldy;
        inst.set_bbox_changed();
        return false;
    };
    Runtime.prototype.pushInFractional = function(inst, xdir, ydir, obj, limit) {
        var divisor = 2;
        var frac;
        var forward = false;
        var overlapping = false;
        var bestx = inst.x;
        var besty = inst.y;
        while (divisor <= limit) {
            frac = 1 / divisor;
            divisor *= 2;
            inst.x += xdir * frac * (forward ? 1 : -1);
            inst.y += ydir * frac * (forward ? 1 : -1);
            inst.set_bbox_changed();
            if (this.testOverlap(inst, obj)) {
                forward = true;
                overlapping = true;
            } else {
                forward = false;
                overlapping = false;
                bestx = inst.x;
                besty = inst.y;
            }
        }
        if (overlapping) {
            inst.x = bestx;
            inst.y = besty;
            inst.set_bbox_changed();
        }
    };
    Runtime.prototype.pushOutSolidNearest = function(inst, max_dist_) {
        var max_dist = (cr.is_undefined(max_dist_) ? 100 : max_dist_);
        var dist = 0;
        var oldx = inst.x
        var oldy = inst.y;
        var dir = 0;
        var dx = 0,
            dy = 0;
        var last_overlapped = this.testOverlapSolid(inst);
        if (!last_overlapped)
            return true; // already clear of solids
        while (dist <= max_dist) {
            switch (dir) {
                case 0:
                    dx = 0;
                    dy = -1;
                    dist++;
                    break;
                case 1:
                    dx = 1;
                    dy = -1;
                    break;
                case 2:
                    dx = 1;
                    dy = 0;
                    break;
                case 3:
                    dx = 1;
                    dy = 1;
                    break;
                case 4:
                    dx = 0;
                    dy = 1;
                    break;
                case 5:
                    dx = -1;
                    dy = 1;
                    break;
                case 6:
                    dx = -1;
                    dy = 0;
                    break;
                case 7:
                    dx = -1;
                    dy = -1;
                    break;
            }
            dir = (dir + 1) % 8;
            inst.x = cr.floor(oldx + (dx * dist));
            inst.y = cr.floor(oldy + (dy * dist));
            inst.set_bbox_changed();
            if (!this.testOverlap(inst, last_overlapped)) {
                last_overlapped = this.testOverlapSolid(inst);
                if (!last_overlapped)
                    return true;
            }
        }
        inst.x = oldx;
        inst.y = oldy;
        inst.set_bbox_changed();
        return false;
    };
    Runtime.prototype.registerCollision = function(a, b) {
        if (!a.collisionsEnabled || !b.collisionsEnabled)
            return;
        this.registered_collisions.push([a, b]);
    };
    Runtime.prototype.checkRegisteredCollision = function(a, b) {
        var i, len, x;
        for (i = 0, len = this.registered_collisions.length; i < len; i++) {
            x = this.registered_collisions[i];
            if ((x[0] == a && x[1] == b) || (x[0] == b && x[1] == a))
                return true;
        }
        return false;
    };
    Runtime.prototype.calculateSolidBounceAngle = function(inst, startx, starty, obj) {
        var objx = inst.x;
        var objy = inst.y;
        var radius = cr.max(10, cr.distanceTo(startx, starty, objx, objy));
        var startangle = cr.angleTo(startx, starty, objx, objy);
        var firstsolid = obj || this.testOverlapSolid(inst);
        if (!firstsolid)
            return cr.clamp_angle(startangle + cr.PI);
        var cursolid = firstsolid;
        var i, curangle, anticlockwise_free_angle, clockwise_free_angle;
        var increment = cr.to_radians(5); // 5 degree increments
        for (i = 1; i < 36; i++) {
            curangle = startangle - i * increment;
            inst.x = startx + Math.cos(curangle) * radius;
            inst.y = starty + Math.sin(curangle) * radius;
            inst.set_bbox_changed();
            if (!this.testOverlap(inst, cursolid)) {
                cursolid = obj ? null : this.testOverlapSolid(inst);
                if (!cursolid) {
                    anticlockwise_free_angle = curangle;
                    break;
                }
            }
        }
        if (i === 36)
            anticlockwise_free_angle = cr.clamp_angle(startangle + cr.PI);
        var cursolid = firstsolid;
        for (i = 1; i < 36; i++) {
            curangle = startangle + i * increment;
            inst.x = startx + Math.cos(curangle) * radius;
            inst.y = starty + Math.sin(curangle) * radius;
            inst.set_bbox_changed();
            if (!this.testOverlap(inst, cursolid)) {
                cursolid = obj ? null : this.testOverlapSolid(inst);
                if (!cursolid) {
                    clockwise_free_angle = curangle;
                    break;
                }
            }
        }
        if (i === 36)
            clockwise_free_angle = cr.clamp_angle(startangle + cr.PI);
        inst.x = objx;
        inst.y = objy;
        inst.set_bbox_changed();
        if (clockwise_free_angle === anticlockwise_free_angle)
            return clockwise_free_angle;
        var half_diff = cr.angleDiff(clockwise_free_angle, anticlockwise_free_angle) / 2;
        var normal;
        if (cr.angleClockwise(clockwise_free_angle, anticlockwise_free_angle)) {
            normal = cr.clamp_angle(anticlockwise_free_angle + half_diff + cr.PI);
        } else {
            normal = cr.clamp_angle(clockwise_free_angle + half_diff);
        };
        var vx = Math.cos(startangle);
        var vy = Math.sin(startangle);
        var nx = Math.cos(normal);
        var ny = Math.sin(normal);
        var v_dot_n = vx * nx + vy * ny;
        var rx = vx - 2 * v_dot_n * nx;
        var ry = vy - 2 * v_dot_n * ny;
        return cr.angleTo(0, 0, rx, ry);
    };
    var triggerSheetIndex = -1;
    Runtime.prototype.trigger = function(method, inst, value /* for fast triggers */ ) {;
        if (!this.running_layout)
            return false;
        var sheet = this.running_layout.event_sheet;
        if (!sheet)
            return false; // no event sheet active; nothing to trigger
        var ret = false;
        var r, i, len;
        triggerSheetIndex++;
        var deep_includes = sheet.deep_includes;
        for (i = 0, len = deep_includes.length; i < len; ++i) {
            r = this.triggerOnSheet(method, inst, deep_includes[i], value);
            ret = ret || r;
        }
        r = this.triggerOnSheet(method, inst, sheet, value);
        ret = ret || r;
        triggerSheetIndex--;
        return ret;
    };
    Runtime.prototype.triggerOnSheet = function(method, inst, sheet, value) {
        var ret = false;
        var i, leni, r, families;
        if (!inst) {
            r = this.triggerOnSheetForTypeName(method, inst, "system", sheet, value);
            ret = ret || r;
        } else {
            r = this.triggerOnSheetForTypeName(method, inst, inst.type.name, sheet, value);
            ret = ret || r;
            families = inst.type.families;
            for (i = 0, leni = families.length; i < leni; ++i) {
                r = this.triggerOnSheetForTypeName(method, inst, families[i].name, sheet, value);
                ret = ret || r;
            }
        }
        return ret; // true if anything got triggered
    };
    Runtime.prototype.triggerOnSheetForTypeName = function(method, inst, type_name, sheet, value) {
        var i, leni;
        var ret = false,
            ret2 = false;
        var trig, index;
        var fasttrigger = (typeof value !== "undefined");
        var triggers = (fasttrigger ? sheet.fasttriggers : sheet.triggers);
        var obj_entry = triggers[type_name];
        if (!obj_entry)
            return ret;
        var triggers_list = null;
        for (i = 0, leni = obj_entry.length; i < leni; ++i) {
            if (obj_entry[i].method == method) {
                triggers_list = obj_entry[i].evs;
                break;
            }
        }
        if (!triggers_list)
            return ret;
        var triggers_to_fire;
        if (fasttrigger) {
            triggers_to_fire = triggers_list[value];
        } else {
            triggers_to_fire = triggers_list;
        }
        if (!triggers_to_fire)
            return null;
        for (i = 0, leni = triggers_to_fire.length; i < leni; i++) {
            trig = triggers_to_fire[i][0];
            index = triggers_to_fire[i][1];
            ret2 = this.executeSingleTrigger(inst, type_name, trig, index);
            ret = ret || ret2;
        }
        return ret;
    };
    Runtime.prototype.executeSingleTrigger = function(inst, type_name, trig, index) {
        var i, leni;
        var ret = false;
        this.trigger_depth++;
        var current_event = this.getCurrentEventStack().current_event;
        if (current_event)
            this.pushCleanSol(current_event.solModifiersIncludingParents);
        var isrecursive = (this.trigger_depth > 1); // calling trigger from inside another trigger
        this.pushCleanSol(trig.solModifiersIncludingParents);
        if (isrecursive)
            this.pushLocalVarStack();
        var event_stack = this.pushEventStack(trig);
        event_stack.current_event = trig;
        if (inst) {
            var sol = this.types[type_name].getCurrentSol();
            sol.select_all = false;
            sol.instances.length = 1;
            sol.instances[0] = inst;
            this.types[type_name].applySolToContainer();
        }
        var ok_to_run = true;
        if (trig.parent) {
            var temp_parents_arr = event_stack.temp_parents_arr;
            var cur_parent = trig.parent;
            while (cur_parent) {
                temp_parents_arr.push(cur_parent);
                cur_parent = cur_parent.parent;
            }
            temp_parents_arr.reverse();
            for (i = 0, leni = temp_parents_arr.length; i < leni; i++) {
                if (!temp_parents_arr[i].run_pretrigger()) // parent event failed
                {
                    ok_to_run = false;
                    break;
                }
            }
        }
        if (ok_to_run) {
            this.execcount++;
            if (trig.orblock)
                trig.run_orblocktrigger(index);
            else
                trig.run();
            ret = ret || event_stack.last_event_true;
        }
        this.popEventStack();
        if (isrecursive)
            this.popLocalVarStack();
        this.popSol(trig.solModifiersIncludingParents);
        if (current_event)
            this.popSol(current_event.solModifiersIncludingParents);
        if (this.isInOnDestroy === 0 && triggerSheetIndex === 0 && !this.isRunningEvents && (!this.deathRow.isEmpty() || this.createRow.length)) {
            this.ClearDeathRow();
        }
        this.trigger_depth--;
        return ret;
    };
    Runtime.prototype.getCurrentCondition = function() {
        var evinfo = this.getCurrentEventStack();
        return evinfo.current_event.conditions[evinfo.cndindex];
    };
    Runtime.prototype.getCurrentAction = function() {
        var evinfo = this.getCurrentEventStack();
        return evinfo.current_event.actions[evinfo.actindex];
    };
    Runtime.prototype.pushLocalVarStack = function() {
        this.localvar_stack_index++;
        if (this.localvar_stack_index >= this.localvar_stack.length)
            this.localvar_stack.push([]);
    };
    Runtime.prototype.popLocalVarStack = function() {;
        this.localvar_stack_index--;
    };
    Runtime.prototype.getCurrentLocalVarStack = function() {
        return this.localvar_stack[this.localvar_stack_index];
    };
    Runtime.prototype.pushEventStack = function(cur_event) {
        this.event_stack_index++;
        if (this.event_stack_index >= this.event_stack.length)
            this.event_stack.push(new cr.eventStackFrame());
        var ret = this.getCurrentEventStack();
        ret.reset(cur_event);
        return ret;
    };
    Runtime.prototype.popEventStack = function() {;
        this.event_stack_index--;
    };
    Runtime.prototype.getCurrentEventStack = function() {
        return this.event_stack[this.event_stack_index];
    };
    Runtime.prototype.pushLoopStack = function(name_) {
        this.loop_stack_index++;
        if (this.loop_stack_index >= this.loop_stack.length) {
            this.loop_stack.push(cr.seal({
                name: name_,
                index: 0,
                stopped: false
            }));
        }
        var ret = this.getCurrentLoop();
        ret.name = name_;
        ret.index = 0;
        ret.stopped = false;
        return ret;
    };
    Runtime.prototype.popLoopStack = function() {;
        this.loop_stack_index--;
    };
    Runtime.prototype.getCurrentLoop = function() {
        return this.loop_stack[this.loop_stack_index];
    };
    Runtime.prototype.getEventVariableByName = function(name, scope) {
        var i, leni, j, lenj, sheet, e;
        while (scope) {
            for (i = 0, leni = scope.subevents.length; i < leni; i++) {
                e = scope.subevents[i];
                if (e instanceof cr.eventvariable && cr.equals_nocase(name, e.name))
                    return e;
            }
            scope = scope.parent;
        }
        for (i = 0, leni = this.eventsheets_by_index.length; i < leni; i++) {
            sheet = this.eventsheets_by_index[i];
            for (j = 0, lenj = sheet.events.length; j < lenj; j++) {
                e = sheet.events[j];
                if (e instanceof cr.eventvariable && cr.equals_nocase(name, e.name))
                    return e;
            }
        }
        return null;
    };
    Runtime.prototype.getLayoutBySid = function(sid_) {
        var i, len;
        for (i = 0, len = this.layouts_by_index.length; i < len; i++) {
            if (this.layouts_by_index[i].sid === sid_)
                return this.layouts_by_index[i];
        }
        return null;
    };
    Runtime.prototype.getObjectTypeBySid = function(sid_) {
        var i, len;
        for (i = 0, len = this.types_by_index.length; i < len; i++) {
            if (this.types_by_index[i].sid === sid_)
                return this.types_by_index[i];
        }
        return null;
    };
    Runtime.prototype.getGroupBySid = function(sid_) {
        var i, len;
        for (i = 0, len = this.allGroups.length; i < len; i++) {
            if (this.allGroups[i].sid === sid_)
                return this.allGroups[i];
        }
        return null;
    };

    function makeSaveDb(e) {
        var db = e.target.result;
        db.createObjectStore("saves", {
            keyPath: "slot"
        });
    };

    function IndexedDB_WriteSlot(slot_, data_, oncomplete_, onerror_) {
        var request = indexedDB.open("_C2SaveStates");
        request.onupgradeneeded = makeSaveDb;
        request.onerror = onerror_;
        request.onsuccess = function(e) {
            var db = e.target.result;
            db.onerror = onerror_;
            var transaction = db.transaction(["saves"], "readwrite");
            var objectStore = transaction.objectStore("saves");
            var putReq = objectStore.put({
                "slot": slot_,
                "data": data_
            });
            putReq.onsuccess = oncomplete_;
        };
    };

    function IndexedDB_ReadSlot(slot_, oncomplete_, onerror_) {
        var request = indexedDB.open("_C2SaveStates");
        request.onupgradeneeded = makeSaveDb;
        request.onerror = onerror_;
        request.onsuccess = function(e) {
            var db = e.target.result;
            db.onerror = onerror_;
            var transaction = db.transaction(["saves"]);
            var objectStore = transaction.objectStore("saves");
            var readReq = objectStore.get(slot_);
            readReq.onsuccess = function(e) {
                if (readReq.result)
                    oncomplete_(readReq.result["data"]);
                else
                    oncomplete_(null);
            };
        };
    };
    Runtime.prototype.signalContinuousPreview = function() {
        this.signalledContinuousPreview = true;
    };

    function doContinuousPreviewReload() {
        cr.logexport("Reloading for continuous preview");
        if (!!window["c2cocoonjs"]) {
            CocoonJS["App"]["reload"]();
        } else {
            if (window.location.search.indexOf("continuous") > -1)
                window.location.reload(true);
            else
                window.location = window.location + "?continuous";
        }
    };
    Runtime.prototype.handleSaveLoad = function() {
        var self = this;
        var savingToSlot = this.saveToSlot;
        var savingJson = this.lastSaveJson;
        var loadingFromSlot = this.loadFromSlot;
        var continuous = false;
        if (this.signalledContinuousPreview) {
            continuous = true;
            savingToSlot = "__c2_continuouspreview";
            this.signalledContinuousPreview = false;
        }
        if (savingToSlot.length) {
            this.ClearDeathRow();
            savingJson = this.saveToJSONString();
            if (window.indexedDB && !this.isCocoonJs) {
                IndexedDB_WriteSlot(savingToSlot, savingJson, function() {
                    cr.logexport("Saved state to IndexedDB storage (" + savingJson.length + " bytes)");
                    self.lastSaveJson = savingJson;
                    self.trigger(cr.system_object.prototype.cnds.OnSaveComplete, null);
                    self.lastSaveJson = "";
                    if (continuous)
                        doContinuousPreviewReload();
                }, function(e) {
                    try {
                        localStorage.setItem("__c2save_" + savingToSlot, savingJson);
                        cr.logexport("Saved state to WebStorage (" + savingJson.length + " bytes)");
                        self.lastSaveJson = savingJson;
                        self.trigger(cr.system_object.prototype.cnds.OnSaveComplete, null);
                        self.lastSaveJson = "";
                        if (continuous)
                            doContinuousPreviewReload();
                    } catch (f) {
                        cr.logexport("Failed to save game state: " + e + "; " + f);
                    }
                });
            } else {
                try {
                    localStorage.setItem("__c2save_" + savingToSlot, savingJson);
                    cr.logexport("Saved state to WebStorage (" + savingJson.length + " bytes)");
                    self.lastSaveJson = savingJson;
                    this.trigger(cr.system_object.prototype.cnds.OnSaveComplete, null);
                    self.lastSaveJson = "";
                    if (continuous)
                        doContinuousPreviewReload();
                } catch (e) {
                    cr.logexport("Error saving to WebStorage: " + e);
                }
            }
            this.saveToSlot = "";
            this.loadFromSlot = "";
            this.loadFromJson = "";
        }
        if (loadingFromSlot.length) {
            if (window.indexedDB && !this.isCocoonJs) {
                IndexedDB_ReadSlot(loadingFromSlot, function(result_) {
                    if (result_) {
                        self.loadFromJson = result_;
                        cr.logexport("Loaded state from IndexedDB storage (" + self.loadFromJson.length + " bytes)");
                    } else {
                        self.loadFromJson = localStorage.getItem("__c2save_" + loadingFromSlot) || "";
                        cr.logexport("Loaded state from WebStorage (" + self.loadFromJson.length + " bytes)");
                    }
                    self.suspendDrawing = false;
                    if (!self.loadFromJson.length)
                        self.trigger(cr.system_object.prototype.cnds.OnLoadFailed, null);
                }, function(e) {
                    self.loadFromJson = localStorage.getItem("__c2save_" + loadingFromSlot) || "";
                    cr.logexport("Loaded state from WebStorage (" + self.loadFromJson.length + " bytes)");
                    self.suspendDrawing = false;
                    if (!self.loadFromJson.length)
                        self.trigger(cr.system_object.prototype.cnds.OnLoadFailed, null);
                });
            } else {
                this.loadFromJson = localStorage.getItem("__c2save_" + loadingFromSlot) || "";
                cr.logexport("Loaded state from WebStorage (" + this.loadFromJson.length + " bytes)");
                this.suspendDrawing = false;
                if (!self.loadFromJson.length)
                    self.trigger(cr.system_object.prototype.cnds.OnLoadFailed, null);
            }
            this.loadFromSlot = "";
            this.saveToSlot = "";
        }
        if (this.loadFromJson.length) {
            this.ClearDeathRow();
            this.loadFromJSONString(this.loadFromJson);
            this.lastSaveJson = this.loadFromJson;
            this.trigger(cr.system_object.prototype.cnds.OnLoadComplete, null);
            this.lastSaveJson = "";
            this.loadFromJson = "";
        }
    };

    function CopyExtraObject(extra) {
        var p, ret = {};
        for (p in extra) {
            if (extra.hasOwnProperty(p)) {
                if (extra[p] instanceof cr.ObjectSet)
                    continue;
                if (extra[p] && typeof extra[p].c2userdata !== "undefined")
                    continue;
                ret[p] = extra[p];
            }
        }
        return ret;
    };
    Runtime.prototype.saveToJSONString = function() {
        var i, len, j, lenj, type, layout, typeobj, g, c, a, v, p;
        var o = {
            "c2save": true,
            "version": 1,
            "rt": {
                "time": this.kahanTime.sum,
                "timescale": this.timescale,
                "tickcount": this.tickcount,
                "execcount": this.execcount,
                "next_uid": this.next_uid,
                "running_layout": this.running_layout.sid,
                "start_time_offset": (Date.now() - this.start_time)
            },
            "types": {},
            "layouts": {},
            "events": {
                "groups": {},
                "cnds": {},
                "acts": {},
                "vars": {}
            }
        };
        for (i = 0, len = this.types_by_index.length; i < len; i++) {
            type = this.types_by_index[i];
            if (type.is_family || this.typeHasNoSaveBehavior(type))
                continue;
            typeobj = {
                "instances": []
            };
            if (cr.hasAnyOwnProperty(type.extra))
                typeobj["ex"] = CopyExtraObject(type.extra);
            for (j = 0, lenj = type.instances.length; j < lenj; j++) {
                typeobj["instances"].push(this.saveInstanceToJSON(type.instances[j]));
            }
            o["types"][type.sid.toString()] = typeobj;
        }
        for (i = 0, len = this.layouts_by_index.length; i < len; i++) {
            layout = this.layouts_by_index[i];
            o["layouts"][layout.sid.toString()] = layout.saveToJSON();
        }
        var ogroups = o["events"]["groups"];
        for (i = 0, len = this.allGroups.length; i < len; i++) {
            g = this.allGroups[i];
            ogroups[g.sid.toString()] = this.groups_by_name[g.group_name].group_active;
        }
        var ocnds = o["events"]["cnds"];
        for (p in this.cndsBySid) {
            if (this.cndsBySid.hasOwnProperty(p)) {
                c = this.cndsBySid[p];
                if (cr.hasAnyOwnProperty(c.extra))
                    ocnds[p] = {
                        "ex": CopyExtraObject(c.extra)
                    };
            }
        }
        var oacts = o["events"]["acts"];
        for (p in this.actsBySid) {
            if (this.actsBySid.hasOwnProperty(p)) {
                a = this.actsBySid[p];
                if (cr.hasAnyOwnProperty(a.extra))
                    oacts[p] = {
                        "ex": a.extra
                    };
            }
        }
        var ovars = o["events"]["vars"];
        for (p in this.varsBySid) {
            if (this.varsBySid.hasOwnProperty(p)) {
                v = this.varsBySid[p];
                if (!v.is_constant && (!v.parent || v.is_static))
                    ovars[p] = v.data;
            }
        }
        o["system"] = this.system.saveToJSON();
        return JSON.stringify(o);
    };
    Runtime.prototype.refreshUidMap = function() {
        var i, len, type, j, lenj, inst;
        this.objectsByUid = {};
        for (i = 0, len = this.types_by_index.length; i < len; i++) {
            type = this.types_by_index[i];
            if (type.is_family)
                continue;
            for (j = 0, lenj = type.instances.length; j < lenj; j++) {
                inst = type.instances[j];
                this.objectsByUid[inst.uid.toString()] = inst;
            }
        }
    };
    Runtime.prototype.loadFromJSONString = function(str) {
        var o = JSON.parse(str);
        if (!o["c2save"])
            return; // probably not a c2 save state
        if (o["version"] > 1)
            return; // from future version of c2; assume not compatible
        var rt = o["rt"];
        this.kahanTime.reset();
        this.kahanTime.sum = rt["time"];
        this.timescale = rt["timescale"];
        this.tickcount = rt["tickcount"];
        this.start_time = Date.now() - rt["start_time_offset"];
        var layout_sid = rt["running_layout"];
        if (layout_sid !== this.running_layout.sid) {
            var changeToLayout = this.getLayoutBySid(layout_sid);
            if (changeToLayout)
                this.doChangeLayout(changeToLayout);
            else
                return; // layout that was saved on has gone missing (deleted?)
        }
        this.isLoadingState = true;
        var i, len, j, lenj, k, lenk, p, type, existing_insts, load_insts, inst, binst, layout, layer, g, iid, t;
        var otypes = o["types"];
        for (p in otypes) {
            if (otypes.hasOwnProperty(p)) {
                type = this.getObjectTypeBySid(parseInt(p, 10));
                if (!type || type.is_family || this.typeHasNoSaveBehavior(type))
                    continue;
                if (otypes[p]["ex"])
                    type.extra = otypes[p]["ex"];
                else
                    cr.wipe(type.extra);
                existing_insts = type.instances;
                load_insts = otypes[p]["instances"];
                for (i = 0, len = cr.min(existing_insts.length, load_insts.length); i < len; i++) {
                    this.loadInstanceFromJSON(existing_insts[i], load_insts[i]);
                }
                for (i = load_insts.length, len = existing_insts.length; i < len; i++)
                    this.DestroyInstance(existing_insts[i]);
                for (i = existing_insts.length, len = load_insts.length; i < len; i++) {
                    layer = null;
                    if (type.plugin.is_world) {
                        layer = this.running_layout.getLayerBySid(load_insts[i]["w"]["l"]);
                        if (!layer)
                            continue;
                    }
                    inst = this.createInstanceFromInit(type.default_instance, layer, false, 0, 0, true);
                    this.loadInstanceFromJSON(inst, load_insts[i]);
                }
                type.stale_iids = true;
            }
        }
        this.ClearDeathRow();
        this.refreshUidMap();
        var olayouts = o["layouts"];
        for (p in olayouts) {
            if (olayouts.hasOwnProperty(p)) {
                layout = this.getLayoutBySid(parseInt(p, 10));
                if (!layout)
                    continue; // must've gone missing
                layout.loadFromJSON(olayouts[p]);
            }
        }
        var ogroups = o["events"]["groups"];
        for (p in ogroups) {
            if (ogroups.hasOwnProperty(p)) {
                g = this.getGroupBySid(parseInt(p, 10));
                if (g && this.groups_by_name[g.group_name])
                    this.groups_by_name[g.group_name].group_active = ogroups[p];
            }
        }
        var ocnds = o["events"]["cnds"];
        for (p in ocnds) {
            if (ocnds.hasOwnProperty(p) && this.cndsBySid.hasOwnProperty(p)) {
                this.cndsBySid[p].extra = ocnds[p]["ex"];
            }
        }
        var oacts = o["events"]["acts"];
        for (p in oacts) {
            if (oacts.hasOwnProperty(p) && this.actsBySid.hasOwnProperty(p)) {
                this.actsBySid[p].extra = oacts[p]["ex"];
            }
        }
        var ovars = o["events"]["vars"];
        for (p in ovars) {
            if (ovars.hasOwnProperty(p) && this.varsBySid.hasOwnProperty(p)) {
                this.varsBySid[p].data = ovars[p];
            }
        }
        this.next_uid = rt["next_uid"];
        this.isLoadingState = false;
        this.system.loadFromJSON(o["system"]);
        for (i = 0, len = this.types_by_index.length; i < len; i++) {
            type = this.types_by_index[i];
            if (type.is_family)
                continue;
            for (j = 0, lenj = type.instances.length; j < lenj; j++) {
                inst = type.instances[j];
                if (type.is_contained) {
                    iid = inst.get_iid();
                    inst.siblings.length = 0;
                    for (k = 0, lenk = type.container.length; k < lenk; k++) {
                        t = type.container[k];
                        if (type === t)
                            continue;;
                        inst.siblings.push(t.instances[iid]);
                    }
                }
                if (inst.afterLoad)
                    inst.afterLoad();
                if (inst.behavior_insts) {
                    for (k = 0, lenk = inst.behavior_insts.length; k < lenk; k++) {
                        binst = inst.behavior_insts[k];
                        if (binst.afterLoad)
                            binst.afterLoad();
                    }
                }
            }
        }
        this.redraw = true;
    };
    Runtime.prototype.saveInstanceToJSON = function(inst, state_only) {
        var i, len, world, behinst, et;
        var type = inst.type;
        var plugin = type.plugin;
        var o = {};
        if (state_only)
            o["c2"] = true; // mark as known json data from Construct 2
        else
            o["uid"] = inst.uid;
        if (cr.hasAnyOwnProperty(inst.extra))
            o["ex"] = CopyExtraObject(inst.extra);
        if (inst.instance_vars && inst.instance_vars.length) {
            o["ivs"] = {};
            for (i = 0, len = inst.instance_vars.length; i < len; i++) {
                o["ivs"][inst.type.instvar_sids[i].toString()] = inst.instance_vars[i];
            }
        }
        if (plugin.is_world) {
            world = {
                "x": inst.x,
                "y": inst.y,
                "w": inst.width,
                "h": inst.height,
                "l": inst.layer.sid,
                "zi": inst.get_zindex()
            };
            if (inst.angle !== 0)
                world["a"] = inst.angle;
            if (inst.opacity !== 1)
                world["o"] = inst.opacity;
            if (inst.hotspotX !== 0.5)
                world["hX"] = inst.hotspotX;
            if (inst.hotspotY !== 0.5)
                world["hY"] = inst.hotspotY;
            if (inst.blend_mode !== 0)
                world["bm"] = inst.blend_mode;
            if (!inst.visible)
                world["v"] = inst.visible;
            if (!inst.collisionsEnabled)
                world["ce"] = inst.collisionsEnabled;
            if (inst.my_timescale !== -1)
                world["mts"] = inst.my_timescale;
            if (type.effect_types.length) {
                world["fx"] = [];
                for (i = 0, len = type.effect_types.length; i < len; i++) {
                    et = type.effect_types[i];
                    world["fx"].push({
                        "name": et.name,
                        "active": inst.active_effect_flags[et.index],
                        "params": inst.effect_params[et.index]
                    });
                }
            }
            o["w"] = world;
        }
        if (inst.behavior_insts && inst.behavior_insts.length) {
            o["behs"] = {};
            for (i = 0, len = inst.behavior_insts.length; i < len; i++) {
                behinst = inst.behavior_insts[i];
                if (behinst.saveToJSON)
                    o["behs"][behinst.type.sid.toString()] = behinst.saveToJSON();
            }
        }
        if (inst.saveToJSON)
            o["data"] = inst.saveToJSON();
        return o;
    };
    Runtime.prototype.getInstanceVarIndexBySid = function(type, sid_) {
        var i, len;
        for (i = 0, len = type.instvar_sids.length; i < len; i++) {
            if (type.instvar_sids[i] === sid_)
                return i;
        }
        return -1;
    };
    Runtime.prototype.getBehaviorIndexBySid = function(inst, sid_) {
        var i, len;
        for (i = 0, len = inst.behavior_insts.length; i < len; i++) {
            if (inst.behavior_insts[i].type.sid === sid_)
                return i;
        }
        return -1;
    };
    Runtime.prototype.loadInstanceFromJSON = function(inst, o, state_only) {
        var p, i, len, iv, oivs, world, fxindex, obehs, behindex;
        var oldlayer;
        var type = inst.type;
        var plugin = type.plugin;
        if (state_only) {
            if (!o["c2"])
                return;
        } else
            inst.uid = o["uid"];
        if (o["ex"])
            inst.extra = o["ex"];
        else
            cr.wipe(inst.extra);
        oivs = o["ivs"];
        if (oivs) {
            for (p in oivs) {
                if (oivs.hasOwnProperty(p)) {
                    iv = this.getInstanceVarIndexBySid(type, parseInt(p, 10));
                    if (iv < 0 || iv >= inst.instance_vars.length)
                        continue; // must've gone missing
                    inst.instance_vars[iv] = oivs[p];
                }
            }
        }
        if (plugin.is_world) {
            world = o["w"];
            if (inst.layer.sid !== world["l"]) {
                oldlayer = inst.layer;
                inst.layer = this.running_layout.getLayerBySid(world["l"]);
                if (inst.layer) {
                    inst.layer.instances.push(inst);
                    inst.layer.zindices_stale = true;
                    cr.arrayFindRemove(oldlayer.instances, inst);
                    oldlayer.zindices_stale = true;
                } else {
                    inst.layer = oldlayer;
                    this.DestroyInstance(inst);
                }
            }
            inst.x = world["x"];
            inst.y = world["y"];
            inst.width = world["w"];
            inst.height = world["h"];
            inst.zindex = world["zi"];
            inst.angle = world.hasOwnProperty("a") ? world["a"] : 0;
            inst.opacity = world.hasOwnProperty("o") ? world["o"] : 1;
            inst.hotspotX = world.hasOwnProperty("hX") ? world["hX"] : 0.5;
            inst.hotspotY = world.hasOwnProperty("hY") ? world["hY"] : 0.5;
            inst.visible = world.hasOwnProperty("v") ? world["v"] : true;
            inst.collisionsEnabled = world.hasOwnProperty("ce") ? world["ce"] : true;
            inst.my_timescale = world.hasOwnProperty("mts") ? world["mts"] : -1;
            inst.blend_mode = world.hasOwnProperty("bm") ? world["bm"] : 0;;
            inst.compositeOp = cr.effectToCompositeOp(inst.blend_mode);
            if (this.gl)
                cr.setGLBlend(inst, inst.blend_mode, this.gl);
            inst.set_bbox_changed();
            if (world.hasOwnProperty("fx")) {
                for (i = 0, len = world["fx"].length; i < len; i++) {
                    fxindex = type.getEffectIndexByName(world["fx"][i]["name"]);
                    if (fxindex < 0)
                        continue; // must've gone missing
                    inst.active_effect_flags[fxindex] = world["fx"][i]["active"];
                    inst.effect_params[fxindex] = world["fx"][i]["params"];
                }
            }
            inst.updateActiveEffects();
        }
        obehs = o["behs"];
        if (obehs) {
            for (p in obehs) {
                if (obehs.hasOwnProperty(p)) {
                    behindex = this.getBehaviorIndexBySid(inst, parseInt(p, 10));
                    if (behindex < 0)
                        continue; // must've gone missing
                    inst.behavior_insts[behindex].loadFromJSON(obehs[p]);
                }
            }
        }
        if (o["data"])
            inst.loadFromJSON(o["data"]);
    };
    cr.runtime = Runtime;
    cr.createRuntime = function(canvasid) {
        return new Runtime(document.getElementById(canvasid));
    };
    cr.createDCRuntime = function(w, h) {
        return new Runtime({
            "dc": true,
            "width": w,
            "height": h
        });
    };
    window["cr_createRuntime"] = cr.createRuntime;
    window["cr_createDCRuntime"] = cr.createDCRuntime;
    window["createCocoonJSRuntime"] = function() {
        window["c2cocoonjs"] = true;
        var canvas = document.createElement("screencanvas") || document.createElement("canvas");
        canvas.screencanvas = true;
        document.body.appendChild(canvas);
        var rt = new Runtime(canvas);
        window["c2runtime"] = rt;
        window.addEventListener("orientationchange", function() {
            window["c2runtime"]["setSize"](window.innerWidth, window.innerHeight);
        });
        window["c2runtime"]["setSize"](window.innerWidth, window.innerHeight);
        return rt;
    };
    window["createEjectaRuntime"] = function() {
        var canvas = document.getElementById("canvas");
        var rt = new Runtime(canvas);
        window["c2runtime"] = rt;
        window["c2runtime"]["setSize"](window.innerWidth, window.innerHeight);
        return rt;
    };
}());
window["cr_getC2Runtime"] = function() {
    var canvas = document.getElementById("c2canvas");
    if (canvas)
        return canvas["c2runtime"];
    else if (window["c2runtime"])
        return window["c2runtime"];
    else
        return null;
}
window["cr_sizeCanvas"] = function(w, h) {
    if (w === 0 || h === 0)
        return;
    var runtime = window["cr_getC2Runtime"]();
    if (runtime)
        runtime["setSize"](w, h);
}
window["cr_setSuspended"] = function(s) {
    var runtime = window["cr_getC2Runtime"]();
    if (runtime)
        runtime["setSuspended"](s);
};
(function() {
    function Layout(runtime, m) {
        this.runtime = runtime;
        this.event_sheet = null;
        this.scrollX = (this.runtime.original_width / 2);
        this.scrollY = (this.runtime.original_height / 2);
        this.scale = 1.0;
        this.angle = 0;
        this.first_visit = true;
        this.name = m[0];
        this.width = m[1];
        this.height = m[2];
        this.unbounded_scrolling = m[3];
        this.sheetname = m[4];
        this.sid = m[5];
        var lm = m[6];
        var i, len;
        this.layers = [];
        this.initial_types = [];
        for (i = 0, len = lm.length; i < len; i++) {
            var layer = new cr.layer(this, lm[i]);
            layer.number = i;
            cr.seal(layer);
            this.layers.push(layer);
        }
        var im = m[7];
        this.initial_nonworld = [];
        for (i = 0, len = im.length; i < len; i++) {
            var inst = im[i];
            var type = this.runtime.types_by_index[inst[1]];;
            if (!type.default_instance)
                type.default_instance = inst;
            this.initial_nonworld.push(inst);
            if (this.initial_types.indexOf(type) === -1)
                this.initial_types.push(type);
        }
        this.effect_types = [];
        this.active_effect_types = [];
        this.effect_params = [];
        for (i = 0, len = m[8].length; i < len; i++) {
            this.effect_types.push({
                id: m[8][i][0],
                name: m[8][i][1],
                shaderindex: -1,
                active: true,
                index: i
            });
            this.effect_params.push(m[8][i][2].slice(0));
        }
        this.updateActiveEffects();
        this.rcTex = new cr.rect(0, 0, 1, 1);
        this.rcTex2 = new cr.rect(0, 0, 1, 1);
        this.persist_data = {};
    };
    Layout.prototype.saveObjectToPersist = function(inst) {
        var sidStr = inst.type.sid.toString();
        if (!this.persist_data.hasOwnProperty(sidStr))
            this.persist_data[sidStr] = [];
        var type_persist = this.persist_data[sidStr];
        type_persist.push(this.runtime.saveInstanceToJSON(inst));
    };
    Layout.prototype.hasOpaqueBottomLayer = function() {
        var layer = this.layers[0];
        return !layer.transparent && layer.opacity === 1.0 && !layer.forceOwnTexture && layer.visible;
    };
    Layout.prototype.updateActiveEffects = function() {
        this.active_effect_types.length = 0;
        var i, len, et;
        for (i = 0, len = this.effect_types.length; i < len; i++) {
            et = this.effect_types[i];
            if (et.active)
                this.active_effect_types.push(et);
        }
    };
    Layout.prototype.getEffectByName = function(name_) {
        var i, len, et;
        for (i = 0, len = this.effect_types.length; i < len; i++) {
            et = this.effect_types[i];
            if (et.name === name_)
                return et;
        }
        return null;
    };
    var created_instances = [];
    Layout.prototype.startRunning = function() {
        if (this.sheetname) {
            this.event_sheet = this.runtime.eventsheets[this.sheetname];;
            this.event_sheet.updateDeepIncludes();
        }
        this.runtime.running_layout = this;
        this.scrollX = (this.runtime.original_width / 2);
        this.scrollY = (this.runtime.original_height / 2);
        var i, k, len, lenk, type, type_instances, inst, iid, t, s, p, q, type_data, layer;
        for (i = 0, len = this.runtime.types_by_index.length; i < len; i++) {
            type = this.runtime.types_by_index[i];
            if (type.is_family)
                continue; // instances are only transferred for their real type
            type_instances = type.instances;
            for (k = 0, lenk = type_instances.length; k < lenk; k++) {
                inst = type_instances[k];
                if (inst.layer) {
                    var num = inst.layer.number;
                    if (num >= this.layers.length)
                        num = this.layers.length - 1;
                    inst.layer = this.layers[num];
                    inst.layer.instances.push(inst);
                    inst.layer.zindices_stale = true;
                }
            }
        }
        var layer;
        created_instances.length = 0;
        this.boundScrolling();
        for (i = 0, len = this.layers.length; i < len; i++) {
            layer = this.layers[i];
            layer.createInitialInstances(); // fills created_instances
            layer.disableAngle = true;
            var px = layer.canvasToLayer(0, 0, true, true);
            var py = layer.canvasToLayer(0, 0, false, true);
            layer.disableAngle = false;
            if (this.runtime.pixel_rounding) {
                px = (px + 0.5) | 0;
                py = (py + 0.5) | 0;
            }
            layer.rotateViewport(px, py, null);
        }
        var uids_changed = false;
        if (!this.first_visit) {
            for (p in this.persist_data) {
                if (this.persist_data.hasOwnProperty(p)) {
                    type = this.runtime.getObjectTypeBySid(parseInt(p, 10));
                    if (!type || type.is_family || !this.runtime.typeHasPersistBehavior(type))
                        continue;
                    type_data = this.persist_data[p];
                    for (i = 0, len = type_data.length; i < len; i++) {
                        layer = null;
                        if (type.plugin.is_world) {
                            layer = this.getLayerBySid(type_data[i]["w"]["l"]);
                            if (!layer)
                                continue;
                        }
                        inst = this.runtime.createInstanceFromInit(type.default_instance, layer, false, 0, 0, true);
                        this.runtime.loadInstanceFromJSON(inst, type_data[i]);
                        uids_changed = true;
                        created_instances.push(inst);
                    }
                    type_data.length = 0;
                }
            }
            for (i = 0, len = this.layers.length; i < len; i++) {
                this.layers[i].instances.sort(sortInstanceByZIndex);
                this.layers[i].zindices_stale = true; // in case of duplicates/holes
            }
        }
        if (uids_changed) {
            this.runtime.ClearDeathRow();
            this.runtime.refreshUidMap();
        }
        for (i = 0; i < created_instances.length; i++) {
            inst = created_instances[i];
            if (!inst.type.is_contained)
                continue;
            iid = inst.get_iid();
            for (k = 0, lenk = inst.type.container.length; k < lenk; k++) {
                t = inst.type.container[k];
                if (inst.type === t)
                    continue;
                if (t.instances.length > iid)
                    inst.siblings.push(t.instances[iid]);
                else {
                    if (!t.default_instance) {} else {
                        s = this.runtime.createInstanceFromInit(t.default_instance, inst.layer, true, inst.x, inst.y, true);
                        this.runtime.ClearDeathRow();
                        t.updateIIDs();
                        inst.siblings.push(s);
                        created_instances.push(s); // come back around and link up its own instances too
                    }
                }
            }
        }
        for (i = 0, len = this.initial_nonworld.length; i < len; i++) {
            inst = this.runtime.createInstanceFromInit(this.initial_nonworld[i], null, true);;
        }
        this.runtime.changelayout = null;
        this.runtime.ClearDeathRow();
        if (this.runtime.ctx && !this.runtime.isDomFree) {
            for (i = 0, len = this.runtime.types_by_index.length; i < len; i++) {
                t = this.runtime.types_by_index[i];
                if (t.is_family || !t.instances.length || !t.preloadCanvas2D)
                    continue;
                t.preloadCanvas2D(this.runtime.ctx);
            }
        }
        /*
		if (this.runtime.glwrap)
		{
			console.log("Estimated VRAM at layout start: " + this.runtime.glwrap.textureCount() + " textures, approx. " + Math.round(this.runtime.glwrap.estimateVRAM() / 1024) + " kb");
		}
		*/
        for (i = 0, len = created_instances.length; i < len; i++) {
            inst = created_instances[i];
            this.runtime.trigger(Object.getPrototypeOf(inst.type.plugin).cnds.OnCreated, inst);
        }
        created_instances.length = 0;
        this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart, null);
        this.first_visit = false;
    };
    Layout.prototype.createGlobalNonWorlds = function() {
        var i, k, len, initial_inst, inst, type;
        for (i = 0, k = 0, len = this.initial_nonworld.length; i < len; i++) {
            initial_inst = this.initial_nonworld[i];
            type = this.runtime.types_by_index[initial_inst[1]];
            if (type.global)
                inst = this.runtime.createInstanceFromInit(initial_inst, null, true);
            else {
                this.initial_nonworld[k] = initial_inst;
                k++;
            }
        }
        this.initial_nonworld.length = k;
    };
    Layout.prototype.stopRunning = function() {;
        /*
		if (this.runtime.glwrap)
		{
			console.log("Estimated VRAM at layout end: " + this.runtime.glwrap.textureCount() + " textures, approx. " + Math.round(this.runtime.glwrap.estimateVRAM() / 1024) + " kb");
		}
		*/
        this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd, null);
        this.runtime.system.waits.length = 0;
        var i, leni, j, lenj;
        var layer_instances, inst, type;
        for (i = 0, leni = this.layers.length; i < leni; i++) {
            layer_instances = this.layers[i].instances;
            for (j = 0, lenj = layer_instances.length; j < lenj; j++) {
                inst = layer_instances[j];
                if (!inst.type.global) {
                    if (this.runtime.typeHasPersistBehavior(inst.type))
                        this.saveObjectToPersist(inst);
                    this.runtime.DestroyInstance(inst);
                }
            }
            this.runtime.ClearDeathRow();
            layer_instances.length = 0;
            this.layers[i].zindices_stale = true;
        }
        for (i = 0, leni = this.runtime.types_by_index.length; i < leni; i++) {
            type = this.runtime.types_by_index[i];
            if (type.global || type.plugin.is_world || type.plugin.singleglobal || type.is_family)
                continue;
            for (j = 0, lenj = type.instances.length; j < lenj; j++)
                this.runtime.DestroyInstance(type.instances[j]);
            this.runtime.ClearDeathRow();
        }
    };
    Layout.prototype.draw = function(ctx) {
        var layout_canvas;
        var layout_ctx = ctx;
        var ctx_changed = false;
        var render_offscreen = !this.runtime.fullscreenScalingQuality;
        if (render_offscreen) {
            if (!this.runtime.layout_canvas) {
                this.runtime.layout_canvas = document.createElement("canvas");
                layout_canvas = this.runtime.layout_canvas;
                layout_canvas.width = this.runtime.draw_width;
                layout_canvas.height = this.runtime.draw_height;
                this.runtime.layout_ctx = layout_canvas.getContext("2d");
                ctx_changed = true;
            }
            layout_canvas = this.runtime.layout_canvas;
            layout_ctx = this.runtime.layout_ctx;
            if (layout_canvas.width !== this.runtime.draw_width) {
                layout_canvas.width = this.runtime.draw_width;
                ctx_changed = true;
            }
            if (layout_canvas.height !== this.runtime.draw_height) {
                layout_canvas.height = this.runtime.draw_height;
                ctx_changed = true;
            }
            if (ctx_changed) {
                layout_ctx["webkitImageSmoothingEnabled"] = this.runtime.linearSampling;
                layout_ctx["mozImageSmoothingEnabled"] = this.runtime.linearSampling;
                layout_ctx["msImageSmoothingEnabled"] = this.runtime.linearSampling;
                layout_ctx["imageSmoothingEnabled"] = this.runtime.linearSampling;
            }
        }
        layout_ctx.globalAlpha = 1;
        layout_ctx.globalCompositeOperation = "source-over";
        if (this.runtime.alphaBackground && !this.hasOpaqueBottomLayer())
            layout_ctx.clearRect(0, 0, this.runtime.draw_width, this.runtime.draw_height);
        var i, len, l;
        for (i = 0, len = this.layers.length; i < len; i++) {
            l = this.layers[i];
            if (l.visible && l.opacity > 0 && l.blend_mode !== 11)
                l.draw(layout_ctx);
        }
        if (render_offscreen) {
            ctx.drawImage(layout_canvas, 0, 0, this.runtime.width, this.runtime.height);
        }
    };
    Layout.prototype.drawGL = function(glw) {
        var render_to_texture = (this.active_effect_types.length > 0 ||
            this.runtime.uses_background_blending ||
            !this.runtime.fullscreenScalingQuality);
        if (render_to_texture) {
            if (!this.runtime.layout_tex) {
                this.runtime.layout_tex = glw.createEmptyTexture(this.runtime.draw_width, this.runtime.draw_height, this.runtime.linearSampling);
            }
            if (this.runtime.layout_tex.c2width !== this.runtime.draw_width || this.runtime.layout_tex.c2height !== this.runtime.draw_height) {
                glw.deleteTexture(this.runtime.layout_tex);
                this.runtime.layout_tex = glw.createEmptyTexture(this.runtime.draw_width, this.runtime.draw_height, this.runtime.linearSampling);
            }
            glw.setRenderingToTexture(this.runtime.layout_tex);
            if (!this.runtime.fullscreenScalingQuality) {
                glw.setSize(this.runtime.draw_width, this.runtime.draw_height);
            }
        } else {
            if (this.runtime.layout_tex) {
                glw.setRenderingToTexture(null);
                glw.deleteTexture(this.runtime.layout_tex);
                this.runtime.layout_tex = null;
            }
        }
        if (this.runtime.alphaBackground && !this.hasOpaqueBottomLayer())
            glw.clear(0, 0, 0, 0);
        var i, len;
        for (i = 0, len = this.layers.length; i < len; i++) {
            if (this.layers[i].visible && this.layers[i].opacity > 0)
                this.layers[i].drawGL(glw);
        }
        if (render_to_texture) {
            if (this.active_effect_types.length === 0 ||
                (this.active_effect_types.length === 1 && this.runtime.fullscreenScalingQuality)) {
                if (this.active_effect_types.length === 1) {
                    var etindex = this.active_effect_types[0].index;
                    glw.switchProgram(this.active_effect_types[0].shaderindex);
                    glw.setProgramParameters(null, // backTex
                        1.0 / this.runtime.draw_width, // pixelWidth
                        1.0 / this.runtime.draw_height, // pixelHeight
                        0.0, 0.0, // destStart
                        1.0, 1.0, // destEnd
                        this.scale, // layerScale
                        this.angle, // layerAngle
                        0.0, 0.0, // viewOrigin
                        this.effect_params[etindex]); // fx parameters
                    if (glw.programIsAnimated(this.active_effect_types[0].shaderindex))
                        this.runtime.redraw = true;
                } else
                    glw.switchProgram(0);
                if (!this.runtime.fullscreenScalingQuality) {
                    glw.setSize(this.runtime.width, this.runtime.height);
                }
                glw.setRenderingToTexture(null); // to backbuffer
                glw.setOpacity(1);
                glw.setTexture(this.runtime.layout_tex);
                glw.setAlphaBlend();
                glw.resetModelView();
                glw.updateModelView();
                var halfw = this.runtime.width / 2;
                var halfh = this.runtime.height / 2;
                glw.quad(-halfw, halfh, halfw, halfh, halfw, -halfh, -halfw, -halfh);
                glw.setTexture(null);
            } else {
                this.renderEffectChain(glw, null, null, null);
            }
        }
    };
    Layout.prototype.getRenderTarget = function() {
        return (this.active_effect_types.length > 0 ||
            this.runtime.uses_background_blending ||
            !this.runtime.fullscreenScalingQuality) ? this.runtime.layout_tex : null;
    };
    Layout.prototype.getMinLayerScale = function() {
        var m = this.layers[0].getScale();
        var i, len, l;
        for (i = 1, len = this.layers.length; i < len; i++) {
            l = this.layers[i];
            if (l.parallaxX === 0 && l.parallaxY === 0)
                continue;
            if (l.getScale() < m)
                m = l.getScale();
        }
        return m;
    };
    Layout.prototype.scrollToX = function(x) {
        if (!this.unbounded_scrolling) {
            var widthBoundary = (this.runtime.draw_width * (1 / this.getMinLayerScale()) / 2);
            if (x > this.width - widthBoundary)
                x = this.width - widthBoundary;
            if (x < widthBoundary)
                x = widthBoundary;
        }
        if (this.scrollX !== x) {
            this.scrollX = x;
            this.runtime.redraw = true;
        }
    };
    Layout.prototype.scrollToY = function(y) {
        if (!this.unbounded_scrolling) {
            var heightBoundary = (this.runtime.draw_height * (1 / this.getMinLayerScale()) / 2);
            if (y > this.height - heightBoundary)
                y = this.height - heightBoundary;
            if (y < heightBoundary)
                y = heightBoundary;
        }
        if (this.scrollY !== y) {
            this.scrollY = y;
            this.runtime.redraw = true;
        }
    };
    Layout.prototype.boundScrolling = function() {
        this.scrollToX(this.scrollX);
        this.scrollToY(this.scrollY);
    };
    Layout.prototype.renderEffectChain = function(glw, layer, inst, rendertarget) {
        var active_effect_types = inst ?
            inst.active_effect_types :
            layer ?
            layer.active_effect_types :
            this.active_effect_types;
        var layerScale = 1,
            layerAngle = 0,
            viewOriginLeft = 0,
            viewOriginTop = 0;
        if (inst) {
            layerScale = inst.layer.getScale();
            layerAngle = inst.layer.getAngle();
            viewOriginLeft = inst.layer.viewLeft;
            viewOriginTop = inst.layer.viewTop;
        } else if (layer) {
            layerScale = layer.getScale();
            layerAngle = layer.getAngle();
            viewOriginLeft = layer.viewLeft;
            viewOriginTop = layer.viewTop;
        }
        var fx_tex = this.runtime.fx_tex;
        var i, len, last, temp, fx_index = 0,
            other_fx_index = 1;
        var y, h;
        var windowWidth = this.runtime.draw_width;
        var windowHeight = this.runtime.draw_height;
        var halfw = windowWidth / 2;
        var halfh = windowHeight / 2;
        var rcTex = layer ? layer.rcTex : this.rcTex;
        var rcTex2 = layer ? layer.rcTex2 : this.rcTex2;
        var screenleft = 0,
            clearleft = 0;
        var screentop = 0,
            cleartop = 0;
        var screenright = windowWidth,
            clearright = windowWidth;
        var screenbottom = windowHeight,
            clearbottom = windowHeight;
        var boxExtendHorizontal = 0;
        var boxExtendVertical = 0;
        var inst_layer_angle = inst ? inst.layer.getAngle() : 0;
        if (inst) {
            for (i = 0, len = active_effect_types.length; i < len; i++) {
                boxExtendHorizontal += glw.getProgramBoxExtendHorizontal(active_effect_types[i].shaderindex);
                boxExtendVertical += glw.getProgramBoxExtendVertical(active_effect_types[i].shaderindex);
            }
            var bbox = inst.bbox;
            screenleft = layer.layerToCanvas(bbox.left, bbox.top, true, true);
            screentop = layer.layerToCanvas(bbox.left, bbox.top, false, true);
            screenright = layer.layerToCanvas(bbox.right, bbox.bottom, true, true);
            screenbottom = layer.layerToCanvas(bbox.right, bbox.bottom, false, true);
            if (inst_layer_angle !== 0) {
                var screentrx = layer.layerToCanvas(bbox.right, bbox.top, true, true);
                var screentry = layer.layerToCanvas(bbox.right, bbox.top, false, true);
                var screenblx = layer.layerToCanvas(bbox.left, bbox.bottom, true, true);
                var screenbly = layer.layerToCanvas(bbox.left, bbox.bottom, false, true);
                temp = Math.min(screenleft, screenright, screentrx, screenblx);
                screenright = Math.max(screenleft, screenright, screentrx, screenblx);
                screenleft = temp;
                temp = Math.min(screentop, screenbottom, screentry, screenbly);
                screenbottom = Math.max(screentop, screenbottom, screentry, screenbly);
                screentop = temp;
            }
            screenleft -= boxExtendHorizontal;
            screentop -= boxExtendVertical;
            screenright += boxExtendHorizontal;
            screenbottom += boxExtendVertical;
            rcTex2.left = screenleft / windowWidth;
            rcTex2.top = 1 - screentop / windowHeight;
            rcTex2.right = screenright / windowWidth;
            rcTex2.bottom = 1 - screenbottom / windowHeight;
            clearleft = screenleft = cr.floor(screenleft);
            cleartop = screentop = cr.floor(screentop);
            clearright = screenright = cr.ceil(screenright);
            clearbottom = screenbottom = cr.ceil(screenbottom);
            clearleft -= boxExtendHorizontal;
            cleartop -= boxExtendVertical;
            clearright += boxExtendHorizontal;
            clearbottom += boxExtendVertical;
            if (screenleft < 0) screenleft = 0;
            if (screentop < 0) screentop = 0;
            if (screenright > windowWidth) screenright = windowWidth;
            if (screenbottom > windowHeight) screenbottom = windowHeight;
            if (clearleft < 0) clearleft = 0;
            if (cleartop < 0) cleartop = 0;
            if (clearright > windowWidth) clearright = windowWidth;
            if (clearbottom > windowHeight) clearbottom = windowHeight;
            rcTex.left = screenleft / windowWidth;
            rcTex.top = 1 - screentop / windowHeight;
            rcTex.right = screenright / windowWidth;
            rcTex.bottom = 1 - screenbottom / windowHeight;
        } else {
            rcTex.left = rcTex2.left = 0;
            rcTex.top = rcTex2.top = 0;
            rcTex.right = rcTex2.right = 1;
            rcTex.bottom = rcTex2.bottom = 1;
        }
        var pre_draw = (inst && (((inst.angle || inst_layer_angle) && glw.programUsesDest(active_effect_types[0].shaderindex)) || boxExtendHorizontal !== 0 || boxExtendVertical !== 0 || inst.opacity !== 1 || inst.type.plugin.must_predraw)) || (layer && !inst && layer.opacity !== 1);
        glw.setAlphaBlend();
        if (pre_draw) {
            if (!fx_tex[fx_index]) {
                fx_tex[fx_index] = glw.createEmptyTexture(windowWidth, windowHeight, this.runtime.linearSampling);
            }
            if (fx_tex[fx_index].c2width !== windowWidth || fx_tex[fx_index].c2height !== windowHeight) {
                glw.deleteTexture(fx_tex[fx_index]);
                fx_tex[fx_index] = glw.createEmptyTexture(windowWidth, windowHeight, this.runtime.linearSampling);
            }
            glw.switchProgram(0);
            glw.setRenderingToTexture(fx_tex[fx_index]);
            h = clearbottom - cleartop;
            y = (windowHeight - cleartop) - h;
            glw.clearRect(clearleft, y, clearright - clearleft, h);
            if (inst) {
                inst.drawGL(glw);
            } else {
                glw.setTexture(this.runtime.layer_tex);
                glw.setOpacity(layer.opacity);
                glw.resetModelView();
                glw.translate(-halfw, -halfh);
                glw.updateModelView();
                glw.quadTex(screenleft, screenbottom, screenright, screenbottom, screenright, screentop, screenleft, screentop, rcTex);
            }
            rcTex2.left = rcTex2.top = 0;
            rcTex2.right = rcTex2.bottom = 1;
            if (inst) {
                temp = rcTex.top;
                rcTex.top = rcTex.bottom;
                rcTex.bottom = temp;
            }
            fx_index = 1;
            other_fx_index = 0;
        }
        glw.setOpacity(1);
        var last = active_effect_types.length - 1;
        var post_draw = glw.programUsesCrossSampling(active_effect_types[last].shaderindex) ||
            (!layer && !inst && !this.runtime.fullscreenScalingQuality);
        var etindex = 0;
        for (i = 0, len = active_effect_types.length; i < len; i++) {
            if (!fx_tex[fx_index]) {
                fx_tex[fx_index] = glw.createEmptyTexture(windowWidth, windowHeight, this.runtime.linearSampling);
            }
            if (fx_tex[fx_index].c2width !== windowWidth || fx_tex[fx_index].c2height !== windowHeight) {
                glw.deleteTexture(fx_tex[fx_index]);
                fx_tex[fx_index] = glw.createEmptyTexture(windowWidth, windowHeight, this.runtime.linearSampling);
            }
            glw.switchProgram(active_effect_types[i].shaderindex);
            etindex = active_effect_types[i].index;
            if (glw.programIsAnimated(active_effect_types[i].shaderindex))
                this.runtime.redraw = true;
            if (i == 0 && !pre_draw) {
                glw.setRenderingToTexture(fx_tex[fx_index]);
                h = clearbottom - cleartop;
                y = (windowHeight - cleartop) - h;
                glw.clearRect(clearleft, y, clearright - clearleft, h);
                if (inst) {
                    glw.setProgramParameters(rendertarget, // backTex
                        1.0 / inst.width, // pixelWidth
                        1.0 / inst.height, // pixelHeight
                        rcTex2.left, rcTex2.top, // destStart
                        rcTex2.right, rcTex2.bottom, // destEnd
                        layerScale,
                        layerAngle,
                        viewOriginLeft, viewOriginTop,
                        inst.effect_params[etindex]); // fx params
                    inst.drawGL(glw);
                } else {
                    glw.setProgramParameters(rendertarget, // backTex
                        1.0 / windowWidth, // pixelWidth
                        1.0 / windowHeight, // pixelHeight
                        0.0, 0.0, // destStart
                        1.0, 1.0, // destEnd
                        layerScale,
                        layerAngle,
                        viewOriginLeft, viewOriginTop,
                        layer ? // fx params
                        layer.effect_params[etindex] :
                        this.effect_params[etindex]);
                    glw.setTexture(layer ? this.runtime.layer_tex : this.runtime.layout_tex);
                    glw.resetModelView();
                    glw.translate(-halfw, -halfh);
                    glw.updateModelView();
                    glw.quadTex(screenleft, screenbottom, screenright, screenbottom, screenright, screentop, screenleft, screentop, rcTex);
                }
                rcTex2.left = rcTex2.top = 0;
                rcTex2.right = rcTex2.bottom = 1;
                if (inst && !post_draw) {
                    temp = screenbottom;
                    screenbottom = screentop;
                    screentop = temp;
                }
            } else {
                glw.setProgramParameters(rendertarget, // backTex
                    1.0 / windowWidth, // pixelWidth
                    1.0 / windowHeight, // pixelHeight
                    rcTex2.left, rcTex2.top, // destStart
                    rcTex2.right, rcTex2.bottom, // destEnd
                    layerScale,
                    layerAngle,
                    viewOriginLeft, viewOriginTop,
                    inst ? // fx params
                    inst.effect_params[etindex] :
                    layer ?
                    layer.effect_params[etindex] :
                    this.effect_params[etindex]);
                glw.setTexture(null);
                if (i === last && !post_draw) {
                    if (inst)
                        glw.setBlend(inst.srcBlend, inst.destBlend);
                    else if (layer)
                        glw.setBlend(layer.srcBlend, layer.destBlend);
                    glw.setRenderingToTexture(rendertarget);
                } else {
                    glw.setRenderingToTexture(fx_tex[fx_index]);
                    h = clearbottom - cleartop;
                    y = (windowHeight - cleartop) - h;
                    glw.clearRect(clearleft, y, clearright - clearleft, h);
                }
                glw.setTexture(fx_tex[other_fx_index]);
                glw.resetModelView();
                glw.translate(-halfw, -halfh);
                glw.updateModelView();
                glw.quadTex(screenleft, screenbottom, screenright, screenbottom, screenright, screentop, screenleft, screentop, rcTex);
                if (i === last && !post_draw)
                    glw.setTexture(null);
            }
            fx_index = (fx_index === 0 ? 1 : 0);
            other_fx_index = (fx_index === 0 ? 1 : 0); // will be opposite to fx_index since it was just assigned
        }
        if (post_draw) {
            glw.switchProgram(0);
            if (inst)
                glw.setBlend(inst.srcBlend, inst.destBlend);
            else if (layer)
                glw.setBlend(layer.srcBlend, layer.destBlend);
            else {
                if (!this.runtime.fullscreenScalingQuality) {
                    glw.setSize(this.runtime.width, this.runtime.height);
                    halfw = this.runtime.width / 2;
                    halfh = this.runtime.height / 2;
                    screenleft = 0;
                    screentop = 0;
                    screenright = this.runtime.width;
                    screenbottom = this.runtime.height;
                }
            }
            glw.setRenderingToTexture(rendertarget);
            glw.setTexture(fx_tex[other_fx_index]);
            glw.resetModelView();
            glw.translate(-halfw, -halfh);
            glw.updateModelView();
            if (inst && active_effect_types.length === 1 && !pre_draw)
                glw.quadTex(screenleft, screentop, screenright, screentop, screenright, screenbottom, screenleft, screenbottom, rcTex);
            else
                glw.quadTex(screenleft, screenbottom, screenright, screenbottom, screenright, screentop, screenleft, screentop, rcTex);
            glw.setTexture(null);
        }
    };
    Layout.prototype.getLayerBySid = function(sid_) {
        var i, len;
        for (i = 0, len = this.layers.length; i < len; i++) {
            if (this.layers[i].sid === sid_)
                return this.layers[i];
        }
        return null;
    };
    Layout.prototype.saveToJSON = function() {
        var i, len, layer, et;
        var o = {
            "sx": this.scrollX,
            "sy": this.scrollY,
            "s": this.scale,
            "a": this.angle,
            "w": this.width,
            "h": this.height,
            "fv": this.first_visit, // added r127
            "persist": this.persist_data,
            "fx": [],
            "layers": {}
        };
        for (i = 0, len = this.effect_types.length; i < len; i++) {
            et = this.effect_types[i];
            o["fx"].push({
                "name": et.name,
                "active": et.active,
                "params": this.effect_params[et.index]
            });
        }
        for (i = 0, len = this.layers.length; i < len; i++) {
            layer = this.layers[i];
            o["layers"][layer.sid.toString()] = layer.saveToJSON();
        }
        return o;
    };
    Layout.prototype.loadFromJSON = function(o) {
        var i, len, fx, p, layer;
        this.scrollX = o["sx"];
        this.scrollY = o["sy"];
        this.scale = o["s"];
        this.angle = o["a"];
        this.width = o["w"];
        this.height = o["h"];
        this.persist_data = o["persist"];
        if (typeof o["fv"] !== "undefined")
            this.first_visit = o["fv"];
        var ofx = o["fx"];
        for (i = 0, len = ofx.length; i < len; i++) {
            fx = this.getEffectByName(ofx[i]["name"]);
            if (!fx)
                continue; // must've gone missing
            fx.active = ofx[i]["active"];
            this.effect_params[fx.index] = ofx[i]["params"];
        }
        this.updateActiveEffects();
        var olayers = o["layers"];
        for (p in olayers) {
            if (olayers.hasOwnProperty(p)) {
                layer = this.getLayerBySid(parseInt(p, 10));
                if (!layer)
                    continue; // must've gone missing
                layer.loadFromJSON(olayers[p]);
            }
        }
    };
    cr.layout = Layout;

    function Layer(layout, m) {
        this.layout = layout;
        this.runtime = layout.runtime;
        this.instances = []; // running instances
        this.scale = 1.0;
        this.angle = 0;
        this.disableAngle = false;
        this.tmprect = new cr.rect(0, 0, 0, 0);
        this.tmpquad = new cr.quad();
        this.viewLeft = 0;
        this.viewRight = 0;
        this.viewTop = 0;
        this.viewBottom = 0;
        this.zindices_stale = false;
        this.name = m[0];
        this.index = m[1];
        this.sid = m[2];
        this.visible = m[3]; // initially visible
        this.background_color = m[4];
        this.transparent = m[5];
        this.parallaxX = m[6];
        this.parallaxY = m[7];
        this.opacity = m[8];
        this.forceOwnTexture = m[9];
        this.zoomRate = m[10];
        this.blend_mode = m[11];
        this.effect_fallback = m[12];
        this.compositeOp = "source-over";
        this.srcBlend = 0;
        this.destBlend = 0;
        this.render_offscreen = false;
        var im = m[13];
        var i, len;
        this.initial_instances = [];
        for (i = 0, len = im.length; i < len; i++) {
            var inst = im[i];
            var type = this.runtime.types_by_index[inst[1]];;
            if (!type.default_instance) {
                type.default_instance = inst;
                type.default_layerindex = this.index;
            }
            this.initial_instances.push(inst);
            if (this.layout.initial_types.indexOf(type) === -1)
                this.layout.initial_types.push(type);
        }
        this.effect_types = [];
        this.active_effect_types = [];
        this.effect_params = [];
        for (i = 0, len = m[14].length; i < len; i++) {
            this.effect_types.push({
                id: m[14][i][0],
                name: m[14][i][1],
                shaderindex: -1,
                active: true,
                index: i
            });
            this.effect_params.push(m[14][i][2].slice(0));
        }
        this.updateActiveEffects();
        this.rcTex = new cr.rect(0, 0, 1, 1);
        this.rcTex2 = new cr.rect(0, 0, 1, 1);
    };
    Layer.prototype.updateActiveEffects = function() {
        this.active_effect_types.length = 0;
        var i, len, et;
        for (i = 0, len = this.effect_types.length; i < len; i++) {
            et = this.effect_types[i];
            if (et.active)
                this.active_effect_types.push(et);
        }
    };
    Layer.prototype.getEffectByName = function(name_) {
        var i, len, et;
        for (i = 0, len = this.effect_types.length; i < len; i++) {
            et = this.effect_types[i];
            if (et.name === name_)
                return et;
        }
        return null;
    };
    Layer.prototype.createInitialInstances = function() {
        var i, k, len, inst, initial_inst, type, keep, hasPersistBehavior;
        for (i = 0, k = 0, len = this.initial_instances.length; i < len; i++) {
            initial_inst = this.initial_instances[i];
            type = this.runtime.types_by_index[initial_inst[1]];;
            hasPersistBehavior = this.runtime.typeHasPersistBehavior(type);
            keep = true;
            if (!hasPersistBehavior || this.layout.first_visit) {
                inst = this.runtime.createInstanceFromInit(initial_inst, this, true);;
                created_instances.push(inst);
                if (inst.type.global)
                    keep = false;
            }
            if (keep) {
                this.initial_instances[k] = this.initial_instances[i];
                k++;
            }
        }
        this.initial_instances.length = k;
        this.runtime.ClearDeathRow(); // flushes creation row so IIDs will be correct
        if (!this.runtime.glwrap && this.effect_types.length) // no WebGL renderer and shaders used
            this.blend_mode = this.effect_fallback; // use fallback blend mode
        this.compositeOp = cr.effectToCompositeOp(this.blend_mode);
        if (this.runtime.gl)
            cr.setGLBlend(this, this.blend_mode, this.runtime.gl);
    };
    Layer.prototype.updateZIndices = function() {
        if (!this.zindices_stale)
            return;
        var i, len;
        for (i = 0, len = this.instances.length; i < len; i++) {;;
            this.instances[i].zindex = i;
        }
        this.zindices_stale = false;
    };
    Layer.prototype.getScale = function(include_aspect) {
        return this.getNormalScale() * (this.runtime.fullscreenScalingQuality || include_aspect ? this.runtime.aspect_scale : 1);
    };
    Layer.prototype.getNormalScale = function() {
        return ((this.scale * this.layout.scale) - 1) * this.zoomRate + 1;
    };
    Layer.prototype.getAngle = function() {
        if (this.disableAngle)
            return 0;
        return cr.clamp_angle(this.layout.angle + this.angle);
    };
    Layer.prototype.draw = function(ctx) {
        this.render_offscreen = (this.forceOwnTexture || this.opacity !== 1.0 || this.blend_mode !== 0);
        var layer_canvas = this.runtime.canvas;
        var layer_ctx = ctx;
        var ctx_changed = false;
        if (this.render_offscreen) {
            if (!this.runtime.layer_canvas) {
                this.runtime.layer_canvas = document.createElement("canvas");;
                layer_canvas = this.runtime.layer_canvas;
                layer_canvas.width = this.runtime.draw_width;
                layer_canvas.height = this.runtime.draw_height;
                this.runtime.layer_ctx = layer_canvas.getContext("2d");;
                ctx_changed = true;
            }
            layer_canvas = this.runtime.layer_canvas;
            layer_ctx = this.runtime.layer_ctx;
            if (layer_canvas.width !== this.runtime.draw_width) {
                layer_canvas.width = this.runtime.draw_width;
                ctx_changed = true;
            }
            if (layer_canvas.height !== this.runtime.draw_height) {
                layer_canvas.height = this.runtime.draw_height;
                ctx_changed = true;
            }
            if (ctx_changed) {
                layer_ctx["webkitImageSmoothingEnabled"] = this.runtime.linearSampling;
                layer_ctx["mozImageSmoothingEnabled"] = this.runtime.linearSampling;
                layer_ctx["msImageSmoothingEnabled"] = this.runtime.linearSampling;
                layer_ctx["imageSmoothingEnabled"] = this.runtime.linearSampling;
            }
            if (this.transparent)
                layer_ctx.clearRect(0, 0, this.runtime.draw_width, this.runtime.draw_height);
        }
        layer_ctx.globalAlpha = 1;
        layer_ctx.globalCompositeOperation = "source-over";
        if (!this.transparent) {
            layer_ctx.fillStyle = "rgb(" + this.background_color[0] + "," + this.background_color[1] + "," + this.background_color[2] + ")";
            layer_ctx.fillRect(0, 0, this.runtime.draw_width, this.runtime.draw_height);
        }
        layer_ctx.save();
        this.disableAngle = true;
        var px = this.canvasToLayer(0, 0, true, true);
        var py = this.canvasToLayer(0, 0, false, true);
        this.disableAngle = false;
        if (this.runtime.pixel_rounding) {
            px = (px + 0.5) | 0;
            py = (py + 0.5) | 0;
        }
        this.rotateViewport(px, py, layer_ctx);
        var myscale = this.getScale();
        layer_ctx.scale(myscale, myscale);
        layer_ctx.translate(-px, -py);
        var i, len, inst, bbox;
        for (i = 0, len = this.instances.length; i < len; i++) {
            inst = this.instances[i];
            if (!inst.visible || inst.width === 0 || inst.height === 0)
                continue;
            inst.update_bbox();
            bbox = inst.bbox;
            if (bbox.right < this.viewLeft || bbox.bottom < this.viewTop || bbox.left > this.viewRight || bbox.top > this.viewBottom)
                continue;
            layer_ctx.globalCompositeOperation = inst.compositeOp;
            inst.draw(layer_ctx);
        }
        layer_ctx.restore();
        if (this.render_offscreen) {
            ctx.globalCompositeOperation = this.compositeOp;
            ctx.globalAlpha = this.opacity;
            ctx.drawImage(layer_canvas, 0, 0);
        }
    };
    Layer.prototype.rotateViewport = function(px, py, ctx) {
        var myscale = this.getScale();
        this.viewLeft = px;
        this.viewTop = py;
        this.viewRight = px + (this.runtime.draw_width * (1 / myscale));
        this.viewBottom = py + (this.runtime.draw_height * (1 / myscale));
        var myAngle = this.getAngle();
        if (myAngle !== 0) {
            if (ctx) {
                ctx.translate(this.runtime.draw_width / 2, this.runtime.draw_height / 2);
                ctx.rotate(-myAngle);
                ctx.translate(this.runtime.draw_width / -2, this.runtime.draw_height / -2);
            }
            this.tmprect.set(this.viewLeft, this.viewTop, this.viewRight, this.viewBottom);
            this.tmprect.offset((this.viewLeft + this.viewRight) / -2, (this.viewTop + this.viewBottom) / -2);
            this.tmpquad.set_from_rotated_rect(this.tmprect, myAngle);
            this.tmpquad.bounding_box(this.tmprect);
            this.tmprect.offset((this.viewLeft + this.viewRight) / 2, (this.viewTop + this.viewBottom) / 2);
            this.viewLeft = this.tmprect.left;
            this.viewTop = this.tmprect.top;
            this.viewRight = this.tmprect.right;
            this.viewBottom = this.tmprect.bottom;
        }
    }
    Layer.prototype.drawGL = function(glw) {
        var windowWidth = this.runtime.draw_width;
        var windowHeight = this.runtime.draw_height;
        var shaderindex = 0;
        var etindex = 0;
        this.render_offscreen = (this.forceOwnTexture || this.opacity !== 1.0 || this.active_effect_types.length > 0 || this.blend_mode !== 0);
        if (this.render_offscreen) {
            if (!this.runtime.layer_tex) {
                this.runtime.layer_tex = glw.createEmptyTexture(this.runtime.draw_width, this.runtime.draw_height, this.runtime.linearSampling);
            }
            if (this.runtime.layer_tex.c2width !== this.runtime.draw_width || this.runtime.layer_tex.c2height !== this.runtime.draw_height) {
                glw.deleteTexture(this.runtime.layer_tex);
                this.runtime.layer_tex = glw.createEmptyTexture(this.runtime.draw_width, this.runtime.draw_height, this.runtime.linearSampling);
            }
            glw.setRenderingToTexture(this.runtime.layer_tex);
            if (this.transparent)
                glw.clear(0, 0, 0, 0);
        }
        if (!this.transparent) {
            glw.clear(this.background_color[0] / 255, this.background_color[1] / 255, this.background_color[2] / 255, 1);
        }
        this.disableAngle = true;
        var px = this.canvasToLayer(0, 0, true, true);
        var py = this.canvasToLayer(0, 0, false, true);
        this.disableAngle = false;
        if (this.runtime.pixel_rounding) {
            px = (px + 0.5) | 0;
            py = (py + 0.5) | 0;
        }
        this.rotateViewport(px, py, null);
        var myscale = this.getScale();
        glw.resetModelView();
        glw.scale(myscale, myscale);
        glw.rotateZ(-this.getAngle());
        glw.translate((this.viewLeft + this.viewRight) / -2, (this.viewTop + this.viewBottom) / -2);
        glw.updateModelView();
        var i, len, inst, bbox;
        for (i = 0, len = this.instances.length; i < len; i++) {
            inst = this.instances[i];
            if (!inst.visible || inst.width === 0 || inst.height === 0)
                continue;
            inst.update_bbox();
            bbox = inst.bbox;
            if (bbox.right < this.viewLeft || bbox.bottom < this.viewTop || bbox.left > this.viewRight || bbox.top > this.viewBottom)
                continue;
            if (inst.uses_shaders) {
                shaderindex = inst.active_effect_types[0].shaderindex;
                etindex = inst.active_effect_types[0].index;
                if (inst.active_effect_types.length === 1 && !glw.programUsesCrossSampling(shaderindex) &&
                    !glw.programExtendsBox(shaderindex) && ((!inst.angle && !inst.layer.getAngle()) || !glw.programUsesDest(shaderindex)) &&
                    inst.opacity === 1 && !inst.type.plugin.must_predraw) {
                    glw.switchProgram(shaderindex);
                    glw.setBlend(inst.srcBlend, inst.destBlend);
                    if (glw.programIsAnimated(shaderindex))
                        this.runtime.redraw = true;
                    var destStartX = 0,
                        destStartY = 0,
                        destEndX = 0,
                        destEndY = 0;
                    if (glw.programUsesDest(shaderindex)) {
                        var bbox = inst.bbox;
                        var screenleft = this.layerToCanvas(bbox.left, bbox.top, true, true);
                        var screentop = this.layerToCanvas(bbox.left, bbox.top, false, true);
                        var screenright = this.layerToCanvas(bbox.right, bbox.bottom, true, true);
                        var screenbottom = this.layerToCanvas(bbox.right, bbox.bottom, false, true);
                        destStartX = screenleft / windowWidth;
                        destStartY = 1 - screentop / windowHeight;
                        destEndX = screenright / windowWidth;
                        destEndY = 1 - screenbottom / windowHeight;
                    }
                    glw.setProgramParameters(this.render_offscreen ? this.runtime.layer_tex : this.layout.getRenderTarget(), // backTex
                        1.0 / inst.width, // pixelWidth
                        1.0 / inst.height, // pixelHeight
                        destStartX, destStartY,
                        destEndX, destEndY,
                        this.getScale(),
                        this.getAngle(),
                        this.viewLeft, this.viewTop,
                        inst.effect_params[etindex]);
                    inst.drawGL(glw);
                } else {
                    this.layout.renderEffectChain(glw, this, inst, this.render_offscreen ? this.runtime.layer_tex : this.layout.getRenderTarget());
                    glw.resetModelView();
                    glw.scale(myscale, myscale);
                    glw.rotateZ(-this.getAngle());
                    glw.translate((this.viewLeft + this.viewRight) / -2, (this.viewTop + this.viewBottom) / -2);
                    glw.updateModelView();
                }
            } else {
                glw.switchProgram(0); // un-set any previously set shader
                glw.setBlend(inst.srcBlend, inst.destBlend);
                inst.drawGL(glw);
            }
        }
        if (this.render_offscreen) {
            shaderindex = this.active_effect_types.length ? this.active_effect_types[0].shaderindex : 0;
            etindex = this.active_effect_types.length ? this.active_effect_types[0].index : 0;
            if (this.active_effect_types.length === 0 || (this.active_effect_types.length === 1 &&
                !glw.programUsesCrossSampling(shaderindex) && this.opacity === 1)) {
                if (this.active_effect_types.length === 1) {
                    glw.switchProgram(shaderindex);
                    glw.setProgramParameters(this.layout.getRenderTarget(), // backTex
                        1.0 / this.runtime.draw_width, // pixelWidth
                        1.0 / this.runtime.draw_height, // pixelHeight
                        0.0, 0.0, // destStart
                        1.0, 1.0, // destEnd
                        this.getScale(), // layerScale
                        this.getAngle(),
                        this.viewLeft, this.viewTop,
                        this.effect_params[etindex]); // fx parameters
                    if (glw.programIsAnimated(shaderindex))
                        this.runtime.redraw = true;
                } else
                    glw.switchProgram(0);
                glw.setRenderingToTexture(this.layout.getRenderTarget());
                glw.setOpacity(this.opacity);
                glw.setTexture(this.runtime.layer_tex);
                glw.setBlend(this.srcBlend, this.destBlend);
                glw.resetModelView();
                glw.updateModelView();
                var halfw = this.runtime.draw_width / 2;
                var halfh = this.runtime.draw_height / 2;
                glw.quad(-halfw, halfh, halfw, halfh, halfw, -halfh, -halfw, -halfh);
                glw.setTexture(null);
            } else {
                this.layout.renderEffectChain(glw, this, null, this.layout.getRenderTarget());
            }
        }
    };
    Layer.prototype.canvasToLayer = function(ptx, pty, getx, using_draw_area) {
        var multiplier = this.runtime.devicePixelRatio;
        if (this.runtime.isRetina) {
            ptx *= multiplier;
            pty *= multiplier;
        }
        var ox = this.runtime.parallax_x_origin;
        var oy = this.runtime.parallax_y_origin;
        var x = ((this.layout.scrollX - ox) * this.parallaxX) + ox;
        var y = ((this.layout.scrollY - oy) * this.parallaxY) + oy;
        var invScale = 1 / this.getScale(!using_draw_area);
        if (using_draw_area) {
            x -= (this.runtime.draw_width * invScale) / 2;
            y -= (this.runtime.draw_height * invScale) / 2;
        } else {
            x -= (this.runtime.width * invScale) / 2;
            y -= (this.runtime.height * invScale) / 2;
        }
        x += ptx * invScale;
        y += pty * invScale;
        var a = this.getAngle();
        if (a !== 0) {
            x -= this.layout.scrollX;
            y -= this.layout.scrollY;
            var cosa = Math.cos(a);
            var sina = Math.sin(a);
            var x_temp = (x * cosa) - (y * sina);
            y = (y * cosa) + (x * sina);
            x = x_temp;
            x += this.layout.scrollX;
            y += this.layout.scrollY;
        }
        return getx ? x : y;
    };
    Layer.prototype.layerToCanvas = function(ptx, pty, getx, using_draw_area) {
        var a = this.getAngle();
        if (a !== 0) {
            ptx -= this.layout.scrollX;
            pty -= this.layout.scrollY;
            var cosa = Math.cos(-a);
            var sina = Math.sin(-a);
            var x_temp = (ptx * cosa) - (pty * sina);
            pty = (pty * cosa) + (ptx * sina);
            ptx = x_temp;
            ptx += this.layout.scrollX;
            pty += this.layout.scrollY;
        }
        var ox = this.runtime.parallax_x_origin;
        var oy = this.runtime.parallax_y_origin;
        var x = ((this.layout.scrollX - ox) * this.parallaxX) + ox;
        var y = ((this.layout.scrollY - oy) * this.parallaxY) + oy;
        var invScale = 1 / this.getScale(!using_draw_area);
        if (using_draw_area) {
            x -= (this.runtime.draw_width * invScale) / 2;
            y -= (this.runtime.draw_height * invScale) / 2;
        } else {
            x -= (this.runtime.width * invScale) / 2;
            y -= (this.runtime.height * invScale) / 2;
        }
        x = (ptx - x) / invScale;
        y = (pty - y) / invScale;
        var multiplier = this.runtime.devicePixelRatio;
        if (this.runtime.isRetina && !using_draw_area) {
            x /= multiplier;
            y /= multiplier;
        }
        return getx ? x : y;
    };
    Layer.prototype.rotatePt = function(x_, y_, getx) {
        if (this.getAngle() === 0)
            return getx ? x_ : y_;
        var nx = this.layerToCanvas(x_, y_, true);
        var ny = this.layerToCanvas(x_, y_, false);
        this.disableAngle = true;
        var px = this.canvasToLayer(nx, ny, true);
        var py = this.canvasToLayer(nx, ny, true);
        this.disableAngle = false;
        return getx ? px : py;
    };
    Layer.prototype.saveToJSON = function() {
        var i, len, et;
        var o = {
            "s": this.scale,
            "a": this.angle,
            "vl": this.viewLeft,
            "vt": this.viewTop,
            "vr": this.viewRight,
            "vb": this.viewBottom,
            "v": this.visible,
            "bc": this.background_color,
            "t": this.transparent,
            "px": this.parallaxX,
            "py": this.parallaxY,
            "o": this.opacity,
            "zr": this.zoomRate,
            "fx": [],
            "instances": []
        };
        for (i = 0, len = this.effect_types.length; i < len; i++) {
            et = this.effect_types[i];
            o["fx"].push({
                "name": et.name,
                "active": et.active,
                "params": this.effect_params[et.index]
            });
        }
        return o;
    };

    function sortInstanceByZIndex(a, b) {
        return a.zindex - b.zindex;
    };
    Layer.prototype.loadFromJSON = function(o) {
        var i, len, p, inst, fx;
        this.scale = o["s"];
        this.angle = o["a"];
        this.viewLeft = o["vl"];
        this.viewTop = o["vt"];
        this.viewRight = o["vr"];
        this.viewBottom = o["vb"];
        this.visible = o["v"];
        this.background_color = o["bc"];
        this.transparent = o["t"];
        this.parallaxX = o["px"];
        this.parallaxY = o["py"];
        this.opacity = o["o"];
        this.zoomRate = o["zr"];
        var ofx = o["fx"];
        for (i = 0, len = ofx.length; i < len; i++) {
            fx = this.getEffectByName(ofx[i]["name"]);
            if (!fx)
                continue; // must've gone missing
            fx.active = ofx[i]["active"];
            this.effect_params[fx.index] = ofx[i]["params"];
        }
        this.updateActiveEffects();
        this.instances.sort(sortInstanceByZIndex);
        this.zindices_stale = true;
    };
    cr.layer = Layer;
}());;
(function() {
    var allUniqueSolModifiers = [];

    function testSolsMatch(arr1, arr2) {
        var i, len = arr1.length;
        switch (len) {
            case 0:
                return true;
            case 1:
                return arr1[0] === arr2[0];
            case 2:
                return arr1[0] === arr2[0] && arr1[1] === arr2[1];
            default:
                for (i = 0; i < len; i++) {
                    if (arr1[i] !== arr2[i])
                        return false;
                }
                return true;
        }
    };

    function solArraySorter(t1, t2) {
        return t1.index - t2.index;
    };

    function findMatchingSolModifier(arr) {
        var i, len, u, temp, subarr;
        if (arr.length === 2) {
            if (arr[0].index > arr[1].index) {
                temp = arr[0];
                arr[0] = arr[1];
                arr[1] = temp;
            }
        } else if (arr.length > 2)
            arr.sort(solArraySorter); // so testSolsMatch compares in same order
        if (arr.length >= allUniqueSolModifiers.length)
            allUniqueSolModifiers.length = arr.length + 1;
        if (!allUniqueSolModifiers[arr.length])
            allUniqueSolModifiers[arr.length] = [];
        subarr = allUniqueSolModifiers[arr.length];
        for (i = 0, len = subarr.length; i < len; i++) {
            u = subarr[i];
            if (testSolsMatch(arr, u))
                return u;
        }
        subarr.push(arr);
        return arr;
    };

    function EventSheet(runtime, m) {
        this.runtime = runtime;
        this.triggers = {};
        this.fasttriggers = {};
        this.hasRun = false;
        this.includes = new cr.ObjectSet(); // all event sheets included by this sheet, at first-level indirection only
        this.deep_includes = []; // all includes from this sheet recursively, in trigger order
        this.already_included_sheets = []; // used while building deep_includes
        this.name = m[0];
        var em = m[1]; // events model
        this.events = []; // triggers won't make it to this array
        var i, len;
        for (i = 0, len = em.length; i < len; i++)
            this.init_event(em[i], null, this.events);
    };
    EventSheet.prototype.toString = function() {
        return this.name;
    };
    EventSheet.prototype.init_event = function(m, parent, nontriggers) {
        switch (m[0]) {
            case 0: // event block
                {
                    var block = new cr.eventblock(this, parent, m);
                    cr.seal(block);
                    if (block.orblock) {
                        nontriggers.push(block);
                        var i, len;
                        for (i = 0, len = block.conditions.length; i < len; i++) {
                            if (block.conditions[i].trigger)
                                this.init_trigger(block, i);
                        }
                    } else {
                        if (block.is_trigger())
                            this.init_trigger(block, 0);
                        else
                            nontriggers.push(block);
                    }
                    break;
                }
            case 1: // variable
                {
                    var v = new cr.eventvariable(this, parent, m);
                    cr.seal(v);
                    nontriggers.push(v);
                    break;
                }
            case 2: // include
                {
                    var inc = new cr.eventinclude(this, parent, m);
                    cr.seal(inc);
                    nontriggers.push(inc);
                    break;
                }
            default:
                ;
        }
    };
    EventSheet.prototype.postInit = function() {
        var i, len;
        for (i = 0, len = this.events.length; i < len; i++) {
            this.events[i].postInit(i < len - 1 && this.events[i + 1].is_else_block);
        }
    };
    EventSheet.prototype.updateDeepIncludes = function() {
        this.deep_includes.length = 0;
        this.already_included_sheets.length = 0;
        this.addDeepIncludes(this);
        this.already_included_sheets.length = 0;
    };
    EventSheet.prototype.addDeepIncludes = function(root_sheet) {
        var i, len, inc, sheet;
        var deep_includes = root_sheet.deep_includes;
        var already_included_sheets = root_sheet.already_included_sheets;
        var arr = this.includes.valuesRef();
        for (i = 0, len = arr.length; i < len; ++i) {
            inc = arr[i];
            sheet = inc.include_sheet;
            if (!inc.isActive() || root_sheet === sheet || already_included_sheets.indexOf(sheet) > -1)
                continue;
            already_included_sheets.push(sheet);
            sheet.addDeepIncludes(root_sheet);
            deep_includes.push(sheet);
        }
    };
    EventSheet.prototype.run = function(from_include) {
        if (!this.runtime.resuming_breakpoint) {
            this.hasRun = true;
            if (!from_include)
                this.runtime.isRunningEvents = true;
        }
        var i, len;
        for (i = 0, len = this.events.length; i < len; i++) {
            var ev = this.events[i];
            ev.run();
            this.runtime.clearSol(ev.solModifiers);
            if (!this.runtime.deathRow.isEmpty() || this.runtime.createRow.length)
                this.runtime.ClearDeathRow();
        }
        if (!from_include)
            this.runtime.isRunningEvents = false;
    };

    function isPerformanceSensitiveTrigger(method) {
        if (cr.plugins_.Sprite && method === cr.plugins_.Sprite.prototype.cnds.OnFrameChanged) {
            return true;
        }
        return false;
    };
    EventSheet.prototype.init_trigger = function(trig, index) {
        if (!trig.orblock)
            this.runtime.triggers_to_postinit.push(trig); // needs to be postInit'd later
        var i, len;
        var cnd = trig.conditions[index];
        var type_name;
        if (cnd.type)
            type_name = cnd.type.name;
        else
            type_name = "system";
        var fasttrigger = cnd.fasttrigger;
        var triggers = (fasttrigger ? this.fasttriggers : this.triggers);
        if (!triggers[type_name])
            triggers[type_name] = [];
        var obj_entry = triggers[type_name];
        var method = cnd.func;
        if (fasttrigger) {
            if (!cnd.parameters.length) // no parameters
                return;
            var firstparam = cnd.parameters[0];
            if (firstparam.type !== 1 || // not a string param
                firstparam.expression.type !== 2) // not a string literal node
            {
                return;
            }
            var fastevs;
            var firstvalue = firstparam.expression.value.toLowerCase();
            var i, len;
            for (i = 0, len = obj_entry.length; i < len; i++) {
                if (obj_entry[i].method == method) {
                    fastevs = obj_entry[i].evs;
                    if (!fastevs[firstvalue])
                        fastevs[firstvalue] = [
                            [trig, index]
                        ];
                    else
                        fastevs[firstvalue].push([trig, index]);
                    return;
                }
            }
            fastevs = {};
            fastevs[firstvalue] = [
                [trig, index]
            ];
            obj_entry.push({
                method: method,
                evs: fastevs
            });
        } else {
            for (i = 0, len = obj_entry.length; i < len; i++) {
                if (obj_entry[i].method == method) {
                    obj_entry[i].evs.push([trig, index]);
                    return;
                }
            }
            if (isPerformanceSensitiveTrigger(method))
                obj_entry.unshift({
                    method: method,
                    evs: [
                        [trig, index]
                    ]
                });
            else
                obj_entry.push({
                    method: method,
                    evs: [
                        [trig, index]
                    ]
                });
        }
    };
    cr.eventsheet = EventSheet;

    function Selection(type) {
        this.type = type;
        this.instances = []; // subset of picked instances
        this.else_instances = []; // subset of unpicked instances
        this.select_all = true;
    };
    Selection.prototype.hasObjects = function() {
        if (this.select_all)
            return this.type.instances.length;
        else
            return this.instances.length;
    };
    Selection.prototype.getObjects = function() {
        if (this.select_all)
            return this.type.instances;
        else
            return this.instances;
    };
    /*
	Selection.prototype.ensure_picked = function (inst, skip_siblings)
	{
		var i, len;
		var orblock = inst.runtime.getCurrentEventStack().current_event.orblock;
		if (this.select_all)
		{
			this.select_all = false;
			if (orblock)
			{
				cr.shallowAssignArray(this.else_instances, inst.type.instances);
				cr.arrayFindRemove(this.else_instances, inst);
			}
			this.instances.length = 1;
			this.instances[0] = inst;
		}
		else
		{
			if (orblock)
			{
				i = this.else_instances.indexOf(inst);
				if (i !== -1)
				{
					this.instances.push(this.else_instances[i]);
					this.else_instances.splice(i, 1);
				}
			}
			else
			{
				if (this.instances.indexOf(inst) === -1)
					this.instances.push(inst);
			}
		}
		if (!skip_siblings)
		{
		}
	};
	*/
    Selection.prototype.pick_one = function(inst) {
        if (!inst)
            return;
        if (inst.runtime.getCurrentEventStack().current_event.orblock) {
            if (this.select_all) {
                this.instances.length = 0;
                cr.shallowAssignArray(this.else_instances, inst.type.instances);
                this.select_all = false;
            }
            var i = this.else_instances.indexOf(inst);
            if (i !== -1) {
                this.instances.push(this.else_instances[i]);
                this.else_instances.splice(i, 1);
            }
        } else {
            this.select_all = false;
            this.instances.length = 1;
            this.instances[0] = inst;
        }
    };
    cr.selection = Selection;

    function EventBlock(sheet, parent, m) {
        this.sheet = sheet;
        this.parent = parent;
        this.runtime = sheet.runtime;
        this.solModifiers = [];
        this.solModifiersIncludingParents = [];
        this.solWriterAfterCnds = false; // block does not change SOL after running its conditions
        this.group = false; // is group of events
        this.initially_activated = false; // if a group, is active on startup
        this.toplevelevent = false; // is an event block parented only by a top-level group
        this.toplevelgroup = false; // is parented only by other groups or is top-level (i.e. not in a subevent)
        this.has_else_block = false; // is followed by else
        ;
        this.conditions = [];
        this.actions = [];
        this.subevents = [];
        this.group_name = "";
        this.group = false;
        this.initially_activated = false;
        this.group_active = false;
        this.contained_includes = null;
        if (m[1]) {
            this.group_name = m[1][1].toLowerCase();
            this.group = true;
            this.initially_activated = !!m[1][0];
            this.contained_includes = [];
            this.group_active = this.initially_activated;
            this.runtime.allGroups.push(this);
            this.runtime.groups_by_name[this.group_name] = this;
        }
        this.orblock = m[2];
        this.sid = m[4];
        if (!this.group)
            this.runtime.blocksBySid[this.sid.toString()] = this;
        var i, len;
        var cm = m[5];
        for (i = 0, len = cm.length; i < len; i++) {
            var cnd = new cr.condition(this, cm[i]);
            cnd.index = i;
            cr.seal(cnd);
            this.conditions.push(cnd);
            /*
			if (cnd.is_logical())
				this.is_logical = true;
			if (cnd.type && !cnd.type.plugin.singleglobal && this.cndReferences.indexOf(cnd.type) === -1)
				this.cndReferences.push(cnd.type);
			*/
            this.addSolModifier(cnd.type);
        }
        var am = m[6];
        for (i = 0, len = am.length; i < len; i++) {
            var act = new cr.action(this, am[i]);
            act.index = i;
            cr.seal(act);
            this.actions.push(act);
        }
        if (m.length === 8) {
            var em = m[7];
            for (i = 0, len = em.length; i < len; i++)
                this.sheet.init_event(em[i], this, this.subevents);
        }
        this.is_else_block = false;
        if (this.conditions.length) {
            this.is_else_block = (this.conditions[0].type == null && this.conditions[0].func == cr.system_object.prototype.cnds.Else);
        }
    };
    window["_c2hh_"] = "2133E5B2D2B776104459A315A258C19CAABF85F8";
    EventBlock.prototype.postInit = function(hasElse /*, prevBlock_*/ ) {
        var i, len;
        var p = this.parent;
        if (this.group) {
            this.toplevelgroup = true;
            while (p) {
                if (!p.group) {
                    this.toplevelgroup = false;
                    break;
                }
                p = p.parent;
            }
        }
        this.toplevelevent = !this.is_trigger() && (!this.parent || (this.parent.group && this.parent.toplevelgroup));
        this.has_else_block = !!hasElse;
        this.solModifiersIncludingParents = this.solModifiers.slice(0);
        p = this.parent;
        while (p) {
            for (i = 0, len = p.solModifiers.length; i < len; i++)
                this.addParentSolModifier(p.solModifiers[i]);
            p = p.parent;
        }
        this.solModifiers = findMatchingSolModifier(this.solModifiers);
        this.solModifiersIncludingParents = findMatchingSolModifier(this.solModifiersIncludingParents);
        var i, len /*, s*/ ;
        for (i = 0, len = this.conditions.length; i < len; i++)
            this.conditions[i].postInit();
        for (i = 0, len = this.actions.length; i < len; i++)
            this.actions[i].postInit();
        for (i = 0, len = this.subevents.length; i < len; i++) {
            this.subevents[i].postInit(i < len - 1 && this.subevents[i + 1].is_else_block);
        }
        /*
		if (this.is_else_block && this.prev_block)
		{
			for (i = 0, len = this.prev_block.solModifiers.length; i < len; i++)
			{
				s = this.prev_block.solModifiers[i];
				if (this.solModifiers.indexOf(s) === -1)
					this.solModifiers.push(s);
			}
		}
		*/
    };
    EventBlock.prototype.setGroupActive = function(a) {
        if (this.group_active === !!a)
            return; // same state
        this.group_active = !!a;
        var i, len;
        for (i = 0, len = this.contained_includes.length; i < len; ++i) {
            this.contained_includes[i].updateActive();
        }
        if (len > 0 && this.runtime.running_layout.event_sheet)
            this.runtime.running_layout.event_sheet.updateDeepIncludes();
    };

    function addSolModifierToList(type, arr) {
        var i, len, t;
        if (!type)
            return;
        if (arr.indexOf(type) === -1)
            arr.push(type);
        if (type.is_contained) {
            for (i = 0, len = type.container.length; i < len; i++) {
                t = type.container[i];
                if (type === t)
                    continue; // already handled
                if (arr.indexOf(t) === -1)
                    arr.push(t);
            }
        }
    };
    EventBlock.prototype.addSolModifier = function(type) {
        addSolModifierToList(type, this.solModifiers);
    };
    EventBlock.prototype.addParentSolModifier = function(type) {
        addSolModifierToList(type, this.solModifiersIncludingParents);
    };
    EventBlock.prototype.setSolWriterAfterCnds = function() {
        this.solWriterAfterCnds = true;
        if (this.parent)
            this.parent.setSolWriterAfterCnds();
    };
    EventBlock.prototype.is_trigger = function() {
        if (!this.conditions.length) // no conditions
            return false;
        else
            return this.conditions[0].trigger;
    };
    EventBlock.prototype.run = function() {
        var i, len, any_true = false,
            cnd_result;
        var runtime = this.runtime;
        var evinfo = this.runtime.getCurrentEventStack();
        evinfo.current_event = this;
        var conditions = this.conditions;
        if (!this.is_else_block)
            evinfo.else_branch_ran = false;
        if (this.orblock) {
            if (conditions.length === 0)
                any_true = true; // be sure to run if empty block
            evinfo.cndindex = 0
            for (len = conditions.length; evinfo.cndindex < len; evinfo.cndindex++) {
                if (conditions[evinfo.cndindex].trigger) // skip triggers when running OR block
                    continue;
                cnd_result = conditions[evinfo.cndindex].run();
                if (cnd_result) // make sure all conditions run and run if any were true
                    any_true = true;
            }
            evinfo.last_event_true = any_true;
            if (any_true)
                this.run_actions_and_subevents();
        } else {
            evinfo.cndindex = 0
            for (len = conditions.length; evinfo.cndindex < len; evinfo.cndindex++) {
                cnd_result = conditions[evinfo.cndindex].run();
                if (!cnd_result) // condition failed
                {
                    evinfo.last_event_true = false;
                    if (this.toplevelevent && (!runtime.deathRow.isEmpty() || runtime.createRow.length))
                        runtime.ClearDeathRow();
                    return; // bail out now
                }
            }
            evinfo.last_event_true = true;
            this.run_actions_and_subevents();
        }
        this.end_run(evinfo);
    };
    EventBlock.prototype.end_run = function(evinfo) {
        if (evinfo.last_event_true && this.has_else_block)
            evinfo.else_branch_ran = true;
        if (this.toplevelevent && (!this.runtime.deathRow.isEmpty() || this.runtime.createRow.length))
            this.runtime.ClearDeathRow();
    };
    EventBlock.prototype.run_orblocktrigger = function(index) {
        var evinfo = this.runtime.getCurrentEventStack();
        evinfo.current_event = this;
        if (this.conditions[index].run()) {
            this.run_actions_and_subevents();
            this.runtime.getCurrentEventStack().last_event_true = true;
        }
    };
    EventBlock.prototype.run_actions_and_subevents = function() {
        var evinfo = this.runtime.getCurrentEventStack();
        var len;
        for (evinfo.actindex = 0, len = this.actions.length; evinfo.actindex < len; evinfo.actindex++) {
            if (this.actions[evinfo.actindex].run())
                return;
        }
        this.run_subevents();
    };
    EventBlock.prototype.resume_actions_and_subevents = function() {
        var evinfo = this.runtime.getCurrentEventStack();
        var len;
        for (len = this.actions.length; evinfo.actindex < len; evinfo.actindex++) {
            if (this.actions[evinfo.actindex].run())
                return;
        }
        this.run_subevents();
    };
    EventBlock.prototype.run_subevents = function() {
        if (!this.subevents.length)
            return;
        var i, len, subev, pushpop /*, skipped_pop = false, pop_modifiers = null*/ ;
        var last = this.subevents.length - 1;
        this.runtime.pushEventStack(this);
        if (this.solWriterAfterCnds) {
            for (i = 0, len = this.subevents.length; i < len; i++) {
                subev = this.subevents[i];
                pushpop = (!this.toplevelgroup || (!this.group && i < last));
                if (pushpop)
                    this.runtime.pushCopySol(subev.solModifiers);
                subev.run();
                if (pushpop)
                    this.runtime.popSol(subev.solModifiers);
                else
                    this.runtime.clearSol(subev.solModifiers);
            }
        } else {
            for (i = 0, len = this.subevents.length; i < len; i++) {
                this.subevents[i].run();
            }
        }
        this.runtime.popEventStack();
    };
    EventBlock.prototype.run_pretrigger = function() {
        var evinfo = this.runtime.getCurrentEventStack();
        evinfo.current_event = this;
        var any_true = false;
        var i, len;
        for (evinfo.cndindex = 0, len = this.conditions.length; evinfo.cndindex < len; evinfo.cndindex++) {;
            if (this.conditions[evinfo.cndindex].run())
                any_true = true;
            else if (!this.orblock) // condition failed (let OR blocks run all conditions anyway)
                return false; // bail out
        }
        return this.orblock ? any_true : true;
    };
    EventBlock.prototype.retrigger = function() {
        this.runtime.execcount++;
        var prevcndindex = this.runtime.getCurrentEventStack().cndindex;
        var len;
        var evinfo = this.runtime.pushEventStack(this);
        if (!this.orblock) {
            for (evinfo.cndindex = prevcndindex + 1, len = this.conditions.length; evinfo.cndindex < len; evinfo.cndindex++) {
                if (!this.conditions[evinfo.cndindex].run()) // condition failed
                {
                    this.runtime.popEventStack(); // moving up level of recursion
                    return false; // bail out
                }
            }
        }
        this.run_actions_and_subevents();
        this.runtime.popEventStack();
        return true; // ran an iteration
    };
    EventBlock.prototype.isFirstConditionOfType = function(cnd) {
        var cndindex = cnd.index;
        if (cndindex === 0)
            return true;
        --cndindex;
        for (; cndindex >= 0; --cndindex) {
            if (this.conditions[cndindex].type === cnd.type)
                return false;
        }
        return true;
    };
    cr.eventblock = EventBlock;

    function Condition(block, m) {
        this.block = block;
        this.sheet = block.sheet;
        this.runtime = block.runtime;
        this.parameters = [];
        this.results = [];
        this.extra = {}; // for plugins to stow away some custom info
        this.index = -1;
        this.anyParamVariesPerInstance = false;
        this.func = m[1];;
        this.trigger = (m[3] > 0);
        this.fasttrigger = (m[3] === 2);
        this.looping = m[4];
        this.inverted = m[5];
        this.isstatic = m[6];
        this.sid = m[7];
        this.runtime.cndsBySid[this.sid.toString()] = this;
        if (m[0] === -1) // system object
        {
            this.type = null;
            this.run = this.run_system;
            this.behaviortype = null;
            this.beh_index = -1;
        } else {
            this.type = this.runtime.types_by_index[m[0]];;
            if (this.isstatic)
                this.run = this.run_static;
            else
                this.run = this.run_object;
            if (m[2]) {
                this.behaviortype = this.type.getBehaviorByName(m[2]);;
                this.beh_index = this.type.getBehaviorIndexByName(m[2]);;
            } else {
                this.behaviortype = null;
                this.beh_index = -1;
            }
            if (this.block.parent)
                this.block.parent.setSolWriterAfterCnds();
        }
        if (this.fasttrigger)
            this.run = this.run_true;
        if (m.length === 10) {
            var i, len;
            var em = m[9];
            for (i = 0, len = em.length; i < len; i++) {
                var param = new cr.parameter(this, em[i]);
                cr.seal(param);
                this.parameters.push(param);
            }
            this.results.length = em.length;
        }
    };
    Condition.prototype.postInit = function() {
        var i, len, p;
        for (i = 0, len = this.parameters.length; i < len; i++) {
            p = this.parameters[i];
            p.postInit();
            if (p.variesPerInstance)
                this.anyParamVariesPerInstance = true;
        }
    };
    /*
	Condition.prototype.is_logical = function ()
	{
		return !this.type || this.type.plugin.singleglobal;
	};
	*/
    Condition.prototype.run_true = function() {
        return true;
    };
    Condition.prototype.run_system = function() {
        var i, len;
        for (i = 0, len = this.parameters.length; i < len; i++)
            this.results[i] = this.parameters[i].get();
        return cr.xor(this.func.apply(this.runtime.system, this.results), this.inverted);
    };
    Condition.prototype.run_static = function() {
        var i, len;
        for (i = 0, len = this.parameters.length; i < len; i++)
            this.results[i] = this.parameters[i].get();
        var ret = this.func.apply(this.behaviortype ? this.behaviortype : this.type, this.results);
        this.type.applySolToContainer();
        return ret;
    };
    Condition.prototype.run_object = function() {
        var i, j, k, leni, lenj, p, ret, met, inst, s, sol2;
        var type = this.type;
        var sol = type.getCurrentSol();
        var is_orblock = this.block.orblock && !this.trigger; // triggers in OR blocks need to work normally
        var offset = 0;
        var is_contained = type.is_contained;
        var is_family = type.is_family;
        var family_index = type.family_index;
        var beh_index = this.beh_index;
        var is_beh = (beh_index > -1);
        var params_vary = this.anyParamVariesPerInstance;
        var parameters = this.parameters;
        var results = this.results;
        var inverted = this.inverted;
        var func = this.func;
        var arr, container;
        if (params_vary) {
            for (j = 0, lenj = parameters.length; j < lenj; ++j) {
                p = parameters[j];
                if (!p.variesPerInstance)
                    results[j] = p.get(0);
            }
        } else {
            for (j = 0, lenj = parameters.length; j < lenj; ++j)
                results[j] = parameters[j].get(0);
        }
        if (sol.select_all) {
            sol.instances.length = 0; // clear contents
            sol.else_instances.length = 0;
            arr = type.instances;
            for (i = 0, leni = arr.length; i < leni; ++i) {
                inst = arr[i];;
                if (params_vary) {
                    for (j = 0, lenj = parameters.length; j < lenj; ++j) {
                        p = parameters[j];
                        if (p.variesPerInstance)
                            results[j] = p.get(i); // default SOL index is current object
                    }
                }
                if (is_beh) {
                    offset = 0;
                    if (is_family) {
                        offset = inst.type.family_beh_map[family_index];
                    }
                    ret = func.apply(inst.behavior_insts[beh_index + offset], results);
                } else
                    ret = func.apply(inst, results);
                met = cr.xor(ret, inverted);
                if (met)
                    sol.instances.push(inst);
                else if (is_orblock) // in OR blocks, keep the instances not meeting the condition for subsequent testing
                    sol.else_instances.push(inst);
            }
            if (type.finish)
                type.finish(true);
            sol.select_all = false;
            type.applySolToContainer();
            return sol.hasObjects();
        } else {
            k = 0;
            var using_else_instances = (is_orblock && !this.block.isFirstConditionOfType(this));
            arr = (using_else_instances ? sol.else_instances : sol.instances);
            var any_true = false;
            for (i = 0, leni = arr.length; i < leni; ++i) {
                inst = arr[i];;
                if (params_vary) {
                    for (j = 0, lenj = parameters.length; j < lenj; ++j) {
                        p = parameters[j];
                        if (p.variesPerInstance)
                            results[j] = p.get(i); // default SOL index is current object
                    }
                }
                if (is_beh) {
                    offset = 0;
                    if (is_family) {
                        offset = inst.type.family_beh_map[family_index];
                    }
                    ret = func.apply(inst.behavior_insts[beh_index + offset], results);
                } else
                    ret = func.apply(inst, results);
                if (cr.xor(ret, inverted)) {
                    any_true = true;
                    if (using_else_instances) {
                        sol.instances.push(inst);
                        if (is_contained) {
                            for (j = 0, lenj = inst.siblings.length; j < lenj; j++) {
                                s = inst.siblings[j];
                                s.type.getCurrentSol().instances.push(s);
                            }
                        }
                    } else {
                        arr[k] = inst;
                        if (is_contained) {
                            for (j = 0, lenj = inst.siblings.length; j < lenj; j++) {
                                s = inst.siblings[j];
                                s.type.getCurrentSol().instances[k] = s;
                            }
                        }
                        k++;
                    }
                } else {
                    if (using_else_instances) {
                        arr[k] = inst;
                        if (is_contained) {
                            for (j = 0, lenj = inst.siblings.length; j < lenj; j++) {
                                s = inst.siblings[j];
                                s.type.getCurrentSol().else_instances[k] = s;
                            }
                        }
                        k++;
                    } else if (is_orblock) {
                        sol.else_instances.push(inst);
                        if (is_contained) {
                            for (j = 0, lenj = inst.siblings.length; j < lenj; j++) {
                                s = inst.siblings[j];
                                s.type.getCurrentSol().else_instances.push(s);
                            }
                        }
                    }
                }
            }
            arr.length = k;
            if (is_contained) {
                container = type.container;
                for (i = 0, leni = container.length; i < leni; i++) {
                    sol2 = container[i].getCurrentSol();
                    if (using_else_instances)
                        sol2.else_instances.length = k;
                    else
                        sol2.instances.length = k;
                }
            }
            var pick_in_finish = any_true; // don't pick in finish() if we're only doing the logic test below
            if (using_else_instances && !any_true) {
                for (i = 0, leni = sol.instances.length; i < leni; i++) {
                    inst = sol.instances[i];
                    if (params_vary) {
                        for (j = 0, lenj = parameters.length; j < lenj; j++) {
                            p = parameters[j];
                            if (p.variesPerInstance)
                                results[j] = p.get(i);
                        }
                    }
                    if (is_beh)
                        ret = func.apply(inst.behavior_insts[beh_index], results);
                    else
                        ret = func.apply(inst, results);
                    if (cr.xor(ret, inverted)) {
                        any_true = true;
                        break; // got our flag, don't need to test any more
                    }
                }
            }
            if (type.finish)
                type.finish(pick_in_finish || is_orblock);
            return is_orblock ? any_true : sol.hasObjects();
        }
    };
    cr.condition = Condition;

    function Action(block, m) {
        this.block = block;
        this.sheet = block.sheet;
        this.runtime = block.runtime;
        this.parameters = [];
        this.results = [];
        this.extra = {}; // for plugins to stow away some custom info
        this.index = -1;
        this.anyParamVariesPerInstance = false;
        this.func = m[1];;
        if (m[0] === -1) // system
        {
            this.type = null;
            this.run = this.run_system;
            this.behaviortype = null;
            this.beh_index = -1;
        } else {
            this.type = this.runtime.types_by_index[m[0]];;
            this.run = this.run_object;
            if (m[2]) {
                this.behaviortype = this.type.getBehaviorByName(m[2]);;
                this.beh_index = this.type.getBehaviorIndexByName(m[2]);;
            } else {
                this.behaviortype = null;
                this.beh_index = -1;
            }
        }
        this.sid = m[3];
        this.runtime.actsBySid[this.sid.toString()] = this;
        if (m.length === 6) {
            var i, len;
            var em = m[5];
            for (i = 0, len = em.length; i < len; i++) {
                var param = new cr.parameter(this, em[i]);
                cr.seal(param);
                this.parameters.push(param);
            }
            this.results.length = em.length;
        }
    };
    Action.prototype.postInit = function() {
        var i, len, p;
        for (i = 0, len = this.parameters.length; i < len; i++) {
            p = this.parameters[i];
            p.postInit();
            if (p.variesPerInstance)
                this.anyParamVariesPerInstance = true;
        }
    };
    Action.prototype.run_system = function() {
        var i, len;
        for (i = 0, len = this.parameters.length; i < len; i++)
            this.results[i] = this.parameters[i].get();
        return this.func.apply(this.runtime.system, this.results);
    };
    Action.prototype.run_object = function() {
        var instances = this.type.getCurrentSol().getObjects();
        var is_family = this.type.is_family;
        var family_index = this.type.family_index;
        var beh_index = this.beh_index;
        var is_beh = (beh_index > -1);
        var params_vary = this.anyParamVariesPerInstance;
        var parameters = this.parameters;
        var results = this.results;
        var func = this.func;
        var i, j, leni, lenj, p, inst, offset;
        if (params_vary) {
            for (j = 0, lenj = parameters.length; j < lenj; ++j) {
                p = parameters[j];
                if (!p.variesPerInstance)
                    results[j] = p.get(0);
            }
        } else {
            for (j = 0, lenj = parameters.length; j < lenj; ++j)
                results[j] = parameters[j].get(0);
        }
        for (i = 0, leni = instances.length; i < leni; ++i) {
            inst = instances[i];
            if (params_vary) {
                for (j = 0, lenj = parameters.length; j < lenj; ++j) {
                    p = parameters[j];
                    if (p.variesPerInstance)
                        results[j] = p.get(i); // pass i to use as default SOL index
                }
            }
            if (is_beh) {
                offset = 0;
                if (is_family) {
                    offset = inst.type.family_beh_map[family_index];
                }
                func.apply(inst.behavior_insts[beh_index + offset], results);
            } else
                func.apply(inst, results);
        }
        return false;
    };
    cr.action = Action;
    var tempValues = [];
    var tempValuesPtr = -1;

    function Parameter(owner, m) {
        this.owner = owner;
        this.block = owner.block;
        this.sheet = owner.sheet;
        this.runtime = owner.runtime;
        this.type = m[0];
        this.expression = null;
        this.solindex = 0;
        this.get = null;
        this.combosel = 0;
        this.layout = null;
        this.key = 0;
        this.object = null;
        this.index = 0;
        this.varname = null;
        this.eventvar = null;
        this.fileinfo = null;
        this.subparams = null;
        this.variadicret = null;
        this.subparams = null;
        this.variadicret = null;
        this.variesPerInstance = false;
        var i, len, param;
        switch (m[0]) {
            case 0: // number
            case 7: // any
                this.expression = new cr.expNode(this, m[1]);
                this.solindex = 0;
                this.get = this.get_exp;
                break;
            case 1: // string
                this.expression = new cr.expNode(this, m[1]);
                this.solindex = 0;
                this.get = this.get_exp_str;
                break;
            case 5: // layer
                this.expression = new cr.expNode(this, m[1]);
                this.solindex = 0;
                this.get = this.get_layer;
                break;
            case 3: // combo
            case 8: // cmp
                this.combosel = m[1];
                this.get = this.get_combosel;
                break;
            case 6: // layout
                this.layout = this.runtime.layouts[m[1]];;
                this.get = this.get_layout;
                break;
            case 9: // keyb
                this.key = m[1];
                this.get = this.get_key;
                break;
            case 4: // object
                this.object = this.runtime.types_by_index[m[1]];;
                this.get = this.get_object;
                this.block.addSolModifier(this.object);
                if (this.owner instanceof cr.action)
                    this.block.setSolWriterAfterCnds();
                else if (this.block.parent)
                    this.block.parent.setSolWriterAfterCnds();
                break;
            case 10: // instvar
                this.index = m[1];
                if (owner.type.is_family) {
                    this.get = this.get_familyvar;
                    this.variesPerInstance = true;
                } else
                    this.get = this.get_instvar;
                break;
            case 11: // eventvar
                this.varname = m[1];
                this.eventvar = null;
                this.get = this.get_eventvar;
                break;
            case 2: // audiofile	["name", ismusic]
            case 12: // fileinfo		"name"
                this.fileinfo = m[1];
                this.get = this.get_audiofile;
                break;
            case 13: // variadic
                this.get = this.get_variadic;
                this.subparams = [];
                this.variadicret = [];
                for (i = 1, len = m.length; i < len; i++) {
                    param = new cr.parameter(this.owner, m[i]);
                    cr.seal(param);
                    this.subparams.push(param);
                    this.variadicret.push(0);
                }
                break;
            default:
                ;
        }
    };
    Parameter.prototype.postInit = function() {
        var i, len;
        if (this.type === 11) // eventvar
        {
            this.eventvar = this.runtime.getEventVariableByName(this.varname, this.block.parent);;
        } else if (this.type === 13) // variadic, postInit all sub-params
        {
            for (i = 0, len = this.subparams.length; i < len; i++)
                this.subparams[i].postInit();
        }
        if (this.expression)
            this.expression.postInit();
    };
    Parameter.prototype.maybeVaryForType = function(t) {
        if (this.variesPerInstance)
            return; // already varies per instance, no need to check again
        if (!t)
            return; // never vary for system type
        if (!t.plugin.singleglobal) {
            this.variesPerInstance = true;
            return;
        }
    };
    Parameter.prototype.setVaries = function() {
        this.variesPerInstance = true;
    };
    Parameter.prototype.pushTempValue = function() {
        tempValuesPtr++;
        if (tempValues.length === tempValuesPtr)
            tempValues.push(new cr.expvalue());
        return tempValues[tempValuesPtr];
    };
    Parameter.prototype.popTempValue = function() {
        tempValuesPtr--;
    };
    Parameter.prototype.get_exp = function(solindex) {
        this.solindex = solindex || 0; // default SOL index to use
        var temp = this.pushTempValue();
        this.expression.get(temp);
        this.popTempValue();
        return temp.data; // return actual JS value, not expvalue
    };
    Parameter.prototype.get_exp_str = function(solindex) {
        this.solindex = solindex || 0; // default SOL index to use
        var temp = this.pushTempValue();
        this.expression.get(temp);
        this.popTempValue();
        if (cr.is_string(temp.data))
            return temp.data;
        else
            return "";
    };
    Parameter.prototype.get_object = function() {
        return this.object;
    };
    Parameter.prototype.get_combosel = function() {
        return this.combosel;
    };
    Parameter.prototype.get_layer = function(solindex) {
        this.solindex = solindex || 0; // default SOL index to use
        var temp = this.pushTempValue();
        this.expression.get(temp);
        this.popTempValue();
        if (temp.is_number())
            return this.runtime.getLayerByNumber(temp.data);
        else
            return this.runtime.getLayerByName(temp.data);
    }
    Parameter.prototype.get_layout = function() {
        return this.layout;
    };
    Parameter.prototype.get_key = function() {
        return this.key;
    };
    Parameter.prototype.get_instvar = function() {
        return this.index;
    };
    Parameter.prototype.get_familyvar = function(solindex_) {
        var solindex = solindex_ || 0;
        var familytype = this.owner.type;
        var realtype = null;
        var sol = familytype.getCurrentSol();
        var objs = sol.getObjects();
        if (objs.length)
            realtype = objs[solindex % objs.length].type;
        else if (sol.else_instances.length)
            realtype = sol.else_instances[solindex % sol.else_instances.length].type;
        else if (familytype.instances.length)
            realtype = familytype.instances[solindex % familytype.instances.length].type;
        else
            return 0;
        return this.index + realtype.family_var_map[familytype.family_index];
    };
    Parameter.prototype.get_eventvar = function() {
        return this.eventvar;
    };
    Parameter.prototype.get_audiofile = function() {
        return this.fileinfo;
    };
    Parameter.prototype.get_variadic = function() {
        var i, len;
        for (i = 0, len = this.subparams.length; i < len; i++) {
            this.variadicret[i] = this.subparams[i].get();
        }
        return this.variadicret;
    };
    cr.parameter = Parameter;

    function EventVariable(sheet, parent, m) {
        this.sheet = sheet;
        this.parent = parent;
        this.runtime = sheet.runtime;
        this.solModifiers = [];
        this.name = m[1];
        this.vartype = m[2];
        this.initial = m[3];
        this.is_static = !!m[4];
        this.is_constant = !!m[5];
        this.sid = m[6];
        this.runtime.varsBySid[this.sid.toString()] = this;
        this.data = this.initial; // note: also stored in event stack frame for local nonstatic nonconst vars
        if (this.parent) // local var
        {
            if (this.is_static || this.is_constant)
                this.localIndex = -1;
            else
                this.localIndex = this.runtime.stackLocalCount++;
            this.runtime.all_local_vars.push(this);
        } else // global var
        {
            this.localIndex = -1;
            this.runtime.all_global_vars.push(this);
        }
    };
    EventVariable.prototype.postInit = function() {
        this.solModifiers = findMatchingSolModifier(this.solModifiers);
    };
    EventVariable.prototype.setValue = function(x) {;
        var lvs = this.runtime.getCurrentLocalVarStack();
        if (!this.parent || this.is_static || !lvs)
            this.data = x;
        else // local nonstatic variable: use event stack to keep value at this level of recursion
        {
            if (this.localIndex >= lvs.length)
                lvs.length = this.localIndex + 1;
            lvs[this.localIndex] = x;
        }
    };
    EventVariable.prototype.getValue = function() {
        var lvs = this.runtime.getCurrentLocalVarStack();
        if (!this.parent || this.is_static || !lvs || this.is_constant)
            return this.data;
        else // local nonstatic variable
        {
            if (this.localIndex >= lvs.length) {;
                return this.initial;
            }
            if (typeof lvs[this.localIndex] === "undefined") {;
                return this.initial;
            }
            return lvs[this.localIndex];
        }
    };
    EventVariable.prototype.run = function() {
        if (this.parent && !this.is_static && !this.is_constant)
            this.setValue(this.initial);
    };
    cr.eventvariable = EventVariable;

    function EventInclude(sheet, parent, m) {
        this.sheet = sheet;
        this.parent = parent;
        this.runtime = sheet.runtime;
        this.solModifiers = [];
        this.include_sheet = null; // determined in postInit
        this.include_sheet_name = m[1];
        this.active = true;
    };
    EventInclude.prototype.toString = function() {
        return "include:" + this.include_sheet.toString();
    };
    EventInclude.prototype.postInit = function() {
        this.include_sheet = this.runtime.eventsheets[this.include_sheet_name];;;
        this.sheet.includes.add(this);
        this.solModifiers = findMatchingSolModifier(this.solModifiers);
        var p = this.parent;
        while (p) {
            if (p.group)
                p.contained_includes.push(this);
            p = p.parent;
        }
        this.updateActive();
    };
    EventInclude.prototype.run = function() {
        if (this.parent)
            this.runtime.pushCleanSol(this.runtime.types_by_index);
        if (!this.include_sheet.hasRun)
            this.include_sheet.run(true); // from include
        if (this.parent)
            this.runtime.popSol(this.runtime.types_by_index);
    };
    EventInclude.prototype.updateActive = function() {
        var p = this.parent;
        while (p) {
            if (p.group && !p.group_active) {
                this.active = false;
                return;
            }
            p = p.parent;
        }
        this.active = true;
    };
    EventInclude.prototype.isActive = function() {
        return this.active;
    };
    cr.eventinclude = EventInclude;

    function EventStackFrame() {
        this.temp_parents_arr = [];
        this.reset(null);
        cr.seal(this);
    };
    EventStackFrame.prototype.reset = function(cur_event) {
        this.current_event = cur_event;
        this.cndindex = 0;
        this.actindex = 0;
        this.temp_parents_arr.length = 0;
        this.last_event_true = false;
        this.else_branch_ran = false;
        this.any_true_state = false;
    };
    EventStackFrame.prototype.isModifierAfterCnds = function() {
        if (this.current_event.solWriterAfterCnds)
            return true;
        if (this.cndindex < this.current_event.conditions.length - 1)
            return !!this.current_event.solModifiers.length;
        return false;
    };
    cr.eventStackFrame = EventStackFrame;
}());
(function() {
    function ExpNode(owner_, m) {
        this.owner = owner_;
        this.runtime = owner_.runtime;
        this.type = m[0];;
        this.get = [this.eval_int,
            this.eval_float,
            this.eval_string,
            this.eval_unaryminus,
            this.eval_add,
            this.eval_subtract,
            this.eval_multiply,
            this.eval_divide,
            this.eval_mod,
            this.eval_power,
            this.eval_and,
            this.eval_or,
            this.eval_equal,
            this.eval_notequal,
            this.eval_less,
            this.eval_lessequal,
            this.eval_greater,
            this.eval_greaterequal,
            this.eval_conditional,
            this.eval_system_exp,
            this.eval_object_behavior_exp,
            this.eval_instvar_exp,
            this.eval_object_behavior_exp,
            this.eval_eventvar_exp
        ][this.type];
        var paramsModel = null;
        this.value = null;
        this.first = null;
        this.second = null;
        this.third = null;
        this.func = null;
        this.results = null;
        this.parameters = null;
        this.object_type = null;
        this.beh_index = -1;
        this.instance_expr = null;
        this.varindex = -1;
        this.behavior_type = null;
        this.varname = null;
        this.eventvar = null;
        this.return_string = false;
        switch (this.type) {
            case 0: // int
            case 1: // float
            case 2: // string
                this.value = m[1];
                break;
            case 3: // unaryminus
                this.first = new cr.expNode(owner_, m[1]);
                break;
            case 18: // conditional
                this.first = new cr.expNode(owner_, m[1]);
                this.second = new cr.expNode(owner_, m[2]);
                this.third = new cr.expNode(owner_, m[3]);
                break;
            case 19: // system_exp
                this.func = m[1];;
                if (this.func === cr.system_object.prototype.exps.random || this.func === cr.system_object.prototype.exps.choose) {
                    this.owner.setVaries();
                }
                this.results = [];
                this.parameters = [];
                if (m.length === 3) {
                    paramsModel = m[2];
                    this.results.length = paramsModel.length + 1; // must also fit 'ret'
                } else
                    this.results.length = 1; // to fit 'ret'
                break;
            case 20: // object_exp
                this.object_type = this.runtime.types_by_index[m[1]];;
                this.beh_index = -1;
                this.func = m[2];
                this.return_string = m[3];
                if (cr.plugins_.Function && this.func === cr.plugins_.Function.prototype.exps.Call) {
                    this.owner.setVaries();
                }
                if (m[4])
                    this.instance_expr = new cr.expNode(owner_, m[4]);
                else
                    this.instance_expr = null;
                this.results = [];
                this.parameters = [];
                if (m.length === 6) {
                    paramsModel = m[5];
                    this.results.length = paramsModel.length + 1;
                } else
                    this.results.length = 1; // to fit 'ret'
                break;
            case 21: // instvar_exp
                this.object_type = this.runtime.types_by_index[m[1]];;
                this.return_string = m[2];
                if (m[3])
                    this.instance_expr = new cr.expNode(owner_, m[3]);
                else
                    this.instance_expr = null;
                this.varindex = m[4];
                break;
            case 22: // behavior_exp
                this.object_type = this.runtime.types_by_index[m[1]];;
                this.behavior_type = this.object_type.getBehaviorByName(m[2]);;
                this.beh_index = this.object_type.getBehaviorIndexByName(m[2]);
                this.func = m[3];
                this.return_string = m[4];
                if (m[5])
                    this.instance_expr = new cr.expNode(owner_, m[5]);
                else
                    this.instance_expr = null;
                this.results = [];
                this.parameters = [];
                if (m.length === 7) {
                    paramsModel = m[6];
                    this.results.length = paramsModel.length + 1;
                } else
                    this.results.length = 1; // to fit 'ret'
                break;
            case 23: // eventvar_exp
                this.varname = m[1];
                this.eventvar = null; // assigned in postInit
                break;
        }
        this.owner.maybeVaryForType(this.object_type);
        if (this.type >= 4 && this.type <= 17) {
            this.first = new cr.expNode(owner_, m[1]);
            this.second = new cr.expNode(owner_, m[2]);
        }
        if (paramsModel) {
            var i, len;
            for (i = 0, len = paramsModel.length; i < len; i++)
                this.parameters.push(new cr.expNode(owner_, paramsModel[i]));
        }
        cr.seal(this);
    };
    ExpNode.prototype.postInit = function() {
        if (this.type === 23) // eventvar_exp
        {
            this.eventvar = this.owner.runtime.getEventVariableByName(this.varname, this.owner.block.parent);;
        }
        if (this.first)
            this.first.postInit();
        if (this.second)
            this.second.postInit();
        if (this.third)
            this.third.postInit();
        if (this.instance_expr)
            this.instance_expr.postInit();
        if (this.parameters) {
            var i, len;
            for (i = 0, len = this.parameters.length; i < len; i++)
                this.parameters[i].postInit();
        }
    };
    ExpNode.prototype.eval_system_exp = function(ret) {
        this.results[0] = ret;
        var temp = this.owner.pushTempValue();
        var i, len;
        for (i = 0, len = this.parameters.length; i < len; i++) {
            this.parameters[i].get(temp);
            this.results[i + 1] = temp.data; // passing actual javascript value as argument instead of expvalue
        }
        this.owner.popTempValue();
        this.func.apply(this.runtime.system, this.results);
    };
    ExpNode.prototype.eval_object_behavior_exp = function(ret) {
        var sol = this.object_type.getCurrentSol();
        var instances = sol.getObjects();
        if (!instances.length) {
            if (sol.else_instances.length)
                instances = sol.else_instances;
            else {
                if (this.return_string)
                    ret.set_string("");
                else
                    ret.set_int(0);
                return;
            }
        }
        this.results[0] = ret;
        ret.object_class = this.object_type; // so expression can access family type if need be
        var temp = this.owner.pushTempValue();
        var i, len;
        for (i = 0, len = this.parameters.length; i < len; i++) {
            this.parameters[i].get(temp);
            this.results[i + 1] = temp.data; // passing actual javascript value as argument instead of expvalue
        }
        var index = this.owner.solindex;
        if (this.instance_expr) {
            this.instance_expr.get(temp);
            if (temp.is_number()) {
                index = temp.data;
                instances = this.object_type.instances; // pick from all instances, not SOL
            }
        }
        this.owner.popTempValue();
        index %= instances.length; // wraparound
        if (index < 0)
            index += instances.length;
        var returned_val;
        var inst = instances[index];
        if (this.beh_index > -1) {
            var offset = 0;
            if (this.object_type.is_family) {
                offset = inst.type.family_beh_map[this.object_type.family_index];
            }
            returned_val = this.func.apply(inst.behavior_insts[this.beh_index + offset], this.results);
        } else
            returned_val = this.func.apply(inst, this.results);;
    };
    ExpNode.prototype.eval_instvar_exp = function(ret) {
        var sol = this.object_type.getCurrentSol();
        var instances = sol.getObjects();
        if (!instances.length) {
            if (sol.else_instances.length)
                instances = sol.else_instances;
            else {
                if (this.return_string)
                    ret.set_string("");
                else
                    ret.set_int(0);
                return;
            }
        }
        var index = this.owner.solindex;
        if (this.instance_expr) {
            var temp = this.owner.pushTempValue();
            this.instance_expr.get(temp);
            if (temp.is_number()) {
                index = temp.data;
                var type_instances = this.object_type.instances;
                index %= type_instances.length; // wraparound
                if (index < 0) // offset
                    index += type_instances.length;
                var to_ret = type_instances[index].instance_vars[this.varindex];
                if (cr.is_string(to_ret))
                    ret.set_string(to_ret);
                else
                    ret.set_float(to_ret);
                this.owner.popTempValue();
                return; // done
            }
            this.owner.popTempValue();
        }
        index %= instances.length; // wraparound
        if (index < 0)
            index += instances.length;
        var inst = instances[index];
        var offset = 0;
        if (this.object_type.is_family) {
            offset = inst.type.family_var_map[this.object_type.family_index];
        }
        var to_ret = inst.instance_vars[this.varindex + offset];
        if (cr.is_string(to_ret))
            ret.set_string(to_ret);
        else
            ret.set_float(to_ret);
    };
    ExpNode.prototype.eval_int = function(ret) {
        ret.type = cr.exptype.Integer;
        ret.data = this.value;
    };
    ExpNode.prototype.eval_float = function(ret) {
        ret.type = cr.exptype.Float;
        ret.data = this.value;
    };
    ExpNode.prototype.eval_string = function(ret) {
        ret.type = cr.exptype.String;
        ret.data = this.value;
    };
    ExpNode.prototype.eval_unaryminus = function(ret) {
        this.first.get(ret); // retrieve operand
        if (ret.is_number())
            ret.data = -ret.data;
    };
    ExpNode.prototype.eval_add = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        if (ret.is_number() && temp.is_number()) {
            ret.data += temp.data; // both operands numbers: add
            if (temp.is_float())
                ret.make_float();
        }
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_subtract = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        if (ret.is_number() && temp.is_number()) {
            ret.data -= temp.data; // both operands numbers: subtract
            if (temp.is_float())
                ret.make_float();
        }
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_multiply = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        if (ret.is_number() && temp.is_number()) {
            ret.data *= temp.data; // both operands numbers: multiply
            if (temp.is_float())
                ret.make_float();
        }
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_divide = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        if (ret.is_number() && temp.is_number()) {
            ret.data /= temp.data; // both operands numbers: divide
            ret.make_float();
        }
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_mod = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        if (ret.is_number() && temp.is_number()) {
            ret.data %= temp.data; // both operands numbers: modulo
            if (temp.is_float())
                ret.make_float();
        }
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_power = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        if (ret.is_number() && temp.is_number()) {
            ret.data = Math.pow(ret.data, temp.data); // both operands numbers: raise to power
            if (temp.is_float())
                ret.make_float();
        }
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_and = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        if (ret.is_number()) {
            if (temp.is_string()) {
                ret.set_string(ret.data.toString() + temp.data);
            } else {
                if (ret.data && temp.data)
                    ret.set_int(1);
                else
                    ret.set_int(0);
            }
        } else if (ret.is_string()) {
            if (temp.is_string())
                ret.data += temp.data;
            else {
                ret.data += (Math.round(temp.data * 1e10) / 1e10).toString();
            }
        }
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_or = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        if (ret.is_number() && temp.is_number()) {
            if (ret.data || temp.data)
                ret.set_int(1);
            else
                ret.set_int(0);
        }
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_conditional = function(ret) {
        this.first.get(ret); // condition operand
        if (ret.data) // is true
            this.second.get(ret); // evaluate second operand to ret
        else
            this.third.get(ret); // evaluate third operand to ret
    };
    ExpNode.prototype.eval_equal = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        ret.set_int(ret.data === temp.data ? 1 : 0);
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_notequal = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        ret.set_int(ret.data !== temp.data ? 1 : 0);
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_less = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        ret.set_int(ret.data < temp.data ? 1 : 0);
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_lessequal = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        ret.set_int(ret.data <= temp.data ? 1 : 0);
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_greater = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        ret.set_int(ret.data > temp.data ? 1 : 0);
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_greaterequal = function(ret) {
        this.first.get(ret); // left operand
        var temp = this.owner.pushTempValue();
        this.second.get(temp); // right operand
        ret.set_int(ret.data >= temp.data ? 1 : 0);
        this.owner.popTempValue();
    };
    ExpNode.prototype.eval_eventvar_exp = function(ret) {
        var val = this.eventvar.getValue();
        if (cr.is_number(val))
            ret.set_float(val);
        else
            ret.set_string(val);
    };
    cr.expNode = ExpNode;

    function ExpValue(type, data) {
        this.type = type || cr.exptype.Integer;
        this.data = data || 0;
        this.object_class = null;;;;
        if (this.type == cr.exptype.Integer)
            this.data = Math.floor(this.data);
        cr.seal(this);
    };
    ExpValue.prototype.is_int = function() {
        return this.type === cr.exptype.Integer;
    };
    ExpValue.prototype.is_float = function() {
        return this.type === cr.exptype.Float;
    };
    ExpValue.prototype.is_number = function() {
        return this.type === cr.exptype.Integer || this.type === cr.exptype.Float;
    };
    ExpValue.prototype.is_string = function() {
        return this.type === cr.exptype.String;
    };
    ExpValue.prototype.make_int = function() {
        if (!this.is_int()) {
            if (this.is_float())
                this.data = Math.floor(this.data); // truncate float
            else if (this.is_string())
                this.data = parseInt(this.data, 10);
            this.type = cr.exptype.Integer;
        }
    };
    ExpValue.prototype.make_float = function() {
        if (!this.is_float()) {
            if (this.is_string())
                this.data = parseFloat(this.data);
            this.type = cr.exptype.Float;
        }
    };
    ExpValue.prototype.make_string = function() {
        if (!this.is_string()) {
            this.data = this.data.toString();
            this.type = cr.exptype.String;
        }
    };
    ExpValue.prototype.set_int = function(val) {;
        this.type = cr.exptype.Integer;
        this.data = Math.floor(val);
    };
    ExpValue.prototype.set_float = function(val) {;
        this.type = cr.exptype.Float;
        this.data = val;
    };
    ExpValue.prototype.set_string = function(val) {;
        this.type = cr.exptype.String;
        this.data = val;
    };
    ExpValue.prototype.set_any = function(val) {
        if (cr.is_number(val)) {
            this.type = cr.exptype.Float;
            this.data = val;
        } else if (cr.is_string(val)) {
            this.type = cr.exptype.String;
            this.data = val.toString();
        } else {
            this.type = cr.exptype.Integer;
            this.data = 0;
        }
    };
    cr.expvalue = ExpValue;
    cr.exptype = {
        Integer: 0, // emulated; no native integer support in javascript
        Float: 1,
        String: 2
    };
}());;
cr.system_object = function(runtime) {
    this.runtime = runtime;
    this.waits = [];
};
cr.system_object.prototype.saveToJSON = function() {
    var o = {};
    var i, len, j, lenj, p, w, t, sobj;
    o["waits"] = [];
    var owaits = o["waits"];
    var waitobj;
    for (i = 0, len = this.waits.length; i < len; i++) {
        w = this.waits[i];
        waitobj = {
            "t": w.time,
            "ev": w.ev.sid,
            "sm": [],
            "sols": {}
        };
        if (w.ev.actions[w.actindex])
            waitobj["act"] = w.ev.actions[w.actindex].sid;
        for (j = 0, lenj = w.solModifiers.length; j < lenj; j++)
            waitobj["sm"].push(w.solModifiers[j].sid);
        for (p in w.sols) {
            if (w.sols.hasOwnProperty(p)) {
                t = this.runtime.types_by_index[parseInt(p, 10)];;
                sobj = {
                    "sa": w.sols[p].sa,
                    "insts": []
                };
                for (j = 0, lenj = w.sols[p].insts.length; j < lenj; j++)
                    sobj["insts"].push(w.sols[p].insts[j].uid);
                waitobj["sols"][t.sid.toString()] = sobj;
            }
        }
        owaits.push(waitobj);
    }
    return o;
};
cr.system_object.prototype.loadFromJSON = function(o) {
    var owaits = o["waits"];
    var i, len, j, lenj, p, w, addWait, e, aindex, t, savedsol, nusol, inst;
    this.waits.length = 0;
    for (i = 0, len = owaits.length; i < len; i++) {
        w = owaits[i];
        e = this.runtime.blocksBySid[w["ev"].toString()];
        if (!e)
            continue; // event must've gone missing
        aindex = -1;
        for (j = 0, lenj = e.actions.length; j < lenj; j++) {
            if (e.actions[j].sid === w["act"]) {
                aindex = j;
                break;
            }
        }
        if (aindex === -1)
            continue; // action must've gone missing
        addWait = {};
        addWait.sols = {};
        addWait.solModifiers = [];
        addWait.deleteme = false;
        addWait.time = w["t"];
        addWait.ev = e;
        addWait.actindex = aindex;
        for (j = 0, lenj = w["sm"].length; j < lenj; j++) {
            t = this.runtime.getObjectTypeBySid(w["sm"][j]);
            if (t)
                addWait.solModifiers.push(t);
        }
        for (p in w["sols"]) {
            if (w["sols"].hasOwnProperty(p)) {
                t = this.runtime.getObjectTypeBySid(parseInt(p, 10));
                if (!t)
                    continue; // type must've been deleted
                savedsol = w["sols"][p];
                nusol = {
                    sa: savedsol["sa"],
                    insts: []
                };
                for (j = 0, lenj = savedsol["insts"].length; j < lenj; j++) {
                    inst = this.runtime.getObjectByUID(savedsol["insts"][j]);
                    if (inst)
                        nusol.insts.push(inst);
                }
                addWait.sols[t.index.toString()] = nusol;
            }
        }
        this.waits.push(addWait);
    }
};
(function() {
    var sysProto = cr.system_object.prototype;

    function SysCnds() {};
    SysCnds.prototype.EveryTick = function() {
        return true;
    };
    SysCnds.prototype.OnLayoutStart = function() {
        return true;
    };
    SysCnds.prototype.OnLayoutEnd = function() {
        return true;
    };
    SysCnds.prototype.Compare = function(x, cmp, y) {
        return cr.do_cmp(x, cmp, y);
    };
    SysCnds.prototype.CompareTime = function(cmp, t) {
        var elapsed = this.runtime.kahanTime.sum;
        if (cmp === 0) {
            var cnd = this.runtime.getCurrentCondition();
            if (!cnd.extra.CompareTime_executed) {
                if (elapsed >= t) {
                    cnd.extra.CompareTime_executed = true;
                    return true;
                }
            }
            return false;
        }
        return cr.do_cmp(elapsed, cmp, t);
    };
    SysCnds.prototype.LayerVisible = function(layer) {
        if (!layer)
            return false;
        else
            return layer.visible;
    };
    SysCnds.prototype.LayerCmpOpacity = function(layer, cmp, opacity_) {
        if (!layer)
            return false;
        return cr.do_cmp(layer.opacity * 100, cmp, opacity_);
    };
    SysCnds.prototype.Repeat = function(count) {
        var current_frame = this.runtime.getCurrentEventStack();
        var current_event = current_frame.current_event;
        var solModifierAfterCnds = current_frame.isModifierAfterCnds();
        var current_loop = this.runtime.pushLoopStack();
        var i;
        if (solModifierAfterCnds) {
            for (i = 0; i < count && !current_loop.stopped; i++) {
                this.runtime.pushCopySol(current_event.solModifiers);
                current_loop.index = i;
                current_event.retrigger();
                this.runtime.popSol(current_event.solModifiers);
            }
        } else {
            for (i = 0; i < count && !current_loop.stopped; i++) {
                current_loop.index = i;
                current_event.retrigger();
            }
        }
        this.runtime.popLoopStack();
        return false;
    };
    SysCnds.prototype.While = function(count) {
        var current_frame = this.runtime.getCurrentEventStack();
        var current_event = current_frame.current_event;
        var solModifierAfterCnds = current_frame.isModifierAfterCnds();
        var current_loop = this.runtime.pushLoopStack();
        var i;
        if (solModifierAfterCnds) {
            for (i = 0; !current_loop.stopped; i++) {
                this.runtime.pushCopySol(current_event.solModifiers);
                current_loop.index = i;
                if (!current_event.retrigger()) // one of the other conditions returned false
                    current_loop.stopped = true; // break
                this.runtime.popSol(current_event.solModifiers);
            }
        } else {
            for (i = 0; !current_loop.stopped; i++) {
                current_loop.index = i;
                if (!current_event.retrigger())
                    current_loop.stopped = true;
            }
        }
        this.runtime.popLoopStack();
        return false;
    };
    SysCnds.prototype.For = function(name, start, end) {
        var current_frame = this.runtime.getCurrentEventStack();
        var current_event = current_frame.current_event;
        var solModifierAfterCnds = current_frame.isModifierAfterCnds();
        var current_loop = this.runtime.pushLoopStack(name);
        var i;
        if (end < start) {
            if (solModifierAfterCnds) {
                for (i = start; i >= end && !current_loop.stopped; --i) // inclusive to end
                {
                    this.runtime.pushCopySol(current_event.solModifiers);
                    current_loop.index = i;
                    current_event.retrigger();
                    this.runtime.popSol(current_event.solModifiers);
                }
            } else {
                for (i = start; i >= end && !current_loop.stopped; --i) // inclusive to end
                {
                    current_loop.index = i;
                    current_event.retrigger();
                }
            }
        } else {
            if (solModifierAfterCnds) {
                for (i = start; i <= end && !current_loop.stopped; ++i) // inclusive to end
                {
                    this.runtime.pushCopySol(current_event.solModifiers);
                    current_loop.index = i;
                    current_event.retrigger();
                    this.runtime.popSol(current_event.solModifiers);
                }
            } else {
                for (i = start; i <= end && !current_loop.stopped; ++i) // inclusive to end
                {
                    current_loop.index = i;
                    current_event.retrigger();
                }
            }
        }
        this.runtime.popLoopStack();
        return false;
    };
    var foreach_instancestack = [];
    var foreach_instanceptr = -1;
    SysCnds.prototype.ForEach = function(obj) {
        var sol = obj.getCurrentSol();
        foreach_instanceptr++;
        if (foreach_instancestack.length === foreach_instanceptr)
            foreach_instancestack.push([]);
        var instances = foreach_instancestack[foreach_instanceptr];
        cr.shallowAssignArray(instances, sol.getObjects());
        var current_frame = this.runtime.getCurrentEventStack();
        var current_event = current_frame.current_event;
        var solModifierAfterCnds = current_frame.isModifierAfterCnds();
        var current_loop = this.runtime.pushLoopStack();
        var i, len, j, lenj, inst, s, sol2;
        var is_contained = obj.is_contained;
        if (solModifierAfterCnds) {
            for (i = 0, len = instances.length; i < len && !current_loop.stopped; i++) {
                this.runtime.pushCopySol(current_event.solModifiers);
                inst = instances[i];
                sol = obj.getCurrentSol();
                sol.select_all = false;
                sol.instances.length = 1;
                sol.instances[0] = inst;
                if (is_contained) {
                    for (j = 0, lenj = inst.siblings.length; j < lenj; j++) {
                        s = inst.siblings[j];
                        sol2 = s.type.getCurrentSol();
                        sol2.select_all = false;
                        sol2.instances.length = 1;
                        sol2.instances[0] = s;
                    }
                }
                current_loop.index = i;
                current_event.retrigger();
                this.runtime.popSol(current_event.solModifiers);
            }
        } else {
            sol.select_all = false;
            sol.instances.length = 1;
            for (i = 0, len = instances.length; i < len && !current_loop.stopped; i++) {
                inst = instances[i];
                sol.instances[0] = inst;
                if (is_contained) {
                    for (j = 0, lenj = inst.siblings.length; j < lenj; j++) {
                        s = inst.siblings[j];
                        sol2 = s.type.getCurrentSol();
                        sol2.select_all = false;
                        sol2.instances.length = 1;
                        sol2.instances[0] = s;
                    }
                }
                current_loop.index = i;
                current_event.retrigger();
            }
        }
        instances.length = 0;
        this.runtime.popLoopStack();
        foreach_instanceptr--;
        return false;
    };

    function foreach_sortinstances(a, b) {
        var va = a.extra.c2_foreachordered_val;
        var vb = b.extra.c2_foreachordered_val;
        if (cr.is_number(va) && cr.is_number(vb))
            return va - vb;
        else {
            va = "" + va;
            vb = "" + vb;
            if (va < vb)
                return -1;
            else if (va > vb)
                return 1;
            else
                return 0;
        }
    };
    SysCnds.prototype.ForEachOrdered = function(obj, exp, order) {
        var sol = obj.getCurrentSol();
        foreach_instanceptr++;
        if (foreach_instancestack.length === foreach_instanceptr)
            foreach_instancestack.push([]);
        var instances = foreach_instancestack[foreach_instanceptr];
        cr.shallowAssignArray(instances, sol.getObjects());
        var current_frame = this.runtime.getCurrentEventStack();
        var current_event = current_frame.current_event;
        var current_condition = this.runtime.getCurrentCondition();
        var solModifierAfterCnds = current_frame.isModifierAfterCnds();
        var current_loop = this.runtime.pushLoopStack();
        var i, len, j, lenj, inst, s, sol2;
        for (i = 0, len = instances.length; i < len; i++) {
            instances[i].extra.c2_foreachordered_val = current_condition.parameters[1].get(i);
        }
        instances.sort(foreach_sortinstances);
        if (order === 1)
            instances.reverse();
        var is_contained = obj.is_contained;
        if (solModifierAfterCnds) {
            for (i = 0, len = instances.length; i < len && !current_loop.stopped; i++) {
                this.runtime.pushCopySol(current_event.solModifiers);
                inst = instances[i];
                sol = obj.getCurrentSol();
                sol.select_all = false;
                sol.instances.length = 1;
                sol.instances[0] = inst;
                if (is_contained) {
                    for (j = 0, lenj = inst.siblings.length; j < lenj; j++) {
                        s = inst.siblings[j];
                        sol2 = s.type.getCurrentSol();
                        sol2.select_all = false;
                        sol2.instances.length = 1;
                        sol2.instances[0] = s;
                    }
                }
                current_loop.index = i;
                current_event.retrigger();
                this.runtime.popSol(current_event.solModifiers);
            }
        } else {
            sol.select_all = false;
            sol.instances.length = 1;
            for (i = 0, len = instances.length; i < len && !current_loop.stopped; i++) {
                inst = instances[i];
                sol.instances[0] = inst;
                if (is_contained) {
                    for (j = 0, lenj = inst.siblings.length; j < lenj; j++) {
                        s = inst.siblings[j];
                        sol2 = s.type.getCurrentSol();
                        sol2.select_all = false;
                        sol2.instances.length = 1;
                        sol2.instances[0] = s;
                    }
                }
                current_loop.index = i;
                current_event.retrigger();
            }
        }
        instances.length = 0;
        this.runtime.popLoopStack();
        foreach_instanceptr--;
        return false;
    };
    SysCnds.prototype.PickByComparison = function(obj_, exp_, cmp_, val_) {
        var i, len, k, inst;
        if (!obj_)
            return;
        foreach_instanceptr++;
        if (foreach_instancestack.length === foreach_instanceptr)
            foreach_instancestack.push([]);
        var tmp_instances = foreach_instancestack[foreach_instanceptr];
        var sol = obj_.getCurrentSol();
        cr.shallowAssignArray(tmp_instances, sol.getObjects());
        if (sol.select_all)
            sol.else_instances.length = 0;
        var current_condition = this.runtime.getCurrentCondition();
        for (i = 0, k = 0, len = tmp_instances.length; i < len; i++) {
            inst = tmp_instances[i];
            tmp_instances[k] = inst;
            exp_ = current_condition.parameters[1].get(i);
            val_ = current_condition.parameters[3].get(i);
            if (cr.do_cmp(exp_, cmp_, val_)) {
                k++;
            } else {
                sol.else_instances.push(inst);
            }
        }
        tmp_instances.length = k;
        sol.select_all = false;
        cr.shallowAssignArray(sol.instances, tmp_instances);
        tmp_instances.length = 0;
        foreach_instanceptr--;
        obj_.applySolToContainer();
        return !!sol.instances.length;
    };
    SysCnds.prototype.PickByEvaluate = function(obj_, exp_) {
        var i, len, k, inst;
        if (!obj_)
            return;
        foreach_instanceptr++;
        if (foreach_instancestack.length === foreach_instanceptr)
            foreach_instancestack.push([]);
        var tmp_instances = foreach_instancestack[foreach_instanceptr];
        var sol = obj_.getCurrentSol();
        cr.shallowAssignArray(tmp_instances, sol.getObjects());
        if (sol.select_all)
            sol.else_instances.length = 0;
        var current_condition = this.runtime.getCurrentCondition();
        for (i = 0, k = 0, len = tmp_instances.length; i < len; i++) {
            inst = tmp_instances[i];
            tmp_instances[k] = inst;
            exp_ = current_condition.parameters[1].get(i);
            if (exp_) {
                k++;
            } else {
                sol.else_instances.push(inst);
            }
        }
        tmp_instances.length = k;
        sol.select_all = false;
        cr.shallowAssignArray(sol.instances, tmp_instances);
        tmp_instances.length = 0;
        foreach_instanceptr--;
        obj_.applySolToContainer();
        return !!sol.instances.length;
    };
    SysCnds.prototype.TriggerOnce = function() {
        var cndextra = this.runtime.getCurrentCondition().extra;
        if (typeof cndextra.TriggerOnce_lastTick === "undefined")
            cndextra.TriggerOnce_lastTick = -1;
        var last_tick = cndextra.TriggerOnce_lastTick;
        var cur_tick = this.runtime.tickcount;
        cndextra.TriggerOnce_lastTick = cur_tick;
        return this.runtime.layout_first_tick || last_tick !== cur_tick - 1;
    };
    SysCnds.prototype.Every = function(seconds) {
        var cnd = this.runtime.getCurrentCondition();
        var last_time = cnd.extra.Every_lastTime || 0;
        var cur_time = this.runtime.kahanTime.sum;
        if (typeof cnd.extra.Every_seconds === "undefined")
            cnd.extra.Every_seconds = seconds;
        var this_seconds = cnd.extra.Every_seconds;
        if (cur_time >= last_time + this_seconds) {
            cnd.extra.Every_lastTime = last_time + this_seconds;
            if (cur_time >= cnd.extra.Every_lastTime + 0.04) {
                cnd.extra.Every_lastTime = cur_time;
            }
            cnd.extra.Every_seconds = seconds;
            return true;
        } else if (cur_time < last_time - 0.1) {
            cnd.extra.Every_lastTime = cur_time;
        }
        return false;
    };
    SysCnds.prototype.PickNth = function(obj, index) {
        if (!obj)
            return false;
        var sol = obj.getCurrentSol();
        var instances = sol.getObjects();
        index = cr.floor(index);
        if (index < 0 || index >= instances.length)
            return false;
        var inst = instances[index];
        sol.pick_one(inst);
        obj.applySolToContainer();
        return true;
    };
    SysCnds.prototype.PickRandom = function(obj) {
        if (!obj)
            return false;
        var sol = obj.getCurrentSol();
        var instances = sol.getObjects();
        var index = cr.floor(Math.random() * instances.length);
        if (index >= instances.length)
            return false;
        var inst = instances[index];
        sol.pick_one(inst);
        obj.applySolToContainer();
        return true;
    };
    SysCnds.prototype.CompareVar = function(v, cmp, val) {
        return cr.do_cmp(v.getValue(), cmp, val);
    };
    SysCnds.prototype.IsGroupActive = function(group) {
        var g = this.runtime.groups_by_name[group.toLowerCase()];
        return g && g.group_active;
    };
    SysCnds.prototype.IsPreview = function() {
        return typeof cr_is_preview !== "undefined";
    };
    SysCnds.prototype.PickAll = function(obj) {
        if (!obj)
            return false;
        if (!obj.instances.length)
            return false;
        var sol = obj.getCurrentSol();
        sol.select_all = true;
        obj.applySolToContainer();
        return true;
    };
    SysCnds.prototype.IsMobile = function() {
        return this.runtime.isMobile;
    };
    SysCnds.prototype.CompareBetween = function(x, a, b) {
        return x >= a && x <= b;
    };
    SysCnds.prototype.Else = function() {
        var current_frame = this.runtime.getCurrentEventStack();
        if (current_frame.else_branch_ran)
            return false; // another event in this else-if chain has run
        else
            return !current_frame.last_event_true;
        /*
		var current_frame = this.runtime.getCurrentEventStack();
        var current_event = current_frame.current_event;
		var prev_event = current_event.prev_block;
		if (!prev_event)
			return false;
		if (prev_event.is_logical)
			return !this.runtime.last_event_true;
		var i, len, j, lenj, s, sol, temp, inst, any_picked = false;
		for (i = 0, len = prev_event.cndReferences.length; i < len; i++)
		{
			s = prev_event.cndReferences[i];
			sol = s.getCurrentSol();
			if (sol.select_all || sol.instances.length === s.instances.length)
			{
				sol.select_all = false;
				sol.instances.length = 0;
			}
			else
			{
				if (sol.instances.length === 1 && sol.else_instances.length === 0 && s.instances.length >= 2)
				{
					inst = sol.instances[0];
					sol.instances.length = 0;
					for (j = 0, lenj = s.instances.length; j < lenj; j++)
					{
						if (s.instances[j] != inst)
							sol.instances.push(s.instances[j]);
					}
					any_picked = true;
				}
				else
				{
					temp = sol.instances;
					sol.instances = sol.else_instances;
					sol.else_instances = temp;
					any_picked = true;
				}
			}
		}
		return any_picked;
		*/
    };
    SysCnds.prototype.OnLoadFinished = function() {
        return true;
    };
    SysCnds.prototype.OnCanvasSnapshot = function() {
        return true;
    };
    SysCnds.prototype.EffectsSupported = function() {
        return !!this.runtime.glwrap;
    };
    SysCnds.prototype.OnSaveComplete = function() {
        return true;
    };
    SysCnds.prototype.OnLoadComplete = function() {
        return true;
    };
    SysCnds.prototype.OnLoadFailed = function() {
        return true;
    };
    SysCnds.prototype.ObjectUIDExists = function(u) {
        return !!this.runtime.getObjectByUID(u);
    };
    SysCnds.prototype.IsOnPlatform = function(p) {
        var rt = this.runtime;
        switch (p) {
            case 0: // HTML5 website
                return !rt.isDomFree && !rt.isNodeWebkit && !rt.isPhoneGap && !rt.isCrosswalk && !rt.isWinJS && !rt.isWindowsPhone8 && !rt.isBlackberry10 && !rt.isAmazonWebApp;
            case 1: // iOS
                return rt.isiOS;
            case 2: // Android
                return rt.isAndroid;
            case 3: // Windows 8
                return rt.isWindows8App;
            case 4: // Windows Phone 8
                return rt.isWindowsPhone8;
            case 5: // Blackberry 10
                return rt.isBlackberry10;
            case 6: // Tizen
                return rt.isTizen;
            case 7: // CocoonJS
                return rt.isCocoonJs;
            case 8: // PhoneGap
                return rt.isPhoneGap;
            case 9: // Scirra Arcade
                return rt.isArcade;
            case 10: // node-webkit
                return rt.isNodeWebkit;
            case 11: // crosswalk
                return rt.isCrosswalk;
            case 12: // amazon webapp
                return rt.isAmazonWebApp;
            default: // should not be possible
                return false;
        }
    };
    var cacheRegex = null;
    var lastRegex = "";
    var lastFlags = "";

    function getRegex(regex_, flags_) {
        if (!cacheRegex || regex_ !== lastRegex || flags_ !== lastFlags) {
            cacheRegex = new RegExp(regex_, flags_);
            lastRegex = regex_;
            lastFlags = flags_;
        }
        cacheRegex.lastIndex = 0; // reset
        return cacheRegex;
    };
    SysCnds.prototype.RegexTest = function(str_, regex_, flags_) {
        var regex = getRegex(regex_, flags_);
        return regex.test(str_);
    };
    var tmp_arr = [];
    SysCnds.prototype.PickOverlappingPoint = function(obj_, x_, y_) {
        if (!obj_)
            return false;
        var sol = obj_.getCurrentSol();
        var instances = sol.getObjects();
        var current_event = this.runtime.getCurrentEventStack().current_event;
        var orblock = current_event.orblock;
        var cnd = this.runtime.getCurrentCondition();
        var i, len, inst, pick;
        if (sol.select_all) {
            cr.shallowAssignArray(tmp_arr, instances);
            sol.else_instances.length = 0;
            sol.select_all = false;
            sol.instances.length = 0;
        } else {
            if (orblock) {
                cr.shallowAssignArray(tmp_arr, sol.else_instances);
                sol.else_instances.length = 0;
            } else {
                cr.shallowAssignArray(tmp_arr, instances);
                sol.instances.length = 0;
            }
        }
        for (i = 0, len = tmp_arr.length; i < len; ++i) {
            inst = tmp_arr[i];
            inst.update_bbox();
            pick = cr.xor(inst.contains_pt(x_, y_), cnd.inverted);
            if (pick)
                sol.instances.push(inst);
            else
                sol.else_instances.push(inst);
        }
        obj_.applySolToContainer();
        return cr.xor(!!sol.instances.length, cnd.inverted);
    };
    sysProto.cnds = new SysCnds();

    function SysActs() {};
    SysActs.prototype.GoToLayout = function(to) {
        if (this.runtime.isloading)
            return; // cannot change layout while loading on loader layout
        if (this.runtime.changelayout)
            return; // already changing to a different layout
        ;
        this.runtime.changelayout = to;
    };
    SysActs.prototype.CreateObject = function(obj, layer, x, y) {
        if (!layer || !obj)
            return;
        var inst = this.runtime.createInstance(obj, layer, x, y);
        if (!inst)
            return;
        this.runtime.isInOnDestroy++;
        var i, len, s;
        this.runtime.trigger(Object.getPrototypeOf(obj.plugin).cnds.OnCreated, inst);
        if (inst.is_contained) {
            for (i = 0, len = inst.siblings.length; i < len; i++) {
                s = inst.siblings[i];
                this.runtime.trigger(Object.getPrototypeOf(s.type.plugin).cnds.OnCreated, s);
            }
        }
        this.runtime.isInOnDestroy--;
        var sol = obj.getCurrentSol();
        sol.select_all = false;
        sol.instances.length = 1;
        sol.instances[0] = inst;
        if (inst.is_contained) {
            for (i = 0, len = inst.siblings.length; i < len; i++) {
                s = inst.siblings[i];
                sol = s.type.getCurrentSol();
                sol.select_all = false;
                sol.instances.length = 1;
                sol.instances[0] = s;
            }
        }
    };
    SysActs.prototype.SetLayerVisible = function(layer, visible_) {
        if (!layer)
            return;
        if (layer.visible !== visible_) {
            layer.visible = visible_;
            this.runtime.redraw = true;
        }
    };
    SysActs.prototype.SetLayerOpacity = function(layer, opacity_) {
        if (!layer)
            return;
        opacity_ = cr.clamp(opacity_ / 100, 0, 1);
        if (layer.opacity !== opacity_) {
            layer.opacity = opacity_;
            this.runtime.redraw = true;
        }
    };
    SysActs.prototype.SetLayerScaleRate = function(layer, sr) {
        if (!layer)
            return;
        if (layer.zoomRate !== sr) {
            layer.zoomRate = sr;
            this.runtime.redraw = true;
        }
    };
    SysActs.prototype.SetLayoutScale = function(s) {
        if (!this.runtime.running_layout)
            return;
        if (this.runtime.running_layout.scale !== s) {
            this.runtime.running_layout.scale = s;
            this.runtime.running_layout.boundScrolling();
            this.runtime.redraw = true;
        }
    };
    SysActs.prototype.ScrollX = function(x) {
        this.runtime.running_layout.scrollToX(x);
    };
    SysActs.prototype.ScrollY = function(y) {
        this.runtime.running_layout.scrollToY(y);
    };
    SysActs.prototype.Scroll = function(x, y) {
        this.runtime.running_layout.scrollToX(x);
        this.runtime.running_layout.scrollToY(y);
    };
    SysActs.prototype.ScrollToObject = function(obj) {
        var inst = obj.getFirstPicked();
        if (inst) {
            this.runtime.running_layout.scrollToX(inst.x);
            this.runtime.running_layout.scrollToY(inst.y);
        }
    };
    SysActs.prototype.SetVar = function(v, x) {;
        if (v.vartype === 0) {
            if (cr.is_number(x))
                v.setValue(x);
            else
                v.setValue(parseFloat(x));
        } else if (v.vartype === 1)
            v.setValue(x.toString());
    };
    SysActs.prototype.AddVar = function(v, x) {;
        if (v.vartype === 0) {
            if (cr.is_number(x))
                v.setValue(v.getValue() + x);
            else
                v.setValue(v.getValue() + parseFloat(x));
        } else if (v.vartype === 1)
            v.setValue(v.getValue() + x.toString());
    };
    SysActs.prototype.SubVar = function(v, x) {;
        if (v.vartype === 0) {
            if (cr.is_number(x))
                v.setValue(v.getValue() - x);
            else
                v.setValue(v.getValue() - parseFloat(x));
        }
    };
    SysActs.prototype.SetGroupActive = function(group, active) {
        var g = this.runtime.groups_by_name[group.toLowerCase()];
        if (!g)
            return;
        switch (active) {
            case 0:
                g.setGroupActive(false);
                break;
            case 1:
                g.setGroupActive(true);
                break;
            case 2:
                g.setGroupActive(!g.group_active);
                break;
        }
    };
    SysActs.prototype.SetTimescale = function(ts_) {
        var ts = ts_;
        if (ts < 0)
            ts = 0;
        this.runtime.timescale = ts;
    };
    SysActs.prototype.SetObjectTimescale = function(obj, ts_) {
        var ts = ts_;
        if (ts < 0)
            ts = 0;
        if (!obj)
            return;
        var sol = obj.getCurrentSol();
        var instances = sol.getObjects();
        var i, len;
        for (i = 0, len = instances.length; i < len; i++) {
            instances[i].my_timescale = ts;
        }
    };
    SysActs.prototype.RestoreObjectTimescale = function(obj) {
        if (!obj)
            return false;
        var sol = obj.getCurrentSol();
        var instances = sol.getObjects();
        var i, len;
        for (i = 0, len = instances.length; i < len; i++) {
            instances[i].my_timescale = -1.0;
        }
    };
    var waitobjrecycle = [];

    function allocWaitObject() {
        var w;
        if (waitobjrecycle.length)
            w = waitobjrecycle.pop();
        else {
            w = {};
            w.sols = {};
            w.solModifiers = [];
        }
        w.deleteme = false;
        return w;
    };

    function freeWaitObject(w) {
        cr.wipe(w.sols);
        w.solModifiers.length = 0;
        waitobjrecycle.push(w);
    };
    var solstateobjects = [];

    function allocSolStateObject() {
        var s;
        if (solstateobjects.length)
            s = solstateobjects.pop();
        else {
            s = {};
            s.insts = [];
        }
        s.sa = false;
        return s;
    };

    function freeSolStateObject(s) {
        s.insts.length = 0;
        solstateobjects.push(s);
    };
    SysActs.prototype.Wait = function(seconds) {
        if (seconds < 0)
            return;
        var i, len, s, t, ss;
        var evinfo = this.runtime.getCurrentEventStack();
        var waitobj = allocWaitObject();
        waitobj.time = this.runtime.kahanTime.sum + seconds;
        waitobj.ev = evinfo.current_event;
        waitobj.actindex = evinfo.actindex + 1; // pointing at next action
        for (i = 0, len = this.runtime.types_by_index.length; i < len; i++) {
            t = this.runtime.types_by_index[i];
            s = t.getCurrentSol();
            if (s.select_all && evinfo.current_event.solModifiers.indexOf(t) === -1)
                continue;
            waitobj.solModifiers.push(t);
            ss = allocSolStateObject();
            ss.sa = s.select_all;
            cr.shallowAssignArray(ss.insts, s.instances);
            waitobj.sols[i.toString()] = ss;
        }
        this.waits.push(waitobj);
        return true;
    };
    SysActs.prototype.SetLayerScale = function(layer, scale) {
        if (!layer)
            return;
        if (layer.scale === scale)
            return;
        layer.scale = scale;
        this.runtime.redraw = true;
    };
    SysActs.prototype.ResetGlobals = function() {
        var i, len, g;
        for (i = 0, len = this.runtime.all_global_vars.length; i < len; i++) {
            g = this.runtime.all_global_vars[i];
            g.data = g.initial;
        }
    };
    SysActs.prototype.SetLayoutAngle = function(a) {
        a = cr.to_radians(a);
        a = cr.clamp_angle(a);
        if (this.runtime.running_layout) {
            if (this.runtime.running_layout.angle !== a) {
                this.runtime.running_layout.angle = a;
                this.runtime.redraw = true;
            }
        }
    };
    SysActs.prototype.SetLayerAngle = function(layer, a) {
        if (!layer)
            return;
        a = cr.to_radians(a);
        a = cr.clamp_angle(a);
        if (layer.angle === a)
            return;
        layer.angle = a;
        this.runtime.redraw = true;
    };
    SysActs.prototype.SetLayerParallax = function(layer, px, py) {
        if (!layer)
            return;
        if (layer.parallaxX === px / 100 && layer.parallaxY === py / 100)
            return;
        layer.parallaxX = px / 100;
        layer.parallaxY = py / 100;
        if (layer.parallaxX !== 1 || layer.parallaxY !== 1) {
            var i, len, instances = layer.instances;
            for (i = 0, len = instances.length; i < len; ++i) {
                instances[i].type.any_instance_parallaxed = true;
            }
        }
        this.runtime.redraw = true;
    };
    SysActs.prototype.SetLayerBackground = function(layer, c) {
        if (!layer)
            return;
        var r = cr.GetRValue(c);
        var g = cr.GetGValue(c);
        var b = cr.GetBValue(c);
        if (layer.background_color[0] === r && layer.background_color[1] === g && layer.background_color[2] === b)
            return;
        layer.background_color[0] = r;
        layer.background_color[1] = g;
        layer.background_color[2] = b;
        this.runtime.redraw = true;
    };
    SysActs.prototype.SetLayerTransparent = function(layer, t) {
        if (!layer)
            return;
        if (!!t === !!layer.transparent)
            return;
        layer.transparent = !!t;
        this.runtime.redraw = true;
    };
    SysActs.prototype.StopLoop = function() {
        if (this.runtime.loop_stack_index < 0)
            return; // no loop currently running
        this.runtime.getCurrentLoop().stopped = true;
    };
    SysActs.prototype.GoToLayoutByName = function(layoutname) {
        if (this.runtime.isloading)
            return; // cannot change layout while loading on loader layout
        if (this.runtime.changelayout)
            return; // already changing to different layout
        ;
        var l;
        for (l in this.runtime.layouts) {
            if (this.runtime.layouts.hasOwnProperty(l) && cr.equals_nocase(l, layoutname)) {
                this.runtime.changelayout = this.runtime.layouts[l];
                return;
            }
        }
    };
    SysActs.prototype.RestartLayout = function(layoutname) {
        if (this.runtime.isloading)
            return; // cannot restart loader layouts
        if (this.runtime.changelayout)
            return; // already changing to a different layout
        ;
        if (!this.runtime.running_layout)
            return;
        this.runtime.changelayout = this.runtime.running_layout;
        var i, len, g;
        for (i = 0, len = this.runtime.allGroups.length; i < len; i++) {
            g = this.runtime.allGroups[i];
            g.setGroupActive(g.initially_activated);
        }
    };
    SysActs.prototype.SnapshotCanvas = function(format_, quality_) {
        this.runtime.snapshotCanvas = [format_ === 0 ? "image/png" : "image/jpeg", quality_ / 100];
        this.runtime.redraw = true; // force redraw so snapshot is always taken
    };
    SysActs.prototype.SetCanvasSize = function(w, h) {
        if (w <= 0 || h <= 0)
            return;
        var mode = this.runtime.fullscreen_mode;
        var isfullscreen = (document["mozFullScreen"] || document["webkitIsFullScreen"] || !!document["msFullscreenElement"] || document["fullScreen"] || this.runtime.isNodeFullscreen);
        if (isfullscreen && this.runtime.fullscreen_scaling > 0)
            mode = this.runtime.fullscreen_scaling;
        if (mode === 0) {
            this.runtime["setSize"](w, h, true);
        } else {
            this.runtime.original_width = w;
            this.runtime.original_height = h;
            this.runtime["setSize"](this.runtime.lastWindowWidth, this.runtime.lastWindowHeight, true);
        }
    };
    SysActs.prototype.SetLayoutEffectEnabled = function(enable_, effectname_) {
        if (!this.runtime.running_layout || !this.runtime.glwrap)
            return;
        var et = this.runtime.running_layout.getEffectByName(effectname_);
        if (!et)
            return; // effect name not found
        var enable = (enable_ === 1);
        if (et.active == enable)
            return; // no change
        et.active = enable;
        this.runtime.running_layout.updateActiveEffects();
        this.runtime.redraw = true;
    };
    SysActs.prototype.SetLayerEffectEnabled = function(layer, enable_, effectname_) {
        if (!layer || !this.runtime.glwrap)
            return;
        var et = layer.getEffectByName(effectname_);
        if (!et)
            return; // effect name not found
        var enable = (enable_ === 1);
        if (et.active == enable)
            return; // no change
        et.active = enable;
        layer.updateActiveEffects();
        this.runtime.redraw = true;
    };
    SysActs.prototype.SetLayoutEffectParam = function(effectname_, index_, value_) {
        if (!this.runtime.running_layout || !this.runtime.glwrap)
            return;
        var et = this.runtime.running_layout.getEffectByName(effectname_);
        if (!et)
            return; // effect name not found
        var params = this.runtime.running_layout.effect_params[et.index];
        index_ = Math.floor(index_);
        if (index_ < 0 || index_ >= params.length)
            return; // effect index out of bounds
        if (this.runtime.glwrap.getProgramParameterType(et.shaderindex, index_) === 1)
            value_ /= 100.0;
        if (params[index_] === value_)
            return; // no change
        params[index_] = value_;
        if (et.active)
            this.runtime.redraw = true;
    };
    SysActs.prototype.SetLayerEffectParam = function(layer, effectname_, index_, value_) {
        if (!layer || !this.runtime.glwrap)
            return;
        var et = layer.getEffectByName(effectname_);
        if (!et)
            return; // effect name not found
        var params = layer.effect_params[et.index];
        index_ = Math.floor(index_);
        if (index_ < 0 || index_ >= params.length)
            return; // effect index out of bounds
        if (this.runtime.glwrap.getProgramParameterType(et.shaderindex, index_) === 1)
            value_ /= 100.0;
        if (params[index_] === value_)
            return; // no change
        params[index_] = value_;
        if (et.active)
            this.runtime.redraw = true;
    };
    SysActs.prototype.SaveState = function(slot_) {
        this.runtime.saveToSlot = slot_;
    };
    SysActs.prototype.LoadState = function(slot_) {
        this.runtime.loadFromSlot = slot_;
    };
    SysActs.prototype.LoadStateJSON = function(jsonstr_) {
        this.runtime.loadFromJson = jsonstr_;
    };
    SysActs.prototype.SetHalfFramerateMode = function(set_) {
        this.runtime.halfFramerateMode = (set_ !== 0);
    };
    SysActs.prototype.SetFullscreenQuality = function(q) {
        var isfullscreen = (document["mozFullScreen"] || document["webkitIsFullScreen"] || !!document["msFullscreenElement"] || document["fullScreen"] || this.isNodeFullscreen);
        if (!isfullscreen && this.runtime.fullscreen_mode === 0)
            return;
        this.runtime.wantFullscreenScalingQuality = (q !== 0);
        this.runtime["setSize"](this.runtime.lastWindowWidth, this.runtime.lastWindowHeight, true);
    };
    sysProto.acts = new SysActs();

    function SysExps() {};
    SysExps.prototype["int"] = function(ret, x) {
        if (cr.is_string(x)) {
            ret.set_int(parseInt(x, 10));
            if (isNaN(ret.data))
                ret.data = 0;
        } else
            ret.set_int(x);
    };
    SysExps.prototype["float"] = function(ret, x) {
        if (cr.is_string(x)) {
            ret.set_float(parseFloat(x));
            if (isNaN(ret.data))
                ret.data = 0;
        } else
            ret.set_float(x);
    };
    SysExps.prototype.str = function(ret, x) {
        if (cr.is_string(x))
            ret.set_string(x);
        else
            ret.set_string(x.toString());
    };
    SysExps.prototype.len = function(ret, x) {
        ret.set_int(x.length || 0);
    };
    SysExps.prototype.random = function(ret, a, b) {
        if (b === undefined) {
            ret.set_float(Math.random() * a);
        } else {
            ret.set_float(Math.random() * (b - a) + a);
        }
    };
    SysExps.prototype.sqrt = function(ret, x) {
        ret.set_float(Math.sqrt(x));
    };
    SysExps.prototype.abs = function(ret, x) {
        ret.set_float(Math.abs(x));
    };
    SysExps.prototype.round = function(ret, x) {
        ret.set_int(Math.round(x));
    };
    SysExps.prototype.floor = function(ret, x) {
        ret.set_int(Math.floor(x));
    };
    SysExps.prototype.ceil = function(ret, x) {
        ret.set_int(Math.ceil(x));
    };
    SysExps.prototype.sin = function(ret, x) {
        ret.set_float(Math.sin(cr.to_radians(x)));
    };
    SysExps.prototype.cos = function(ret, x) {
        ret.set_float(Math.cos(cr.to_radians(x)));
    };
    SysExps.prototype.tan = function(ret, x) {
        ret.set_float(Math.tan(cr.to_radians(x)));
    };
    SysExps.prototype.asin = function(ret, x) {
        ret.set_float(cr.to_degrees(Math.asin(x)));
    };
    SysExps.prototype.acos = function(ret, x) {
        ret.set_float(cr.to_degrees(Math.acos(x)));
    };
    SysExps.prototype.atan = function(ret, x) {
        ret.set_float(cr.to_degrees(Math.atan(x)));
    };
    SysExps.prototype.exp = function(ret, x) {
        ret.set_float(Math.exp(x));
    };
    SysExps.prototype.ln = function(ret, x) {
        ret.set_float(Math.log(x));
    };
    SysExps.prototype.log10 = function(ret, x) {
        ret.set_float(Math.log(x) / Math.LN10);
    };
    SysExps.prototype.max = function(ret) {
        var max_ = arguments[1];
        var i, len;
        for (i = 2, len = arguments.length; i < len; i++) {
            if (max_ < arguments[i])
                max_ = arguments[i];
        }
        ret.set_float(max_);
    };
    SysExps.prototype.min = function(ret) {
        var min_ = arguments[1];
        var i, len;
        for (i = 2, len = arguments.length; i < len; i++) {
            if (min_ > arguments[i])
                min_ = arguments[i];
        }
        ret.set_float(min_);
    };
    SysExps.prototype.dt = function(ret) {
        ret.set_float(this.runtime.dt);
    };
    SysExps.prototype.timescale = function(ret) {
        ret.set_float(this.runtime.timescale);
    };
    SysExps.prototype.wallclocktime = function(ret) {
        ret.set_float((Date.now() - this.runtime.start_time) / 1000.0);
    };
    SysExps.prototype.time = function(ret) {
        ret.set_float(this.runtime.kahanTime.sum);
    };
    SysExps.prototype.tickcount = function(ret) {
        ret.set_int(this.runtime.tickcount);
    };
    SysExps.prototype.objectcount = function(ret) {
        ret.set_int(this.runtime.objectcount);
    };
    SysExps.prototype.fps = function(ret) {
        ret.set_int(this.runtime.fps);
    };
    SysExps.prototype.loopindex = function(ret, name_) {
        var loop, i, len;
        if (!this.runtime.loop_stack.length) {
            ret.set_int(0);
            return;
        }
        if (name_) {
            for (i = 0, len = this.runtime.loop_stack.length; i < len; i++) {
                loop = this.runtime.loop_stack[i];
                if (loop.name === name_) {
                    ret.set_int(loop.index);
                    return;
                }
            }
            ret.set_int(0);
        } else {
            loop = this.runtime.getCurrentLoop();
            ret.set_int(loop ? loop.index : -1);
        }
    };
    SysExps.prototype.distance = function(ret, x1, y1, x2, y2) {
        ret.set_float(cr.distanceTo(x1, y1, x2, y2));
    };
    SysExps.prototype.angle = function(ret, x1, y1, x2, y2) {
        ret.set_float(cr.to_degrees(cr.angleTo(x1, y1, x2, y2)));
    };
    SysExps.prototype.scrollx = function(ret) {
        ret.set_float(this.runtime.running_layout.scrollX);
    };
    SysExps.prototype.scrolly = function(ret) {
        ret.set_float(this.runtime.running_layout.scrollY);
    };
    SysExps.prototype.newline = function(ret) {
        ret.set_string("\n");
    };
    SysExps.prototype.lerp = function(ret, a, b, x) {
        ret.set_float(cr.lerp(a, b, x));
    };
    SysExps.prototype.qarp = function(ret, a, b, c, x) {
        ret.set_float(cr.qarp(a, b, c, x));
    };
    SysExps.prototype.cubic = function(ret, a, b, c, d, x) {
        ret.set_float(cr.cubic(a, b, c, d, x));
    };
    SysExps.prototype.cosp = function(ret, a, b, x) {
        ret.set_float(cr.cosp(a, b, x));
    };
    SysExps.prototype.windowwidth = function(ret) {
        ret.set_int(this.runtime.width);
    };
    SysExps.prototype.windowheight = function(ret) {
        ret.set_int(this.runtime.height);
    };
    SysExps.prototype.uppercase = function(ret, str) {
        ret.set_string(cr.is_string(str) ? str.toUpperCase() : "");
    };
    SysExps.prototype.lowercase = function(ret, str) {
        ret.set_string(cr.is_string(str) ? str.toLowerCase() : "");
    };
    SysExps.prototype.clamp = function(ret, x, l, u) {
        if (x < l)
            ret.set_float(l);
        else if (x > u)
            ret.set_float(u);
        else
            ret.set_float(x);
    };
    SysExps.prototype.layerscale = function(ret, layerparam) {
        var layer = this.runtime.getLayer(layerparam);
        if (!layer)
            ret.set_float(0);
        else
            ret.set_float(layer.scale);
    };
    SysExps.prototype.layeropacity = function(ret, layerparam) {
        var layer = this.runtime.getLayer(layerparam);
        if (!layer)
            ret.set_float(0);
        else
            ret.set_float(layer.opacity * 100);
    };
    SysExps.prototype.layerscalerate = function(ret, layerparam) {
        var layer = this.runtime.getLayer(layerparam);
        if (!layer)
            ret.set_float(0);
        else
            ret.set_float(layer.zoomRate);
    };
    SysExps.prototype.layerparallaxx = function(ret, layerparam) {
        var layer = this.runtime.getLayer(layerparam);
        if (!layer)
            ret.set_float(0);
        else
            ret.set_float(layer.parallaxX * 100);
    };
    SysExps.prototype.layerparallaxy = function(ret, layerparam) {
        var layer = this.runtime.getLayer(layerparam);
        if (!layer)
            ret.set_float(0);
        else
            ret.set_float(layer.parallaxY * 100);
    };
    SysExps.prototype.layoutscale = function(ret) {
        if (this.runtime.running_layout)
            ret.set_float(this.runtime.running_layout.scale);
        else
            ret.set_float(0);
    };
    SysExps.prototype.layoutangle = function(ret) {
        ret.set_float(cr.to_degrees(this.runtime.running_layout.angle));
    };
    SysExps.prototype.layerangle = function(ret, layerparam) {
        var layer = this.runtime.getLayer(layerparam);
        if (!layer)
            ret.set_float(0);
        else
            ret.set_float(cr.to_degrees(layer.angle));
    };
    SysExps.prototype.layoutwidth = function(ret) {
        ret.set_int(this.runtime.running_layout.width);
    };
    SysExps.prototype.layoutheight = function(ret) {
        ret.set_int(this.runtime.running_layout.height);
    };
    SysExps.prototype.find = function(ret, text, searchstr) {
        if (cr.is_string(text) && cr.is_string(searchstr))
            ret.set_int(text.search(new RegExp(cr.regexp_escape(searchstr), "i")));
        else
            ret.set_int(-1);
    };
    SysExps.prototype.left = function(ret, text, n) {
        ret.set_string(cr.is_string(text) ? text.substr(0, n) : "");
    };
    SysExps.prototype.right = function(ret, text, n) {
        ret.set_string(cr.is_string(text) ? text.substr(text.length - n) : "");
    };
    SysExps.prototype.mid = function(ret, text, index_, length_) {
        ret.set_string(cr.is_string(text) ? text.substr(index_, length_) : "");
    };
    SysExps.prototype.tokenat = function(ret, text, index_, sep) {
        if (cr.is_string(text) && cr.is_string(sep)) {
            var arr = text.split(sep);
            var i = cr.floor(index_);
            if (i < 0 || i >= arr.length)
                ret.set_string("");
            else
                ret.set_string(arr[i]);
        } else
            ret.set_string("");
    };
    SysExps.prototype.tokencount = function(ret, text, sep) {
        if (cr.is_string(text) && text.length)
            ret.set_int(text.split(sep).length);
        else
            ret.set_int(0);
    };
    SysExps.prototype.replace = function(ret, text, find_, replace_) {
        if (cr.is_string(text) && cr.is_string(find_) && cr.is_string(replace_))
            ret.set_string(text.replace(new RegExp(cr.regexp_escape(find_), "gi"), replace_));
        else
            ret.set_string(cr.is_string(text) ? text : "");
    };
    SysExps.prototype.trim = function(ret, text) {
        ret.set_string(cr.is_string(text) ? text.trim() : "");
    };
    SysExps.prototype.pi = function(ret) {
        ret.set_float(cr.PI);
    };
    SysExps.prototype.layoutname = function(ret) {
        if (this.runtime.running_layout)
            ret.set_string(this.runtime.running_layout.name);
        else
            ret.set_string("");
    };
    SysExps.prototype.renderer = function(ret) {
        ret.set_string(this.runtime.gl ? "webgl" : "canvas2d");
    };
    SysExps.prototype.anglediff = function(ret, a, b) {
        ret.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(a), cr.to_radians(b))));
    };
    SysExps.prototype.choose = function(ret) {
        var index = cr.floor(Math.random() * (arguments.length - 1));
        ret.set_any(arguments[index + 1]);
    };
    SysExps.prototype.rgb = function(ret, r, g, b) {
        ret.set_int(cr.RGB(r, g, b));
    };
    SysExps.prototype.projectversion = function(ret) {
        ret.set_string(this.runtime.versionstr);
    };
    SysExps.prototype.anglelerp = function(ret, a, b, x) {
        a = cr.to_radians(a);
        b = cr.to_radians(b);
        var diff = cr.angleDiff(a, b);
        if (cr.angleClockwise(b, a)) {
            ret.set_float(cr.to_clamped_degrees(a + diff * x));
        } else {
            ret.set_float(cr.to_clamped_degrees(a - diff * x));
        }
    };
    SysExps.prototype.anglerotate = function(ret, a, b, c) {
        a = cr.to_radians(a);
        b = cr.to_radians(b);
        c = cr.to_radians(c);
        ret.set_float(cr.to_clamped_degrees(cr.angleRotate(a, b, c)));
    };
    SysExps.prototype.zeropad = function(ret, n, d) {
        var s = (n < 0 ? "-" : "");
        if (n < 0) n = -n;
        var zeroes = d - n.toString().length;
        for (var i = 0; i < zeroes; i++)
            s += "0";
        ret.set_string(s + n.toString());
    };
    SysExps.prototype.cpuutilisation = function(ret) {
        ret.set_float(this.runtime.cpuutilisation / 1000);
    };
    SysExps.prototype.viewportleft = function(ret, layerparam) {
        var layer = this.runtime.getLayer(layerparam);
        ret.set_float(layer ? layer.viewLeft : 0);
    };
    SysExps.prototype.viewporttop = function(ret, layerparam) {
        var layer = this.runtime.getLayer(layerparam);
        ret.set_float(layer ? layer.viewTop : 0);
    };
    SysExps.prototype.viewportright = function(ret, layerparam) {
        var layer = this.runtime.getLayer(layerparam);
        ret.set_float(layer ? layer.viewRight : 0);
    };
    SysExps.prototype.viewportbottom = function(ret, layerparam) {
        var layer = this.runtime.getLayer(layerparam);
        ret.set_float(layer ? layer.viewBottom : 0);
    };
    SysExps.prototype.loadingprogress = function(ret) {
        ret.set_float(this.runtime.loadingprogress);
    };
    SysExps.prototype.unlerp = function(ret, a, b, y) {
        ret.set_float(cr.unlerp(a, b, y));
    };
    SysExps.prototype.canvassnapshot = function(ret) {
        ret.set_string(this.runtime.snapshotData);
    };
    SysExps.prototype.urlencode = function(ret, s) {
        ret.set_string(encodeURIComponent(s));
    };
    SysExps.prototype.urldecode = function(ret, s) {
        ret.set_string(decodeURIComponent(s));
    };
    SysExps.prototype.canvastolayerx = function(ret, layerparam, x, y) {
        var layer = this.runtime.getLayer(layerparam);
        ret.set_float(layer ? layer.canvasToLayer(x, y, true) : 0);
    };
    SysExps.prototype.canvastolayery = function(ret, layerparam, x, y) {
        var layer = this.runtime.getLayer(layerparam);
        ret.set_float(layer ? layer.canvasToLayer(x, y, false) : 0);
    };
    SysExps.prototype.layertocanvasx = function(ret, layerparam, x, y) {
        var layer = this.runtime.getLayer(layerparam);
        ret.set_float(layer ? layer.layerToCanvas(x, y, true) : 0);
    };
    SysExps.prototype.layertocanvasy = function(ret, layerparam, x, y) {
        var layer = this.runtime.getLayer(layerparam);
        ret.set_float(layer ? layer.layerToCanvas(x, y, false) : 0);
    };
    SysExps.prototype.savestatejson = function(ret) {
        ret.set_string(this.runtime.lastSaveJson);
    };
    SysExps.prototype.imagememoryusage = function(ret) {
        if (this.runtime.glwrap)
            ret.set_float(Math.round(100 * this.runtime.glwrap.estimateVRAM() / (1024 * 1024)) / 100);
        else
            ret.set_float(0);
    };
    SysExps.prototype.regexsearch = function(ret, str_, regex_, flags_) {
        var regex = getRegex(regex_, flags_);
        ret.set_int(str_ ? str_.search(regex) : -1);
    };
    SysExps.prototype.regexreplace = function(ret, str_, regex_, flags_, replace_) {
        var regex = getRegex(regex_, flags_);
        ret.set_string(str_ ? str_.replace(regex, replace_) : "");
    };
    var regexMatches = [];
    var lastMatchesStr = "";
    var lastMatchesRegex = "";
    var lastMatchesFlags = "";

    function updateRegexMatches(str_, regex_, flags_) {
        if (str_ === lastMatchesStr && regex_ === lastMatchesRegex && flags_ === lastMatchesFlags)
            return;
        var regex = getRegex(regex_, flags_);
        regexMatches = str_.match(regex);
        lastMatchesStr = str_;
        lastMatchesRegex = regex_;
        lastMatchesFlags = flags_;
    };
    SysExps.prototype.regexmatchcount = function(ret, str_, regex_, flags_) {
        var regex = getRegex(regex_, flags_);
        updateRegexMatches(str_, regex_, flags_);
        ret.set_int(regexMatches ? regexMatches.length : 0);
    };
    SysExps.prototype.regexmatchat = function(ret, str_, regex_, flags_, index_) {
        index_ = Math.floor(index_);
        var regex = getRegex(regex_, flags_);
        updateRegexMatches(str_, regex_, flags_);
        if (!regexMatches || index_ < 0 || index_ >= regexMatches.length)
            ret.set_string("");
        else
            ret.set_string(regexMatches[index_]);
    };
    SysExps.prototype.infinity = function(ret) {
        ret.set_float(Infinity);
    };
    SysExps.prototype.setbit = function(ret, n, b, v) {
        n = n | 0;
        b = b | 0;
        v = (v !== 0 ? 1 : 0);
        ret.set_int((n & ~(1 << b)) | (v << b));
    };
    SysExps.prototype.togglebit = function(ret, n, b) {
        n = n | 0;
        b = b | 0;
        ret.set_int(n ^ (1 << b));
    };
    SysExps.prototype.getbit = function(ret, n, b) {
        n = n | 0;
        b = b | 0;
        ret.set_int((n & (1 << b)) ? 1 : 0);
    };
    sysProto.exps = new SysExps();
    sysProto.runWaits = function() {
        var i, j, len, w, k, s, ss;
        var evinfo = this.runtime.getCurrentEventStack();
        for (i = 0, len = this.waits.length; i < len; i++) {
            w = this.waits[i];
            if (w.time > this.runtime.kahanTime.sum)
                continue;
            evinfo.current_event = w.ev;
            evinfo.actindex = w.actindex;
            evinfo.cndindex = 0;
            for (k in w.sols) {
                if (w.sols.hasOwnProperty(k)) {
                    s = this.runtime.types_by_index[parseInt(k, 10)].getCurrentSol();
                    ss = w.sols[k];
                    s.select_all = ss.sa;
                    cr.shallowAssignArray(s.instances, ss.insts);
                    freeSolStateObject(ss);
                }
            }
            w.ev.resume_actions_and_subevents();
            this.runtime.clearSol(w.solModifiers);
            w.deleteme = true;
        }
        for (i = 0, j = 0, len = this.waits.length; i < len; i++) {
            w = this.waits[i];
            this.waits[j] = w;
            if (w.deleteme)
                freeWaitObject(w);
            else
                j++;
        }
        this.waits.length = j;
    };
}());;
(function() {
    cr.add_common_aces = function(m) {
        var pluginProto = m[0].prototype;
        var singleglobal_ = m[1];
        var position_aces = m[3];
        var size_aces = m[4];
        var angle_aces = m[5];
        var appearance_aces = m[6];
        var zorder_aces = m[7];
        var effects_aces = m[8];
        if (!pluginProto.cnds)
            pluginProto.cnds = {};
        if (!pluginProto.acts)
            pluginProto.acts = {};
        if (!pluginProto.exps)
            pluginProto.exps = {};
        var cnds = pluginProto.cnds;
        var acts = pluginProto.acts;
        var exps = pluginProto.exps;
        if (position_aces) {
            cnds.CompareX = function(cmp, x) {
                return cr.do_cmp(this.x, cmp, x);
            };
            cnds.CompareY = function(cmp, y) {
                return cr.do_cmp(this.y, cmp, y);
            };
            cnds.IsOnScreen = function() {
                var layer = this.layer;
                this.update_bbox();
                var bbox = this.bbox;
                return !(bbox.right < layer.viewLeft || bbox.bottom < layer.viewTop || bbox.left > layer.viewRight || bbox.top > layer.viewBottom);
            };
            cnds.IsOutsideLayout = function() {
                this.update_bbox();
                var bbox = this.bbox;
                var layout = this.runtime.running_layout;
                return (bbox.right < 0 || bbox.bottom < 0 || bbox.left > layout.width || bbox.top > layout.height);
            };
            cnds.PickDistance = function(which, x, y) {
                var sol = this.getCurrentSol();
                var instances = sol.getObjects();
                if (!instances.length)
                    return false;
                var inst = instances[0];
                var pickme = inst;
                var dist = cr.distanceTo(inst.x, inst.y, x, y);
                var i, len, d;
                for (i = 1, len = instances.length; i < len; i++) {
                    inst = instances[i];
                    d = cr.distanceTo(inst.x, inst.y, x, y);
                    if ((which === 0 && d < dist) || (which === 1 && d > dist)) {
                        dist = d;
                        pickme = inst;
                    }
                }
                sol.pick_one(pickme);
                return true;
            };
            acts.SetX = function(x) {
                if (this.x !== x) {
                    this.x = x;
                    this.set_bbox_changed();
                }
            };
            acts.SetY = function(y) {
                if (this.y !== y) {
                    this.y = y;
                    this.set_bbox_changed();
                }
            };
            acts.SetPos = function(x, y) {
                if (this.x !== x || this.y !== y) {
                    this.x = x;
                    this.y = y;
                    this.set_bbox_changed();
                }
            };
            acts.SetPosToObject = function(obj, imgpt) {
                var inst = obj.getPairedInstance(this);
                if (!inst)
                    return;
                var newx, newy;
                if (inst.getImagePoint) {
                    newx = inst.getImagePoint(imgpt, true);
                    newy = inst.getImagePoint(imgpt, false);
                } else {
                    newx = inst.x;
                    newy = inst.y;
                }
                if (this.x !== newx || this.y !== newy) {
                    this.x = newx;
                    this.y = newy;
                    this.set_bbox_changed();
                }
            };
            acts.MoveForward = function(dist) {
                if (dist !== 0) {
                    this.x += Math.cos(this.angle) * dist;
                    this.y += Math.sin(this.angle) * dist;
                    this.set_bbox_changed();
                }
            };
            acts.MoveAtAngle = function(a, dist) {
                if (dist !== 0) {
                    this.x += Math.cos(cr.to_radians(a)) * dist;
                    this.y += Math.sin(cr.to_radians(a)) * dist;
                    this.set_bbox_changed();
                }
            };
            exps.X = function(ret) {
                ret.set_float(this.x);
            };
            exps.Y = function(ret) {
                ret.set_float(this.y);
            };
            exps.dt = function(ret) {
                ret.set_float(this.runtime.getDt(this));
            };
        }
        if (size_aces) {
            cnds.CompareWidth = function(cmp, w) {
                return cr.do_cmp(this.width, cmp, w);
            };
            cnds.CompareHeight = function(cmp, h) {
                return cr.do_cmp(this.height, cmp, h);
            };
            acts.SetWidth = function(w) {
                if (this.width !== w) {
                    this.width = w;
                    this.set_bbox_changed();
                }
            };
            acts.SetHeight = function(h) {
                if (this.height !== h) {
                    this.height = h;
                    this.set_bbox_changed();
                }
            };
            acts.SetSize = function(w, h) {
                if (this.width !== w || this.height !== h) {
                    this.width = w;
                    this.height = h;
                    this.set_bbox_changed();
                }
            };
            exps.Width = function(ret) {
                ret.set_float(this.width);
            };
            exps.Height = function(ret) {
                ret.set_float(this.height);
            };
            exps.BBoxLeft = function(ret) {
                this.update_bbox();
                ret.set_float(this.bbox.left);
            };
            exps.BBoxTop = function(ret) {
                this.update_bbox();
                ret.set_float(this.bbox.top);
            };
            exps.BBoxRight = function(ret) {
                this.update_bbox();
                ret.set_float(this.bbox.right);
            };
            exps.BBoxBottom = function(ret) {
                this.update_bbox();
                ret.set_float(this.bbox.bottom);
            };
        }
        if (angle_aces) {
            cnds.AngleWithin = function(within, a) {
                return cr.angleDiff(this.angle, cr.to_radians(a)) <= cr.to_radians(within);
            };
            cnds.IsClockwiseFrom = function(a) {
                return cr.angleClockwise(this.angle, cr.to_radians(a));
            };
            cnds.IsBetweenAngles = function(a, b) {
                var lower = cr.to_clamped_radians(a);
                var upper = cr.to_clamped_radians(b);
                var angle = cr.clamp_angle(this.angle);
                var obtuse = (!cr.angleClockwise(upper, lower));
                if (obtuse)
                    return !(!cr.angleClockwise(angle, lower) && cr.angleClockwise(angle, upper));
                else
                    return cr.angleClockwise(angle, lower) && !cr.angleClockwise(angle, upper);
            };
            acts.SetAngle = function(a) {
                var newangle = cr.to_radians(cr.clamp_angle_degrees(a));
                if (isNaN(newangle))
                    return;
                if (this.angle !== newangle) {
                    this.angle = newangle;
                    this.set_bbox_changed();
                }
            };
            acts.RotateClockwise = function(a) {
                if (a !== 0 && !isNaN(a)) {
                    this.angle += cr.to_radians(a);
                    this.angle = cr.clamp_angle(this.angle);
                    this.set_bbox_changed();
                }
            };
            acts.RotateCounterclockwise = function(a) {
                if (a !== 0 && !isNaN(a)) {
                    this.angle -= cr.to_radians(a);
                    this.angle = cr.clamp_angle(this.angle);
                    this.set_bbox_changed();
                }
            };
            acts.RotateTowardAngle = function(amt, target) {
                var newangle = cr.angleRotate(this.angle, cr.to_radians(target), cr.to_radians(amt));
                if (isNaN(newangle))
                    return;
                if (this.angle !== newangle) {
                    this.angle = newangle;
                    this.set_bbox_changed();
                }
            };
            acts.RotateTowardPosition = function(amt, x, y) {
                var dx = x - this.x;
                var dy = y - this.y;
                var target = Math.atan2(dy, dx);
                var newangle = cr.angleRotate(this.angle, target, cr.to_radians(amt));
                if (isNaN(newangle))
                    return;
                if (this.angle !== newangle) {
                    this.angle = newangle;
                    this.set_bbox_changed();
                }
            };
            acts.SetTowardPosition = function(x, y) {
                var dx = x - this.x;
                var dy = y - this.y;
                var newangle = Math.atan2(dy, dx);
                if (isNaN(newangle))
                    return;
                if (this.angle !== newangle) {
                    this.angle = newangle;
                    this.set_bbox_changed();
                }
            };
            exps.Angle = function(ret) {
                ret.set_float(cr.to_clamped_degrees(this.angle));
            };
        }
        if (!singleglobal_) {
            cnds.CompareInstanceVar = function(iv, cmp, val) {
                return cr.do_cmp(this.instance_vars[iv], cmp, val);
            };
            cnds.IsBoolInstanceVarSet = function(iv) {
                return this.instance_vars[iv];
            };
            cnds.PickInstVarHiLow = function(which, iv) {
                var sol = this.getCurrentSol();
                var instances = sol.getObjects();
                if (!instances.length)
                    return false;
                var inst = instances[0];
                var pickme = inst;
                var val = inst.instance_vars[iv];
                var i, len, v;
                for (i = 1, len = instances.length; i < len; i++) {
                    inst = instances[i];
                    v = inst.instance_vars[iv];
                    if ((which === 0 && v < val) || (which === 1 && v > val)) {
                        val = v;
                        pickme = inst;
                    }
                }
                sol.pick_one(pickme);
                return true;
            };
            cnds.PickByUID = function(u) {
                var i, len, j, inst, families, instances, sol;
                var cnd = this.runtime.getCurrentCondition();
                if (cnd.inverted) {
                    sol = this.getCurrentSol();
                    if (sol.select_all) {
                        sol.select_all = false;
                        sol.instances.length = 0;
                        sol.else_instances.length = 0;
                        instances = this.instances;
                        for (i = 0, len = instances.length; i < len; i++) {
                            inst = instances[i];
                            if (inst.uid === u)
                                sol.else_instances.push(inst);
                            else
                                sol.instances.push(inst);
                        }
                        this.applySolToContainer();
                        return !!sol.instances.length;
                    } else {
                        for (i = 0, j = 0, len = sol.instances.length; i < len; i++) {
                            inst = sol.instances[i];
                            sol.instances[j] = inst;
                            if (inst.uid === u) {
                                sol.else_instances.push(inst);
                            } else
                                j++;
                        }
                        sol.instances.length = j;
                        this.applySolToContainer();
                        return !!sol.instances.length;
                    }
                } else {
                    inst = this.runtime.getObjectByUID(u);
                    if (!inst)
                        return false;
                    sol = this.getCurrentSol();
                    if (!sol.select_all && sol.instances.indexOf(inst) === -1)
                        return false; // not picked
                    if (this.is_family) {
                        families = inst.type.families;
                        for (i = 0, len = families.length; i < len; i++) {
                            if (families[i] === this) {
                                sol.pick_one(inst);
                                this.applySolToContainer();
                                return true;
                            }
                        }
                    } else if (inst.type === this) {
                        sol.pick_one(inst);
                        this.applySolToContainer();
                        return true;
                    }
                    return false;
                }
            };
            cnds.OnCreated = function() {
                return true;
            };
            cnds.OnDestroyed = function() {
                return true;
            };
            acts.SetInstanceVar = function(iv, val) {
                var myinstvars = this.instance_vars;
                if (cr.is_number(myinstvars[iv])) {
                    if (cr.is_number(val))
                        myinstvars[iv] = val;
                    else
                        myinstvars[iv] = parseFloat(val);
                } else if (cr.is_string(myinstvars[iv])) {
                    if (cr.is_string(val))
                        myinstvars[iv] = val;
                    else
                        myinstvars[iv] = val.toString();
                } else
                ;
            };
            acts.AddInstanceVar = function(iv, val) {
                var myinstvars = this.instance_vars;
                if (cr.is_number(myinstvars[iv])) {
                    if (cr.is_number(val))
                        myinstvars[iv] += val;
                    else
                        myinstvars[iv] += parseFloat(val);
                } else if (cr.is_string(myinstvars[iv])) {
                    if (cr.is_string(val))
                        myinstvars[iv] += val;
                    else
                        myinstvars[iv] += val.toString();
                } else
                ;
            };
            acts.SubInstanceVar = function(iv, val) {
                var myinstvars = this.instance_vars;
                if (cr.is_number(myinstvars[iv])) {
                    if (cr.is_number(val))
                        myinstvars[iv] -= val;
                    else
                        myinstvars[iv] -= parseFloat(val);
                } else
                ;
            };
            acts.SetBoolInstanceVar = function(iv, val) {
                this.instance_vars[iv] = val ? 1 : 0;
            };
            acts.ToggleBoolInstanceVar = function(iv) {
                this.instance_vars[iv] = 1 - this.instance_vars[iv];
            };
            acts.Destroy = function() {
                this.runtime.DestroyInstance(this);
            };
            if (!acts.LoadFromJsonString) {
                acts.LoadFromJsonString = function(str_) {
                    var o, i, len, binst;
                    try {
                        o = JSON.parse(str_);
                    } catch (e) {
                        return;
                    }
                    this.runtime.loadInstanceFromJSON(this, o, true);
                    if (this.afterLoad)
                        this.afterLoad();
                    if (this.behavior_insts) {
                        for (i = 0, len = this.behavior_insts.length; i < len; ++i) {
                            binst = this.behavior_insts[i];
                            if (binst.afterLoad)
                                binst.afterLoad();
                        }
                    }
                };
            }
            exps.Count = function(ret) {
                var count = ret.object_class.instances.length;
                var i, len, inst;
                for (i = 0, len = this.runtime.createRow.length; i < len; i++) {
                    inst = this.runtime.createRow[i];
                    if (ret.object_class.is_family) {
                        if (inst.type.families.indexOf(ret.object_class) >= 0)
                            count++;
                    } else {
                        if (inst.type === ret.object_class)
                            count++;
                    }
                }
                ret.set_int(count);
            };
            exps.PickedCount = function(ret) {
                ret.set_int(ret.object_class.getCurrentSol().getObjects().length);
            };
            exps.UID = function(ret) {
                ret.set_int(this.uid);
            };
            exps.IID = function(ret) {
                ret.set_int(this.get_iid());
            };
            if (!exps.AsJSON) {
                exps.AsJSON = function(ret) {
                    ret.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this, true)));
                };
            }
        }
        if (appearance_aces) {
            cnds.IsVisible = function() {
                return this.visible;
            };
            acts.SetVisible = function(v) {
                if (!v !== !this.visible) {
                    this.visible = v;
                    this.runtime.redraw = true;
                }
            };
            cnds.CompareOpacity = function(cmp, x) {
                return cr.do_cmp(cr.round6dp(this.opacity * 100), cmp, x);
            };
            acts.SetOpacity = function(x) {
                var new_opacity = x / 100.0;
                if (new_opacity < 0)
                    new_opacity = 0;
                else if (new_opacity > 1)
                    new_opacity = 1;
                if (new_opacity !== this.opacity) {
                    this.opacity = new_opacity;
                    this.runtime.redraw = true;
                }
            };
            exps.Opacity = function(ret) {
                ret.set_float(cr.round6dp(this.opacity * 100.0));
            };
        }
        if (zorder_aces) {
            cnds.IsOnLayer = function(layer_) {
                if (!layer_)
                    return false;
                return this.layer === layer_;
            };
            cnds.PickTopBottom = function(which_) {
                var sol = this.getCurrentSol();
                var instances = sol.getObjects();
                if (!instances.length)
                    return false;
                var inst = instances[0];
                var pickme = inst;
                var i, len;
                for (i = 1, len = instances.length; i < len; i++) {
                    inst = instances[i];
                    if (which_ === 0) {
                        if (inst.layer.index > pickme.layer.index || (inst.layer.index === pickme.layer.index && inst.get_zindex() > pickme.get_zindex())) {
                            pickme = inst;
                        }
                    } else {
                        if (inst.layer.index < pickme.layer.index || (inst.layer.index === pickme.layer.index && inst.get_zindex() < pickme.get_zindex())) {
                            pickme = inst;
                        }
                    }
                }
                sol.pick_one(pickme);
                return true;
            };
            acts.MoveToTop = function() {
                var zindex = this.get_zindex();
                if (zindex === this.layer.instances.length - 1)
                    return;
                cr.arrayRemove(this.layer.instances, zindex);
                this.layer.instances.push(this);
                this.runtime.redraw = true;
                this.layer.zindices_stale = true;
            };
            acts.MoveToBottom = function() {
                var zindex = this.get_zindex();
                if (zindex === 0)
                    return;
                cr.arrayRemove(this.layer.instances, zindex);
                this.layer.instances.unshift(this);
                this.runtime.redraw = true;
                this.layer.zindices_stale = true;
            };
            acts.MoveToLayer = function(layerMove) {
                if (!layerMove || layerMove == this.layer)
                    return;
                cr.arrayRemove(this.layer.instances, this.get_zindex());
                this.layer.zindices_stale = true;
                this.layer = layerMove;
                this.zindex = layerMove.instances.length;
                layerMove.instances.push(this);
                this.runtime.redraw = true;
            };
            acts.ZMoveToObject = function(where_, obj_) {
                var isafter = (where_ === 0);
                if (!obj_)
                    return;
                var other = obj_.getFirstPicked(this);
                if (!other || other.uid === this.uid)
                    return;
                if (this.layer.index !== other.layer.index) {
                    cr.arrayRemove(this.layer.instances, this.get_zindex());
                    this.layer.zindices_stale = true;
                    this.layer = other.layer;
                    this.zindex = other.layer.instances.length;
                    other.layer.instances.push(this);
                }
                var myZ = this.get_zindex();
                var insertZ = other.get_zindex();
                cr.arrayRemove(this.layer.instances, myZ);
                if (myZ < insertZ)
                    insertZ--;
                if (isafter)
                    insertZ++;
                if (insertZ === this.layer.instances.length)
                    this.layer.instances.push(this);
                else
                    this.layer.instances.splice(insertZ, 0, this);
                this.layer.zindices_stale = true;
                this.runtime.redraw = true;
            };
            exps.LayerNumber = function(ret) {
                ret.set_int(this.layer.number);
            };
            exps.LayerName = function(ret) {
                ret.set_string(this.layer.name);
            };
            exps.ZIndex = function(ret) {
                ret.set_int(this.get_zindex());
            };
        }
        if (effects_aces) {
            acts.SetEffectEnabled = function(enable_, effectname_) {
                if (!this.runtime.glwrap)
                    return;
                var i = this.type.getEffectIndexByName(effectname_);
                if (i < 0)
                    return; // effect name not found
                var enable = (enable_ === 1);
                if (this.active_effect_flags[i] === enable)
                    return; // no change
                this.active_effect_flags[i] = enable;
                this.updateActiveEffects();
                this.runtime.redraw = true;
            };
            acts.SetEffectParam = function(effectname_, index_, value_) {
                if (!this.runtime.glwrap)
                    return;
                var i = this.type.getEffectIndexByName(effectname_);
                if (i < 0)
                    return; // effect name not found
                var et = this.type.effect_types[i];
                var params = this.effect_params[i];
                index_ = Math.floor(index_);
                if (index_ < 0 || index_ >= params.length)
                    return; // effect index out of bounds
                if (this.runtime.glwrap.getProgramParameterType(et.shaderindex, index_) === 1)
                    value_ /= 100.0;
                if (params[index_] === value_)
                    return; // no change
                params[index_] = value_;
                if (et.active)
                    this.runtime.redraw = true;
            };
        }
    };
    cr.set_bbox_changed = function() {
        this.bbox_changed = true; // will recreate next time box requested
        this.cell_changed = true;
        this.type.any_cell_changed = true; // avoid unnecessary updateAllBBox() calls
        this.runtime.redraw = true; // assume runtime needs to redraw
        var i, len, callbacks = this.bbox_changed_callbacks;
        for (i = 0, len = callbacks.length; i < len; ++i) {
            callbacks[i](this);
        }
    };
    cr.add_bbox_changed_callback = function(f) {
        if (f) {
            this.bbox_changed_callbacks.push(f);
        }
    };
    cr.update_bbox = function() {
        if (!this.bbox_changed)
            return; // bounding box not changed
        var bbox = this.bbox;
        var bquad = this.bquad;
        bbox.set(this.x, this.y, this.x + this.width, this.y + this.height);
        bbox.offset(-this.hotspotX * this.width, -this.hotspotY * this.height);
        if (!this.angle) {
            bquad.set_from_rect(bbox); // make bounding quad from box
        } else {
            bbox.offset(-this.x, -this.y); // translate to origin
            bquad.set_from_rotated_rect(bbox, this.angle); // rotate around origin
            bquad.offset(this.x, this.y); // translate back to original position
            bquad.bounding_box(bbox);
        }
        bbox.normalize();
        this.bbox_changed = false; // bounding box up to date
    };
    var tmprc = new cr.rect(0, 0, 0, 0);
    cr.update_collision_cell = function() {
        if (!this.cell_changed || !this.collisionsEnabled)
            return;
        this.update_bbox();
        var mygrid = this.type.collision_grid;
        var collcells = this.collcells;
        var bbox = this.bbox;
        tmprc.set(mygrid.XToCell(bbox.left), mygrid.YToCell(bbox.top), mygrid.XToCell(bbox.right), mygrid.YToCell(bbox.bottom));
        if (collcells.equals(tmprc))
            return;
        if (collcells.right < collcells.left)
            mygrid.update(this, null, tmprc); // first insertion with invalid rect: don't provide old range
        else
            mygrid.update(this, collcells, tmprc);
        collcells.copy(tmprc);
        this.cell_changed = false;
    };
    cr.inst_contains_pt = function(x, y) {
        if (!this.bbox.contains_pt(x, y))
            return false;
        if (!this.bquad.contains_pt(x, y))
            return false;
        if (this.collision_poly && !this.collision_poly.is_empty()) {
            this.collision_poly.cache_poly(this.width, this.height, this.angle);
            return this.collision_poly.contains_pt(x - this.x, y - this.y);
        } else
            return true;
    };
    cr.inst_get_iid = function() {
        this.type.updateIIDs();
        return this.iid;
    };
    cr.inst_get_zindex = function() {
        this.layer.updateZIndices();
        return this.zindex;
    };
    cr.inst_updateActiveEffects = function() {
        this.active_effect_types.length = 0;
        var i, len, et, inst;
        for (i = 0, len = this.active_effect_flags.length; i < len; i++) {
            if (this.active_effect_flags[i])
                this.active_effect_types.push(this.type.effect_types[i]);
        }
        this.uses_shaders = !!this.active_effect_types.length;
    };
    cr.inst_toString = function() {
        return "Inst" + this.puid;
    };
    cr.type_getFirstPicked = function(frominst) {
        if (frominst && frominst.is_contained && frominst.type != this) {
            var i, len, s;
            for (i = 0, len = frominst.siblings.length; i < len; i++) {
                s = frominst.siblings[i];
                if (s.type == this)
                    return s;
            }
        }
        var instances = this.getCurrentSol().getObjects();
        if (instances.length)
            return instances[0];
        else
            return null;
    };
    cr.type_getPairedInstance = function(inst) {
        var instances = this.getCurrentSol().getObjects();
        if (instances.length)
            return instances[inst.get_iid() % instances.length];
        else
            return null;
    };
    cr.type_updateIIDs = function() {
        if (!this.stale_iids || this.is_family)
            return; // up to date or is family - don't want family to overwrite IIDs
        var i, len;
        for (i = 0, len = this.instances.length; i < len; i++)
            this.instances[i].iid = i;
        var next_iid = i;
        var createRow = this.runtime.createRow;
        for (i = 0, len = createRow.length; i < len; ++i) {
            if (createRow[i].type === this)
                createRow[i].iid = next_iid++;
        }
        this.stale_iids = false;
    };
    cr.type_getInstanceByIID = function(i) {
        if (i < this.instances.length)
            return this.instances[i];
        i -= this.instances.length;
        var createRow = this.runtime.createRow;
        var j, lenj;
        for (j = 0, lenj = createRow.length; j < lenj; ++j) {
            if (createRow[j].type === this) {
                if (i === 0)
                    return createRow[j];
                --i;
            }
        };
        return null;
    };
    cr.type_getCurrentSol = function() {
        return this.solstack[this.cur_sol];
    };
    cr.type_pushCleanSol = function() {
        this.cur_sol++;
        if (this.cur_sol === this.solstack.length)
            this.solstack.push(new cr.selection(this));
        else
            this.solstack[this.cur_sol].select_all = true; // else clear next SOL
    };
    cr.type_pushCopySol = function() {
        this.cur_sol++;
        if (this.cur_sol === this.solstack.length)
            this.solstack.push(new cr.selection(this));
        var clonesol = this.solstack[this.cur_sol];
        var prevsol = this.solstack[this.cur_sol - 1];
        if (prevsol.select_all)
            clonesol.select_all = true;
        else {
            clonesol.select_all = false;
            cr.shallowAssignArray(clonesol.instances, prevsol.instances);
            cr.shallowAssignArray(clonesol.else_instances, prevsol.else_instances);
        }
    };
    cr.type_popSol = function() {;
        this.cur_sol--;
    };
    cr.type_getBehaviorByName = function(behname) {
        var i, len, j, lenj, f, index = 0;
        if (!this.is_family) {
            for (i = 0, len = this.families.length; i < len; i++) {
                f = this.families[i];
                for (j = 0, lenj = f.behaviors.length; j < lenj; j++) {
                    if (behname === f.behaviors[j].name) {
                        this.extra.lastBehIndex = index;
                        return f.behaviors[j];
                    }
                    index++;
                }
            }
        }
        for (i = 0, len = this.behaviors.length; i < len; i++) {
            if (behname === this.behaviors[i].name) {
                this.extra.lastBehIndex = index;
                return this.behaviors[i];
            }
            index++;
        }
        return null;
    };
    cr.type_getBehaviorIndexByName = function(behname) {
        var b = this.getBehaviorByName(behname);
        if (b)
            return this.extra.lastBehIndex;
        else
            return -1;
    };
    cr.type_getEffectIndexByName = function(name_) {
        var i, len;
        for (i = 0, len = this.effect_types.length; i < len; i++) {
            if (this.effect_types[i].name === name_)
                return i;
        }
        return -1;
    };
    cr.type_applySolToContainer = function() {
        if (!this.is_contained || this.is_family)
            return;
        var i, len, j, lenj, t, sol, sol2;
        this.updateIIDs();
        sol = this.getCurrentSol();
        var select_all = sol.select_all;
        var es = this.runtime.getCurrentEventStack();
        var orblock = es && es.current_event && es.current_event.orblock;
        for (i = 0, len = this.container.length; i < len; i++) {
            t = this.container[i];
            if (t === this)
                continue;
            t.updateIIDs();
            sol2 = t.getCurrentSol();
            sol2.select_all = select_all;
            if (!select_all) {
                sol2.instances.length = sol.instances.length;
                for (j = 0, lenj = sol.instances.length; j < lenj; j++)
                    sol2.instances[j] = t.getInstanceByIID(sol.instances[j].iid);
                if (orblock) {
                    sol2.else_instances.length = sol.else_instances.length;
                    for (j = 0, lenj = sol.else_instances.length; j < lenj; j++)
                        sol2.else_instances[j] = t.getInstanceByIID(sol.else_instances[j].iid);
                }
            }
        }
    };
    cr.type_toString = function() {
        return "Type" + this.sid;
    };
    cr.do_cmp = function(x, cmp, y) {
        if (typeof x === "undefined" || typeof y === "undefined")
            return false;
        switch (cmp) {
            case 0: // equal
                return x === y;
            case 1: // not equal
                return x !== y;
            case 2: // less
                return x < y;
            case 3: // less/equal
                return x <= y;
            case 4: // greater
                return x > y;
            case 5: // greater/equal
                return x >= y;
            default:
                ;
                return false;
        }
    };
})();
cr.shaders = {};;;
cr.plugins_.Arr = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var pluginProto = cr.plugins_.Arr.prototype;
    pluginProto.Type = function(plugin) {
        this.plugin = plugin;
        this.runtime = plugin.runtime;
    };
    var typeProto = pluginProto.Type.prototype;
    typeProto.onCreate = function() {};
    pluginProto.Instance = function(type) {
        this.type = type;
        this.runtime = type.runtime;
    };
    var instanceProto = pluginProto.Instance.prototype;
    var arrCache = [];

    function allocArray() {
        if (arrCache.length)
            return arrCache.pop();
        else
            return [];
    };
    if (!Array.isArray) {
        Array.isArray = function(vArg) {
            return Object.prototype.toString.call(vArg) === "[object Array]";
        };
    }

    function freeArray(a) {
        var i, len;
        for (i = 0, len = a.length; i < len; i++) {
            if (Array.isArray(a[i]))
                freeArray(a[i]);
        }
        a.length = 0;
        arrCache.push(a);
    };
    instanceProto.onCreate = function() {
        this.cx = this.properties[0];
        this.cy = this.properties[1];
        this.cz = this.properties[2];
        if (!this.recycled)
            this.arr = allocArray();
        var a = this.arr;
        a.length = this.cx;
        var x, y, z;
        for (x = 0; x < this.cx; x++) {
            if (!a[x])
                a[x] = allocArray();
            a[x].length = this.cy;
            for (y = 0; y < this.cy; y++) {
                if (!a[x][y])
                    a[x][y] = allocArray();
                a[x][y].length = this.cz;
                for (z = 0; z < this.cz; z++)
                    a[x][y][z] = 0;
            }
        }
        this.forX = 0;
        this.forY = 0;
        this.forZ = 0;
    };
    instanceProto.onDestroy = function() {
        var x;
        for (x = 0; x < this.cx; x++)
            freeArray(this.arr[x]); // will recurse down and recycle other arrays
        this.arr.length = 0;
    };
    instanceProto.at = function(x, y, z) {
        x = Math.floor(x);
        y = Math.floor(y);
        z = Math.floor(z);
        if (isNaN(x) || x < 0 || x > this.cx - 1)
            return 0;
        if (isNaN(y) || y < 0 || y > this.cy - 1)
            return 0;
        if (isNaN(z) || z < 0 || z > this.cz - 1)
            return 0;
        return this.arr[x][y][z];
    };
    instanceProto.set = function(x, y, z, val) {
        x = Math.floor(x);
        y = Math.floor(y);
        z = Math.floor(z);
        if (isNaN(x) || x < 0 || x > this.cx - 1)
            return;
        if (isNaN(y) || y < 0 || y > this.cy - 1)
            return;
        if (isNaN(z) || z < 0 || z > this.cz - 1)
            return;
        this.arr[x][y][z] = val;
    };
    instanceProto.getAsJSON = function() {
        return JSON.stringify({
            "c2array": true,
            "size": [this.cx, this.cy, this.cz],
            "data": this.arr
        });
    };
    instanceProto.saveToJSON = function() {
        return {
            "size": [this.cx, this.cy, this.cz],
            "data": this.arr
        };
    };
    instanceProto.loadFromJSON = function(o) {
        var sz = o["size"];
        this.cx = sz[0];
        this.cy = sz[1];
        this.cz = sz[2];
        this.arr = o["data"];
    };
    instanceProto.setSize = function(w, h, d) {
        if (w < 0) w = 0;
        if (h < 0) h = 0;
        if (d < 0) d = 0;
        if (this.cx === w && this.cy === h && this.cz === d)
            return; // no change
        this.cx = w;
        this.cy = h;
        this.cz = d;
        var x, y, z;
        var a = this.arr;
        a.length = w;
        for (x = 0; x < this.cx; x++) {
            if (cr.is_undefined(a[x]))
                a[x] = allocArray();
            a[x].length = h;
            for (y = 0; y < this.cy; y++) {
                if (cr.is_undefined(a[x][y]))
                    a[x][y] = allocArray();
                a[x][y].length = d;
                for (z = 0; z < this.cz; z++) {
                    if (cr.is_undefined(a[x][y][z]))
                        a[x][y][z] = 0;
                }
            }
        }
    };

    function Cnds() {};
    Cnds.prototype.CompareX = function(x, cmp, val) {
        return cr.do_cmp(this.at(x, 0, 0), cmp, val);
    };
    Cnds.prototype.CompareXY = function(x, y, cmp, val) {
        return cr.do_cmp(this.at(x, y, 0), cmp, val);
    };
    Cnds.prototype.CompareXYZ = function(x, y, z, cmp, val) {
        return cr.do_cmp(this.at(x, y, z), cmp, val);
    };
    instanceProto.doForEachTrigger = function(current_event) {
        this.runtime.pushCopySol(current_event.solModifiers);
        current_event.retrigger();
        this.runtime.popSol(current_event.solModifiers);
    };
    Cnds.prototype.ArrForEach = function(dims) {
        var current_event = this.runtime.getCurrentEventStack().current_event;
        this.forX = 0;
        this.forY = 0;
        this.forZ = 0;
        switch (dims) {
            case 0:
                for (this.forX = 0; this.forX < this.cx; this.forX++) {
                    for (this.forY = 0; this.forY < this.cy; this.forY++) {
                        for (this.forZ = 0; this.forZ < this.cz; this.forZ++) {
                            this.doForEachTrigger(current_event);
                        }
                    }
                }
                break;
            case 1:
                for (this.forX = 0; this.forX < this.cx; this.forX++) {
                    for (this.forY = 0; this.forY < this.cy; this.forY++) {
                        this.doForEachTrigger(current_event);
                    }
                }
                break;
            case 2:
                for (this.forX = 0; this.forX < this.cx; this.forX++) {
                    this.doForEachTrigger(current_event);
                }
                break;
        }
        this.forX = 0;
        this.forY = 0;
        this.forZ = 0;
        return false;
    };
    Cnds.prototype.CompareCurrent = function(cmp, val) {
        return cr.do_cmp(this.at(this.forX, this.forY, this.forZ), cmp, val);
    };
    Cnds.prototype.Contains = function(val) {
        var x, y, z;
        for (x = 0; x < this.cx; x++) {
            for (y = 0; y < this.cy; y++) {
                for (z = 0; z < this.cz; z++) {
                    if (this.arr[x][y][z] === val)
                        return true;
                }
            }
        }
        return false;
    };
    Cnds.prototype.IsEmpty = function() {
        return this.cx === 0 || this.cy === 0 || this.cz === 0;
    };
    Cnds.prototype.CompareSize = function(axis, cmp, value) {
        var s = 0;
        switch (axis) {
            case 0:
                s = this.cx;
                break;
            case 1:
                s = this.cy;
                break;
            case 2:
                s = this.cz;
                break;
        }
        return cr.do_cmp(s, cmp, value);
    };
    pluginProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.Clear = function() {
        var x, y, z;
        for (x = 0; x < this.cx; x++)
            for (y = 0; y < this.cy; y++)
                for (z = 0; z < this.cz; z++)
                    this.arr[x][y][z] = 0;
    };
    Acts.prototype.SetSize = function(w, h, d) {
        this.setSize(w, h, d);
    };
    Acts.prototype.SetX = function(x, val) {
        this.set(x, 0, 0, val);
    };
    Acts.prototype.SetXY = function(x, y, val) {
        this.set(x, y, 0, val);
    };
    Acts.prototype.SetXYZ = function(x, y, z, val) {
        this.set(x, y, z, val);
    };
    Acts.prototype.Push = function(where, value, axis) {
        var x = 0,
            y = 0,
            z = 0;
        var a = this.arr;
        switch (axis) {
            case 0: // X axis
                if (where === 0) // back
                {
                    x = a.length;
                    a.push(allocArray());
                } else // front
                {
                    x = 0;
                    a.unshift(allocArray());
                }
                a[x].length = this.cy;
                for (; y < this.cy; y++) {
                    a[x][y] = allocArray();
                    a[x][y].length = this.cz;
                    for (z = 0; z < this.cz; z++)
                        a[x][y][z] = value;
                }
                this.cx++;
                break;
            case 1: // Y axis
                for (; x < this.cx; x++) {
                    if (where === 0) // back
                    {
                        y = a[x].length;
                        a[x].push(allocArray());
                    } else // front
                    {
                        y = 0;
                        a[x].unshift(allocArray());
                    }
                    a[x][y].length = this.cz;
                    for (z = 0; z < this.cz; z++)
                        a[x][y][z] = value;
                }
                this.cy++;
                break;
            case 2: // Z axis
                for (; x < this.cx; x++) {
                    for (y = 0; y < this.cy; y++) {
                        if (where === 0) // back
                        {
                            a[x][y].push(value);
                        } else // front
                        {
                            a[x][y].unshift(value);
                        }
                    }
                }
                this.cz++;
                break;
        }
    };
    Acts.prototype.Pop = function(where, axis) {
        var x = 0,
            y = 0,
            z = 0;
        var a = this.arr;
        switch (axis) {
            case 0: // X axis
                if (this.cx === 0)
                    break;
                if (where === 0) // back
                {
                    freeArray(a.pop());
                } else // front
                {
                    freeArray(a.shift());
                }
                this.cx--;
                break;
            case 1: // Y axis
                if (this.cy === 0)
                    break;
                for (; x < this.cx; x++) {
                    if (where === 0) // back
                    {
                        freeArray(a[x].pop());
                    } else // front
                    {
                        freeArray(a[x].shift());
                    }
                }
                this.cy--;
                break;
            case 2: // Z axis
                if (this.cz === 0)
                    break;
                for (; x < this.cx; x++) {
                    for (y = 0; y < this.cy; y++) {
                        if (where === 0) // back
                        {
                            a[x][y].pop();
                        } else // front
                        {
                            a[x][y].shift();
                        }
                    }
                }
                this.cz--;
                break;
        }
    };
    Acts.prototype.Reverse = function(axis) {
        var x = 0,
            y = 0,
            z = 0;
        var a = this.arr;
        if (this.cx === 0 || this.cy === 0 || this.cz === 0)
            return; // no point reversing empty array
        switch (axis) {
            case 0: // X axis
                a.reverse();
                break;
            case 1: // Y axis
                for (; x < this.cx; x++)
                    a[x].reverse();
                break;
            case 2: // Z axis
                for (; x < this.cx; x++)
                    for (y = 0; y < this.cy; y++)
                        a[x][y].reverse();
                this.cz--;
                break;
        }
    };

    function compareValues(va, vb) {
        if (cr.is_number(va) && cr.is_number(vb))
            return va - vb;
        else {
            var sa = "" + va;
            var sb = "" + vb;
            if (sa < sb)
                return -1;
            else if (sa > sb)
                return 1;
            else
                return 0;
        }
    }
    Acts.prototype.Sort = function(axis) {
        var x = 0,
            y = 0,
            z = 0;
        var a = this.arr;
        if (this.cx === 0 || this.cy === 0 || this.cz === 0)
            return; // no point sorting empty array
        switch (axis) {
            case 0: // X axis
                a.sort(function(a, b) {
                    return compareValues(a[0][0], b[0][0]);
                });
                break;
            case 1: // Y axis
                for (; x < this.cx; x++) {
                    a[x].sort(function(a, b) {
                        return compareValues(a[0], b[0]);
                    });
                }
                break;
            case 2: // Z axis
                for (; x < this.cx; x++) {
                    for (y = 0; y < this.cy; y++) {
                        a[x][y].sort(compareValues);
                    }
                }
                break;
        }
    };
    Acts.prototype.Delete = function(index, axis) {
        var x = 0,
            y = 0,
            z = 0;
        index = Math.floor(index);
        var a = this.arr;
        if (index < 0)
            return;
        switch (axis) {
            case 0: // X axis
                if (index >= this.cx)
                    break;
                freeArray(a[index]);
                a.splice(index, 1);
                this.cx--;
                break;
            case 1: // Y axis
                if (index >= this.cy)
                    break;
                for (; x < this.cx; x++) {
                    freeArray(a[x][index]);
                    a[x].splice(index, 1);
                }
                this.cy--;
                break;
            case 2: // Z axis
                if (index >= this.cz)
                    break;
                for (; x < this.cx; x++) {
                    for (y = 0; y < this.cy; y++) {
                        a[x][y].splice(index, 1);
                    }
                }
                this.cz--;
                break;
        }
    };
    Acts.prototype.Insert = function(value, index, axis) {
        var x = 0,
            y = 0,
            z = 0;
        index = Math.floor(index);
        var a = this.arr;
        if (index < 0)
            return;
        switch (axis) {
            case 0: // X axis
                if (index > this.cx)
                    return;
                x = index;
                a.splice(x, 0, allocArray());
                a[x].length = this.cy;
                for (; y < this.cy; y++) {
                    a[x][y] = allocArray();
                    a[x][y].length = this.cz;
                    for (z = 0; z < this.cz; z++)
                        a[x][y][z] = value;
                }
                this.cx++;
                break;
            case 1: // Y axis
                if (index > this.cy)
                    return;
                for (; x < this.cx; x++) {
                    y = index;
                    a[x].splice(y, 0, allocArray());
                    a[x][y].length = this.cz;
                    for (z = 0; z < this.cz; z++)
                        a[x][y][z] = value;
                }
                this.cy++;
                break;
            case 2: // Z axis
                if (index > this.cz)
                    return;
                for (; x < this.cx; x++) {
                    for (y = 0; y < this.cy; y++) {
                        a[x][y].splice(index, 0, value);
                    }
                }
                this.cz++;
                break;
        }
    };
    Acts.prototype.JSONLoad = function(json_) {
        var o;
        try {
            o = JSON.parse(json_);
        } catch (e) {
            return;
        }
        if (!o["c2array"]) // presumably not a c2array object
            return;
        var sz = o["size"];
        this.cx = sz[0];
        this.cy = sz[1];
        this.cz = sz[2];
        this.arr = o["data"];
    };
    Acts.prototype.JSONDownload = function(filename) {
        var a = document.createElement("a");
        if (typeof a.download === "undefined") {
            var str = 'data:text/html,' + encodeURIComponent("<p><a download='" + filename + "' href=\"data:application/json," + encodeURIComponent(this.getAsJSON()) + "\">Download link</a></p>");
            window.open(str);
        } else {
            var body = document.getElementsByTagName("body")[0];
            a.textContent = filename;
            a.href = "data:application/json," + encodeURIComponent(this.getAsJSON());
            a.download = filename;
            body.appendChild(a);
            var clickEvent = document.createEvent("MouseEvent");
            clickEvent.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
            a.dispatchEvent(clickEvent);
            body.removeChild(a);
        }
    };
    pluginProto.acts = new Acts();

    function Exps() {};
    Exps.prototype.At = function(ret, x, y_, z_) {
        var y = y_ || 0;
        var z = z_ || 0;
        ret.set_any(this.at(x, y, z));
    };
    Exps.prototype.Width = function(ret) {
        ret.set_int(this.cx);
    };
    Exps.prototype.Height = function(ret) {
        ret.set_int(this.cy);
    };
    Exps.prototype.Depth = function(ret) {
        ret.set_int(this.cz);
    };
    Exps.prototype.CurX = function(ret) {
        ret.set_int(this.forX);
    };
    Exps.prototype.CurY = function(ret) {
        ret.set_int(this.forY);
    };
    Exps.prototype.CurZ = function(ret) {
        ret.set_int(this.forZ);
    };
    Exps.prototype.CurValue = function(ret) {
        ret.set_any(this.at(this.forX, this.forY, this.forZ));
    };
    Exps.prototype.Front = function(ret) {
        ret.set_any(this.at(0, 0, 0));
    };
    Exps.prototype.Back = function(ret) {
        ret.set_any(this.at(this.cx - 1, 0, 0));
    };
    Exps.prototype.IndexOf = function(ret, v) {
        for (var i = 0; i < this.cx; i++) {
            if (this.arr[i][0][0] === v) {
                ret.set_int(i);
                return;
            }
        }
        ret.set_int(-1);
    };
    Exps.prototype.LastIndexOf = function(ret, v) {
        for (var i = this.cx - 1; i >= 0; i--) {
            if (this.arr[i][0][0] === v) {
                ret.set_int(i);
                return;
            }
        }
        ret.set_int(-1);
    };
    Exps.prototype.AsJSON = function(ret) {
        ret.set_string(this.getAsJSON());
    };
    pluginProto.exps = new Exps();
}());;;
cr.plugins_.Audio = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var pluginProto = cr.plugins_.Audio.prototype;
    pluginProto.Type = function(plugin) {
        this.plugin = plugin;
        this.runtime = plugin.runtime;
    };
    var typeProto = pluginProto.Type.prototype;
    typeProto.onCreate = function() {};
    var audRuntime = null;
    var audInst = null;
    var audTag = "";
    var appPath = ""; // for PhoneGap only
    var API_HTML5 = 0;
    var API_WEBAUDIO = 1;
    var API_PHONEGAP = 2;
    var API_APPMOBI = 3;
    var api = API_HTML5;
    var context = null;
    var audioBuffers = []; // cache of buffers
    var audioInstances = []; // cache of instances
    var lastAudio = null;
    var useOgg = false; // determined at create time
    var timescale_mode = 0;
    var silent = false;
    var masterVolume = 1;
    var listenerX = 0;
    var listenerY = 0;
    var panningModel = 1; // HRTF
    var distanceModel = 1; // Inverse
    var refDistance = 10;
    var maxDistance = 10000;
    var rolloffFactor = 1;
    var micSource = null;
    var micTag = "";
    var isMusicWorkaround = false;
    var musicPlayNextTouch = [];

    function dbToLinear(x) {
        var v = dbToLinear_nocap(x);
        if (v < 0)
            v = 0;
        if (v > 1)
            v = 1;
        return v;
    };

    function linearToDb(x) {
        if (x < 0)
            x = 0;
        if (x > 1)
            x = 1;
        return linearToDb_nocap(x);
    };

    function dbToLinear_nocap(x) {
        return Math.pow(10, x / 20);
    };

    function linearToDb_nocap(x) {
        return (Math.log(x) / Math.log(10)) * 20;
    };
    var effects = {};

    function getDestinationForTag(tag) {
        tag = tag.toLowerCase();
        if (effects.hasOwnProperty(tag)) {
            if (effects[tag].length)
                return effects[tag][0].getInputNode();
        }
        return context["destination"];
    };

    function createGain() {
        if (context["createGain"])
            return context["createGain"]();
        else
            return context["createGainNode"]();
    };

    function createDelay(d) {
        if (context["createDelay"])
            return context["createDelay"](d);
        else
            return context["createDelayNode"](d);
    };

    function startSource(s) {
        if (s["start"])
            s["start"](0);
        else
            s["noteOn"](0);
    };

    function startSourceAt(s, x, d) {
        if (s["start"])
            s["start"](0, x);
        else
            s["noteGrainOn"](0, x, d - x);
    };

    function stopSource(s) {
        try {
            if (s["stop"])
                s["stop"](0);
            else
                s["noteOff"](0);
        } catch (e) {}
    };

    function setAudioParam(ap, value, ramp, time) {
        if (!ap)
            return; // iOS is missing some parameters
        ap["cancelScheduledValues"](0);
        if (time === 0) {
            ap["value"] = value;
            return;
        }
        var curTime = context["currentTime"];
        time += curTime;
        switch (ramp) {
            case 0: // step
                ap["setValueAtTime"](value, time);
                break;
            case 1: // linear
                ap["setValueAtTime"](ap["value"], curTime); // to set what to ramp from
                ap["linearRampToValueAtTime"](value, time);
                break;
            case 2: // exponential
                ap["setValueAtTime"](ap["value"], curTime); // to set what to ramp from
                ap["exponentialRampToValueAtTime"](value, time);
                break;
        }
    };
    var filterTypes = ["lowpass", "highpass", "bandpass", "lowshelf", "highshelf", "peaking", "notch", "allpass"];

    function FilterEffect(type, freq, detune, q, gain, mix) {
        this.type = "filter";
        this.params = [type, freq, detune, q, gain, mix];
        this.inputNode = createGain();
        this.wetNode = createGain();
        this.wetNode["gain"]["value"] = mix;
        this.dryNode = createGain();
        this.dryNode["gain"]["value"] = 1 - mix;
        this.filterNode = context["createBiquadFilter"]();
        if (typeof this.filterNode["type"] === "number")
            this.filterNode["type"] = type;
        else
            this.filterNode["type"] = filterTypes[type];
        this.filterNode["frequency"]["value"] = freq;
        if (this.filterNode["detune"]) // iOS 6 doesn't have detune yet
            this.filterNode["detune"]["value"] = detune;
        this.filterNode["Q"]["value"] = q;
        this.filterNode["gain"]["value"] = gain;
        this.inputNode["connect"](this.filterNode);
        this.inputNode["connect"](this.dryNode);
        this.filterNode["connect"](this.wetNode);
    };
    FilterEffect.prototype.connectTo = function(node) {
        this.wetNode["disconnect"]();
        this.wetNode["connect"](node);
        this.dryNode["disconnect"]();
        this.dryNode["connect"](node);
    };
    FilterEffect.prototype.remove = function() {
        this.inputNode["disconnect"]();
        this.filterNode["disconnect"]();
        this.wetNode["disconnect"]();
        this.dryNode["disconnect"]();
    };
    FilterEffect.prototype.getInputNode = function() {
        return this.inputNode;
    };
    FilterEffect.prototype.setParam = function(param, value, ramp, time) {
        switch (param) {
            case 0: // mix
                value = value / 100;
                if (value < 0) value = 0;
                if (value > 1) value = 1;
                this.params[5] = value;
                setAudioParam(this.wetNode["gain"], value, ramp, time);
                setAudioParam(this.dryNode["gain"], 1 - value, ramp, time);
                break;
            case 1: // filter frequency
                this.params[1] = value;
                setAudioParam(this.filterNode["frequency"], value, ramp, time);
                break;
            case 2: // filter detune
                this.params[2] = value;
                setAudioParam(this.filterNode["detune"], value, ramp, time);
                break;
            case 3: // filter Q
                this.params[3] = value;
                setAudioParam(this.filterNode["Q"], value, ramp, time);
                break;
            case 4: // filter/delay gain (note value is in dB here)
                this.params[4] = value;
                setAudioParam(this.filterNode["gain"], value, ramp, time);
                break;
        }
    };

    function DelayEffect(delayTime, delayGain, mix) {
        this.type = "delay";
        this.params = [delayTime, delayGain, mix];
        this.inputNode = createGain();
        this.wetNode = createGain();
        this.wetNode["gain"]["value"] = mix;
        this.dryNode = createGain();
        this.dryNode["gain"]["value"] = 1 - mix;
        this.mainNode = createGain();
        this.delayNode = createDelay(delayTime);
        this.delayNode["delayTime"]["value"] = delayTime;
        this.delayGainNode = createGain();
        this.delayGainNode["gain"]["value"] = delayGain;
        this.inputNode["connect"](this.mainNode);
        this.inputNode["connect"](this.dryNode);
        this.mainNode["connect"](this.wetNode);
        this.mainNode["connect"](this.delayNode);
        this.delayNode["connect"](this.delayGainNode);
        this.delayGainNode["connect"](this.mainNode);
    };
    DelayEffect.prototype.connectTo = function(node) {
        this.wetNode["disconnect"]();
        this.wetNode["connect"](node);
        this.dryNode["disconnect"]();
        this.dryNode["connect"](node);
    };
    DelayEffect.prototype.remove = function() {
        this.inputNode["disconnect"]();
        this.mainNode["disconnect"]();
        this.delayNode["disconnect"]();
        this.delayGainNode["disconnect"]();
        this.wetNode["disconnect"]();
        this.dryNode["disconnect"]();
    };
    DelayEffect.prototype.getInputNode = function() {
        return this.inputNode;
    };
    DelayEffect.prototype.setParam = function(param, value, ramp, time) {
        switch (param) {
            case 0: // mix
                value = value / 100;
                if (value < 0) value = 0;
                if (value > 1) value = 1;
                this.params[2] = value;
                setAudioParam(this.wetNode["gain"], value, ramp, time);
                setAudioParam(this.dryNode["gain"], 1 - value, ramp, time);
                break;
            case 4: // filter/delay gain (note value is passed in dB but needs to be linear here)
                this.params[1] = dbToLinear(value);
                setAudioParam(this.delayGainNode["gain"], dbToLinear(value), ramp, time);
                break;
            case 5: // delay time
                this.params[0] = value;
                setAudioParam(this.delayNode["delayTime"], value, ramp, time);
                break;
        }
    };

    function ConvolveEffect(buffer, normalize, mix, src) {
        this.type = "convolve";
        this.params = [normalize, mix, src];
        this.inputNode = createGain();
        this.wetNode = createGain();
        this.wetNode["gain"]["value"] = mix;
        this.dryNode = createGain();
        this.dryNode["gain"]["value"] = 1 - mix;
        this.convolveNode = context["createConvolver"]();
        if (buffer) {
            this.convolveNode["normalize"] = normalize;
            this.convolveNode["buffer"] = buffer;
        }
        this.inputNode["connect"](this.convolveNode);
        this.inputNode["connect"](this.dryNode);
        this.convolveNode["connect"](this.wetNode);
    };
    ConvolveEffect.prototype.connectTo = function(node) {
        this.wetNode["disconnect"]();
        this.wetNode["connect"](node);
        this.dryNode["disconnect"]();
        this.dryNode["connect"](node);
    };
    ConvolveEffect.prototype.remove = function() {
        this.inputNode["disconnect"]();
        this.convolveNode["disconnect"]();
        this.wetNode["disconnect"]();
        this.dryNode["disconnect"]();
    };
    ConvolveEffect.prototype.getInputNode = function() {
        return this.inputNode;
    };
    ConvolveEffect.prototype.setParam = function(param, value, ramp, time) {
        switch (param) {
            case 0: // mix
                value = value / 100;
                if (value < 0) value = 0;
                if (value > 1) value = 1;
                this.params[1] = value;
                setAudioParam(this.wetNode["gain"], value, ramp, time);
                setAudioParam(this.dryNode["gain"], 1 - value, ramp, time);
                break;
        }
    };

    function FlangerEffect(delay, modulation, freq, feedback, mix) {
        this.type = "flanger";
        this.params = [delay, modulation, freq, feedback, mix];
        this.inputNode = createGain();
        this.dryNode = createGain();
        this.dryNode["gain"]["value"] = 1 - (mix / 2);
        this.wetNode = createGain();
        this.wetNode["gain"]["value"] = mix / 2;
        this.feedbackNode = createGain();
        this.feedbackNode["gain"]["value"] = feedback;
        this.delayNode = createDelay(delay + modulation);
        this.delayNode["delayTime"]["value"] = delay;
        this.oscNode = context["createOscillator"]();
        this.oscNode["frequency"]["value"] = freq;
        this.oscGainNode = createGain();
        this.oscGainNode["gain"]["value"] = modulation;
        this.inputNode["connect"](this.delayNode);
        this.inputNode["connect"](this.dryNode);
        this.delayNode["connect"](this.wetNode);
        this.delayNode["connect"](this.feedbackNode);
        this.feedbackNode["connect"](this.delayNode);
        this.oscNode["connect"](this.oscGainNode);
        this.oscGainNode["connect"](this.delayNode["delayTime"]);
        startSource(this.oscNode);
    };
    FlangerEffect.prototype.connectTo = function(node) {
        this.dryNode["disconnect"]();
        this.dryNode["connect"](node);
        this.wetNode["disconnect"]();
        this.wetNode["connect"](node);
    };
    FlangerEffect.prototype.remove = function() {
        this.inputNode["disconnect"]();
        this.delayNode["disconnect"]();
        this.oscNode["disconnect"]();
        this.oscGainNode["disconnect"]();
        this.dryNode["disconnect"]();
        this.wetNode["disconnect"]();
        this.feedbackNode["disconnect"]();
    };
    FlangerEffect.prototype.getInputNode = function() {
        return this.inputNode;
    };
    FlangerEffect.prototype.setParam = function(param, value, ramp, time) {
        switch (param) {
            case 0: // mix
                value = value / 100;
                if (value < 0) value = 0;
                if (value > 1) value = 1;
                this.params[4] = value;
                setAudioParam(this.wetNode["gain"], value / 2, ramp, time);
                setAudioParam(this.dryNode["gain"], 1 - (value / 2), ramp, time);
                break;
            case 6: // modulation
                this.params[1] = value / 1000;
                setAudioParam(this.oscGainNode["gain"], value / 1000, ramp, time);
                break;
            case 7: // modulation frequency
                this.params[2] = value;
                setAudioParam(this.oscNode["frequency"], value, ramp, time);
                break;
            case 8: // feedback
                this.params[3] = value / 100;
                setAudioParam(this.feedbackNode["gain"], value / 100, ramp, time);
                break;
        }
    };

    function PhaserEffect(freq, detune, q, modulation, modfreq, mix) {
        this.type = "phaser";
        this.params = [freq, detune, q, modulation, modfreq, mix];
        this.inputNode = createGain();
        this.dryNode = createGain();
        this.dryNode["gain"]["value"] = 1 - (mix / 2);
        this.wetNode = createGain();
        this.wetNode["gain"]["value"] = mix / 2;
        this.filterNode = context["createBiquadFilter"]();
        if (typeof this.filterNode["type"] === "number")
            this.filterNode["type"] = 7; // all-pass
        else
            this.filterNode["type"] = "allpass";
        this.filterNode["frequency"]["value"] = freq;
        if (this.filterNode["detune"]) // iOS 6 doesn't have detune yet
            this.filterNode["detune"]["value"] = detune;
        this.filterNode["Q"]["value"] = q;
        this.oscNode = context["createOscillator"]();
        this.oscNode["frequency"]["value"] = modfreq;
        this.oscGainNode = createGain();
        this.oscGainNode["gain"]["value"] = modulation;
        this.inputNode["connect"](this.filterNode);
        this.inputNode["connect"](this.dryNode);
        this.filterNode["connect"](this.wetNode);
        this.oscNode["connect"](this.oscGainNode);
        this.oscGainNode["connect"](this.filterNode["frequency"]);
        startSource(this.oscNode);
    };
    PhaserEffect.prototype.connectTo = function(node) {
        this.dryNode["disconnect"]();
        this.dryNode["connect"](node);
        this.wetNode["disconnect"]();
        this.wetNode["connect"](node);
    };
    PhaserEffect.prototype.remove = function() {
        this.inputNode["disconnect"]();
        this.filterNode["disconnect"]();
        this.oscNode["disconnect"]();
        this.oscGainNode["disconnect"]();
        this.dryNode["disconnect"]();
        this.wetNode["disconnect"]();
    };
    PhaserEffect.prototype.getInputNode = function() {
        return this.inputNode;
    };
    PhaserEffect.prototype.setParam = function(param, value, ramp, time) {
        switch (param) {
            case 0: // mix
                value = value / 100;
                if (value < 0) value = 0;
                if (value > 1) value = 1;
                this.params[5] = value;
                setAudioParam(this.wetNode["gain"], value / 2, ramp, time);
                setAudioParam(this.dryNode["gain"], 1 - (value / 2), ramp, time);
                break;
            case 1: // filter frequency
                this.params[0] = value;
                setAudioParam(this.filterNode["frequency"], value, ramp, time);
                break;
            case 2: // filter detune
                this.params[1] = value;
                setAudioParam(this.filterNode["detune"], value, ramp, time);
                break;
            case 3: // filter Q
                this.params[2] = value;
                setAudioParam(this.filterNode["Q"], value, ramp, time);
                break;
            case 6: // modulation
                this.params[3] = value;
                setAudioParam(this.oscGainNode["gain"], value, ramp, time);
                break;
            case 7: // modulation frequency
                this.params[4] = value;
                setAudioParam(this.oscNode["frequency"], value, ramp, time);
                break;
        }
    };

    function GainEffect(g) {
        this.type = "gain";
        this.params = [g];
        this.node = createGain();
        this.node["gain"]["value"] = g;
    };
    GainEffect.prototype.connectTo = function(node_) {
        this.node["disconnect"]();
        this.node["connect"](node_);
    };
    GainEffect.prototype.remove = function() {
        this.node["disconnect"]();
    };
    GainEffect.prototype.getInputNode = function() {
        return this.node;
    };
    GainEffect.prototype.setParam = function(param, value, ramp, time) {
        switch (param) {
            case 4: // gain
                this.params[0] = dbToLinear(value);
                setAudioParam(this.node["gain"], dbToLinear(value), ramp, time);
                break;
        }
    };

    function TremoloEffect(freq, mix) {
        this.type = "tremolo";
        this.params = [freq, mix];
        this.node = createGain();
        this.node["gain"]["value"] = 1 - (mix / 2);
        this.oscNode = context["createOscillator"]();
        this.oscNode["frequency"]["value"] = freq;
        this.oscGainNode = createGain();
        this.oscGainNode["gain"]["value"] = mix / 2;
        this.oscNode["connect"](this.oscGainNode);
        this.oscGainNode["connect"](this.node["gain"]);
        startSource(this.oscNode);
    };
    TremoloEffect.prototype.connectTo = function(node_) {
        this.node["disconnect"]();
        this.node["connect"](node_);
    };
    TremoloEffect.prototype.remove = function() {
        this.oscNode["disconnect"]();
        this.oscGainNode["disconnect"]();
        this.node["disconnect"]();
    };
    TremoloEffect.prototype.getInputNode = function() {
        return this.node;
    };
    TremoloEffect.prototype.setParam = function(param, value, ramp, time) {
        switch (param) {
            case 0: // mix
                value = value / 100;
                if (value < 0) value = 0;
                if (value > 1) value = 1;
                this.params[1] = value;
                setAudioParam(this.node["gain"]["value"], 1 - (value / 2), ramp, time);
                setAudioParam(this.oscGainNode["gain"]["value"], value / 2, ramp, time);
                break;
            case 7: // modulation frequency
                this.params[0] = value;
                setAudioParam(this.oscNode["frequency"], value, ramp, time);
                break;
        }
    };

    function RingModulatorEffect(freq, mix) {
        this.type = "ringmod";
        this.params = [freq, mix];
        this.inputNode = createGain();
        this.wetNode = createGain();
        this.wetNode["gain"]["value"] = mix;
        this.dryNode = createGain();
        this.dryNode["gain"]["value"] = 1 - mix;
        this.ringNode = createGain();
        this.ringNode["gain"]["value"] = 0;
        this.oscNode = context["createOscillator"]();
        this.oscNode["frequency"]["value"] = freq;
        this.oscNode["connect"](this.ringNode["gain"]);
        startSource(this.oscNode);
        this.inputNode["connect"](this.ringNode);
        this.inputNode["connect"](this.dryNode);
        this.ringNode["connect"](this.wetNode);
    };
    RingModulatorEffect.prototype.connectTo = function(node_) {
        this.wetNode["disconnect"]();
        this.wetNode["connect"](node_);
        this.dryNode["disconnect"]();
        this.dryNode["connect"](node_);
    };
    RingModulatorEffect.prototype.remove = function() {
        this.oscNode["disconnect"]();
        this.ringNode["disconnect"]();
        this.inputNode["disconnect"]();
        this.wetNode["disconnect"]();
        this.dryNode["disconnect"]();
    };
    RingModulatorEffect.prototype.getInputNode = function() {
        return this.inputNode;
    };
    RingModulatorEffect.prototype.setParam = function(param, value, ramp, time) {
        switch (param) {
            case 0: // mix
                value = value / 100;
                if (value < 0) value = 0;
                if (value > 1) value = 1;
                this.params[1] = value;
                setAudioParam(this.wetNode["gain"], value, ramp, time);
                setAudioParam(this.dryNode["gain"], 1 - value, ramp, time);
                break;
            case 7: // modulation frequency
                this.params[0] = value;
                setAudioParam(this.oscNode["frequency"], value, ramp, time);
                break;
        }
    };

    function DistortionEffect(threshold, headroom, drive, makeupgain, mix) {
        this.type = "distortion";
        this.params = [threshold, headroom, drive, makeupgain, mix];
        this.inputNode = createGain();
        this.preGain = createGain();
        this.postGain = createGain();
        this.setDrive(drive, dbToLinear_nocap(makeupgain));
        this.wetNode = createGain();
        this.wetNode["gain"]["value"] = mix;
        this.dryNode = createGain();
        this.dryNode["gain"]["value"] = 1 - mix;
        this.waveShaper = context["createWaveShaper"]();
        this.curve = new Float32Array(65536);
        this.generateColortouchCurve(threshold, headroom);
        this.waveShaper.curve = this.curve;
        this.inputNode["connect"](this.preGain);
        this.inputNode["connect"](this.dryNode);
        this.preGain["connect"](this.waveShaper);
        this.waveShaper["connect"](this.postGain);
        this.postGain["connect"](this.wetNode);
    };
    DistortionEffect.prototype.setDrive = function(drive, makeupgain) {
        if (drive < 0.01)
            drive = 0.01;
        this.preGain["gain"]["value"] = drive;
        this.postGain["gain"]["value"] = Math.pow(1 / drive, 0.6) * makeupgain;
    };

    function e4(x, k) {
        return 1.0 - Math.exp(-k * x);
    }
    DistortionEffect.prototype.shape = function(x, linearThreshold, linearHeadroom) {
        var maximum = 1.05 * linearHeadroom * linearThreshold;
        var kk = (maximum - linearThreshold);
        var sign = x < 0 ? -1 : +1;
        var absx = x < 0 ? -x : x;
        var shapedInput = absx < linearThreshold ? absx : linearThreshold + kk * e4(absx - linearThreshold, 1.0 / kk);
        shapedInput *= sign;
        return shapedInput;
    };
    DistortionEffect.prototype.generateColortouchCurve = function(threshold, headroom) {
        var linearThreshold = dbToLinear_nocap(threshold);
        var linearHeadroom = dbToLinear_nocap(headroom);
        var n = 65536;
        var n2 = n / 2;
        var x = 0;
        for (var i = 0; i < n2; ++i) {
            x = i / n2;
            x = this.shape(x, linearThreshold, linearHeadroom);
            this.curve[n2 + i] = x;
            this.curve[n2 - i - 1] = -x;
        }
    };
    DistortionEffect.prototype.connectTo = function(node) {
        this.wetNode["disconnect"]();
        this.wetNode["connect"](node);
        this.dryNode["disconnect"]();
        this.dryNode["connect"](node);
    };
    DistortionEffect.prototype.remove = function() {
        this.inputNode["disconnect"]();
        this.preGain["disconnect"]();
        this.waveShaper["disconnect"]();
        this.postGain["disconnect"]();
        this.wetNode["disconnect"]();
        this.dryNode["disconnect"]();
    };
    DistortionEffect.prototype.getInputNode = function() {
        return this.inputNode;
    };
    DistortionEffect.prototype.setParam = function(param, value, ramp, time) {
        switch (param) {
            case 0: // mix
                value = value / 100;
                if (value < 0) value = 0;
                if (value > 1) value = 1;
                this.params[4] = value;
                setAudioParam(this.wetNode["gain"], value, ramp, time);
                setAudioParam(this.dryNode["gain"], 1 - value, ramp, time);
                break;
        }
    };

    function CompressorEffect(threshold, knee, ratio, attack, release) {
        this.type = "compressor";
        this.params = [threshold, knee, ratio, attack, release];
        this.node = context["createDynamicsCompressor"]();
        try {
            this.node["threshold"]["value"] = threshold;
            this.node["knee"]["value"] = knee;
            this.node["ratio"]["value"] = ratio;
            this.node["attack"]["value"] = attack;
            this.node["release"]["value"] = release;
        } catch (e) {}
    };
    CompressorEffect.prototype.connectTo = function(node_) {
        this.node["disconnect"]();
        this.node["connect"](node_);
    };
    CompressorEffect.prototype.remove = function() {
        this.node["disconnect"]();
    };
    CompressorEffect.prototype.getInputNode = function() {
        return this.node;
    };
    CompressorEffect.prototype.setParam = function(param, value, ramp, time) {};

    function AnalyserEffect(fftSize, smoothing) {
        this.type = "analyser";
        this.params = [fftSize, smoothing];
        this.node = context["createAnalyser"]();
        this.node["fftSize"] = fftSize;
        this.node["smoothingTimeConstant"] = smoothing;
        this.freqBins = new Float32Array(this.node["frequencyBinCount"]);
        this.signal = new Uint8Array(fftSize);
        this.peak = 0;
        this.rms = 0;
    };
    AnalyserEffect.prototype.tick = function() {
        this.node["getFloatFrequencyData"](this.freqBins);
        this.node["getByteTimeDomainData"](this.signal);
        var fftSize = this.node["fftSize"];
        var i = 0;
        this.peak = 0;
        var rmsSquaredSum = 0;
        var s = 0;
        for (; i < fftSize; i++) {
            s = (this.signal[i] - 128) / 128;
            if (s < 0)
                s = -s;
            if (this.peak < s)
                this.peak = s;
            rmsSquaredSum += s * s;
        }
        this.peak = linearToDb(this.peak);
        this.rms = linearToDb(Math.sqrt(rmsSquaredSum / fftSize));
    };
    AnalyserEffect.prototype.connectTo = function(node_) {
        this.node["disconnect"]();
        this.node["connect"](node_);
    };
    AnalyserEffect.prototype.remove = function() {
        this.node["disconnect"]();
    };
    AnalyserEffect.prototype.getInputNode = function() {
        return this.node;
    };
    AnalyserEffect.prototype.setParam = function(param, value, ramp, time) {};
    var OT_POS_SAMPLES = 4;

    function ObjectTracker() {
        this.obj = null;
        this.loadUid = 0;
        this.speeds = [];
        this.lastX = 0;
        this.lastY = 0;
        this.moveAngle = 0;
    };
    ObjectTracker.prototype.setObject = function(obj_) {
        this.obj = obj_;
        if (this.obj) {
            this.lastX = this.obj.x;
            this.lastY = this.obj.y;
        }
        this.speeds.length = 0;
    };
    ObjectTracker.prototype.hasObject = function() {
        return !!this.obj;
    };
    ObjectTracker.prototype.tick = function(dt) {
        if (!this.obj || dt === 0)
            return;
        this.moveAngle = cr.angleTo(this.lastX, this.lastY, this.obj.x, this.obj.y);
        var s = cr.distanceTo(this.lastX, this.lastY, this.obj.x, this.obj.y) / dt;
        if (this.speeds.length < OT_POS_SAMPLES)
            this.speeds.push(s);
        else {
            this.speeds.shift();
            this.speeds.push(s);
        }
        this.lastX = this.obj.x;
        this.lastY = this.obj.y;
    };
    ObjectTracker.prototype.getSpeed = function() {
        if (!this.speeds.length)
            return 0;
        var i, len, sum = 0;
        for (i = 0, len = this.speeds.length; i < len; i++) {
            sum += this.speeds[i];
        }
        return sum / this.speeds.length;
    };
    ObjectTracker.prototype.getVelocityX = function() {
        return Math.cos(this.moveAngle) * this.getSpeed();
    };
    ObjectTracker.prototype.getVelocityY = function() {
        return Math.sin(this.moveAngle) * this.getSpeed();
    };
    var iOShadtouch = false; // has had touch input on iOS to work around web audio API muting
    function C2AudioBuffer(src_, is_music) {
        this.src = src_;
        this.myapi = api;
        this.is_music = is_music;
        this.added_end_listener = false;
        var self = this;
        this.outNode = null;
        this.mediaSourceNode = null;
        this.panWhenReady = []; // for web audio API positioned sounds
        this.seekWhenReady = 0;
        this.pauseWhenReady = false;
        this.supportWebAudioAPI = false;
        if (api === API_WEBAUDIO && is_music) {
            this.myapi = API_HTML5;
            this.outNode = createGain();
        }
        this.bufferObject = null; // actual audio object
        this.audioData = null; // web audio api: ajax request result (compressed audio that needs decoding)
        var request;
        switch (this.myapi) {
            case API_HTML5:
                this.bufferObject = new Audio();
                if (api === API_WEBAUDIO && context["createMediaElementSource"] && !audRuntime.isFirefox && !/wiiu/i.test(navigator.userAgent)) {
                    this.supportWebAudioAPI = true; // can be routed through web audio api
                    this.bufferObject.addEventListener("canplay", function() {
                        if (!self.mediaSourceNode) // protect against this event firing twice
                        {
                            self.mediaSourceNode = context["createMediaElementSource"](self.bufferObject);
                            self.mediaSourceNode["connect"](self.outNode);
                        }
                    });
                }
                this.bufferObject.autoplay = false; // this is only a source buffer, not an instance
                this.bufferObject.preload = "auto";
                this.bufferObject.src = src_;
                break;
            case API_WEBAUDIO:
                request = new XMLHttpRequest();
                request.open("GET", src_, true);
                request.responseType = "arraybuffer";
                request.onload = function() {
                    self.audioData = request.response;
                    self.decodeAudioBuffer();
                };
                request.send();
                break;
            case API_PHONEGAP:
                this.bufferObject = true;
                break;
            case API_APPMOBI:
                this.bufferObject = true;
                break;
        }
    };
    C2AudioBuffer.prototype.decodeAudioBuffer = function() {
        if (this.bufferObject || !this.audioData)
            return; // audio already decoded or AJAX request not yet complete
        var self = this;
        if (context["decodeAudioData"]) {
            context["decodeAudioData"](this.audioData, function(buffer) {
                self.bufferObject = buffer;
                var p, i, len, a;
                if (!cr.is_undefined(self.playTagWhenReady) && !silent) {
                    if (self.panWhenReady.length) {
                        for (i = 0, len = self.panWhenReady.length; i < len; i++) {
                            p = self.panWhenReady[i];
                            a = new C2AudioInstance(self, p.thistag);
                            a.setPannerEnabled(true);
                            if (typeof p.objUid !== "undefined") {
                                p.obj = audRuntime.getObjectByUID(p.objUid);
                                if (!p.obj)
                                    continue;
                            }
                            if (p.obj) {
                                var px = cr.rotatePtAround(p.obj.x, p.obj.y, -p.obj.layer.getAngle(), listenerX, listenerY, true);
                                var py = cr.rotatePtAround(p.obj.x, p.obj.y, -p.obj.layer.getAngle(), listenerX, listenerY, false);
                                a.setPan(px, py, cr.to_degrees(p.obj.angle - p.obj.layer.getAngle()), p.ia, p.oa, p.og);
                                a.setObject(p.obj);
                            } else {
                                a.setPan(p.x, p.y, p.a, p.ia, p.oa, p.og);
                            }
                            a.play(self.loopWhenReady, self.volumeWhenReady, self.seekWhenReady);
                            if (self.pauseWhenReady)
                                a.pause();
                            audioInstances.push(a);
                        }
                        self.panWhenReady.length = 0;
                    } else {
                        a = new C2AudioInstance(self, self.playTagWhenReady);
                        a.play(self.loopWhenReady, self.volumeWhenReady, self.seekWhenReady);
                        if (self.pauseWhenReady)
                            a.pause();
                        audioInstances.push(a);
                    }
                } else if (!cr.is_undefined(self.convolveWhenReady)) {
                    var convolveNode = self.convolveWhenReady.convolveNode;
                    convolveNode["normalize"] = self.normalizeWhenReady;
                    convolveNode["buffer"] = buffer;
                }
            });
        } else {
            this.bufferObject = context["createBuffer"](this.audioData, false);
            if (!cr.is_undefined(this.playTagWhenReady) && !silent) {
                var a = new C2AudioInstance(this, this.playTagWhenReady);
                a.play(this.loopWhenReady, this.volumeWhenReady, this.seekWhenReady);
                if (this.pauseWhenReady)
                    a.pause();
                audioInstances.push(a);
            } else if (!cr.is_undefined(this.convolveWhenReady)) {
                var convolveNode = this.convolveWhenReady.convolveNode;
                convolveNode["normalize"] = this.normalizeWhenReady;
                convolveNode["buffer"] = this.bufferObject;
            }
        }
    };
    C2AudioBuffer.prototype.isLoaded = function() {
        switch (this.myapi) {
            case API_HTML5:
                return this.bufferObject["readyState"] >= 4; // HAVE_ENOUGH_DATA
            case API_WEBAUDIO:
                return !!this.audioData; // null until AJAX request completes
            case API_PHONEGAP:
                return true;
            case API_APPMOBI:
                return true;
        }
        return false;
    };

    function C2AudioInstance(buffer_, tag_) {
        var self = this;
        this.tag = tag_;
        this.fresh = true;
        this.stopped = true;
        this.src = buffer_.src;
        this.buffer = buffer_;
        this.myapi = api;
        this.is_music = buffer_.is_music;
        this.playbackRate = 1;
        this.pgended = true; // for PhoneGap only: ended flag
        this.resume_me = false; // make sure resumes when leaving suspend
        this.is_paused = false;
        this.resume_position = 0; // for web audio api to resume from correct playback position
        this.looping = false;
        this.is_muted = false;
        this.is_silent = false;
        this.volume = 1;
        this.mutevol = 1;
        this.startTime = audRuntime.kahanTime.sum;
        this.gainNode = null;
        this.pannerNode = null;
        this.pannerEnabled = false;
        this.objectTracker = null;
        this.panX = 0;
        this.panY = 0;
        this.panAngle = 0;
        this.panConeInner = 0;
        this.panConeOuter = 0;
        this.panConeOuterGain = 0;
        this.instanceObject = null;
        var add_end_listener = false;
        if (this.myapi === API_WEBAUDIO && this.buffer.myapi === API_HTML5 && !this.buffer.supportWebAudioAPI)
            this.myapi = API_HTML5;
        switch (this.myapi) {
            case API_HTML5:
                if (this.is_music) {
                    this.instanceObject = buffer_.bufferObject;
                    add_end_listener = !buffer_.added_end_listener;
                    buffer_.added_end_listener = true;
                } else {
                    this.instanceObject = new Audio();
                    this.instanceObject.autoplay = false;
                    this.instanceObject.src = buffer_.bufferObject.src;
                    add_end_listener = true;
                }
                if (add_end_listener) {
                    this.instanceObject.addEventListener('ended', function() {
                        audTag = self.tag;
                        self.stopped = true;
                        audRuntime.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded, audInst);
                    });
                }
                break;
            case API_WEBAUDIO:
                this.gainNode = createGain();
                this.gainNode["connect"](getDestinationForTag(tag_));
                if (this.buffer.myapi === API_WEBAUDIO) {
                    if (buffer_.bufferObject) {
                        this.instanceObject = context["createBufferSource"]();
                        this.instanceObject["buffer"] = buffer_.bufferObject;
                        this.instanceObject["connect"](this.gainNode);
                    }
                } else {
                    this.instanceObject = this.buffer.bufferObject; // reference the audio element
                    this.buffer.outNode["connect"](this.gainNode);
                }
                break;
            case API_PHONEGAP:
                this.instanceObject = new window["Media"](appPath + this.src, null, null, function(status) {
                    if (status === window["Media"]["MEDIA_STOPPED"]) {
                        self.pgended = true;
                        self.stopped = true;
                        audTag = self.tag;
                        audRuntime.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded, audInst);
                    }
                });
                break;
            case API_APPMOBI:
                this.instanceObject = true;
                break;
        }
    };
    C2AudioInstance.prototype.hasEnded = function() {
        switch (this.myapi) {
            case API_HTML5:
                return this.instanceObject.ended;
            case API_WEBAUDIO:
                if (this.buffer.myapi === API_WEBAUDIO) {
                    if (!this.fresh && !this.stopped && this.instanceObject["loop"])
                        return false;
                    if (this.is_paused)
                        return false;
                    return (audRuntime.kahanTime.sum - this.startTime) > this.buffer.bufferObject["duration"];
                } else
                    return this.instanceObject.ended;
            case API_PHONEGAP:
                return this.pgended;
            case API_APPMOBI:
                true; // recycling an AppMobi sound does not matter because it will just do another throwaway playSound
        }
        return true;
    };
    C2AudioInstance.prototype.canBeRecycled = function() {
        if (this.fresh || this.stopped)
            return true; // not yet used or is not playing
        return this.hasEnded();
    };
    C2AudioInstance.prototype.setPannerEnabled = function(enable_) {
        if (api !== API_WEBAUDIO)
            return;
        if (!this.pannerEnabled && enable_) {
            if (!this.gainNode)
                return;
            if (!this.pannerNode) {
                this.pannerNode = context["createPanner"]();
                if (typeof this.pannerNode["panningModel"] === "number")
                    this.pannerNode["panningModel"] = panningModel;
                else
                    this.pannerNode["panningModel"] = ["equalpower", "HRTF", "soundfield"][panningModel];
                if (typeof this.pannerNode["distanceModel"] === "number")
                    this.pannerNode["distanceModel"] = distanceModel;
                else
                    this.pannerNode["distanceModel"] = ["linear", "inverse", "exponential"][distanceModel];
                this.pannerNode["refDistance"] = refDistance;
                this.pannerNode["maxDistance"] = maxDistance;
                this.pannerNode["rolloffFactor"] = rolloffFactor;
            }
            this.gainNode["disconnect"]();
            this.gainNode["connect"](this.pannerNode);
            this.pannerNode["connect"](getDestinationForTag(this.tag));
            this.pannerEnabled = true;
        } else if (this.pannerEnabled && !enable_) {
            if (!this.gainNode)
                return;
            this.pannerNode["disconnect"]();
            this.gainNode["disconnect"]();
            this.gainNode["connect"](getDestinationForTag(this.tag));
            this.pannerEnabled = false;
        }
    };
    C2AudioInstance.prototype.setPan = function(x, y, angle, innerangle, outerangle, outergain) {
        if (!this.pannerEnabled || api !== API_WEBAUDIO)
            return;
        this.pannerNode["setPosition"](x, y, 0);
        this.pannerNode["setOrientation"](Math.cos(cr.to_radians(angle)), Math.sin(cr.to_radians(angle)), 0);
        this.pannerNode["coneInnerAngle"] = innerangle;
        this.pannerNode["coneOuterAngle"] = outerangle;
        this.pannerNode["coneOuterGain"] = outergain;
        this.panX = x;
        this.panY = y;
        this.panAngle = angle;
        this.panConeInner = innerangle;
        this.panConeOuter = outerangle;
        this.panConeOuterGain = outergain;
    };
    C2AudioInstance.prototype.setObject = function(o) {
        if (!this.pannerEnabled || api !== API_WEBAUDIO)
            return;
        if (!this.objectTracker)
            this.objectTracker = new ObjectTracker();
        this.objectTracker.setObject(o);
    };
    C2AudioInstance.prototype.tick = function(dt) {
        if (!this.pannerEnabled || api !== API_WEBAUDIO || !this.objectTracker || !this.objectTracker.hasObject() || !this.isPlaying()) {
            return;
        }
        this.objectTracker.tick(dt);
        var inst = this.objectTracker.obj;
        var px = cr.rotatePtAround(inst.x, inst.y, -inst.layer.getAngle(), listenerX, listenerY, true);
        var py = cr.rotatePtAround(inst.x, inst.y, -inst.layer.getAngle(), listenerX, listenerY, false);
        this.pannerNode["setPosition"](px, py, 0);
        var a = 0;
        if (typeof this.objectTracker.obj.angle !== "undefined") {
            a = inst.angle - inst.layer.getAngle();
            this.pannerNode["setOrientation"](Math.cos(a), Math.sin(a), 0);
        }
        px = cr.rotatePtAround(this.objectTracker.getVelocityX(), this.objectTracker.getVelocityY(), -inst.layer.getAngle(), 0, 0, true);
        py = cr.rotatePtAround(this.objectTracker.getVelocityX(), this.objectTracker.getVelocityY(), -inst.layer.getAngle(), 0, 0, false);
        this.pannerNode["setVelocity"](px, py, 0);
    };
    C2AudioInstance.prototype.play = function(looping, vol, fromPosition) {
        var instobj = this.instanceObject;
        this.looping = looping;
        this.volume = vol;
        var seekPos = fromPosition || 0;
        switch (this.myapi) {
            case API_HTML5:
                if (instobj.playbackRate !== 1.0)
                    instobj.playbackRate = 1.0;
                if (instobj.volume !== vol * masterVolume)
                    instobj.volume = vol * masterVolume;
                if (instobj.loop !== looping)
                    instobj.loop = looping;
                if (instobj.muted)
                    instobj.muted = false;
                if (instobj.currentTime !== seekPos) {
                    try {
                        instobj.currentTime = seekPos;
                    } catch (err) {;
                    }
                }
                if (this.is_music && isMusicWorkaround && !audRuntime.isInUserInputEvent)
                    musicPlayNextTouch.push(this);
                else {
                    try {
                        this.instanceObject.play();
                    } catch (e) {} // sometimes throws on WP8.1... try not to kill the app
                }
                break;
            case API_WEBAUDIO:
                this.muted = false;
                this.mutevol = 1;
                if (this.buffer.myapi === API_WEBAUDIO) {
                    if (!this.fresh) {
                        this.instanceObject = context["createBufferSource"]();
                        this.instanceObject["buffer"] = this.buffer.bufferObject;
                        this.instanceObject["connect"](this.gainNode);
                    }
                    this.instanceObject.loop = looping;
                    this.gainNode["gain"]["value"] = vol * masterVolume;
                    if (seekPos === 0)
                        startSource(this.instanceObject);
                    else
                        startSourceAt(this.instanceObject, seekPos, this.getDuration());
                } else {
                    if (instobj.playbackRate !== 1.0)
                        instobj.playbackRate = 1.0;
                    if (instobj.loop !== looping)
                        instobj.loop = looping;
                    this.gainNode["gain"]["value"] = vol * masterVolume;
                    if (instobj.currentTime !== seekPos) {
                        try {
                            instobj.currentTime = seekPos;
                        } catch (err) {;
                        }
                    }
                    if (this.is_music && isMusicWorkaround && !audRuntime.isInUserInputEvent)
                        musicPlayNextTouch.push(this);
                    else
                        instobj.play();
                }
                break;
            case API_PHONEGAP:
                if ((!this.fresh && this.stopped) || seekPos !== 0)
                    instobj["seekTo"](seekPos);
                instobj["play"]();
                this.pgended = false;
                break;
            case API_APPMOBI:
                if (audRuntime.isDirectCanvas)
                    AppMobi["context"]["playSound"](this.src, looping);
                else
                    AppMobi["player"]["playSound"](this.src, looping);
                break;
        }
        this.playbackRate = 1;
        this.startTime = audRuntime.kahanTime.sum - seekPos;
        this.fresh = false;
        this.stopped = false;
        this.is_paused = false;
    };
    C2AudioInstance.prototype.stop = function() {
        switch (this.myapi) {
            case API_HTML5:
                if (!this.instanceObject.paused)
                    this.instanceObject.pause();
                break;
            case API_WEBAUDIO:
                if (this.buffer.myapi === API_WEBAUDIO)
                    stopSource(this.instanceObject);
                else {
                    if (!this.instanceObject.paused)
                        this.instanceObject.pause();
                }
                break;
            case API_PHONEGAP:
                this.instanceObject["stop"]();
                break;
            case API_APPMOBI:
                if (audRuntime.isDirectCanvas)
                    AppMobi["context"]["stopSound"](this.src);
                break;
        }
        this.stopped = true;
        this.is_paused = false;
    };
    C2AudioInstance.prototype.pause = function() {
        if (this.fresh || this.stopped || this.hasEnded() || this.is_paused)
            return;
        switch (this.myapi) {
            case API_HTML5:
                if (!this.instanceObject.paused)
                    this.instanceObject.pause();
                break;
            case API_WEBAUDIO:
                if (this.buffer.myapi === API_WEBAUDIO) {
                    this.resume_position = this.getPlaybackTime();
                    if (this.looping)
                        this.resume_position = this.resume_position % this.getDuration();
                    stopSource(this.instanceObject);
                } else {
                    if (!this.instanceObject.paused)
                        this.instanceObject.pause();
                }
                break;
            case API_PHONEGAP:
                this.instanceObject["pause"]();
                break;
            case API_APPMOBI:
                if (audRuntime.isDirectCanvas)
                    AppMobi["context"]["stopSound"](this.src);
                break;
        }
        this.is_paused = true;
    };
    C2AudioInstance.prototype.resume = function() {
        if (this.fresh || this.stopped || this.hasEnded() || !this.is_paused)
            return;
        switch (this.myapi) {
            case API_HTML5:
                this.instanceObject.play();
                break;
            case API_WEBAUDIO:
                if (this.buffer.myapi === API_WEBAUDIO) {
                    this.instanceObject = context["createBufferSource"]();
                    this.instanceObject["buffer"] = this.buffer.bufferObject;
                    this.instanceObject["connect"](this.gainNode);
                    this.instanceObject.loop = this.looping;
                    this.gainNode["gain"]["value"] = masterVolume * this.volume * this.mutevol;
                    this.startTime = audRuntime.kahanTime.sum - this.resume_position;
                    startSourceAt(this.instanceObject, this.resume_position, this.getDuration());
                } else {
                    this.instanceObject.play();
                }
                break;
            case API_PHONEGAP:
                this.instanceObject["play"]();
                break;
            case API_APPMOBI:
                if (audRuntime.isDirectCanvas)
                    AppMobi["context"]["resumeSound"](this.src);
                break;
        }
        this.is_paused = false;
    };
    C2AudioInstance.prototype.seek = function(pos) {
        if (this.fresh || this.stopped || this.hasEnded())
            return;
        switch (this.myapi) {
            case API_HTML5:
                try {
                    this.instanceObject.currentTime = pos;
                } catch (e) {}
                break;
            case API_WEBAUDIO:
                if (this.buffer.myapi === API_WEBAUDIO) {
                    if (this.is_paused)
                        this.resume_position = pos;
                    else {
                        this.pause();
                        this.resume_position = pos;
                        this.resume();
                    }
                } else {
                    try {
                        this.instanceObject.currentTime = pos;
                    } catch (e) {}
                }
                break;
            case API_PHONEGAP:
                break;
            case API_APPMOBI:
                if (audRuntime.isDirectCanvas)
                    AppMobi["context"]["seekSound"](this.src, pos);
                break;
        }
    };
    C2AudioInstance.prototype.reconnect = function(toNode) {
        if (this.myapi !== API_WEBAUDIO)
            return;
        if (this.pannerEnabled) {
            this.pannerNode["disconnect"]();
            this.pannerNode["connect"](toNode);
        } else {
            this.gainNode["disconnect"]();
            this.gainNode["connect"](toNode);
        }
    };
    C2AudioInstance.prototype.getDuration = function() {
        switch (this.myapi) {
            case API_HTML5:
                if (typeof this.instanceObject.duration !== "undefined")
                    return this.instanceObject.duration;
                else
                    return 0;
            case API_WEBAUDIO:
                return this.buffer.bufferObject["duration"];
            case API_PHONEGAP:
                return this.instanceObject["getDuration"]();
            case API_APPMOBI:
                if (audRuntime.isDirectCanvas)
                    return AppMobi["context"]["getDurationSound"](this.src);
                else
                    return 0;
        }
        return 0;
    };
    C2AudioInstance.prototype.getPlaybackTime = function() {
        var duration = this.getDuration();
        var ret = 0;
        switch (this.myapi) {
            case API_HTML5:
                if (typeof this.instanceObject.currentTime !== "undefined")
                    ret = this.instanceObject.currentTime;
                break;
            case API_WEBAUDIO:
                if (this.buffer.myapi === API_WEBAUDIO) {
                    if (this.is_paused)
                        return this.resume_position;
                    else
                        ret = audRuntime.kahanTime.sum - this.startTime;
                } else if (typeof this.instanceObject.currentTime !== "undefined")
                    ret = this.instanceObject.currentTime;
                break;
            case API_PHONEGAP:
                break;
            case API_APPMOBI:
                if (audRuntime.isDirectCanvas)
                    ret = AppMobi["context"]["getPlaybackTimeSound"](this.src);
                break;
        }
        if (!this.looping && ret > duration)
            ret = duration;
        return ret;
    };
    C2AudioInstance.prototype.isPlaying = function() {
        return !this.is_paused && !this.fresh && !this.stopped && !this.hasEnded();
    };
    C2AudioInstance.prototype.setVolume = function(v) {
        this.volume = v;
        this.updateVolume();
    };
    C2AudioInstance.prototype.updateVolume = function() {
        var volToSet = this.volume * masterVolume;
        switch (this.myapi) {
            case API_HTML5:
                if (this.instanceObject.volume && this.instanceObject.volume !== volToSet)
                    this.instanceObject.volume = volToSet;
                break;
            case API_WEBAUDIO:
                this.gainNode["gain"]["value"] = volToSet * this.mutevol;
                break;
            case API_PHONEGAP:
                break;
            case API_APPMOBI:
                break;
        }
    };
    C2AudioInstance.prototype.getVolume = function() {
        return this.volume;
    };
    C2AudioInstance.prototype.doSetMuted = function(m) {
        switch (this.myapi) {
            case API_HTML5:
                if (this.instanceObject.muted !== !!m)
                    this.instanceObject.muted = !!m;
                break;
            case API_WEBAUDIO:
                this.mutevol = (m ? 0 : 1);
                this.gainNode["gain"]["value"] = masterVolume * this.volume * this.mutevol;
                break;
            case API_PHONEGAP:
                break;
            case API_APPMOBI:
                break;
        }
    };
    C2AudioInstance.prototype.setMuted = function(m) {
        this.is_muted = !!m;
        this.doSetMuted(this.is_muted || this.is_silent);
    };
    C2AudioInstance.prototype.setSilent = function(m) {
        this.is_silent = !!m;
        this.doSetMuted(this.is_muted || this.is_silent);
    };
    C2AudioInstance.prototype.setLooping = function(l) {
        this.looping = l;
        switch (this.myapi) {
            case API_HTML5:
                if (this.instanceObject.loop !== !!l)
                    this.instanceObject.loop = !!l;
                break;
            case API_WEBAUDIO:
                if (this.instanceObject.loop !== !!l)
                    this.instanceObject.loop = !!l;
                break;
            case API_PHONEGAP:
                break;
            case API_APPMOBI:
                if (audRuntime.isDirectCanvas)
                    AppMobi["context"]["setLoopingSound"](this.src, l);
                break;
        }
    };
    C2AudioInstance.prototype.setPlaybackRate = function(r) {
        this.playbackRate = r;
        this.updatePlaybackRate();
    };
    C2AudioInstance.prototype.updatePlaybackRate = function() {
        var r = this.playbackRate;
        if ((timescale_mode === 1 && !this.is_music) || timescale_mode === 2)
            r *= audRuntime.timescale;
        switch (this.myapi) {
            case API_HTML5:
                if (this.instanceObject.playbackRate !== r)
                    this.instanceObject.playbackRate = r;
                break;
            case API_WEBAUDIO:
                if (this.buffer.myapi === API_WEBAUDIO) {
                    if (this.instanceObject["playbackRate"]["value"] !== r)
                        this.instanceObject["playbackRate"]["value"] = r;
                } else {
                    if (this.instanceObject.playbackRate !== r)
                        this.instanceObject.playbackRate = r;
                }
                break;
            case API_PHONEGAP:
                break;
            case API_APPMOBI:
                break;
        }
    };
    C2AudioInstance.prototype.setSuspended = function(s) {
        switch (this.myapi) {
            case API_HTML5:
                if (s) {
                    if (this.isPlaying()) {
                        this.instanceObject["pause"]();
                        this.resume_me = true;
                    } else
                        this.resume_me = false;
                } else {
                    if (this.resume_me)
                        this.instanceObject["play"]();
                }
                break;
            case API_WEBAUDIO:
                if (s) {
                    if (this.isPlaying()) {
                        if (this.buffer.myapi === API_WEBAUDIO) {
                            this.resume_position = this.getPlaybackTime();
                            if (this.looping)
                                this.resume_position = this.resume_position % this.getDuration();
                            stopSource(this.instanceObject);
                        } else
                            this.instanceObject["pause"]();
                        this.resume_me = true;
                    } else
                        this.resume_me = false;
                } else {
                    if (this.resume_me) {
                        if (this.buffer.myapi === API_WEBAUDIO) {
                            this.instanceObject = context["createBufferSource"]();
                            this.instanceObject["buffer"] = this.buffer.bufferObject;
                            this.instanceObject["connect"](this.gainNode);
                            this.instanceObject.loop = this.looping;
                            this.gainNode["gain"]["value"] = masterVolume * this.volume * this.mutevol;
                            this.startTime = audRuntime.kahanTime.sum - this.resume_position;
                            startSourceAt(this.instanceObject, this.resume_position, this.getDuration());
                        } else {
                            this.instanceObject["play"]();
                        }
                    }
                }
                break;
            case API_PHONEGAP:
                if (s) {
                    if (this.isPlaying()) {
                        this.instanceObject["pause"]();
                        this.resume_me = true;
                    } else
                        this.resume_me = false;
                } else {
                    if (this.resume_me)
                        this.instanceObject["play"]();
                }
                break;
            case API_APPMOBI:
                break;
        }
    };
    pluginProto.Instance = function(type) {
        this.type = type;
        this.runtime = type.runtime;
        audRuntime = this.runtime;
        audInst = this;
        this.listenerTracker = null;
        this.listenerZ = -600;
        if ((this.runtime.isiOS || (this.runtime.isAndroid && (this.runtime.isChrome || this.runtime.isAndroidStockBrowser))) && !this.runtime.isCrosswalk && !this.runtime.isDomFree) {
            isMusicWorkaround = true;
        }
        context = null;
        if (typeof AudioContext !== "undefined") {
            api = API_WEBAUDIO;
            context = new AudioContext();
        } else if (typeof webkitAudioContext !== "undefined") {
            api = API_WEBAUDIO;
            context = new webkitAudioContext();
        }
        if ((this.runtime.isiOS && api === API_WEBAUDIO) || isMusicWorkaround) {
            document.addEventListener("touchstart", function() {
                var i, len, m;
                if (!iOShadtouch && context) {
                    var buffer = context["createBuffer"](1, 1, 22050);
                    var source = context["createBufferSource"]();
                    source["buffer"] = buffer;
                    source["connect"](context["destination"]);
                    startSource(source);
                    iOShadtouch = true;
                }
                if (isMusicWorkaround) {
                    if (!silent) {
                        for (i = 0, len = musicPlayNextTouch.length; i < len; ++i) {
                            m = musicPlayNextTouch[i];
                            if (!m.stopped && !m.is_paused)
                                m.instanceObject.play();
                        }
                    }
                    musicPlayNextTouch.length = 0;
                }
            }, true);
        }
        if (api !== API_WEBAUDIO) {
            if (this.runtime.isPhoneGap)
                api = API_PHONEGAP;
            else if (this.runtime.isAppMobi)
                api = API_APPMOBI;
        }
        if (api === API_PHONEGAP) {
            appPath = location.href;
            var i = appPath.lastIndexOf("/");
            if (i > -1)
                appPath = appPath.substr(0, i + 1);
            appPath = appPath.replace("file://", "");
        }
        if (this.runtime.isSafari && this.runtime.isWindows && typeof Audio === "undefined") {
            alert("It looks like you're using Safari for Windows without Quicktime.  Audio cannot be played until Quicktime is installed.");
            this.runtime.DestroyInstance(this);
        } else {
            if (this.runtime.isDirectCanvas)
                useOgg = this.runtime.isAndroid; // AAC on iOS, OGG on Android
            else {
                try {
                    useOgg = !!(new Audio().canPlayType('audio/ogg; codecs="vorbis"'));
                } catch (e) {
                    useOgg = false;
                }
            }
            switch (api) {
                case API_HTML5:
                    ;
                    break;
                case API_WEBAUDIO:
                    ;
                    break;
                case API_PHONEGAP:
                    ;
                    break;
                case API_APPMOBI:
                    ;
                    break;
                default:
                    ;
            }
            this.runtime.tickMe(this);
        }
    };
    var instanceProto = pluginProto.Instance.prototype;
    instanceProto.onCreate = function() {
        timescale_mode = this.properties[0]; // 0 = off, 1 = sounds only, 2 = all
        this.saveload = this.properties[1]; // 0 = all, 1 = sounds only, 2 = music only, 3 = none
        panningModel = this.properties[2]; // 0 = equalpower, 1 = hrtf, 3 = soundfield
        distanceModel = this.properties[3]; // 0 = linear, 1 = inverse, 2 = exponential
        this.listenerZ = -this.properties[4];
        refDistance = this.properties[5];
        maxDistance = this.properties[6];
        rolloffFactor = this.properties[7];
        this.listenerTracker = new ObjectTracker();
        if (api === API_WEBAUDIO) {
            context["listener"]["speedOfSound"] = this.properties[8];
            context["listener"]["dopplerFactor"] = this.properties[9];
            context["listener"]["setPosition"](this.runtime.draw_width / 2, this.runtime.draw_height / 2, this.listenerZ);
            context["listener"]["setOrientation"](0, 0, 1, 0, -1, 0);
            window["c2OnAudioMicStream"] = function(localMediaStream, tag) {
                if (micSource)
                    micSource["disconnect"]();
                micTag = tag.toLowerCase();
                micSource = context["createMediaStreamSource"](localMediaStream);
                micSource["connect"](getDestinationForTag(micTag));
            };
        }
        this.runtime.addSuspendCallback(function(s) {
            audInst.onSuspend(s);
        });
        var self = this;
        this.runtime.addDestroyCallback(function(inst) {
            self.onInstanceDestroyed(inst);
        });
    };
    instanceProto.onInstanceDestroyed = function(inst) {
        var i, len, a;
        for (i = 0, len = audioInstances.length; i < len; i++) {
            a = audioInstances[i];
            if (a.objectTracker) {
                if (a.objectTracker.obj === inst) {
                    a.objectTracker.obj = null;
                    if (a.pannerEnabled && a.isPlaying() && a.looping)
                        a.stop();
                }
            }
        }
        if (this.listenerTracker.obj === inst)
            this.listenerTracker.obj = null;
    };
    instanceProto.saveToJSON = function() {
        var o = {
            "silent": silent,
            "masterVolume": masterVolume,
            "listenerZ": this.listenerZ,
            "listenerUid": this.listenerTracker.hasObject() ? this.listenerTracker.obj.uid : -1,
            "playing": [],
            "effects": {}
        };
        var playingarr = o["playing"];
        var i, len, a, d, p, panobj, playbackTime;
        for (i = 0, len = audioInstances.length; i < len; i++) {
            a = audioInstances[i];
            if (!a.isPlaying())
                continue; // no need to save stopped sounds
            if (this.saveload === 3) // not saving/loading any sounds/music
                continue;
            if (a.is_music && this.saveload === 1) // not saving/loading music
                continue;
            if (!a.is_music && this.saveload === 2) // not saving/loading sound
                continue;
            playbackTime = a.getPlaybackTime();
            if (a.looping)
                playbackTime = playbackTime % a.getDuration();
            d = {
                "tag": a.tag,
                "buffersrc": a.buffer.src,
                "is_music": a.is_music,
                "playbackTime": playbackTime,
                "volume": a.volume,
                "looping": a.looping,
                "muted": a.is_muted,
                "playbackRate": a.playbackRate,
                "paused": a.is_paused,
                "resume_position": a.resume_position
            };
            if (a.pannerEnabled) {
                d["pan"] = {};
                panobj = d["pan"];
                if (a.objectTracker && a.objectTracker.hasObject()) {
                    panobj["objUid"] = a.objectTracker.obj.uid;
                } else {
                    panobj["x"] = a.panX;
                    panobj["y"] = a.panY;
                    panobj["a"] = a.panAngle;
                }
                panobj["ia"] = a.panConeInner;
                panobj["oa"] = a.panConeOuter;
                panobj["og"] = a.panConeOuterGain;
            }
            playingarr.push(d);
        }
        var fxobj = o["effects"];
        var fxarr;
        for (p in effects) {
            if (effects.hasOwnProperty(p)) {
                fxarr = [];
                for (i = 0, len = effects[p].length; i < len; i++) {
                    fxarr.push({
                        "type": effects[p][i].type,
                        "params": effects[p][i].params
                    });
                }
                fxobj[p] = fxarr;
            }
        }
        return o;
    };
    var objectTrackerUidsToLoad = [];
    instanceProto.loadFromJSON = function(o) {
        var setSilent = o["silent"];
        masterVolume = o["masterVolume"];
        this.listenerZ = o["listenerZ"];
        this.listenerTracker.setObject(null);
        var listenerUid = o["listenerUid"];
        if (listenerUid !== -1) {
            this.listenerTracker.loadUid = listenerUid;
            objectTrackerUidsToLoad.push(this.listenerTracker);
        }
        var playingarr = o["playing"];
        var i, len, d, src, is_music, tag, playbackTime, looping, vol, b, a, p, pan, panObjUid;
        if (this.saveload !== 3) {
            for (i = 0, len = audioInstances.length; i < len; i++) {
                a = audioInstances[i];
                if (a.is_music && this.saveload === 1)
                    continue; // only saving/loading sound: leave music playing
                if (!a.is_music && this.saveload === 2)
                    continue; // only saving/loading music: leave sound playing
                a.stop();
            }
        }
        var fxarr, fxtype, fxparams, fx;
        for (p in effects) {
            if (effects.hasOwnProperty(p)) {
                for (i = 0, len = effects[p].length; i < len; i++)
                    effects[p][i].remove();
            }
        }
        cr.wipe(effects);
        for (p in o["effects"]) {
            if (o["effects"].hasOwnProperty(p)) {
                fxarr = o["effects"][p];
                for (i = 0, len = fxarr.length; i < len; i++) {
                    fxtype = fxarr[i]["type"];
                    fxparams = fxarr[i]["params"];
                    switch (fxtype) {
                        case "filter":
                            addEffectForTag(p, new FilterEffect(fxparams[0], fxparams[1], fxparams[2], fxparams[3], fxparams[4], fxparams[5]));
                            break;
                        case "delay":
                            addEffectForTag(p, new DelayEffect(fxparams[0], fxparams[1], fxparams[2]));
                            break;
                        case "convolve":
                            src = fxparams[2];
                            b = this.getAudioBuffer(src, false);
                            if (b.bufferObject) {
                                fx = new ConvolveEffect(b.bufferObject, fxparams[0], fxparams[1], src);
                            } else {
                                fx = new ConvolveEffect(null, fxparams[0], fxparams[1], src);
                                b.normalizeWhenReady = fxparams[0];
                                b.convolveWhenReady = fx;
                            }
                            addEffectForTag(p, fx);
                            break;
                        case "flanger":
                            addEffectForTag(p, new FlangerEffect(fxparams[0], fxparams[1], fxparams[2], fxparams[3], fxparams[4]));
                            break;
                        case "phaser":
                            addEffectForTag(p, new PhaserEffect(fxparams[0], fxparams[1], fxparams[2], fxparams[3], fxparams[4], fxparams[5]));
                            break;
                        case "gain":
                            addEffectForTag(p, new GainEffect(fxparams[0]));
                            break;
                        case "tremolo":
                            addEffectForTag(p, new TremoloEffect(fxparams[0], fxparams[1]));
                            break;
                        case "ringmod":
                            addEffectForTag(p, new RingModulatorEffect(fxparams[0], fxparams[1]));
                            break;
                        case "distortion":
                            addEffectForTag(p, new DistortionEffect(fxparams[0], fxparams[1], fxparams[2], fxparams[3], fxparams[4]));
                            break;
                        case "compressor":
                            addEffectForTag(p, new CompressorEffect(fxparams[0], fxparams[1], fxparams[2], fxparams[3], fxparams[4]));
                            break;
                        case "analyser":
                            addEffectForTag(p, new AnalyserEffect(fxparams[0], fxparams[1]));
                            break;
                    }
                }
            }
        }
        for (i = 0, len = playingarr.length; i < len; i++) {
            if (this.saveload === 3) // not saving/loading any sounds/music
                continue;
            d = playingarr[i];
            src = d["buffersrc"];
            is_music = d["is_music"];
            tag = d["tag"];
            playbackTime = d["playbackTime"];
            looping = d["looping"];
            vol = d["volume"];
            pan = d["pan"];
            panObjUid = (pan && pan.hasOwnProperty("objUid")) ? pan["objUid"] : -1;
            if (is_music && this.saveload === 1) // not saving/loading music
                continue;
            if (!is_music && this.saveload === 2) // not saving/loading sound
                continue;
            a = this.getAudioInstance(src, tag, is_music, looping, vol);
            if (!a) {
                b = this.getAudioBuffer(src, is_music);
                b.seekWhenReady = playbackTime;
                b.pauseWhenReady = d["paused"];
                if (pan) {
                    if (panObjUid !== -1) {
                        b.panWhenReady.push({
                            objUid: panObjUid,
                            ia: pan["ia"],
                            oa: pan["oa"],
                            og: pan["og"],
                            thistag: tag
                        });
                    } else {
                        b.panWhenReady.push({
                            x: pan["x"],
                            y: pan["y"],
                            a: pan["a"],
                            ia: pan["ia"],
                            oa: pan["oa"],
                            og: pan["og"],
                            thistag: tag
                        });
                    }
                }
                continue;
            }
            a.resume_position = d["resume_position"];
            a.setPannerEnabled(!!pan);
            a.play(looping, vol, playbackTime);
            a.updatePlaybackRate();
            a.updateVolume();
            a.doSetMuted(a.is_muted || a.is_silent);
            if (d["paused"])
                a.pause();
            if (d["muted"])
                a.setMuted(true);
            a.doSetMuted(a.is_muted || a.is_silent);
            if (pan) {
                if (panObjUid !== -1) {
                    a.objectTracker = a.objectTracker || new ObjectTracker();
                    a.objectTracker.loadUid = panObjUid;
                    objectTrackerUidsToLoad.push(a.objectTracker);
                } else {
                    a.setPan(pan["x"], pan["y"], pan["a"], pan["ia"], pan["oa"], pan["og"]);
                }
            }
        }
        if (setSilent && !silent) // setting silent
        {
            for (i = 0, len = audioInstances.length; i < len; i++)
                audioInstances[i].setSilent(true);
            silent = true;
        } else if (!setSilent && silent) // setting not silent
        {
            for (i = 0, len = audioInstances.length; i < len; i++)
                audioInstances[i].setSilent(false);
            silent = false;
        }
    };
    instanceProto.afterLoad = function() {
        var i, len, ot, inst;
        for (i = 0, len = objectTrackerUidsToLoad.length; i < len; i++) {
            ot = objectTrackerUidsToLoad[i];
            inst = this.runtime.getObjectByUID(ot.loadUid);
            ot.setObject(inst);
            ot.loadUid = -1;
            if (inst) {
                listenerX = inst.x;
                listenerY = inst.y;
            }
        }
        objectTrackerUidsToLoad.length = 0;
    };
    instanceProto.onSuspend = function(s) {
        var i, len;
        for (i = 0, len = audioInstances.length; i < len; i++)
            audioInstances[i].setSuspended(s);
    };
    instanceProto.tick = function() {
        var dt = this.runtime.dt;
        var i, len, a;
        for (i = 0, len = audioInstances.length; i < len; i++) {
            a = audioInstances[i];
            a.tick(dt);
            if (a.myapi !== API_HTML5 && a.myapi !== API_APPMOBI) {
                if (!a.fresh && !a.stopped && a.hasEnded()) {
                    a.stopped = true;
                    audTag = a.tag;
                    audRuntime.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded, audInst);
                }
            }
            if (timescale_mode !== 0)
                a.updatePlaybackRate();
        }
        var p, arr, f;
        for (p in effects) {
            if (effects.hasOwnProperty(p)) {
                arr = effects[p];
                for (i = 0, len = arr.length; i < len; i++) {
                    f = arr[i];
                    if (f.tick)
                        f.tick();
                }
            }
        }
        if (api === API_WEBAUDIO && this.listenerTracker.hasObject()) {
            this.listenerTracker.tick(dt);
            listenerX = this.listenerTracker.obj.x;
            listenerY = this.listenerTracker.obj.y;
            context["listener"]["setPosition"](this.listenerTracker.obj.x, this.listenerTracker.obj.y, this.listenerZ);
            context["listener"]["setVelocity"](this.listenerTracker.getVelocityX(), this.listenerTracker.getVelocityY(), 0);
        }
    };
    instanceProto.getAudioBuffer = function(src_, is_music) {
        var i, len, a, ret = null,
            j, k, lenj, ai;
        for (i = 0, len = audioBuffers.length; i < len; i++) {
            a = audioBuffers[i];
            if (a.src === src_) {
                ret = a;
                break;
            }
        }
        if (!ret) {
            ret = new C2AudioBuffer(src_, is_music);
            audioBuffers.push(ret);
        }
        return ret;
    };
    instanceProto.getAudioInstance = function(src_, tag, is_music, looping, vol) {
        var i, len, a;
        for (i = 0, len = audioInstances.length; i < len; i++) {
            a = audioInstances[i];
            if (a.src === src_ && (a.canBeRecycled() || is_music)) {
                a.tag = tag;
                return a;
            }
        }
        var b = this.getAudioBuffer(src_, is_music);
        if (!b.bufferObject) {
            if (tag !== "<preload>") {
                b.playTagWhenReady = tag;
                b.loopWhenReady = looping;
                b.volumeWhenReady = vol;
            }
            return null;
        }
        a = new C2AudioInstance(b, tag);
        audioInstances.push(a);
        return a;
    };
    var taggedAudio = [];

    function getAudioByTag(tag) {
        taggedAudio.length = 0;
        if (!tag.length) {
            if (!lastAudio || lastAudio.hasEnded())
                return;
            else {
                taggedAudio.length = 1;
                taggedAudio[0] = lastAudio;
                return;
            }
        }
        var i, len, a;
        for (i = 0, len = audioInstances.length; i < len; i++) {
            a = audioInstances[i];
            if (cr.equals_nocase(tag, a.tag))
                taggedAudio.push(a);
        }
    };

    function reconnectEffects(tag) {
        var i, len, arr, n, toNode = context["destination"];
        if (effects.hasOwnProperty(tag)) {
            arr = effects[tag];
            if (arr.length) {
                toNode = arr[0].getInputNode();
                for (i = 0, len = arr.length; i < len; i++) {
                    n = arr[i];
                    if (i + 1 === len)
                        n.connectTo(context["destination"]);
                    else
                        n.connectTo(arr[i + 1].getInputNode());
                }
            }
        }
        getAudioByTag(tag);
        for (i = 0, len = taggedAudio.length; i < len; i++)
            taggedAudio[i].reconnect(toNode);
        if (micSource && micTag === tag) {
            micSource["disconnect"]();
            micSource["connect"](toNode);
        }
    };

    function addEffectForTag(tag, fx) {
        if (!effects.hasOwnProperty(tag))
            effects[tag] = [fx];
        else
            effects[tag].push(fx);
        reconnectEffects(tag);
    };

    function Cnds() {};
    Cnds.prototype.OnEnded = function(t) {
        return cr.equals_nocase(audTag, t);
    };
    Cnds.prototype.PreloadsComplete = function() {
        var i, len;
        for (i = 0, len = audioBuffers.length; i < len; i++) {
            if (!audioBuffers[i].isLoaded())
                return false;
        }
        return true;
    };
    Cnds.prototype.AdvancedAudioSupported = function() {
        return api === API_WEBAUDIO;
    };
    Cnds.prototype.IsSilent = function() {
        return silent;
    };
    Cnds.prototype.IsAnyPlaying = function() {
        var i, len;
        for (i = 0, len = audioInstances.length; i < len; i++) {
            if (audioInstances[i].isPlaying())
                return true;
        }
        return false;
    };
    Cnds.prototype.IsTagPlaying = function(tag) {
        getAudioByTag(tag);
        var i, len;
        for (i = 0, len = taggedAudio.length; i < len; i++) {
            if (taggedAudio[i].isPlaying())
                return true;
        }
        return false;
    };
    pluginProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.Play = function(file, looping, vol, tag) {
        if (silent)
            return;
        var v = dbToLinear(vol);
        var is_music = file[1];
        var src = this.runtime.files_subfolder + file[0] + (useOgg ? ".ogg" : ".m4a");
        lastAudio = this.getAudioInstance(src, tag, is_music, looping !== 0, v);
        if (!lastAudio)
            return;
        lastAudio.setPannerEnabled(false);
        lastAudio.play(looping !== 0, v);
    };
    Acts.prototype.PlayAtPosition = function(file, looping, vol, x_, y_, angle_, innerangle_, outerangle_, outergain_, tag) {
        if (silent)
            return;
        var v = dbToLinear(vol);
        var is_music = file[1];
        var src = this.runtime.files_subfolder + file[0] + (useOgg ? ".ogg" : ".m4a");
        lastAudio = this.getAudioInstance(src, tag, is_music, looping !== 0, v);
        if (!lastAudio) {
            var b = this.getAudioBuffer(src, is_music);
            b.panWhenReady.push({
                x: x_,
                y: y_,
                a: angle_,
                ia: innerangle_,
                oa: outerangle_,
                og: dbToLinear(outergain_),
                thistag: tag
            });
            return;
        }
        lastAudio.setPannerEnabled(true);
        lastAudio.setPan(x_, y_, angle_, innerangle_, outerangle_, dbToLinear(outergain_));
        lastAudio.play(looping !== 0, v);
    };
    Acts.prototype.PlayAtObject = function(file, looping, vol, obj, innerangle, outerangle, outergain, tag) {
        if (silent || !obj)
            return;
        var inst = obj.getFirstPicked();
        if (!inst)
            return;
        var v = dbToLinear(vol);
        var is_music = file[1];
        var src = this.runtime.files_subfolder + file[0] + (useOgg ? ".ogg" : ".m4a");
        lastAudio = this.getAudioInstance(src, tag, is_music, looping !== 0, v);
        if (!lastAudio) {
            var b = this.getAudioBuffer(src, is_music);
            b.panWhenReady.push({
                obj: inst,
                ia: innerangle,
                oa: outerangle,
                og: dbToLinear(outergain),
                thistag: tag
            });
            return;
        }
        lastAudio.setPannerEnabled(true);
        var px = cr.rotatePtAround(inst.x, inst.y, -inst.layer.getAngle(), listenerX, listenerY, true);
        var py = cr.rotatePtAround(inst.x, inst.y, -inst.layer.getAngle(), listenerX, listenerY, false);
        lastAudio.setPan(px, py, cr.to_degrees(inst.angle - inst.layer.getAngle()), innerangle, outerangle, dbToLinear(outergain));
        lastAudio.setObject(inst);
        lastAudio.play(looping !== 0, v);
    };
    Acts.prototype.PlayByName = function(folder, filename, looping, vol, tag) {
        if (silent)
            return;
        var v = dbToLinear(vol);
        var is_music = (folder === 1);
        var src = this.runtime.files_subfolder + filename.toLowerCase() + (useOgg ? ".ogg" : ".m4a");
        lastAudio = this.getAudioInstance(src, tag, is_music, looping !== 0, v);
        if (!lastAudio)
            return;
        lastAudio.setPannerEnabled(false);
        lastAudio.play(looping !== 0, v);
    };
    Acts.prototype.PlayAtPositionByName = function(folder, filename, looping, vol, x_, y_, angle_, innerangle_, outerangle_, outergain_, tag) {
        if (silent)
            return;
        var v = dbToLinear(vol);
        var is_music = (folder === 1);
        var src = this.runtime.files_subfolder + filename.toLowerCase() + (useOgg ? ".ogg" : ".m4a");
        lastAudio = this.getAudioInstance(src, tag, is_music, looping !== 0, v);
        if (!lastAudio) {
            var b = this.getAudioBuffer(src, is_music);
            b.panWhenReady.push({
                x: x_,
                y: y_,
                a: angle_,
                ia: innerangle_,
                oa: outerangle_,
                og: dbToLinear(outergain_),
                thistag: tag
            });
            return;
        }
        lastAudio.setPannerEnabled(true);
        lastAudio.setPan(x_, y_, angle_, innerangle_, outerangle_, dbToLinear(outergain_));
        lastAudio.play(looping !== 0, v);
    };
    Acts.prototype.PlayAtObjectByName = function(folder, filename, looping, vol, obj, innerangle, outerangle, outergain, tag) {
        if (silent || !obj)
            return;
        var inst = obj.getFirstPicked();
        if (!inst)
            return;
        var v = dbToLinear(vol);
        var is_music = (folder === 1);
        var src = this.runtime.files_subfolder + filename.toLowerCase() + (useOgg ? ".ogg" : ".m4a");
        lastAudio = this.getAudioInstance(src, tag, is_music, looping !== 0, v);
        if (!lastAudio) {
            var b = this.getAudioBuffer(src, is_music);
            b.panWhenReady.push({
                obj: inst,
                ia: innerangle,
                oa: outerangle,
                og: dbToLinear(outergain),
                thistag: tag
            });
            return;
        }
        lastAudio.setPannerEnabled(true);
        var px = cr.rotatePtAround(inst.x, inst.y, -inst.layer.getAngle(), listenerX, listenerY, true);
        var py = cr.rotatePtAround(inst.x, inst.y, -inst.layer.getAngle(), listenerX, listenerY, false);
        lastAudio.setPan(px, py, cr.to_degrees(inst.angle - inst.layer.getAngle()), innerangle, outerangle, dbToLinear(outergain));
        lastAudio.setObject(inst);
        lastAudio.play(looping !== 0, v);
    };
    Acts.prototype.SetLooping = function(tag, looping) {
        getAudioByTag(tag);
        var i, len;
        for (i = 0, len = taggedAudio.length; i < len; i++)
            taggedAudio[i].setLooping(looping === 0);
    };
    Acts.prototype.SetMuted = function(tag, muted) {
        getAudioByTag(tag);
        var i, len;
        for (i = 0, len = taggedAudio.length; i < len; i++)
            taggedAudio[i].setMuted(muted === 0);
    };
    Acts.prototype.SetVolume = function(tag, vol) {
        getAudioByTag(tag);
        var v = dbToLinear(vol);
        var i, len;
        for (i = 0, len = taggedAudio.length; i < len; i++)
            taggedAudio[i].setVolume(v);
    };
    Acts.prototype.Preload = function(file) {
        if (silent)
            return;
        var is_music = file[1];
        var src = this.runtime.files_subfolder + file[0] + (useOgg ? ".ogg" : ".m4a");
        if (api === API_APPMOBI) {
            if (this.runtime.isDirectCanvas)
                AppMobi["context"]["loadSound"](src);
            else
                AppMobi["player"]["loadSound"](src);
            return;
        } else if (api === API_PHONEGAP) {
            return;
        }
        this.getAudioInstance(src, "<preload>", is_music, false);
    };
    Acts.prototype.PreloadByName = function(folder, filename) {
        if (silent)
            return;
        var is_music = (folder === 1);
        var src = this.runtime.files_subfolder + filename.toLowerCase() + (useOgg ? ".ogg" : ".m4a");
        if (api === API_APPMOBI) {
            if (this.runtime.isDirectCanvas)
                AppMobi["context"]["loadSound"](src);
            else
                AppMobi["player"]["loadSound"](src);
            return;
        } else if (api === API_PHONEGAP) {
            return;
        }
        this.getAudioInstance(src, "<preload>", is_music, false);
    };
    Acts.prototype.SetPlaybackRate = function(tag, rate) {
        getAudioByTag(tag);
        if (rate < 0.0)
            rate = 0;
        var i, len;
        for (i = 0, len = taggedAudio.length; i < len; i++)
            taggedAudio[i].setPlaybackRate(rate);
    };
    Acts.prototype.Stop = function(tag) {
        getAudioByTag(tag);
        var i, len;
        for (i = 0, len = taggedAudio.length; i < len; i++)
            taggedAudio[i].stop();
    };
    Acts.prototype.StopAll = function() {
        var i, len;
        for (i = 0, len = audioInstances.length; i < len; i++)
            audioInstances[i].stop();
    };
    Acts.prototype.SetPaused = function(tag, state) {
        getAudioByTag(tag);
        var i, len;
        for (i = 0, len = taggedAudio.length; i < len; i++) {
            if (state === 0)
                taggedAudio[i].pause();
            else
                taggedAudio[i].resume();
        }
    };
    Acts.prototype.Seek = function(tag, pos) {
        getAudioByTag(tag);
        var i, len;
        for (i = 0, len = taggedAudio.length; i < len; i++) {
            taggedAudio[i].seek(pos);
        }
    };
    Acts.prototype.SetSilent = function(s) {
        var i, len;
        if (s === 2) // toggling
            s = (silent ? 1 : 0); // choose opposite state
        if (s === 0 && !silent) // setting silent
        {
            for (i = 0, len = audioInstances.length; i < len; i++)
                audioInstances[i].setSilent(true);
            silent = true;
        } else if (s === 1 && silent) // setting not silent
        {
            for (i = 0, len = audioInstances.length; i < len; i++)
                audioInstances[i].setSilent(false);
            silent = false;
        }
    };
    Acts.prototype.SetMasterVolume = function(vol) {
        masterVolume = dbToLinear(vol);
        var i, len;
        for (i = 0, len = audioInstances.length; i < len; i++)
            audioInstances[i].updateVolume();
    };
    Acts.prototype.AddFilterEffect = function(tag, type, freq, detune, q, gain, mix) {
        if (api !== API_WEBAUDIO || type < 0 || type >= filterTypes.length || !context["createBiquadFilter"])
            return;
        tag = tag.toLowerCase();
        mix = mix / 100;
        if (mix < 0) mix = 0;
        if (mix > 1) mix = 1;
        addEffectForTag(tag, new FilterEffect(type, freq, detune, q, gain, mix));
    };
    Acts.prototype.AddDelayEffect = function(tag, delay, gain, mix) {
        if (api !== API_WEBAUDIO)
            return;
        tag = tag.toLowerCase();
        mix = mix / 100;
        if (mix < 0) mix = 0;
        if (mix > 1) mix = 1;
        addEffectForTag(tag, new DelayEffect(delay, dbToLinear(gain), mix));
    };
    Acts.prototype.AddFlangerEffect = function(tag, delay, modulation, freq, feedback, mix) {
        if (api !== API_WEBAUDIO || !context["createOscillator"])
            return;
        tag = tag.toLowerCase();
        mix = mix / 100;
        if (mix < 0) mix = 0;
        if (mix > 1) mix = 1;
        addEffectForTag(tag, new FlangerEffect(delay / 1000, modulation / 1000, freq, feedback / 100, mix));
    };
    Acts.prototype.AddPhaserEffect = function(tag, freq, detune, q, mod, modfreq, mix) {
        if (api !== API_WEBAUDIO || !context["createOscillator"])
            return;
        tag = tag.toLowerCase();
        mix = mix / 100;
        if (mix < 0) mix = 0;
        if (mix > 1) mix = 1;
        addEffectForTag(tag, new PhaserEffect(freq, detune, q, mod, modfreq, mix));
    };
    Acts.prototype.AddConvolutionEffect = function(tag, file, norm, mix) {
        if (api !== API_WEBAUDIO || !context["createConvolver"])
            return;
        var doNormalize = (norm === 0);
        var src = this.runtime.files_subfolder + file[0] + (useOgg ? ".ogg" : ".m4a");
        var b = this.getAudioBuffer(src, false);
        tag = tag.toLowerCase();
        mix = mix / 100;
        if (mix < 0) mix = 0;
        if (mix > 1) mix = 1;
        var fx;
        if (b.bufferObject) {
            fx = new ConvolveEffect(b.bufferObject, doNormalize, mix, src);
        } else {
            fx = new ConvolveEffect(null, doNormalize, mix, src);
            b.normalizeWhenReady = doNormalize;
            b.convolveWhenReady = fx;
        }
        addEffectForTag(tag, fx);
    };
    Acts.prototype.AddGainEffect = function(tag, g) {
        if (api !== API_WEBAUDIO)
            return;
        tag = tag.toLowerCase();
        addEffectForTag(tag, new GainEffect(dbToLinear(g)));
    };
    Acts.prototype.AddMuteEffect = function(tag) {
        if (api !== API_WEBAUDIO)
            return;
        tag = tag.toLowerCase();
        addEffectForTag(tag, new GainEffect(0)); // re-use gain effect with 0 gain
    };
    Acts.prototype.AddTremoloEffect = function(tag, freq, mix) {
        if (api !== API_WEBAUDIO || !context["createOscillator"])
            return;
        tag = tag.toLowerCase();
        mix = mix / 100;
        if (mix < 0) mix = 0;
        if (mix > 1) mix = 1;
        addEffectForTag(tag, new TremoloEffect(freq, mix));
    };
    Acts.prototype.AddRingModEffect = function(tag, freq, mix) {
        if (api !== API_WEBAUDIO || !context["createOscillator"])
            return;
        tag = tag.toLowerCase();
        mix = mix / 100;
        if (mix < 0) mix = 0;
        if (mix > 1) mix = 1;
        addEffectForTag(tag, new RingModulatorEffect(freq, mix));
    };
    Acts.prototype.AddDistortionEffect = function(tag, threshold, headroom, drive, makeupgain, mix) {
        if (api !== API_WEBAUDIO || !context["createWaveShaper"])
            return;
        tag = tag.toLowerCase();
        mix = mix / 100;
        if (mix < 0) mix = 0;
        if (mix > 1) mix = 1;
        addEffectForTag(tag, new DistortionEffect(threshold, headroom, drive, makeupgain, mix));
    };
    Acts.prototype.AddCompressorEffect = function(tag, threshold, knee, ratio, attack, release) {
        if (api !== API_WEBAUDIO || !context["createDynamicsCompressor"])
            return;
        tag = tag.toLowerCase();
        addEffectForTag(tag, new CompressorEffect(threshold, knee, ratio, attack / 1000, release / 1000));
    };
    Acts.prototype.AddAnalyserEffect = function(tag, fftSize, smoothing) {
        if (api !== API_WEBAUDIO)
            return;
        tag = tag.toLowerCase();
        addEffectForTag(tag, new AnalyserEffect(fftSize, smoothing));
    };
    Acts.prototype.RemoveEffects = function(tag) {
        if (api !== API_WEBAUDIO)
            return;
        tag = tag.toLowerCase();
        var i, len, arr;
        if (effects.hasOwnProperty(tag)) {
            arr = effects[tag];
            if (arr.length) {
                for (i = 0, len = arr.length; i < len; i++)
                    arr[i].remove();
                arr.length = 0;
                reconnectEffects(tag);
            }
        }
    };
    Acts.prototype.SetEffectParameter = function(tag, index, param, value, ramp, time) {
        if (api !== API_WEBAUDIO)
            return;
        tag = tag.toLowerCase();
        index = Math.floor(index);
        var arr;
        if (!effects.hasOwnProperty(tag))
            return;
        arr = effects[tag];
        if (index < 0 || index >= arr.length)
            return;
        arr[index].setParam(param, value, ramp, time);
    };
    Acts.prototype.SetListenerObject = function(obj_) {
        if (!obj_ || api !== API_WEBAUDIO)
            return;
        var inst = obj_.getFirstPicked();
        if (!inst)
            return;
        this.listenerTracker.setObject(inst);
        listenerX = inst.x;
        listenerY = inst.y;
    };
    Acts.prototype.SetListenerZ = function(z) {
        this.listenerZ = z;
    };
    pluginProto.acts = new Acts();

    function Exps() {};
    Exps.prototype.Duration = function(ret, tag) {
        getAudioByTag(tag);
        if (taggedAudio.length)
            ret.set_float(taggedAudio[0].getDuration());
        else
            ret.set_float(0);
    };
    Exps.prototype.PlaybackTime = function(ret, tag) {
        getAudioByTag(tag);
        if (taggedAudio.length)
            ret.set_float(taggedAudio[0].getPlaybackTime());
        else
            ret.set_float(0);
    };
    Exps.prototype.Volume = function(ret, tag) {
        getAudioByTag(tag);
        if (taggedAudio.length) {
            var v = taggedAudio[0].getVolume();
            ret.set_float(linearToDb(v));
        } else
            ret.set_float(0);
    };
    Exps.prototype.MasterVolume = function(ret) {
        ret.set_float(masterVolume);
    };
    Exps.prototype.EffectCount = function(ret, tag) {
        tag = tag.toLowerCase();
        var arr = null;
        if (effects.hasOwnProperty(tag))
            arr = effects[tag];
        ret.set_int(arr ? arr.length : 0);
    };

    function getAnalyser(tag, index) {
        var arr = null;
        if (effects.hasOwnProperty(tag))
            arr = effects[tag];
        if (arr && index >= 0 && index < arr.length && arr[index].freqBins)
            return arr[index];
        else
            return null;
    };
    Exps.prototype.AnalyserFreqBinCount = function(ret, tag, index) {
        tag = tag.toLowerCase();
        index = Math.floor(index);
        var analyser = getAnalyser(tag, index);
        ret.set_int(analyser ? analyser.node["frequencyBinCount"] : 0);
    };
    Exps.prototype.AnalyserFreqBinAt = function(ret, tag, index, bin) {
        tag = tag.toLowerCase();
        index = Math.floor(index);
        bin = Math.floor(bin);
        var analyser = getAnalyser(tag, index);
        if (!analyser)
            ret.set_float(0);
        else if (bin < 0 || bin >= analyser.node["frequencyBinCount"])
            ret.set_float(0);
        else
            ret.set_float(analyser.freqBins[bin]);
    };
    Exps.prototype.AnalyserPeakLevel = function(ret, tag, index) {
        tag = tag.toLowerCase();
        index = Math.floor(index);
        var analyser = getAnalyser(tag, index);
        if (analyser)
            ret.set_float(analyser.peak);
        else
            ret.set_float(0);
    };
    Exps.prototype.AnalyserRMSLevel = function(ret, tag, index) {
        tag = tag.toLowerCase();
        index = Math.floor(index);
        var analyser = getAnalyser(tag, index);
        if (analyser)
            ret.set_float(analyser.rms);
        else
            ret.set_float(0);
    };
    pluginProto.exps = new Exps();
}());;;
cr.plugins_.Sprite = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var pluginProto = cr.plugins_.Sprite.prototype;
    pluginProto.Type = function(plugin) {
        this.plugin = plugin;
        this.runtime = plugin.runtime;
    };
    var typeProto = pluginProto.Type.prototype;

    function frame_getDataUri() {
        if (this.datauri.length === 0) {
            var tmpcanvas = document.createElement("canvas");
            tmpcanvas.width = this.width;
            tmpcanvas.height = this.height;
            var tmpctx = tmpcanvas.getContext("2d");
            if (this.spritesheeted) {
                tmpctx.drawImage(this.texture_img, this.offx, this.offy, this.width, this.height,
                    0, 0, this.width, this.height);
            } else {
                tmpctx.drawImage(this.texture_img, 0, 0, this.width, this.height);
            }
            this.datauri = tmpcanvas.toDataURL("image/png");
        }
        return this.datauri;
    };
    typeProto.onCreate = function() {
        if (this.is_family)
            return;
        var i, leni, j, lenj;
        var anim, frame, animobj, frameobj, wt, uv;
        this.all_frames = [];
        this.has_loaded_textures = false;
        for (i = 0, leni = this.animations.length; i < leni; i++) {
            anim = this.animations[i];
            animobj = {};
            animobj.name = anim[0];
            animobj.speed = anim[1];
            animobj.loop = anim[2];
            animobj.repeatcount = anim[3];
            animobj.repeatto = anim[4];
            animobj.pingpong = anim[5];
            animobj.sid = anim[6];
            animobj.frames = [];
            for (j = 0, lenj = anim[7].length; j < lenj; j++) {
                frame = anim[7][j];
                frameobj = {};
                frameobj.texture_file = frame[0];
                frameobj.texture_filesize = frame[1];
                frameobj.offx = frame[2];
                frameobj.offy = frame[3];
                frameobj.width = frame[4];
                frameobj.height = frame[5];
                frameobj.duration = frame[6];
                frameobj.hotspotX = frame[7];
                frameobj.hotspotY = frame[8];
                frameobj.image_points = frame[9];
                frameobj.poly_pts = frame[10];
                frameobj.pixelformat = frame[11];
                frameobj.spritesheeted = (frameobj.width !== 0);
                frameobj.datauri = ""; // generated on demand and cached
                frameobj.getDataUri = frame_getDataUri;
                uv = {};
                uv.left = 0;
                uv.top = 0;
                uv.right = 1;
                uv.bottom = 1;
                frameobj.sheetTex = uv;
                frameobj.webGL_texture = null;
                wt = this.runtime.findWaitingTexture(frame[0]);
                if (wt) {
                    frameobj.texture_img = wt;
                } else {
                    frameobj.texture_img = new Image();
                    frameobj.texture_img["idtkLoadDisposed"] = true;
                    frameobj.texture_img.src = frame[0];
                    frameobj.texture_img.cr_src = frame[0];
                    frameobj.texture_img.cr_filesize = frame[1];
                    frameobj.texture_img.c2webGL_texture = null;
                    this.runtime.waitForImageLoad(frameobj.texture_img);
                }
                cr.seal(frameobj);
                animobj.frames.push(frameobj);
                this.all_frames.push(frameobj);
            }
            cr.seal(animobj);
            this.animations[i] = animobj; // swap array data for object
        }
    };
    typeProto.updateAllCurrentTexture = function() {
        var i, len, inst;
        for (i = 0, len = this.instances.length; i < len; i++) {
            inst = this.instances[i];
            inst.curWebGLTexture = inst.curFrame.webGL_texture;
        }
    };
    typeProto.onLostWebGLContext = function() {
        if (this.is_family)
            return;
        var i, len, frame;
        for (i = 0, len = this.all_frames.length; i < len; ++i) {
            frame = this.all_frames[i];
            frame.texture_img.c2webGL_texture = null;
            frame.webGL_texture = null;
        }
    };
    typeProto.onRestoreWebGLContext = function() {
        if (this.is_family || !this.instances.length)
            return;
        var i, len, frame;
        for (i = 0, len = this.all_frames.length; i < len; ++i) {
            frame = this.all_frames[i];
            frame.webGL_texture = this.runtime.glwrap.loadTexture(frame.texture_img, false, this.runtime.linearSampling, frame.pixelformat);
        }
        this.updateAllCurrentTexture();
    };
    typeProto.loadTextures = function() {
        if (this.is_family || this.has_loaded_textures || !this.runtime.glwrap)
            return;
        var i, len, frame;
        for (i = 0, len = this.all_frames.length; i < len; ++i) {
            frame = this.all_frames[i];
            frame.webGL_texture = this.runtime.glwrap.loadTexture(frame.texture_img, false, this.runtime.linearSampling, frame.pixelformat);
        }
        this.has_loaded_textures = true;
    };
    typeProto.unloadTextures = function() {
        if (this.is_family || this.instances.length || !this.has_loaded_textures)
            return;
        var i, len, frame;
        for (i = 0, len = this.all_frames.length; i < len; ++i) {
            frame = this.all_frames[i];
            this.runtime.glwrap.deleteTexture(frame.webGL_texture);
            frame.webGL_texture = null;
        }
        this.has_loaded_textures = false;
    };
    var already_drawn_images = [];
    typeProto.preloadCanvas2D = function(ctx) {
        var i, len, frameimg;
        already_drawn_images.length = 0;
        for (i = 0, len = this.all_frames.length; i < len; ++i) {
            frameimg = this.all_frames[i].texture_img;
            if (already_drawn_images.indexOf(frameimg) !== -1)
                continue;
            ctx.drawImage(frameimg, 0, 0);
            already_drawn_images.push(frameimg);
        }
    };
    pluginProto.Instance = function(type) {
        this.type = type;
        this.runtime = type.runtime;
        var poly_pts = this.type.animations[0].frames[0].poly_pts;
        if (this.recycled)
            this.collision_poly.set_pts(poly_pts);
        else
            this.collision_poly = new cr.CollisionPoly(poly_pts);
    };
    var instanceProto = pluginProto.Instance.prototype;
    instanceProto.onCreate = function() {
        this.visible = (this.properties[0] === 0); // 0=visible, 1=invisible
        this.isTicking = false;
        this.inAnimTrigger = false;
        this.collisionsEnabled = (this.properties[3] !== 0);
        if (!(this.type.animations.length === 1 && this.type.animations[0].frames.length === 1) && this.type.animations[0].speed !== 0) {
            this.runtime.tickMe(this);
            this.isTicking = true;
        }
        this.cur_animation = this.getAnimationByName(this.properties[1]) || this.type.animations[0];
        this.cur_frame = this.properties[2];
        if (this.cur_frame < 0)
            this.cur_frame = 0;
        if (this.cur_frame >= this.cur_animation.frames.length)
            this.cur_frame = this.cur_animation.frames.length - 1;
        var curanimframe = this.cur_animation.frames[this.cur_frame];
        this.collision_poly.set_pts(curanimframe.poly_pts);
        this.hotspotX = curanimframe.hotspotX;
        this.hotspotY = curanimframe.hotspotY;
        this.cur_anim_speed = this.cur_animation.speed;
        if (this.recycled)
            this.animTimer.reset();
        else
            this.animTimer = new cr.KahanAdder();
        this.frameStart = this.getNowTime();
        this.animPlaying = true;
        this.animRepeats = 0;
        this.animForwards = true;
        this.animTriggerName = "";
        this.changeAnimName = "";
        this.changeAnimFrom = 0;
        this.changeAnimFrame = -1;
        this.type.loadTextures();
        var i, leni, j, lenj;
        var anim, frame, uv, maintex;
        for (i = 0, leni = this.type.animations.length; i < leni; i++) {
            anim = this.type.animations[i];
            for (j = 0, lenj = anim.frames.length; j < lenj; j++) {
                frame = anim.frames[j];
                if (frame.width === 0) {
                    frame.width = frame.texture_img.width;
                    frame.height = frame.texture_img.height;
                }
                if (frame.spritesheeted) {
                    maintex = frame.texture_img;
                    uv = frame.sheetTex;
                    uv.left = frame.offx / maintex.width;
                    uv.top = frame.offy / maintex.height;
                    uv.right = (frame.offx + frame.width) / maintex.width;
                    uv.bottom = (frame.offy + frame.height) / maintex.height;
                    if (frame.offx === 0 && frame.offy === 0 && frame.width === maintex.width && frame.height === maintex.height) {
                        frame.spritesheeted = false;
                    }
                }
            }
        }
        this.curFrame = this.cur_animation.frames[this.cur_frame];
        this.curWebGLTexture = this.curFrame.webGL_texture;
    };
    instanceProto.saveToJSON = function() {
        var o = {
            "a": this.cur_animation.sid,
            "f": this.cur_frame,
            "cas": this.cur_anim_speed,
            "fs": this.frameStart,
            "ar": this.animRepeats,
            "at": this.animTimer.sum
        };
        if (!this.animPlaying)
            o["ap"] = this.animPlaying;
        if (!this.animForwards)
            o["af"] = this.animForwards;
        return o;
    };
    instanceProto.loadFromJSON = function(o) {
        var anim = this.getAnimationBySid(o["a"]);
        if (anim)
            this.cur_animation = anim;
        this.cur_frame = o["f"];
        if (this.cur_frame < 0)
            this.cur_frame = 0;
        if (this.cur_frame >= this.cur_animation.frames.length)
            this.cur_frame = this.cur_animation.frames.length - 1;
        this.cur_anim_speed = o["cas"];
        this.frameStart = o["fs"];
        this.animRepeats = o["ar"];
        this.animTimer.reset();
        this.animTimer.sum = o["at"];
        this.animPlaying = o.hasOwnProperty("ap") ? o["ap"] : true;
        this.animForwards = o.hasOwnProperty("af") ? o["af"] : true;
        this.curFrame = this.cur_animation.frames[this.cur_frame];
        this.curWebGLTexture = this.curFrame.webGL_texture;
        this.collision_poly.set_pts(this.curFrame.poly_pts);
        this.hotspotX = this.curFrame.hotspotX;
        this.hotspotY = this.curFrame.hotspotY;
    };
    instanceProto.animationFinish = function(reverse) {
        this.cur_frame = reverse ? 0 : this.cur_animation.frames.length - 1;
        this.animPlaying = false;
        this.animTriggerName = this.cur_animation.name;
        this.inAnimTrigger = true;
        this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished, this);
        this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished, this);
        this.inAnimTrigger = false;
        this.animRepeats = 0;
    };
    instanceProto.getNowTime = function() {
        return this.animTimer.sum;
    };
    instanceProto.tick = function() {
        this.animTimer.add(this.runtime.getDt(this));
        if (this.changeAnimName.length)
            this.doChangeAnim();
        if (this.changeAnimFrame >= 0)
            this.doChangeAnimFrame();
        var now = this.getNowTime();
        var cur_animation = this.cur_animation;
        var prev_frame = cur_animation.frames[this.cur_frame];
        var next_frame;
        var cur_frame_time = prev_frame.duration / this.cur_anim_speed;
        if (this.animPlaying && now >= this.frameStart + cur_frame_time) {
            if (this.animForwards) {
                this.cur_frame++;
            } else {
                this.cur_frame--;
            }
            this.frameStart += cur_frame_time;
            if (this.cur_frame >= cur_animation.frames.length) {
                if (cur_animation.pingpong) {
                    this.animForwards = false;
                    this.cur_frame = cur_animation.frames.length - 2;
                } else if (cur_animation.loop) {
                    this.cur_frame = cur_animation.repeatto;
                } else {
                    this.animRepeats++;
                    if (this.animRepeats >= cur_animation.repeatcount) {
                        this.animationFinish(false);
                    } else {
                        this.cur_frame = cur_animation.repeatto;
                    }
                }
            }
            if (this.cur_frame < 0) {
                if (cur_animation.pingpong) {
                    this.cur_frame = 1;
                    this.animForwards = true;
                    if (!cur_animation.loop) {
                        this.animRepeats++;
                        if (this.animRepeats >= cur_animation.repeatcount) {
                            this.animationFinish(true);
                        }
                    }
                } else {
                    if (cur_animation.loop) {
                        this.cur_frame = cur_animation.repeatto;
                    } else {
                        this.animRepeats++;
                        if (this.animRepeats >= cur_animation.repeatcount) {
                            this.animationFinish(true);
                        } else {
                            this.cur_frame = cur_animation.repeatto;
                        }
                    }
                }
            }
            if (this.cur_frame < 0)
                this.cur_frame = 0;
            else if (this.cur_frame >= cur_animation.frames.length)
                this.cur_frame = cur_animation.frames.length - 1;
            if (now > this.frameStart + (cur_animation.frames[this.cur_frame].duration / this.cur_anim_speed)) {
                this.frameStart = now;
            }
            next_frame = cur_animation.frames[this.cur_frame];
            this.OnFrameChanged(prev_frame, next_frame);
            this.runtime.redraw = true;
        }
    };
    instanceProto.getAnimationByName = function(name_) {
        var i, len, a;
        for (i = 0, len = this.type.animations.length; i < len; i++) {
            a = this.type.animations[i];
            if (cr.equals_nocase(a.name, name_))
                return a;
        }
        return null;
    };
    instanceProto.getAnimationBySid = function(sid_) {
        var i, len, a;
        for (i = 0, len = this.type.animations.length; i < len; i++) {
            a = this.type.animations[i];
            if (a.sid === sid_)
                return a;
        }
        return null;
    };
    instanceProto.doChangeAnim = function() {
        var prev_frame = this.cur_animation.frames[this.cur_frame];
        var anim = this.getAnimationByName(this.changeAnimName);
        this.changeAnimName = "";
        if (!anim)
            return;
        if (cr.equals_nocase(anim.name, this.cur_animation.name) && this.animPlaying)
            return;
        this.cur_animation = anim;
        this.cur_anim_speed = anim.speed;
        if (this.cur_frame < 0)
            this.cur_frame = 0;
        if (this.cur_frame >= this.cur_animation.frames.length)
            this.cur_frame = this.cur_animation.frames.length - 1;
        if (this.changeAnimFrom === 1)
            this.cur_frame = 0;
        this.animPlaying = true;
        this.frameStart = this.getNowTime();
        this.animForwards = true;
        this.OnFrameChanged(prev_frame, this.cur_animation.frames[this.cur_frame]);
        this.runtime.redraw = true;
    };
    instanceProto.doChangeAnimFrame = function() {
        var prev_frame = this.cur_animation.frames[this.cur_frame];
        var prev_frame_number = this.cur_frame;
        this.cur_frame = cr.floor(this.changeAnimFrame);
        if (this.cur_frame < 0)
            this.cur_frame = 0;
        if (this.cur_frame >= this.cur_animation.frames.length)
            this.cur_frame = this.cur_animation.frames.length - 1;
        if (prev_frame_number !== this.cur_frame) {
            this.OnFrameChanged(prev_frame, this.cur_animation.frames[this.cur_frame]);
            this.frameStart = this.getNowTime();
            this.runtime.redraw = true;
        }
        this.changeAnimFrame = -1;
    };
    instanceProto.OnFrameChanged = function(prev_frame, next_frame) {
        var oldw = prev_frame.width;
        var oldh = prev_frame.height;
        var neww = next_frame.width;
        var newh = next_frame.height;
        if (oldw != neww)
            this.width *= (neww / oldw);
        if (oldh != newh)
            this.height *= (newh / oldh);
        this.hotspotX = next_frame.hotspotX;
        this.hotspotY = next_frame.hotspotY;
        this.collision_poly.set_pts(next_frame.poly_pts);
        this.set_bbox_changed();
        this.curFrame = next_frame;
        this.curWebGLTexture = next_frame.webGL_texture;
        var i, len, b;
        for (i = 0, len = this.behavior_insts.length; i < len; i++) {
            b = this.behavior_insts[i];
            if (b.onSpriteFrameChanged)
                b.onSpriteFrameChanged(prev_frame, next_frame);
        }
        this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged, this);
    };
    instanceProto.draw = function(ctx) {
        ctx.globalAlpha = this.opacity;
        var cur_frame = this.curFrame;
        var spritesheeted = cur_frame.spritesheeted;
        var cur_image = cur_frame.texture_img;
        var myx = this.x;
        var myy = this.y;
        var w = this.width;
        var h = this.height;
        if (this.angle === 0 && w >= 0 && h >= 0) {
            myx -= this.hotspotX * w;
            myy -= this.hotspotY * h;
            if (this.runtime.pixel_rounding) {
                myx = (myx + 0.5) | 0;
                myy = (myy + 0.5) | 0;
            }
            if (spritesheeted) {
                ctx.drawImage(cur_image, cur_frame.offx, cur_frame.offy, cur_frame.width, cur_frame.height,
                    myx, myy, w, h);
            } else {
                ctx.drawImage(cur_image, myx, myy, w, h);
            }
        } else {
            if (this.runtime.pixel_rounding) {
                myx = (myx + 0.5) | 0;
                myy = (myy + 0.5) | 0;
            }
            ctx.save();
            var widthfactor = w > 0 ? 1 : -1;
            var heightfactor = h > 0 ? 1 : -1;
            ctx.translate(myx, myy);
            if (widthfactor !== 1 || heightfactor !== 1)
                ctx.scale(widthfactor, heightfactor);
            ctx.rotate(this.angle * widthfactor * heightfactor);
            var drawx = 0 - (this.hotspotX * cr.abs(w))
            var drawy = 0 - (this.hotspotY * cr.abs(h));
            if (spritesheeted) {
                ctx.drawImage(cur_image, cur_frame.offx, cur_frame.offy, cur_frame.width, cur_frame.height,
                    drawx, drawy, cr.abs(w), cr.abs(h));
            } else {
                ctx.drawImage(cur_image, drawx, drawy, cr.abs(w), cr.abs(h));
            }
            ctx.restore();
        }
        /*
		ctx.strokeStyle = "#f00";
		ctx.lineWidth = 3;
		ctx.beginPath();
		this.collision_poly.cache_poly(this.width, this.height, this.angle);
		var i, len, ax, ay, bx, by;
		for (i = 0, len = this.collision_poly.pts_count; i < len; i++)
		{
			ax = this.collision_poly.pts_cache[i*2] + this.x;
			ay = this.collision_poly.pts_cache[i*2+1] + this.y;
			bx = this.collision_poly.pts_cache[((i+1)%len)*2] + this.x;
			by = this.collision_poly.pts_cache[((i+1)%len)*2+1] + this.y;
			ctx.moveTo(ax, ay);
			ctx.lineTo(bx, by);
		}
		ctx.stroke();
		ctx.closePath();
		*/
        /*
		if (this.behavior_insts.length >= 1 && this.behavior_insts[0].draw)
		{
			this.behavior_insts[0].draw(ctx);
		}
		*/
    };
    instanceProto.drawGL = function(glw) {
        glw.setTexture(this.curWebGLTexture);
        glw.setOpacity(this.opacity);
        var cur_frame = this.curFrame;
        var q = this.bquad;
        if (this.runtime.pixel_rounding) {
            var ox = ((this.x + 0.5) | 0) - this.x;
            var oy = ((this.y + 0.5) | 0) - this.y;
            if (cur_frame.spritesheeted)
                glw.quadTex(q.tlx + ox, q.tly + oy, q.trx + ox, q.try_ + oy, q.brx + ox, q.bry + oy, q.blx + ox, q.bly + oy, cur_frame.sheetTex);
            else
                glw.quad(q.tlx + ox, q.tly + oy, q.trx + ox, q.try_ + oy, q.brx + ox, q.bry + oy, q.blx + ox, q.bly + oy);
        } else {
            if (cur_frame.spritesheeted)
                glw.quadTex(q.tlx, q.tly, q.trx, q.try_, q.brx, q.bry, q.blx, q.bly, cur_frame.sheetTex);
            else
                glw.quad(q.tlx, q.tly, q.trx, q.try_, q.brx, q.bry, q.blx, q.bly);
        }
    };
    instanceProto.getImagePointIndexByName = function(name_) {
        var cur_frame = this.curFrame;
        var i, len;
        for (i = 0, len = cur_frame.image_points.length; i < len; i++) {
            if (cr.equals_nocase(name_, cur_frame.image_points[i][0]))
                return i;
        }
        return -1;
    };
    instanceProto.getImagePoint = function(imgpt, getX) {
        var cur_frame = this.curFrame;
        var image_points = cur_frame.image_points;
        var index;
        if (cr.is_string(imgpt))
            index = this.getImagePointIndexByName(imgpt);
        else
            index = imgpt - 1; // 0 is origin
        index = cr.floor(index);
        if (index < 0 || index >= image_points.length)
            return getX ? this.x : this.y; // return origin
        var x = (image_points[index][1] - cur_frame.hotspotX) * this.width;
        var y = image_points[index][2];
        y = (y - cur_frame.hotspotY) * this.height;
        var cosa = Math.cos(this.angle);
        var sina = Math.sin(this.angle);
        var x_temp = (x * cosa) - (y * sina);
        y = (y * cosa) + (x * sina);
        x = x_temp;
        x += this.x;
        y += this.y;
        return getX ? x : y;
    };

    function Cnds() {};
    var arrCache = [];

    function allocArr() {
        if (arrCache.length)
            return arrCache.pop();
        else
            return [0, 0, 0];
    };

    function freeArr(a) {
        a[0] = 0;
        a[1] = 0;
        a[2] = 0;
        arrCache.push(a);
    };

    function makeCollKey(a, b) {
        if (a < b)
            return "" + a + "," + b;
        else
            return "" + b + "," + a;
    };

    function collmemory_add(collmemory, a, b, tickcount) {
        var a_uid = a.uid;
        var b_uid = b.uid;
        var key = makeCollKey(a_uid, b_uid);
        if (collmemory.hasOwnProperty(key)) {
            collmemory[key][2] = tickcount;
            return;
        }
        var arr = allocArr();
        arr[0] = a_uid;
        arr[1] = b_uid;
        arr[2] = tickcount;
        collmemory[key] = arr;
    };

    function collmemory_remove(collmemory, a, b) {
        var key = makeCollKey(a.uid, b.uid);
        if (collmemory.hasOwnProperty(key)) {
            freeArr(collmemory[key]);
            delete collmemory[key];
        }
    };

    function collmemory_removeInstance(collmemory, inst) {
        var uid = inst.uid;
        var p, entry;
        for (p in collmemory) {
            if (collmemory.hasOwnProperty(p)) {
                entry = collmemory[p];
                if (entry[0] === uid || entry[1] === uid) {
                    freeArr(collmemory[p]);
                    delete collmemory[p];
                }
            }
        }
    };
    var last_coll_tickcount = -2;

    function collmemory_has(collmemory, a, b) {
        var key = makeCollKey(a.uid, b.uid);
        if (collmemory.hasOwnProperty(key)) {
            last_coll_tickcount = collmemory[key][2];
            return true;
        } else {
            last_coll_tickcount = -2;
            return false;
        }
    };
    var candidates1 = [];
    Cnds.prototype.OnCollision = function(rtype) {
        if (!rtype)
            return false;
        var runtime = this.runtime;
        var cnd = runtime.getCurrentCondition();
        var ltype = cnd.type;
        if (!cnd.extra.collmemory) {
            cnd.extra.collmemory = {};
            runtime.addDestroyCallback((function(collmemory) {
                return function(inst) {
                    collmemory_removeInstance(collmemory, inst);
                };
            })(cnd.extra.collmemory));
        }
        var collmemory = cnd.extra.collmemory;
        var lsol = ltype.getCurrentSol();
        var rsol = rtype.getCurrentSol();
        var linstances = lsol.getObjects();
        var rinstances;
        var l, linst, r, rinst;
        var curlsol, currsol;
        var tickcount = this.runtime.tickcount;
        var lasttickcount = tickcount - 1;
        var exists, run;
        var current_event = runtime.getCurrentEventStack().current_event;
        var orblock = current_event.orblock;
        for (l = 0; l < linstances.length; l++) {
            linst = linstances[l];
            if (rsol.select_all) {
                linst.update_bbox();
                this.runtime.getCollisionCandidates(linst.layer, rtype, linst.bbox, candidates1);
                rinstances = candidates1;
            } else
                rinstances = rsol.getObjects();
            for (r = 0; r < rinstances.length; r++) {
                rinst = rinstances[r];
                if (runtime.testOverlap(linst, rinst) || runtime.checkRegisteredCollision(linst, rinst)) {
                    exists = collmemory_has(collmemory, linst, rinst);
                    run = (!exists || (last_coll_tickcount < lasttickcount));
                    collmemory_add(collmemory, linst, rinst, tickcount);
                    if (run) {
                        runtime.pushCopySol(current_event.solModifiers);
                        curlsol = ltype.getCurrentSol();
                        currsol = rtype.getCurrentSol();
                        curlsol.select_all = false;
                        currsol.select_all = false;
                        if (ltype === rtype) {
                            curlsol.instances.length = 2; // just use lsol, is same reference as rsol
                            curlsol.instances[0] = linst;
                            curlsol.instances[1] = rinst;
                            ltype.applySolToContainer();
                        } else {
                            curlsol.instances.length = 1;
                            currsol.instances.length = 1;
                            curlsol.instances[0] = linst;
                            currsol.instances[0] = rinst;
                            ltype.applySolToContainer();
                            rtype.applySolToContainer();
                        }
                        current_event.retrigger();
                        runtime.popSol(current_event.solModifiers);
                    }
                } else {
                    collmemory_remove(collmemory, linst, rinst);
                }
            }
            candidates1.length = 0;
        }
        return false;
    };
    var rpicktype = null;
    var rtopick = new cr.ObjectSet();
    var needscollisionfinish = false;
    var candidates2 = [];

    function DoOverlapCondition(rtype, offx, offy) {
        if (!rtype)
            return false;
        var do_offset = (offx !== 0 || offy !== 0);
        var oldx, oldy, ret = false,
            r, lenr, rinst;
        var cnd = this.runtime.getCurrentCondition();
        var ltype = cnd.type;
        var inverted = cnd.inverted;
        var rsol = rtype.getCurrentSol();
        var orblock = this.runtime.getCurrentEventStack().current_event.orblock;
        var rinstances;
        if (rsol.select_all) {
            this.update_bbox();
            this.runtime.getCollisionCandidates(this.layer, rtype, this.bbox, candidates2);
            rinstances = candidates2;
        } else if (orblock)
            rinstances = rsol.else_instances;
        else
            rinstances = rsol.instances;
        rpicktype = rtype;
        needscollisionfinish = (ltype !== rtype && !inverted);
        if (do_offset) {
            oldx = this.x;
            oldy = this.y;
            this.x += offx;
            this.y += offy;
            this.set_bbox_changed();
        }
        for (r = 0, lenr = rinstances.length; r < lenr; r++) {
            rinst = rinstances[r];
            if (this.runtime.testOverlap(this, rinst)) {
                ret = true;
                if (inverted)
                    break;
                if (ltype !== rtype)
                    rtopick.add(rinst);
            }
        }
        if (do_offset) {
            this.x = oldx;
            this.y = oldy;
            this.set_bbox_changed();
        }
        candidates2.length = 0;
        return ret;
    };
    typeProto.finish = function(do_pick) {
        if (!needscollisionfinish)
            return;
        if (do_pick) {
            var orblock = this.runtime.getCurrentEventStack().current_event.orblock;
            var sol = rpicktype.getCurrentSol();
            var topick = rtopick.valuesRef();
            var i, len, inst;
            if (sol.select_all) {
                sol.select_all = false;
                sol.instances.length = topick.length;
                for (i = 0, len = topick.length; i < len; i++) {
                    sol.instances[i] = topick[i];
                }
                if (orblock) {
                    sol.else_instances.length = 0;
                    for (i = 0, len = rpicktype.instances.length; i < len; i++) {
                        inst = rpicktype.instances[i];
                        if (!rtopick.contains(inst))
                            sol.else_instances.push(inst);
                    }
                }
            } else {
                if (orblock) {
                    var initsize = sol.instances.length;
                    sol.instances.length = initsize + topick.length;
                    for (i = 0, len = topick.length; i < len; i++) {
                        sol.instances[initsize + i] = topick[i];
                        cr.arrayFindRemove(sol.else_instances, topick[i]);
                    }
                } else {
                    cr.shallowAssignArray(sol.instances, topick);
                }
            }
            rpicktype.applySolToContainer();
        }
        rtopick.clear();
        needscollisionfinish = false;
    };
    Cnds.prototype.IsOverlapping = function(rtype) {
        return DoOverlapCondition.call(this, rtype, 0, 0);
    };
    Cnds.prototype.IsOverlappingOffset = function(rtype, offx, offy) {
        return DoOverlapCondition.call(this, rtype, offx, offy);
    };
    Cnds.prototype.IsAnimPlaying = function(animname) {
        if (this.changeAnimName.length)
            return cr.equals_nocase(this.changeAnimName, animname);
        else
            return cr.equals_nocase(this.cur_animation.name, animname);
    };
    Cnds.prototype.CompareFrame = function(cmp, framenum) {
        return cr.do_cmp(this.cur_frame, cmp, framenum);
    };
    Cnds.prototype.CompareAnimSpeed = function(cmp, x) {
        var s = (this.animForwards ? this.cur_anim_speed : -this.cur_anim_speed);
        return cr.do_cmp(s, cmp, x);
    };
    Cnds.prototype.OnAnimFinished = function(animname) {
        return cr.equals_nocase(this.animTriggerName, animname);
    };
    Cnds.prototype.OnAnyAnimFinished = function() {
        return true;
    };
    Cnds.prototype.OnFrameChanged = function() {
        return true;
    };
    Cnds.prototype.IsMirrored = function() {
        return this.width < 0;
    };
    Cnds.prototype.IsFlipped = function() {
        return this.height < 0;
    };
    Cnds.prototype.OnURLLoaded = function() {
        return true;
    };
    Cnds.prototype.IsCollisionEnabled = function() {
        return this.collisionsEnabled;
    };
    pluginProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.Spawn = function(obj, layer, imgpt) {
        if (!obj || !layer)
            return;
        var inst = this.runtime.createInstance(obj, layer, this.getImagePoint(imgpt, true), this.getImagePoint(imgpt, false));
        if (!inst)
            return;
        if (typeof inst.angle !== "undefined") {
            inst.angle = this.angle;
            inst.set_bbox_changed();
        }
        this.runtime.isInOnDestroy++;
        var i, len, s;
        this.runtime.trigger(Object.getPrototypeOf(obj.plugin).cnds.OnCreated, inst);
        if (inst.is_contained) {
            for (i = 0, len = inst.siblings.length; i < len; i++) {
                s = inst.siblings[i];
                this.runtime.trigger(Object.getPrototypeOf(s.type.plugin).cnds.OnCreated, s);
            }
        }
        this.runtime.isInOnDestroy--;
        var cur_act = this.runtime.getCurrentAction();
        var reset_sol = false;
        if (cr.is_undefined(cur_act.extra.Spawn_LastExec) || cur_act.extra.Spawn_LastExec < this.runtime.execcount) {
            reset_sol = true;
            cur_act.extra.Spawn_LastExec = this.runtime.execcount;
        }
        var sol;
        if (obj != this.type) {
            sol = obj.getCurrentSol();
            sol.select_all = false;
            if (reset_sol) {
                sol.instances.length = 1;
                sol.instances[0] = inst;
            } else
                sol.instances.push(inst);
            if (inst.is_contained) {
                for (i = 0, len = inst.siblings.length; i < len; i++) {
                    s = inst.siblings[i];
                    sol = s.type.getCurrentSol();
                    sol.select_all = false;
                    if (reset_sol) {
                        sol.instances.length = 1;
                        sol.instances[0] = s;
                    } else
                        sol.instances.push(s);
                }
            }
        }
    };
    Acts.prototype.SetEffect = function(effect) {
        this.compositeOp = cr.effectToCompositeOp(effect);
        cr.setGLBlend(this, effect, this.runtime.gl);
        this.runtime.redraw = true;
    };
    Acts.prototype.StopAnim = function() {
        this.animPlaying = false;
    };
    Acts.prototype.StartAnim = function(from) {
        this.animPlaying = true;
        this.frameStart = this.getNowTime();
        if (from === 1 && this.cur_frame !== 0) {
            this.changeAnimFrame = 0;
            if (!this.inAnimTrigger)
                this.doChangeAnimFrame();
        }
        if (!this.isTicking) {
            this.runtime.tickMe(this);
            this.isTicking = true;
        }
    };
    Acts.prototype.SetAnim = function(animname, from) {
        this.changeAnimName = animname;
        this.changeAnimFrom = from;
        if (!this.isTicking) {
            this.runtime.tickMe(this);
            this.isTicking = true;
        }
        if (!this.inAnimTrigger)
            this.doChangeAnim();
    };
    Acts.prototype.SetAnimFrame = function(framenumber) {
        this.changeAnimFrame = framenumber;
        if (!this.isTicking) {
            this.runtime.tickMe(this);
            this.isTicking = true;
        }
        if (!this.inAnimTrigger)
            this.doChangeAnimFrame();
    };
    Acts.prototype.SetAnimSpeed = function(s) {
        this.cur_anim_speed = cr.abs(s);
        this.animForwards = (s >= 0);
        if (!this.isTicking) {
            this.runtime.tickMe(this);
            this.isTicking = true;
        }
    };
    Acts.prototype.SetMirrored = function(m) {
        var neww = cr.abs(this.width) * (m === 0 ? -1 : 1);
        if (this.width === neww)
            return;
        this.width = neww;
        this.set_bbox_changed();
    };
    Acts.prototype.SetFlipped = function(f) {
        var newh = cr.abs(this.height) * (f === 0 ? -1 : 1);
        if (this.height === newh)
            return;
        this.height = newh;
        this.set_bbox_changed();
    };
    Acts.prototype.SetScale = function(s) {
        var cur_frame = this.curFrame;
        var mirror_factor = (this.width < 0 ? -1 : 1);
        var flip_factor = (this.height < 0 ? -1 : 1);
        var new_width = cur_frame.width * s * mirror_factor;
        var new_height = cur_frame.height * s * flip_factor;
        if (this.width !== new_width || this.height !== new_height) {
            this.width = new_width;
            this.height = new_height;
            this.set_bbox_changed();
        }
    };
    Acts.prototype.LoadURL = function(url_, resize_) {
        var img = new Image();
        var self = this;
        var curFrame_ = this.curFrame;
        img.onload = function() {
            if (curFrame_.texture_img.src === img.src) {
                if (self.runtime.glwrap && self.curFrame === curFrame_)
                    self.curWebGLTexture = curFrame_.webGL_texture;
                self.runtime.redraw = true;
                self.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded, self);
                return;
            }
            curFrame_.texture_img = img;
            curFrame_.offx = 0;
            curFrame_.offy = 0;
            curFrame_.width = img.width;
            curFrame_.height = img.height;
            curFrame_.spritesheeted = false;
            curFrame_.datauri = "";
            if (self.runtime.glwrap) {
                if (curFrame_.webGL_texture)
                    self.runtime.glwrap.deleteTexture(curFrame_.webGL_texture);
                curFrame_.webGL_texture = self.runtime.glwrap.loadTexture(img, false, self.runtime.linearSampling);
                if (self.curFrame === curFrame_)
                    self.curWebGLTexture = curFrame_.webGL_texture;
                self.type.updateAllCurrentTexture();
            }
            if (resize_ === 0) // resize to image size
            {
                self.width = img.width;
                self.height = img.height;
                self.set_bbox_changed();
            }
            self.runtime.redraw = true;
            self.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded, self);
        };
        if (url_.substr(0, 5) !== "data:")
            img.crossOrigin = 'anonymous';
        img.src = url_;
    };
    Acts.prototype.SetCollisions = function(set_) {
        if (this.collisionsEnabled === (set_ !== 0))
            return; // no change
        this.collisionsEnabled = (set_ !== 0);
        if (this.collisionsEnabled)
            this.set_bbox_changed(); // needs to be added back to cells
        else {
            if (this.collcells.right >= this.collcells.left)
                this.type.collision_grid.update(this, this.collcells, null);
            this.collcells.set(0, 0, -1, -1);
        }
    };
    pluginProto.acts = new Acts();

    function Exps() {};
    Exps.prototype.AnimationFrame = function(ret) {
        ret.set_int(this.cur_frame);
    };
    Exps.prototype.AnimationFrameCount = function(ret) {
        ret.set_int(this.cur_animation.frames.length);
    };
    Exps.prototype.AnimationName = function(ret) {
        ret.set_string(this.cur_animation.name);
    };
    Exps.prototype.AnimationSpeed = function(ret) {
        ret.set_float(this.animForwards ? this.cur_anim_speed : -this.cur_anim_speed);
    };
    Exps.prototype.ImagePointX = function(ret, imgpt) {
        ret.set_float(this.getImagePoint(imgpt, true));
    };
    Exps.prototype.ImagePointY = function(ret, imgpt) {
        ret.set_float(this.getImagePoint(imgpt, false));
    };
    Exps.prototype.ImagePointCount = function(ret) {
        ret.set_int(this.curFrame.image_points.length);
    };
    Exps.prototype.ImageWidth = function(ret) {
        ret.set_float(this.curFrame.width);
    };
    Exps.prototype.ImageHeight = function(ret) {
        ret.set_float(this.curFrame.height);
    };
    pluginProto.exps = new Exps();
}());;;
cr.plugins_.Text = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var pluginProto = cr.plugins_.Text.prototype;
    pluginProto.onCreate = function() {
        pluginProto.acts.SetWidth = function(w) {
            if (this.width !== w) {
                this.width = w;
                this.text_changed = true; // also recalculate text wrapping
                this.set_bbox_changed();
            }
        };
    };
    pluginProto.Type = function(plugin) {
        this.plugin = plugin;
        this.runtime = plugin.runtime;
    };
    var typeProto = pluginProto.Type.prototype;
    typeProto.onCreate = function() {};
    typeProto.onLostWebGLContext = function() {
        if (this.is_family)
            return;
        var i, len, inst;
        for (i = 0, len = this.instances.length; i < len; i++) {
            inst = this.instances[i];
            inst.mycanvas = null;
            inst.myctx = null;
            inst.mytex = null;
        }
    };
    pluginProto.Instance = function(type) {
        this.type = type;
        this.runtime = type.runtime;
        if (this.recycled)
            this.lines.length = 0;
        else
            this.lines = []; // for word wrapping
        this.text_changed = true;
    };
    var instanceProto = pluginProto.Instance.prototype;
    var requestedWebFonts = {}; // already requested web fonts have an entry here
    instanceProto.onCreate = function() {
        this.text = this.properties[0];
        this.visible = (this.properties[1] === 0); // 0=visible, 1=invisible
        this.font = this.properties[2];
        this.color = this.properties[3];
        this.halign = this.properties[4]; // 0=left, 1=center, 2=right
        this.valign = this.properties[5]; // 0=top, 1=center, 2=bottom
        this.wrapbyword = (this.properties[7] === 0); // 0=word, 1=character
        this.lastwidth = this.width;
        this.lastwrapwidth = this.width;
        this.lastheight = this.height;
        this.line_height_offset = this.properties[8];
        this.facename = "";
        this.fontstyle = "";
        this.ptSize = 0;
        this.textWidth = 0;
        this.textHeight = 0;
        this.parseFont();
        this.mycanvas = null;
        this.myctx = null;
        this.mytex = null;
        this.need_text_redraw = false;
        this.last_render_tick = this.runtime.tickcount;
        if (this.recycled)
            this.rcTex.set(0, 0, 1, 1);
        else
            this.rcTex = new cr.rect(0, 0, 1, 1);
        if (this.runtime.glwrap)
            this.runtime.tickMe(this);;
    };
    instanceProto.parseFont = function() {
        var arr = this.font.split(" ");
        var i;
        for (i = 0; i < arr.length; i++) {
            if (arr[i].substr(arr[i].length - 2, 2) === "pt") {
                this.ptSize = parseInt(arr[i].substr(0, arr[i].length - 2));
                this.pxHeight = Math.ceil((this.ptSize / 72.0) * 96.0) + 4; // assume 96dpi...
                if (i > 0)
                    this.fontstyle = arr[i - 1];
                this.facename = arr[i + 1];
                for (i = i + 2; i < arr.length; i++)
                    this.facename += " " + arr[i];
                break;
            }
        }
    };
    instanceProto.saveToJSON = function() {
        return {
            "t": this.text,
            "f": this.font,
            "c": this.color,
            "ha": this.halign,
            "va": this.valign,
            "wr": this.wrapbyword,
            "lho": this.line_height_offset,
            "fn": this.facename,
            "fs": this.fontstyle,
            "ps": this.ptSize,
            "pxh": this.pxHeight,
            "tw": this.textWidth,
            "th": this.textHeight,
            "lrt": this.last_render_tick
        };
    };
    instanceProto.loadFromJSON = function(o) {
        this.text = o["t"];
        this.font = o["f"];
        this.color = o["c"];
        this.halign = o["ha"];
        this.valign = o["va"];
        this.wrapbyword = o["wr"];
        this.line_height_offset = o["lho"];
        this.facename = o["fn"];
        this.fontstyle = o["fs"];
        this.ptSize = o["ps"];
        this.pxHeight = o["pxh"];
        this.textWidth = o["tw"];
        this.textHeight = o["th"];
        this.last_render_tick = o["lrt"];
        this.text_changed = true;
        this.lastwidth = this.width;
        this.lastwrapwidth = this.width;
        this.lastheight = this.height;
    };
    instanceProto.tick = function() {
        if (this.runtime.glwrap && this.mytex && (this.runtime.tickcount - this.last_render_tick >= 300)) {
            var layer = this.layer;
            this.update_bbox();
            var bbox = this.bbox;
            if (bbox.right < layer.viewLeft || bbox.bottom < layer.viewTop || bbox.left > layer.viewRight || bbox.top > layer.viewBottom) {
                this.runtime.glwrap.deleteTexture(this.mytex);
                this.mytex = null;
                this.myctx = null;
                this.mycanvas = null;
            }
        }
    };
    instanceProto.onDestroy = function() {
        this.myctx = null;
        this.mycanvas = null;
        if (this.runtime.glwrap && this.mytex)
            this.runtime.glwrap.deleteTexture(this.mytex);
        this.mytex = null;
    };
    instanceProto.updateFont = function() {
        this.font = this.fontstyle + " " + this.ptSize.toString() + "pt " + this.facename;
        this.text_changed = true;
        this.runtime.redraw = true;
    };
    instanceProto.draw = function(ctx, glmode) {
        ctx.font = this.font;
        ctx.textBaseline = "top";
        ctx.fillStyle = this.color;
        ctx.globalAlpha = glmode ? 1 : this.opacity;
        var myscale = 1;
        if (glmode) {
            myscale = this.layer.getScale();
            ctx.save();
            ctx.scale(myscale, myscale);
        }
        if (this.text_changed || this.width !== this.lastwrapwidth) {
            this.type.plugin.WordWrap(this.text, this.lines, ctx, this.width, this.wrapbyword);
            this.text_changed = false;
            this.lastwrapwidth = this.width;
        }
        this.update_bbox();
        var penX = glmode ? 0 : this.bquad.tlx;
        var penY = glmode ? 0 : this.bquad.tly;
        if (this.runtime.pixel_rounding) {
            penX = (penX + 0.5) | 0;
            penY = (penY + 0.5) | 0;
        }
        if (this.angle !== 0 && !glmode) {
            ctx.save();
            ctx.translate(penX, penY);
            ctx.rotate(this.angle);
            penX = 0;
            penY = 0;
        }
        var endY = penY + this.height;
        var line_height = this.pxHeight;
        line_height += this.line_height_offset;
        var drawX;
        var i;
        if (this.valign === 1) // center
            penY += Math.max(this.height / 2 - (this.lines.length * line_height) / 2, 0);
        else if (this.valign === 2) // bottom
            penY += Math.max(this.height - (this.lines.length * line_height) - 2, 0);
        for (i = 0; i < this.lines.length; i++) {
            drawX = penX;
            if (this.halign === 1) // center
                drawX = penX + (this.width - this.lines[i].width) / 2;
            else if (this.halign === 2) // right
                drawX = penX + (this.width - this.lines[i].width);
            ctx.fillText(this.lines[i].text, drawX, penY);
            penY += line_height;
            if (penY >= endY - line_height)
                break;
        }
        if (this.angle !== 0 || glmode)
            ctx.restore();
        this.last_render_tick = this.runtime.tickcount;
    };
    instanceProto.drawGL = function(glw) {
        if (this.width < 1 || this.height < 1)
            return;
        var need_redraw = this.text_changed || this.need_text_redraw;
        this.need_text_redraw = false;
        var layer_scale = this.layer.getScale();
        var layer_angle = this.layer.getAngle();
        var rcTex = this.rcTex;
        var floatscaledwidth = layer_scale * this.width;
        var floatscaledheight = layer_scale * this.height;
        var scaledwidth = Math.ceil(floatscaledwidth);
        var scaledheight = Math.ceil(floatscaledheight);
        var halfw = this.runtime.draw_width / 2;
        var halfh = this.runtime.draw_height / 2;
        if (!this.myctx) {
            this.mycanvas = document.createElement("canvas");
            this.mycanvas.width = scaledwidth;
            this.mycanvas.height = scaledheight;
            this.lastwidth = scaledwidth;
            this.lastheight = scaledheight;
            need_redraw = true;
            this.myctx = this.mycanvas.getContext("2d");
        }
        if (scaledwidth !== this.lastwidth || scaledheight !== this.lastheight) {
            this.mycanvas.width = scaledwidth;
            this.mycanvas.height = scaledheight;
            if (this.mytex) {
                glw.deleteTexture(this.mytex);
                this.mytex = null;
            }
            need_redraw = true;
        }
        if (need_redraw) {
            this.myctx.clearRect(0, 0, scaledwidth, scaledheight);
            this.draw(this.myctx, true);
            if (!this.mytex)
                this.mytex = glw.createEmptyTexture(scaledwidth, scaledheight, this.runtime.linearSampling, this.runtime.isMobile);
            glw.videoToTexture(this.mycanvas, this.mytex, this.runtime.isMobile);
        }
        this.lastwidth = scaledwidth;
        this.lastheight = scaledheight;
        glw.setTexture(this.mytex);
        glw.setOpacity(this.opacity);
        glw.resetModelView();
        glw.translate(-halfw, -halfh);
        glw.updateModelView();
        var q = this.bquad;
        var tlx = this.layer.layerToCanvas(q.tlx, q.tly, true, true);
        var tly = this.layer.layerToCanvas(q.tlx, q.tly, false, true);
        var trx = this.layer.layerToCanvas(q.trx, q.try_, true, true);
        var try_ = this.layer.layerToCanvas(q.trx, q.try_, false, true);
        var brx = this.layer.layerToCanvas(q.brx, q.bry, true, true);
        var bry = this.layer.layerToCanvas(q.brx, q.bry, false, true);
        var blx = this.layer.layerToCanvas(q.blx, q.bly, true, true);
        var bly = this.layer.layerToCanvas(q.blx, q.bly, false, true);
        if (this.runtime.pixel_rounding || (this.angle === 0 && layer_angle === 0)) {
            var ox = ((tlx + 0.5) | 0) - tlx;
            var oy = ((tly + 0.5) | 0) - tly
            tlx += ox;
            tly += oy;
            trx += ox;
            try_ += oy;
            brx += ox;
            bry += oy;
            blx += ox;
            bly += oy;
        }
        if (this.angle === 0 && layer_angle === 0) {
            trx = tlx + scaledwidth;
            try_ = tly;
            brx = trx;
            bry = tly + scaledheight;
            blx = tlx;
            bly = bry;
            rcTex.right = 1;
            rcTex.bottom = 1;
        } else {
            rcTex.right = floatscaledwidth / scaledwidth;
            rcTex.bottom = floatscaledheight / scaledheight;
        }
        glw.quadTex(tlx, tly, trx, try_, brx, bry, blx, bly, rcTex);
        glw.resetModelView();
        glw.scale(layer_scale, layer_scale);
        glw.rotateZ(-this.layer.getAngle());
        glw.translate((this.layer.viewLeft + this.layer.viewRight) / -2, (this.layer.viewTop + this.layer.viewBottom) / -2);
        glw.updateModelView();
        this.last_render_tick = this.runtime.tickcount;
    };
    var wordsCache = [];
    pluginProto.TokeniseWords = function(text) {
        wordsCache.length = 0;
        var cur_word = "";
        var ch;
        var i = 0;
        while (i < text.length) {
            ch = text.charAt(i);
            if (ch === "\n") {
                if (cur_word.length) {
                    wordsCache.push(cur_word);
                    cur_word = "";
                }
                wordsCache.push("\n");
                ++i;
            } else if (ch === " " || ch === "\t" || ch === "-") {
                do {
                    cur_word += text.charAt(i);
                    i++;
                }
                while (i < text.length && (text.charAt(i) === " " || text.charAt(i) === "\t"));
                wordsCache.push(cur_word);
                cur_word = "";
            } else if (i < text.length) {
                cur_word += ch;
                i++;
            }
        }
        if (cur_word.length)
            wordsCache.push(cur_word);
    };
    var linesCache = [];

    function allocLine() {
        if (linesCache.length)
            return linesCache.pop();
        else
            return {};
    };

    function freeLine(l) {
        linesCache.push(l);
    };

    function freeAllLines(arr) {
        var i, len;
        for (i = 0, len = arr.length; i < len; i++) {
            freeLine(arr[i]);
        }
        arr.length = 0;
    };
    pluginProto.WordWrap = function(text, lines, ctx, width, wrapbyword) {
        if (!text || !text.length) {
            freeAllLines(lines);
            return;
        }
        if (width <= 2.0) {
            freeAllLines(lines);
            return;
        }
        if (text.length <= 100 && text.indexOf("\n") === -1) {
            var all_width = ctx.measureText(text).width;
            if (all_width <= width) {
                freeAllLines(lines);
                lines.push(allocLine());
                lines[0].text = text;
                lines[0].width = all_width;
                return;
            }
        }
        this.WrapText(text, lines, ctx, width, wrapbyword);
    };
    pluginProto.WrapText = function(text, lines, ctx, width, wrapbyword) {
        var wordArray;
        if (wrapbyword) {
            this.TokeniseWords(text); // writes to wordsCache
            wordArray = wordsCache;
        } else
            wordArray = text;
        var cur_line = "";
        var prev_line;
        var line_width;
        var i;
        var lineIndex = 0;
        var line;
        for (i = 0; i < wordArray.length; i++) {
            if (wordArray[i] === "\n") {
                if (lineIndex >= lines.length)
                    lines.push(allocLine());
                line = lines[lineIndex];
                line.text = cur_line;
                line.width = ctx.measureText(cur_line).width;
                lineIndex++;
                cur_line = "";
                continue;
            }
            prev_line = cur_line;
            cur_line += wordArray[i];
            line_width = ctx.measureText(cur_line).width;
            if (line_width >= width) {
                if (lineIndex >= lines.length)
                    lines.push(allocLine());
                line = lines[lineIndex];
                line.text = prev_line;
                line.width = ctx.measureText(prev_line).width;
                lineIndex++;
                cur_line = wordArray[i];
                if (!wrapbyword && cur_line === " ")
                    cur_line = "";
            }
        }
        if (cur_line.length) {
            if (lineIndex >= lines.length)
                lines.push(allocLine());
            line = lines[lineIndex];
            line.text = cur_line;
            line.width = ctx.measureText(cur_line).width;
            lineIndex++;
        }
        for (i = lineIndex; i < lines.length; i++)
            freeLine(lines[i]);
        lines.length = lineIndex;
    };

    function Cnds() {};
    Cnds.prototype.CompareText = function(text_to_compare, case_sensitive) {
        if (case_sensitive)
            return this.text == text_to_compare;
        else
            return cr.equals_nocase(this.text, text_to_compare);
    };
    pluginProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.SetText = function(param) {
        if (cr.is_number(param) && param < 1e9)
            param = Math.round(param * 1e10) / 1e10; // round to nearest ten billionth - hides floating point errors
        var text_to_set = param.toString();
        if (this.text !== text_to_set) {
            this.text = text_to_set;
            this.text_changed = true;
            this.runtime.redraw = true;
        }
    };
    Acts.prototype.AppendText = function(param) {
        if (cr.is_number(param))
            param = Math.round(param * 1e10) / 1e10; // round to nearest ten billionth - hides floating point errors
        var text_to_append = param.toString();
        if (text_to_append) // not empty
        {
            this.text += text_to_append;
            this.text_changed = true;
            this.runtime.redraw = true;
        }
    };
    Acts.prototype.SetFontFace = function(face_, style_) {
        var newstyle = "";
        switch (style_) {
            case 1:
                newstyle = "bold";
                break;
            case 2:
                newstyle = "italic";
                break;
            case 3:
                newstyle = "bold italic";
                break;
        }
        if (face_ === this.facename && newstyle === this.fontstyle)
            return; // no change
        this.facename = face_;
        this.fontstyle = newstyle;
        this.updateFont();
    };
    Acts.prototype.SetFontSize = function(size_) {
        if (this.ptSize === size_)
            return;
        this.ptSize = size_;
        this.pxHeight = Math.ceil((this.ptSize / 72.0) * 96.0) + 4; // assume 96dpi...
        this.updateFont();
    };
    Acts.prototype.SetFontColor = function(rgb) {
        var newcolor = "rgb(" + cr.GetRValue(rgb).toString() + "," + cr.GetGValue(rgb).toString() + "," + cr.GetBValue(rgb).toString() + ")";
        if (newcolor === this.color)
            return;
        this.color = newcolor;
        this.need_text_redraw = true;
        this.runtime.redraw = true;
    };
    Acts.prototype.SetWebFont = function(familyname_, cssurl_) {
        if (this.runtime.isDomFree) {
            cr.logexport("[Construct 2] Text plugin: 'Set web font' not supported on this platform - the action has been ignored");
            return; // DC todo
        }
        var self = this;
        var refreshFunc = (function() {
            self.runtime.redraw = true;
            self.text_changed = true;
        });
        if (requestedWebFonts.hasOwnProperty(cssurl_)) {
            var newfacename = "'" + familyname_ + "'";
            if (this.facename === newfacename)
                return; // no change
            this.facename = newfacename;
            this.updateFont();
            for (var i = 1; i < 10; i++) {
                setTimeout(refreshFunc, i * 100);
                setTimeout(refreshFunc, i * 1000);
            }
            return;
        }
        var wf = document.createElement("link");
        wf.href = cssurl_;
        wf.rel = "stylesheet";
        wf.type = "text/css";
        wf.onload = refreshFunc;
        document.getElementsByTagName('head')[0].appendChild(wf);
        requestedWebFonts[cssurl_] = true;
        this.facename = "'" + familyname_ + "'";
        this.updateFont();
        for (var i = 1; i < 10; i++) {
            setTimeout(refreshFunc, i * 100);
            setTimeout(refreshFunc, i * 1000);
        };
    };
    Acts.prototype.SetEffect = function(effect) {
        this.compositeOp = cr.effectToCompositeOp(effect);
        cr.setGLBlend(this, effect, this.runtime.gl);
        this.runtime.redraw = true;
    };
    pluginProto.acts = new Acts();

    function Exps() {};
    Exps.prototype.Text = function(ret) {
        ret.set_string(this.text);
    };
    Exps.prototype.FaceName = function(ret) {
        ret.set_string(this.facename);
    };
    Exps.prototype.FaceSize = function(ret) {
        ret.set_int(this.ptSize);
    };
    Exps.prototype.TextWidth = function(ret) {
        var w = 0;
        var i, len, x;
        for (i = 0, len = this.lines.length; i < len; i++) {
            x = this.lines[i].width;
            if (w < x)
                w = x;
        }
        ret.set_int(w);
    };
    Exps.prototype.TextHeight = function(ret) {
        ret.set_int(this.lines.length * (this.pxHeight + this.line_height_offset) - this.line_height_offset);
    };
    pluginProto.exps = new Exps();
}());;;
cr.plugins_.TiledBg = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var pluginProto = cr.plugins_.TiledBg.prototype;
    pluginProto.Type = function(plugin) {
        this.plugin = plugin;
        this.runtime = plugin.runtime;
    };
    var typeProto = pluginProto.Type.prototype;
    typeProto.onCreate = function() {
        if (this.is_family)
            return;
        this.texture_img = new Image();
        this.texture_img["idtkLoadDisposed"] = true;
        this.texture_img.src = this.texture_file;
        this.texture_img.cr_filesize = this.texture_filesize;
        this.runtime.waitForImageLoad(this.texture_img);
        this.pattern = null;
        this.webGL_texture = null;
    };
    typeProto.onLostWebGLContext = function() {
        if (this.is_family)
            return;
        this.webGL_texture = null;
    };
    typeProto.onRestoreWebGLContext = function() {
        if (this.is_family || !this.instances.length)
            return;
        if (!this.webGL_texture) {
            this.webGL_texture = this.runtime.glwrap.loadTexture(this.texture_img, true, this.runtime.linearSampling, this.texture_pixelformat);
        }
        var i, len;
        for (i = 0, len = this.instances.length; i < len; i++)
            this.instances[i].webGL_texture = this.webGL_texture;
    };
    typeProto.loadTextures = function() {
        if (this.is_family || this.webGL_texture || !this.runtime.glwrap)
            return;
        this.webGL_texture = this.runtime.glwrap.loadTexture(this.texture_img, true, this.runtime.linearSampling, this.texture_pixelformat);
    };
    typeProto.unloadTextures = function() {
        if (this.is_family || this.instances.length || !this.webGL_texture)
            return;
        this.runtime.glwrap.deleteTexture(this.webGL_texture);
        this.webGL_texture = null;
    };
    typeProto.preloadCanvas2D = function(ctx) {
        ctx.drawImage(this.texture_img, 0, 0);
    };
    pluginProto.Instance = function(type) {
        this.type = type;
        this.runtime = type.runtime;
    };
    var instanceProto = pluginProto.Instance.prototype;
    instanceProto.onCreate = function() {
        this.visible = (this.properties[0] === 0); // 0=visible, 1=invisible
        this.rcTex = new cr.rect(0, 0, 0, 0);
        this.has_own_texture = false; // true if a texture loaded in from URL
        this.texture_img = this.type.texture_img;
        if (this.runtime.glwrap) {
            this.type.loadTextures();
            this.webGL_texture = this.type.webGL_texture;
        } else {
            if (!this.type.pattern)
                this.type.pattern = this.runtime.ctx.createPattern(this.type.texture_img, "repeat");
            this.pattern = this.type.pattern;
        }
    };
    instanceProto.afterLoad = function() {
        this.has_own_texture = false;
        this.texture_img = this.type.texture_img;
    };
    instanceProto.onDestroy = function() {
        if (this.runtime.glwrap && this.has_own_texture && this.webGL_texture) {
            this.runtime.glwrap.deleteTexture(this.webGL_texture);
            this.webGL_texture = null;
        }
    };
    instanceProto.draw = function(ctx) {
        ctx.globalAlpha = this.opacity;
        ctx.save();
        ctx.fillStyle = this.pattern;
        var myx = this.x;
        var myy = this.y;
        if (this.runtime.pixel_rounding) {
            myx = (myx + 0.5) | 0;
            myy = (myy + 0.5) | 0;
        }
        var drawX = -(this.hotspotX * this.width);
        var drawY = -(this.hotspotY * this.height);
        var offX = drawX % this.texture_img.width;
        var offY = drawY % this.texture_img.height;
        if (offX < 0)
            offX += this.texture_img.width;
        if (offY < 0)
            offY += this.texture_img.height;
        ctx.translate(myx, myy);
        ctx.rotate(this.angle);
        ctx.translate(offX, offY);
        ctx.fillRect(drawX - offX,
            drawY - offY,
            this.width,
            this.height);
        ctx.restore();
    };
    instanceProto.drawGL = function(glw) {
        glw.setTexture(this.webGL_texture);
        glw.setOpacity(this.opacity);
        var rcTex = this.rcTex;
        rcTex.right = this.width / this.texture_img.width;
        rcTex.bottom = this.height / this.texture_img.height;
        var q = this.bquad;
        if (this.runtime.pixel_rounding) {
            var ox = ((this.x + 0.5) | 0) - this.x;
            var oy = ((this.y + 0.5) | 0) - this.y;
            glw.quadTex(q.tlx + ox, q.tly + oy, q.trx + ox, q.try_ + oy, q.brx + ox, q.bry + oy, q.blx + ox, q.bly + oy, rcTex);
        } else
            glw.quadTex(q.tlx, q.tly, q.trx, q.try_, q.brx, q.bry, q.blx, q.bly, rcTex);
    };

    function Cnds() {};
    Cnds.prototype.OnURLLoaded = function() {
        return true;
    };
    pluginProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.SetEffect = function(effect) {
        this.compositeOp = cr.effectToCompositeOp(effect);
        cr.setGLBlend(this, effect, this.runtime.gl);
        this.runtime.redraw = true;
    };
    Acts.prototype.LoadURL = function(url_) {
        var img = new Image();
        var self = this;
        img.onload = function() {
            self.texture_img = img;
            if (self.runtime.glwrap) {
                if (self.has_own_texture && self.webGL_texture)
                    self.runtime.glwrap.deleteTexture(self.webGL_texture);
                self.webGL_texture = self.runtime.glwrap.loadTexture(img, true, self.runtime.linearSampling);
            } else {
                self.pattern = self.runtime.ctx.createPattern(img, "repeat");
            }
            self.has_own_texture = true;
            self.runtime.redraw = true;
            self.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded, self);
        };
        if (url_.substr(0, 5) !== "data:")
            img.crossOrigin = 'anonymous';
        img.src = url_;
    };
    pluginProto.acts = new Acts();

    function Exps() {};
    Exps.prototype.ImageWidth = function(ret) {
        ret.set_float(this.texture_img.width);
    };
    Exps.prototype.ImageHeight = function(ret) {
        ret.set_float(this.texture_img.height);
    };
    pluginProto.exps = new Exps();
}());;;
cr.plugins_.Touch = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var pluginProto = cr.plugins_.Touch.prototype;
    pluginProto.Type = function(plugin) {
        this.plugin = plugin;
        this.runtime = plugin.runtime;
    };
    var typeProto = pluginProto.Type.prototype;
    typeProto.onCreate = function() {};
    pluginProto.Instance = function(type) {
        this.type = type;
        this.runtime = type.runtime;
        this.touches = [];
        this.mouseDown = false;
    };
    var instanceProto = pluginProto.Instance.prototype;
    var dummyoffset = {
        left: 0,
        top: 0
    };
    instanceProto.findTouch = function(id) {
        var i, len;
        for (i = 0, len = this.touches.length; i < len; i++) {
            if (this.touches[i]["id"] === id)
                return i;
        }
        return -1;
    };
    var appmobi_accx = 0;
    var appmobi_accy = 0;
    var appmobi_accz = 0;

    function AppMobiGetAcceleration(evt) {
        appmobi_accx = evt.x;
        appmobi_accy = evt.y;
        appmobi_accz = evt.z;
    };
    var pg_accx = 0;
    var pg_accy = 0;
    var pg_accz = 0;

    function PhoneGapGetAcceleration(evt) {
        pg_accx = evt.x;
        pg_accy = evt.y;
        pg_accz = evt.z;
    };
    var theInstance = null;
    instanceProto.onCreate = function() {
        theInstance = this;
        this.isWindows8 = !!(typeof window["c2isWindows8"] !== "undefined" && window["c2isWindows8"]);
        this.orient_alpha = 0;
        this.orient_beta = 0;
        this.orient_gamma = 0;
        this.acc_g_x = 0;
        this.acc_g_y = 0;
        this.acc_g_z = 0;
        this.acc_x = 0;
        this.acc_y = 0;
        this.acc_z = 0;
        this.curTouchX = 0;
        this.curTouchY = 0;
        this.trigger_index = 0;
        this.trigger_id = 0;
        this.useMouseInput = (this.properties[0] !== 0);
        var elem = (this.runtime.fullscreen_mode > 0) ? document : this.runtime.canvas;
        var elem2 = document;
        if (this.runtime.isDirectCanvas)
            elem2 = elem = window["Canvas"];
        else if (this.runtime.isCocoonJs)
            elem2 = elem = window;
        var self = this;
        if (window.navigator["pointerEnabled"]) {
            elem.addEventListener("pointerdown",
                function(info) {
                    self.onPointerStart(info);
                },
                false
            );
            elem.addEventListener("pointermove",
                function(info) {
                    self.onPointerMove(info);
                },
                false
            );
            elem2.addEventListener("pointerup",
                function(info) {
                    self.onPointerEnd(info);
                },
                false
            );
            elem2.addEventListener("pointercancel",
                function(info) {
                    self.onPointerEnd(info);
                },
                false
            );
            if (this.runtime.canvas) {
                this.runtime.canvas.addEventListener("MSGestureHold", function(e) {
                    e.preventDefault();
                }, false);
                document.addEventListener("MSGestureHold", function(e) {
                    e.preventDefault();
                }, false);
                this.runtime.canvas.addEventListener("gesturehold", function(e) {
                    e.preventDefault();
                }, false);
                document.addEventListener("gesturehold", function(e) {
                    e.preventDefault();
                }, false);
            }
        } else if (window.navigator["msPointerEnabled"]) {
            elem.addEventListener("MSPointerDown",
                function(info) {
                    self.onPointerStart(info);
                },
                false
            );
            elem.addEventListener("MSPointerMove",
                function(info) {
                    self.onPointerMove(info);
                },
                false
            );
            elem2.addEventListener("MSPointerUp",
                function(info) {
                    self.onPointerEnd(info);
                },
                false
            );
            elem2.addEventListener("MSPointerCancel",
                function(info) {
                    self.onPointerEnd(info);
                },
                false
            );
            if (this.runtime.canvas) {
                this.runtime.canvas.addEventListener("MSGestureHold", function(e) {
                    e.preventDefault();
                }, false);
                document.addEventListener("MSGestureHold", function(e) {
                    e.preventDefault();
                }, false);
            }
        } else {
            elem.addEventListener("touchstart",
                function(info) {
                    self.onTouchStart(info);
                },
                false
            );
            elem.addEventListener("touchmove",
                function(info) {
                    self.onTouchMove(info);
                },
                false
            );
            elem2.addEventListener("touchend",
                function(info) {
                    self.onTouchEnd(info);
                },
                false
            );
            elem2.addEventListener("touchcancel",
                function(info) {
                    self.onTouchEnd(info);
                },
                false
            );
        }
        if (this.isWindows8) {
            var win8accelerometerFn = function(e) {
                var reading = e["reading"];
                self.acc_x = reading["accelerationX"];
                self.acc_y = reading["accelerationY"];
                self.acc_z = reading["accelerationZ"];
            };
            var win8inclinometerFn = function(e) {
                var reading = e["reading"];
                self.orient_alpha = reading["yawDegrees"];
                self.orient_beta = reading["pitchDegrees"];
                self.orient_gamma = reading["rollDegrees"];
            };
            var accelerometer = Windows["Devices"]["Sensors"]["Accelerometer"]["getDefault"]();
            if (accelerometer) {
                accelerometer["reportInterval"] = Math.max(accelerometer["minimumReportInterval"], 16);
                accelerometer.addEventListener("readingchanged", win8accelerometerFn);
            }
            var inclinometer = Windows["Devices"]["Sensors"]["Inclinometer"]["getDefault"]();
            if (inclinometer) {
                inclinometer["reportInterval"] = Math.max(inclinometer["minimumReportInterval"], 16);
                inclinometer.addEventListener("readingchanged", win8inclinometerFn);
            }
            document.addEventListener("visibilitychange", function(e) {
                if (document["hidden"] || document["msHidden"]) {
                    if (accelerometer)
                        accelerometer.removeEventListener("readingchanged", win8accelerometerFn);
                    if (inclinometer)
                        inclinometer.removeEventListener("readingchanged", win8inclinometerFn);
                } else {
                    if (accelerometer)
                        accelerometer.addEventListener("readingchanged", win8accelerometerFn);
                    if (inclinometer)
                        inclinometer.addEventListener("readingchanged", win8inclinometerFn);
                }
            }, false);
        } else {
            window.addEventListener("deviceorientation", function(eventData) {
                self.orient_alpha = eventData["alpha"] || 0;
                self.orient_beta = eventData["beta"] || 0;
                self.orient_gamma = eventData["gamma"] || 0;
            }, false);
            window.addEventListener("devicemotion", function(eventData) {
                if (eventData["accelerationIncludingGravity"]) {
                    self.acc_g_x = eventData["accelerationIncludingGravity"]["x"] || 0;
                    self.acc_g_y = eventData["accelerationIncludingGravity"]["y"] || 0;
                    self.acc_g_z = eventData["accelerationIncludingGravity"]["z"] || 0;
                }
                if (eventData["acceleration"]) {
                    self.acc_x = eventData["acceleration"]["x"] || 0;
                    self.acc_y = eventData["acceleration"]["y"] || 0;
                    self.acc_z = eventData["acceleration"]["z"] || 0;
                }
            }, false);
        }
        if (this.useMouseInput && !this.runtime.isDomFree) {
            jQuery(document).mousemove(
                function(info) {
                    self.onMouseMove(info);
                }
            );
            jQuery(document).mousedown(
                function(info) {
                    self.onMouseDown(info);
                }
            );
            jQuery(document).mouseup(
                function(info) {
                    self.onMouseUp(info);
                }
            );
        }
        if (this.runtime.isAppMobi && !this.runtime.isDirectCanvas) {
            AppMobi["accelerometer"]["watchAcceleration"](AppMobiGetAcceleration, {
                "frequency": 40,
                "adjustForRotation": true
            });
        }
        if (this.runtime.isPhoneGap && navigator["accelerometer"] && navigator["accelerometer"]["watchAcceleration"]) {
            navigator["accelerometer"]["watchAcceleration"](PhoneGapGetAcceleration, null, {
                "frequency": 40
            });
        }
        this.runtime.tick2Me(this);
    };
    instanceProto.onPointerMove = function(info) {
        if (info["pointerType"] === info["MSPOINTER_TYPE_MOUSE"] || info["pointerType"] === "mouse")
            return;
        if (info.preventDefault)
            info.preventDefault();
        var i = this.findTouch(info["pointerId"]);
        var nowtime = cr.performance_now();
        if (i >= 0) {
            var offset = this.runtime.isDomFree ? dummyoffset : jQuery(this.runtime.canvas).offset();
            var t = this.touches[i];
            if (nowtime - t.time < 2)
                return;
            t.lasttime = t.time;
            t.lastx = t.x;
            t.lasty = t.y;
            t.time = nowtime;
            t.x = info.pageX - offset.left;
            t.y = info.pageY - offset.top;
        }
    };
    instanceProto.onPointerStart = function(info) {
        if (info["pointerType"] === info["MSPOINTER_TYPE_MOUSE"] || info["pointerType"] === "mouse")
            return;
        if (info.preventDefault)
            info.preventDefault();
        var offset = this.runtime.isDomFree ? dummyoffset : jQuery(this.runtime.canvas).offset();
        var touchx = info.pageX - offset.left;
        var touchy = info.pageY - offset.top;
        var nowtime = cr.performance_now();
        this.trigger_index = this.touches.length;
        this.trigger_id = info["pointerId"];
        this.touches.push({
            time: nowtime,
            x: touchx,
            y: touchy,
            lasttime: nowtime,
            lastx: touchx,
            lasty: touchy,
            "id": info["pointerId"],
            startindex: this.trigger_index
        });
        this.runtime.isInUserInputEvent = true;
        this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart, this);
        this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart, this);
        this.curTouchX = touchx;
        this.curTouchY = touchy;
        this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject, this);
        this.runtime.isInUserInputEvent = false;
    };
    instanceProto.onPointerEnd = function(info) {
        if (info["pointerType"] === info["MSPOINTER_TYPE_MOUSE"] || info["pointerType"] === "mouse")
            return;
        if (info.preventDefault)
            info.preventDefault();
        var i = this.findTouch(info["pointerId"]);
        this.trigger_index = (i >= 0 ? this.touches[i].startindex : -1);
        this.trigger_id = (i >= 0 ? this.touches[i]["id"] : -1);
        this.runtime.isInUserInputEvent = true;
        this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd, this);
        this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd, this);
        this.runtime.isInUserInputEvent = false;
        if (i >= 0) {
            this.touches.splice(i, 1);
        }
    };
    instanceProto.onTouchMove = function(info) {
        if (info.preventDefault)
            info.preventDefault();
        var nowtime = cr.performance_now();
        var i, len, t, u;
        for (i = 0, len = info.changedTouches.length; i < len; i++) {
            t = info.changedTouches[i];
            var j = this.findTouch(t["identifier"]);
            if (j >= 0) {
                var offset = this.runtime.isDomFree ? dummyoffset : jQuery(this.runtime.canvas).offset();
                u = this.touches[j];
                if (nowtime - u.time < 2)
                    continue;
                u.lasttime = u.time;
                u.lastx = u.x;
                u.lasty = u.y;
                u.time = nowtime;
                u.x = t.pageX - offset.left;
                u.y = t.pageY - offset.top;
            }
        }
    };
    instanceProto.onTouchStart = function(info) {
        if (info.preventDefault)
            info.preventDefault();
        var offset = this.runtime.isDomFree ? dummyoffset : jQuery(this.runtime.canvas).offset();
        var nowtime = cr.performance_now();
        this.runtime.isInUserInputEvent = true;
        var i, len, t, j;
        for (i = 0, len = info.changedTouches.length; i < len; i++) {
            t = info.changedTouches[i];
            j = this.findTouch(t["identifier"]);
            if (j !== -1)
                continue;
            var touchx = t.pageX - offset.left;
            var touchy = t.pageY - offset.top;
            this.trigger_index = this.touches.length;
            this.trigger_id = t["identifier"];
            this.touches.push({
                time: nowtime,
                x: touchx,
                y: touchy,
                lasttime: nowtime,
                lastx: touchx,
                lasty: touchy,
                "id": t["identifier"],
                startindex: this.trigger_index
            });
            this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart, this);
            this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart, this);
            this.curTouchX = touchx;
            this.curTouchY = touchy;
            this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject, this);
        }
        this.runtime.isInUserInputEvent = false;
    };
    instanceProto.onTouchEnd = function(info) {
        if (info.preventDefault)
            info.preventDefault();
        this.runtime.isInUserInputEvent = true;
        var i, len, t, j;
        for (i = 0, len = info.changedTouches.length; i < len; i++) {
            t = info.changedTouches[i];
            j = this.findTouch(t["identifier"]);
            if (j >= 0) {
                this.trigger_index = this.touches[j].startindex;
                this.trigger_id = this.touches[j]["id"];
                this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd, this);
                this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd, this);
                this.touches.splice(j, 1);
            }
        }
        this.runtime.isInUserInputEvent = false;
    };
    instanceProto.getAlpha = function() {
        if (this.runtime.isAppMobi && this.orient_alpha === 0 && appmobi_accz !== 0)
            return appmobi_accz * 90;
        else if (this.runtime.isPhoneGap && this.orient_alpha === 0 && pg_accz !== 0)
            return pg_accz * 90;
        else
            return this.orient_alpha;
    };
    instanceProto.getBeta = function() {
        if (this.runtime.isAppMobi && this.orient_beta === 0 && appmobi_accy !== 0)
            return appmobi_accy * -90;
        else if (this.runtime.isPhoneGap && this.orient_beta === 0 && pg_accy !== 0)
            return pg_accy * -90;
        else
            return this.orient_beta;
    };
    instanceProto.getGamma = function() {
        if (this.runtime.isAppMobi && this.orient_gamma === 0 && appmobi_accx !== 0)
            return appmobi_accx * 90;
        else if (this.runtime.isPhoneGap && this.orient_gamma === 0 && pg_accx !== 0)
            return pg_accx * 90;
        else
            return this.orient_gamma;
    };
    var noop_func = function() {};
    instanceProto.onMouseDown = function(info) {
        if (info.preventDefault && this.runtime.had_a_click && !this.runtime.isMobile)
            info.preventDefault();
        var t = {
            pageX: info.pageX,
            pageY: info.pageY,
            "identifier": 0
        };
        var fakeinfo = {
            changedTouches: [t]
        };
        this.onTouchStart(fakeinfo);
        this.mouseDown = true;
    };
    instanceProto.onMouseMove = function(info) {
        if (!this.mouseDown)
            return;
        var t = {
            pageX: info.pageX,
            pageY: info.pageY,
            "identifier": 0
        };
        var fakeinfo = {
            changedTouches: [t]
        };
        this.onTouchMove(fakeinfo);
    };
    instanceProto.onMouseUp = function(info) {
        if (info.preventDefault && this.runtime.had_a_click && !this.runtime.isMobile)
            info.preventDefault();
        this.runtime.had_a_click = true;
        var t = {
            pageX: info.pageX,
            pageY: info.pageY,
            "identifier": 0
        };
        var fakeinfo = {
            changedTouches: [t]
        };
        this.onTouchEnd(fakeinfo);
        this.mouseDown = false;
    };
    instanceProto.tick2 = function() {
        var i, len, t;
        var nowtime = cr.performance_now();
        for (i = 0, len = this.touches.length; i < len; i++) {
            t = this.touches[i];
            if (t.time <= nowtime - 50)
                t.lasttime = nowtime;
        }
    };

    function Cnds() {};
    Cnds.prototype.OnTouchStart = function() {
        return true;
    };
    Cnds.prototype.OnTouchEnd = function() {
        return true;
    };
    Cnds.prototype.IsInTouch = function() {
        return this.touches.length;
    };
    Cnds.prototype.OnTouchObject = function(type) {
        if (!type)
            return false;
        return this.runtime.testAndSelectCanvasPointOverlap(type, this.curTouchX, this.curTouchY, false);
    };
    Cnds.prototype.IsTouchingObject = function(type) {
        if (!type)
            return false;
        var sol = type.getCurrentSol();
        var instances = sol.getObjects();
        var px, py;
        var touching = [];
        var i, leni, j, lenj;
        for (i = 0, leni = instances.length; i < leni; i++) {
            var inst = instances[i];
            inst.update_bbox();
            for (j = 0, lenj = this.touches.length; j < lenj; j++) {
                var touch = this.touches[j];
                px = inst.layer.canvasToLayer(touch.x, touch.y, true);
                py = inst.layer.canvasToLayer(touch.x, touch.y, false);
                if (inst.contains_pt(px, py)) {
                    touching.push(inst);
                    break;
                }
            }
        }
        if (touching.length) {
            sol.select_all = false;
            sol.instances = touching;
            type.applySolToContainer();
            return true;
        } else
            return false;
    };
    Cnds.prototype.CompareTouchSpeed = function(index, cmp, s) {
        index = Math.floor(index);
        if (index < 0 || index >= this.touches.length)
            return false;
        var t = this.touches[index];
        var dist = cr.distanceTo(t.x, t.y, t.lastx, t.lasty);
        var timediff = (t.time - t.lasttime) / 1000;
        var speed = 0;
        if (timediff > 0)
            speed = dist / timediff;
        return cr.do_cmp(speed, cmp, s);
    };
    Cnds.prototype.OrientationSupported = function() {
        return typeof window["DeviceOrientationEvent"] !== "undefined";
    };
    Cnds.prototype.MotionSupported = function() {
        return typeof window["DeviceMotionEvent"] !== "undefined";
    };
    Cnds.prototype.CompareOrientation = function(orientation_, cmp_, angle_) {
        var v = 0;
        if (orientation_ === 0)
            v = this.getAlpha();
        else if (orientation_ === 1)
            v = this.getBeta();
        else
            v = this.getGamma();
        return cr.do_cmp(v, cmp_, angle_);
    };
    Cnds.prototype.CompareAcceleration = function(acceleration_, cmp_, angle_) {
        var v = 0;
        if (acceleration_ === 0)
            v = this.acc_g_x;
        else if (acceleration_ === 1)
            v = this.acc_g_y;
        else if (acceleration_ === 2)
            v = this.acc_g_z;
        else if (acceleration_ === 3)
            v = this.acc_x;
        else if (acceleration_ === 4)
            v = this.acc_y;
        else if (acceleration_ === 5)
            v = this.acc_z;
        return cr.do_cmp(v, cmp_, angle_);
    };
    Cnds.prototype.OnNthTouchStart = function(touch_) {
        touch_ = Math.floor(touch_);
        return touch_ === this.trigger_index;
    };
    Cnds.prototype.OnNthTouchEnd = function(touch_) {
        touch_ = Math.floor(touch_);
        return touch_ === this.trigger_index;
    };
    Cnds.prototype.HasNthTouch = function(touch_) {
        touch_ = Math.floor(touch_);
        return this.touches.length >= touch_ + 1;
    };
    pluginProto.cnds = new Cnds();

    function Exps() {};
    Exps.prototype.TouchCount = function(ret) {
        ret.set_int(this.touches.length);
    };
    Exps.prototype.X = function(ret, layerparam) {
        if (this.touches.length) {
            var layer, oldScale, oldZoomRate, oldParallaxX, oldAngle;
            if (cr.is_undefined(layerparam)) {
                layer = this.runtime.getLayerByNumber(0);
                oldScale = layer.scale;
                oldZoomRate = layer.zoomRate;
                oldParallaxX = layer.parallaxX;
                oldAngle = layer.angle;
                layer.scale = this.runtime.running_layout.scale;
                layer.zoomRate = 1.0;
                layer.parallaxX = 1.0;
                layer.angle = this.runtime.running_layout.angle;
                ret.set_float(layer.canvasToLayer(this.touches[0].x, this.touches[0].y, true));
                layer.scale = oldScale;
                layer.zoomRate = oldZoomRate;
                layer.parallaxX = oldParallaxX;
                layer.angle = oldAngle;
            } else {
                if (cr.is_number(layerparam))
                    layer = this.runtime.getLayerByNumber(layerparam);
                else
                    layer = this.runtime.getLayerByName(layerparam);
                if (layer)
                    ret.set_float(layer.canvasToLayer(this.touches[0].x, this.touches[0].y, true));
                else
                    ret.set_float(0);
            }
        } else
            ret.set_float(0);
    };
    Exps.prototype.XAt = function(ret, index, layerparam) {
        index = Math.floor(index);
        if (index < 0 || index >= this.touches.length) {
            ret.set_float(0);
            return;
        }
        var layer, oldScale, oldZoomRate, oldParallaxX, oldAngle;
        if (cr.is_undefined(layerparam)) {
            layer = this.runtime.getLayerByNumber(0);
            oldScale = layer.scale;
            oldZoomRate = layer.zoomRate;
            oldParallaxX = layer.parallaxX;
            oldAngle = layer.angle;
            layer.scale = this.runtime.running_layout.scale;
            layer.zoomRate = 1.0;
            layer.parallaxX = 1.0;
            layer.angle = this.runtime.running_layout.angle;
            ret.set_float(layer.canvasToLayer(this.touches[index].x, this.touches[index].y, true));
            layer.scale = oldScale;
            layer.zoomRate = oldZoomRate;
            layer.parallaxX = oldParallaxX;
            layer.angle = oldAngle;
        } else {
            if (cr.is_number(layerparam))
                layer = this.runtime.getLayerByNumber(layerparam);
            else
                layer = this.runtime.getLayerByName(layerparam);
            if (layer)
                ret.set_float(layer.canvasToLayer(this.touches[index].x, this.touches[index].y, true));
            else
                ret.set_float(0);
        }
    };
    Exps.prototype.XForID = function(ret, id, layerparam) {
        var index = this.findTouch(id);
        if (index < 0) {
            ret.set_float(0);
            return;
        }
        var touch = this.touches[index];
        var layer, oldScale, oldZoomRate, oldParallaxX, oldAngle;
        if (cr.is_undefined(layerparam)) {
            layer = this.runtime.getLayerByNumber(0);
            oldScale = layer.scale;
            oldZoomRate = layer.zoomRate;
            oldParallaxX = layer.parallaxX;
            oldAngle = layer.angle;
            layer.scale = this.runtime.running_layout.scale;
            layer.zoomRate = 1.0;
            layer.parallaxX = 1.0;
            layer.angle = this.runtime.running_layout.angle;
            ret.set_float(layer.canvasToLayer(touch.x, touch.y, true));
            layer.scale = oldScale;
            layer.zoomRate = oldZoomRate;
            layer.parallaxX = oldParallaxX;
            layer.angle = oldAngle;
        } else {
            if (cr.is_number(layerparam))
                layer = this.runtime.getLayerByNumber(layerparam);
            else
                layer = this.runtime.getLayerByName(layerparam);
            if (layer)
                ret.set_float(layer.canvasToLayer(touch.x, touch.y, true));
            else
                ret.set_float(0);
        }
    };
    Exps.prototype.Y = function(ret, layerparam) {
        if (this.touches.length) {
            var layer, oldScale, oldZoomRate, oldParallaxY, oldAngle;
            if (cr.is_undefined(layerparam)) {
                layer = this.runtime.getLayerByNumber(0);
                oldScale = layer.scale;
                oldZoomRate = layer.zoomRate;
                oldParallaxY = layer.parallaxY;
                oldAngle = layer.angle;
                layer.scale = this.runtime.running_layout.scale;
                layer.zoomRate = 1.0;
                layer.parallaxY = 1.0;
                layer.angle = this.runtime.running_layout.angle;
                ret.set_float(layer.canvasToLayer(this.touches[0].x, this.touches[0].y, false));
                layer.scale = oldScale;
                layer.zoomRate = oldZoomRate;
                layer.parallaxY = oldParallaxY;
                layer.angle = oldAngle;
            } else {
                if (cr.is_number(layerparam))
                    layer = this.runtime.getLayerByNumber(layerparam);
                else
                    layer = this.runtime.getLayerByName(layerparam);
                if (layer)
                    ret.set_float(layer.canvasToLayer(this.touches[0].x, this.touches[0].y, false));
                else
                    ret.set_float(0);
            }
        } else
            ret.set_float(0);
    };
    Exps.prototype.YAt = function(ret, index, layerparam) {
        index = Math.floor(index);
        if (index < 0 || index >= this.touches.length) {
            ret.set_float(0);
            return;
        }
        var layer, oldScale, oldZoomRate, oldParallaxY, oldAngle;
        if (cr.is_undefined(layerparam)) {
            layer = this.runtime.getLayerByNumber(0);
            oldScale = layer.scale;
            oldZoomRate = layer.zoomRate;
            oldParallaxY = layer.parallaxY;
            oldAngle = layer.angle;
            layer.scale = this.runtime.running_layout.scale;
            layer.zoomRate = 1.0;
            layer.parallaxY = 1.0;
            layer.angle = this.runtime.running_layout.angle;
            ret.set_float(layer.canvasToLayer(this.touches[index].x, this.touches[index].y, false));
            layer.scale = oldScale;
            layer.zoomRate = oldZoomRate;
            layer.parallaxY = oldParallaxY;
            layer.angle = oldAngle;
        } else {
            if (cr.is_number(layerparam))
                layer = this.runtime.getLayerByNumber(layerparam);
            else
                layer = this.runtime.getLayerByName(layerparam);
            if (layer)
                ret.set_float(layer.canvasToLayer(this.touches[index].x, this.touches[index].y, false));
            else
                ret.set_float(0);
        }
    };
    Exps.prototype.YForID = function(ret, id, layerparam) {
        var index = this.findTouch(id);
        if (index < 0) {
            ret.set_float(0);
            return;
        }
        var touch = this.touches[index];
        var layer, oldScale, oldZoomRate, oldParallaxY, oldAngle;
        if (cr.is_undefined(layerparam)) {
            layer = this.runtime.getLayerByNumber(0);
            oldScale = layer.scale;
            oldZoomRate = layer.zoomRate;
            oldParallaxY = layer.parallaxY;
            oldAngle = layer.angle;
            layer.scale = this.runtime.running_layout.scale;
            layer.zoomRate = 1.0;
            layer.parallaxY = 1.0;
            layer.angle = this.runtime.running_layout.angle;
            ret.set_float(layer.canvasToLayer(touch.x, touch.y, false));
            layer.scale = oldScale;
            layer.zoomRate = oldZoomRate;
            layer.parallaxY = oldParallaxY;
            layer.angle = oldAngle;
        } else {
            if (cr.is_number(layerparam))
                layer = this.runtime.getLayerByNumber(layerparam);
            else
                layer = this.runtime.getLayerByName(layerparam);
            if (layer)
                ret.set_float(layer.canvasToLayer(touch.x, touch.y, false));
            else
                ret.set_float(0);
        }
    };
    Exps.prototype.AbsoluteX = function(ret) {
        if (this.touches.length)
            ret.set_float(this.touches[0].x);
        else
            ret.set_float(0);
    };
    Exps.prototype.AbsoluteXAt = function(ret, index) {
        index = Math.floor(index);
        if (index < 0 || index >= this.touches.length) {
            ret.set_float(0);
            return;
        }
        ret.set_float(this.touches[index].x);
    };
    Exps.prototype.AbsoluteXForID = function(ret, id) {
        var index = this.findTouch(id);
        if (index < 0) {
            ret.set_float(0);
            return;
        }
        var touch = this.touches[index];
        ret.set_float(touch.x);
    };
    Exps.prototype.AbsoluteY = function(ret) {
        if (this.touches.length)
            ret.set_float(this.touches[0].y);
        else
            ret.set_float(0);
    };
    Exps.prototype.AbsoluteYAt = function(ret, index) {
        index = Math.floor(index);
        if (index < 0 || index >= this.touches.length) {
            ret.set_float(0);
            return;
        }
        ret.set_float(this.touches[index].y);
    };
    Exps.prototype.AbsoluteYForID = function(ret, id) {
        var index = this.findTouch(id);
        if (index < 0) {
            ret.set_float(0);
            return;
        }
        var touch = this.touches[index];
        ret.set_float(touch.y);
    };
    Exps.prototype.SpeedAt = function(ret, index) {
        index = Math.floor(index);
        if (index < 0 || index >= this.touches.length) {
            ret.set_float(0);
            return;
        }
        var t = this.touches[index];
        var dist = cr.distanceTo(t.x, t.y, t.lastx, t.lasty);
        var timediff = (t.time - t.lasttime) / 1000;
        if (timediff === 0)
            ret.set_float(0);
        else
            ret.set_float(dist / timediff);
    };
    Exps.prototype.SpeedForID = function(ret, id) {
        var index = this.findTouch(id);
        if (index < 0) {
            ret.set_float(0);
            return;
        }
        var touch = this.touches[index];
        var dist = cr.distanceTo(touch.x, touch.y, touch.lastx, touch.lasty);
        var timediff = (touch.time - touch.lasttime) / 1000;
        if (timediff === 0)
            ret.set_float(0);
        else
            ret.set_float(dist / timediff);
    };
    Exps.prototype.AngleAt = function(ret, index) {
        index = Math.floor(index);
        if (index < 0 || index >= this.touches.length) {
            ret.set_float(0);
            return;
        }
        var t = this.touches[index];
        ret.set_float(cr.to_degrees(cr.angleTo(t.lastx, t.lasty, t.x, t.y)));
    };
    Exps.prototype.AngleForID = function(ret, id) {
        var index = this.findTouch(id);
        if (index < 0) {
            ret.set_float(0);
            return;
        }
        var touch = this.touches[index];
        ret.set_float(cr.to_degrees(cr.angleTo(touch.lastx, touch.lasty, touch.x, touch.y)));
    };
    Exps.prototype.Alpha = function(ret) {
        ret.set_float(this.getAlpha());
    };
    Exps.prototype.Beta = function(ret) {
        ret.set_float(this.getBeta());
    };
    Exps.prototype.Gamma = function(ret) {
        ret.set_float(this.getGamma());
    };
    Exps.prototype.AccelerationXWithG = function(ret) {
        ret.set_float(this.acc_g_x);
    };
    Exps.prototype.AccelerationYWithG = function(ret) {
        ret.set_float(this.acc_g_y);
    };
    Exps.prototype.AccelerationZWithG = function(ret) {
        ret.set_float(this.acc_g_z);
    };
    Exps.prototype.AccelerationX = function(ret) {
        ret.set_float(this.acc_x);
    };
    Exps.prototype.AccelerationY = function(ret) {
        ret.set_float(this.acc_y);
    };
    Exps.prototype.AccelerationZ = function(ret) {
        ret.set_float(this.acc_z);
    };
    Exps.prototype.TouchIndex = function(ret) {
        ret.set_int(this.trigger_index);
    };
    Exps.prototype.TouchID = function(ret) {
        ret.set_float(this.trigger_id);
    };
    pluginProto.exps = new Exps();
}());;;
cr.plugins_.WebStorage = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var pluginProto = cr.plugins_.WebStorage.prototype;
    pluginProto.Type = function(plugin) {
        this.plugin = plugin;
        this.runtime = plugin.runtime;
    };
    var typeProto = pluginProto.Type.prototype;
    typeProto.onCreate = function() {};
    pluginProto.Instance = function(type) {
        this.type = type;
        this.runtime = type.runtime;
    };
    var instanceProto = pluginProto.Instance.prototype;
    var prefix = "";
    var is_arcade = (typeof window["is_scirra_arcade"] !== "undefined");
    if (is_arcade)
        prefix = "arcade" + window["scirra_arcade_id"];
    var logged_sessionnotsupported = false;

    function LogSessionNotSupported() {
        if (logged_sessionnotsupported)
            return;
        cr.logexport("[Construct 2] Webstorage plugin: session storage is not supported on this platform. Try using local storage or global variables instead.");
        logged_sessionnotsupported = true;
    };
    instanceProto.onCreate = function() {};

    function Cnds() {};
    Cnds.prototype.LocalStorageEnabled = function() {
        return true;
    };
    Cnds.prototype.SessionStorageEnabled = function() {
        return true;
    };
    Cnds.prototype.LocalStorageExists = function(key) {
        return localStorage.getItem(prefix + key) != null;
    };
    Cnds.prototype.SessionStorageExists = function(key) {
        if (this.runtime.isCocoonJs || !sessionStorage) {
            LogSessionNotSupported();
            return false;
        }
        return sessionStorage.getItem(prefix + key) != null;
    };
    Cnds.prototype.OnQuotaExceeded = function() {
        return true;
    };
    Cnds.prototype.CompareKeyText = function(key, text_to_compare, case_sensitive) {
        var value = localStorage.getItem(prefix + key) || "";
        if (case_sensitive)
            return value == text_to_compare;
        else
            return cr.equals_nocase(value, text_to_compare);
    };
    Cnds.prototype.CompareKeyNumber = function(key, cmp, x) {
        var value = localStorage.getItem(prefix + key) || "";
        return cr.do_cmp(parseFloat(value), cmp, x);
    };
    pluginProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.StoreLocal = function(key, data) {
        try {
        	//pk: ending
        	if (key == 'Level'){
        		updateShareScore(data);
        	}else if (key == 'wHighscore'){
        		updateShareScore(localStorage.getItem(prefix + 'Level') || 0);
        	}

            localStorage.setItem(prefix + key, data);
        } catch (e) {
            this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded, this);
        }
    };
    Acts.prototype.StoreSession = function(key, data) {
        if (this.runtime.isCocoonJs || !sessionStorage) {
            LogSessionNotSupported();
            return;
        }
        try {
            sessionStorage.setItem(prefix + key, data);
        } catch (e) {
            this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded, this);
        }
    };
    Acts.prototype.RemoveLocal = function(key) {
        localStorage.removeItem(prefix + key);
    };
    Acts.prototype.RemoveSession = function(key) {
        if (this.runtime.isCocoonJs || !sessionStorage) {
            LogSessionNotSupported();
            return;
        }
        sessionStorage.removeItem(prefix + key);
    };
    Acts.prototype.ClearLocal = function() {
        if (!is_arcade)
            localStorage.clear();
    };
    Acts.prototype.ClearSession = function() {
        if (this.runtime.isCocoonJs || !sessionStorage) {
            LogSessionNotSupported();
            return;
        }
        if (!is_arcade)
            sessionStorage.clear();
    };
    Acts.prototype.JSONLoad = function(json_, mode_) {
        var d;
        try {
            d = JSON.parse(json_);
        } catch (e) {
            return;
        }
        if (!d["c2dictionary"]) // presumably not a c2dictionary object
            return;
        var o = d["data"];
        if (mode_ === 0 && !is_arcade) // 'set' mode: must clear webstorage first
            localStorage.clear();
        var p;
        for (p in o) {
            if (o.hasOwnProperty(p)) {
                try {
                    localStorage.setItem(prefix + p, o[p]);
                } catch (e) {
                    this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded, this);
                    return;
                }
            }
        }
    };
    pluginProto.acts = new Acts();

    function Exps() {};
    Exps.prototype.LocalValue = function(ret, key) {
        ret.set_string(localStorage.getItem(prefix + key) || "");
    };
    Exps.prototype.SessionValue = function(ret, key) {
        if (this.runtime.isCocoonJs || !sessionStorage) {
            LogSessionNotSupported();
            ret.set_string("");
            return;
        }
        ret.set_string(sessionStorage.getItem(prefix + key) || "");
    };
    Exps.prototype.LocalCount = function(ret) {
        ret.set_int(is_arcade ? 0 : localStorage.length);
    };
    Exps.prototype.SessionCount = function(ret) {
        if (this.runtime.isCocoonJs || !sessionStorage) {
            LogSessionNotSupported();
            ret.set_int(0);
            return;
        }
        ret.set_int(is_arcade ? 0 : sessionStorage.length);
    };
    Exps.prototype.LocalAt = function(ret, n) {
        if (is_arcade)
            ret.set_string("");
        else
            ret.set_string(localStorage.getItem(localStorage.key(n)) || "");
    };
    Exps.prototype.SessionAt = function(ret, n) {
        if (this.runtime.isCocoonJs || !sessionStorage) {
            LogSessionNotSupported();
            ret.set_string("");
            return;
        }
        if (is_arcade)
            ret.set_string("");
        else
            ret.set_string(sessionStorage.getItem(sessionStorage.key(n)) || "");
    };
    Exps.prototype.LocalKeyAt = function(ret, n) {
        if (is_arcade)
            ret.set_string("");
        else
            ret.set_string(localStorage.key(n) || "");
    };
    Exps.prototype.SessionKeyAt = function(ret, n) {
        if (this.runtime.isCocoonJs || !sessionStorage) {
            LogSessionNotSupported();
            ret.set_string("");
            return;
        }
        if (is_arcade)
            ret.set_string("");
        else
            ret.set_string(sessionStorage.key(n) || "");
    };
    Exps.prototype.AsJSON = function(ret) {
        var o = {},
            i, len, k;
        for (i = 0, len = localStorage.length; i < len; i++) {
            k = localStorage.key(i);
            if (is_arcade) {
                if (k.substr(0, prefix.length) === prefix) {
                    o[k.substr(prefix.length)] = localStorage.getItem(k);
                }
            } else
                o[k] = localStorage.getItem(k);
        }
        ret.set_string(JSON.stringify({
            "c2dictionary": true,
            "data": o
        }));
    };
    pluginProto.exps = new Exps();
}());;;
cr.plugins_.pix_spilgames = function(runtime) {
    this.runtime = runtime;
};
(function(w) {
    var self,
        typeProto,
        pluginProto,
        instanceProto;
    /**
     * Proto
     */
    pluginProto = cr.plugins_.pix_spilgames.prototype;
    pluginProto.Type = function(plugin) {
        this.plugin = plugin;
        this.runtime = plugin.runtime;
    };
    typeProto = pluginProto.Type.prototype;
    typeProto.onCreate = function() {};
    pluginProto.Instance = function(type) {
        this.type = type;
        this.runtime = type.runtime;
    };
    instanceProto = pluginProto.Instance.prototype;
    instanceProto.onCreate = function() {
        self = this;
        self.API = null;
        self.apiReady = false;
        self.apiVersion = null;
        self.branding = {};
        self.gamePaused = false;
        if (w && w["GameAPI"]) {
            w["GameAPI"]["loadAPI"](function(instance) {
                self.API = instance;
                self.apiReady = self.API["isReady"];
                self.apiVersion = self.API["version"];
                self.API["Game"]["on"]("pause", _triggerPause);
                self.API["Game"]["on"]("resume", _triggerResume);
                self.runtime.trigger(cr.plugins_.pix_spilgames.prototype.cnds.apiReady, self);
            });
        }
    };
    /**
     * Conditions
     */
    function Cnds() {};
    Cnds.prototype.apiLoaded = function() {
        return (self.API) ? true : false;
    };
    Cnds.prototype.apiReady = function() {
        return self.apiReady;
    };
    Cnds.prototype.isPaused = function() {
        return self.gamePaused;
    };
    Cnds.prototype.isSplashScreenEnabled = function() {
        if (self.apiReady) {
            if (!self.branding["splashScreen"]) {
                _getSplashScreen();
            }
            return (self.branding["splashScreen"] && self.branding["splashScreen"]["show"]) ? self.branding["splashScreen"]["show"] : false;
        }
    };
    Cnds.prototype.pauseGame = function() {
        return true;
    };
    Cnds.prototype.resumeGame = function() {
        return true;
    };
    pluginProto.cnds = new Cnds();
    /**
     * Actions
     */
    function _isLinkAvailable(type) {
        if (self.apiReady) {
            return (self.API["Branding"]["getLinks"]() && self.API["Branding"]["getLinks"]()[type]) ? true : false;
        }
    }

    function _getOutgoingLink(type) {
        if (self.apiReady) {
            if (!self.branding[type]) {
                switch (type) {
                    case "logo":
                        _getLogo();
                        break;
                    case "splashScreen":
                        _getSplashScreen();
                        break;
                    default:
                        if (_isLinkAvailable(type)) {
                            self.branding[type] = self.API["Branding"]["getLink"](type);
                        }
                        break;
                }
            }
            return (self.branding[type] && self.branding[type]["action"]) ? self.branding[type]["action"] : false;
        }
    }

    function _getLogo() {
        if (self.apiReady) {
            if (!self.branding["logo"]) {
                self.branding["logo"] = self.API["Branding"]["getLogo"]();
            }
        }
    }

    function _getSplashScreen() {
        if (self.apiReady) {
            if (!self.branding["splashScreen"]) {
                self.branding["splashScreen"] = self.API["Branding"]["getSplashScreen"]();
            }
        }
    }

    function _triggerPause() {
        self.gamePaused = 1;
        self.runtime.trigger(cr.plugins_.pix_spilgames.prototype.cnds.pauseGame, self);
    }

    function _triggerResume() {
        self.gamePaused = 0;
        self.runtime.trigger(cr.plugins_.pix_spilgames.prototype.cnds.resumeGame, self);
    }

    function Acts() {};
    Acts.prototype.openOutgoingLink = function(type) {
        if (_getOutgoingLink(type)) {
            _getOutgoingLink(type).call(this);
        } else {
            (function() {}).call(this);
        }
    };
    Acts.prototype.requestGameBreak = function() {
        if (self.apiReady) {
            self.API["GameBreak"]["request"](
                function() {
                    _triggerPause();
                },
                function() {
                    _triggerResume();
                }
            );
        }
    };
    pluginProto.acts = new Acts();
    /**
     * Expressions
     */
    function Exps() {};
    Exps.prototype.logoImage = function(ret) {
        if (!self.branding["logo"]) {
            _getLogo();
        }
        var src = (self.branding["logo"] && self.branding["logo"]["image"]) ? self.branding["logo"]["image"] : '';
        ret.set_string(src);
    };
    Exps.prototype.version = function(ret) {
        ret.set_string(self.apiVersion);
    };
    pluginProto.exps = new Exps();
}(window));;;
cr.behaviors.Bullet = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var behaviorProto = cr.behaviors.Bullet.prototype;
    behaviorProto.Type = function(behavior, objtype) {
        this.behavior = behavior;
        this.objtype = objtype;
        this.runtime = behavior.runtime;
    };
    var behtypeProto = behaviorProto.Type.prototype;
    behtypeProto.onCreate = function() {};
    behaviorProto.Instance = function(type, inst) {
        this.type = type;
        this.behavior = type.behavior;
        this.inst = inst; // associated object instance to modify
        this.runtime = type.runtime;
    };
    var behinstProto = behaviorProto.Instance.prototype;
    behinstProto.onCreate = function() {
        var speed = this.properties[0];
        this.acc = this.properties[1];
        this.g = this.properties[2];
        this.bounceOffSolid = (this.properties[3] !== 0);
        this.setAngle = (this.properties[4] !== 0);
        this.dx = Math.cos(this.inst.angle) * speed;
        this.dy = Math.sin(this.inst.angle) * speed;
        this.lastx = this.inst.x;
        this.lasty = this.inst.y;
        this.lastKnownAngle = this.inst.angle;
        this.travelled = 0;
        this.enabled = (this.properties[5] !== 0);
    };
    behinstProto.saveToJSON = function() {
        return {
            "acc": this.acc,
            "g": this.g,
            "dx": this.dx,
            "dy": this.dy,
            "lx": this.lastx,
            "ly": this.lasty,
            "lka": this.lastKnownAngle,
            "t": this.travelled,
            "e": this.enabled
        };
    };
    behinstProto.loadFromJSON = function(o) {
        this.acc = o["acc"];
        this.g = o["g"];
        this.dx = o["dx"];
        this.dy = o["dy"];
        this.lastx = o["lx"];
        this.lasty = o["ly"];
        this.lastKnownAngle = o["lka"];
        this.travelled = o["t"];
        this.enabled = o["e"];
    };
    behinstProto.tick = function() {
        if (!this.enabled)
            return;
        var dt = this.runtime.getDt(this.inst);
        var s, a;
        var bounceSolid, bounceAngle;
        if (this.inst.angle !== this.lastKnownAngle) {
            if (this.setAngle) {
                s = cr.distanceTo(0, 0, this.dx, this.dy);
                this.dx = Math.cos(this.inst.angle) * s;
                this.dy = Math.sin(this.inst.angle) * s;
            }
            this.lastKnownAngle = this.inst.angle;
        }
        if (this.acc !== 0) {
            s = cr.distanceTo(0, 0, this.dx, this.dy);
            if (this.dx === 0 && this.dy === 0)
                a = this.inst.angle;
            else
                a = cr.angleTo(0, 0, this.dx, this.dy);
            s += this.acc * dt;
            if (s < 0)
                s = 0;
            this.dx = Math.cos(a) * s;
            this.dy = Math.sin(a) * s;
        }
        if (this.g !== 0)
            this.dy += this.g * dt;
        this.lastx = this.inst.x;
        this.lasty = this.inst.y;
        if (this.dx !== 0 || this.dy !== 0) {
            this.inst.x += this.dx * dt;
            this.inst.y += this.dy * dt;
            this.travelled += cr.distanceTo(0, 0, this.dx * dt, this.dy * dt)
            if (this.setAngle) {
                this.inst.angle = cr.angleTo(0, 0, this.dx, this.dy);
                this.inst.set_bbox_changed();
                this.lastKnownAngle = this.inst.angle;
            }
            this.inst.set_bbox_changed();
            if (this.bounceOffSolid) {
                bounceSolid = this.runtime.testOverlapSolid(this.inst);
                if (bounceSolid) {
                    this.runtime.registerCollision(this.inst, bounceSolid);
                    s = cr.distanceTo(0, 0, this.dx, this.dy);
                    bounceAngle = this.runtime.calculateSolidBounceAngle(this.inst, this.lastx, this.lasty);
                    this.dx = Math.cos(bounceAngle) * s;
                    this.dy = Math.sin(bounceAngle) * s;
                    this.inst.x += this.dx * dt; // move out for one tick since the object can't have spent a tick in the solid
                    this.inst.y += this.dy * dt;
                    this.inst.set_bbox_changed();
                    if (this.setAngle) {
                        this.inst.angle = bounceAngle;
                        this.lastKnownAngle = bounceAngle;
                        this.inst.set_bbox_changed();
                    }
                    if (!this.runtime.pushOutSolid(this.inst, this.dx / s, this.dy / s, Math.max(s * 2.5 * dt, 30)))
                        this.runtime.pushOutSolidNearest(this.inst, 100);
                }
            }
        }
    };

    function Cnds() {};
    Cnds.prototype.CompareSpeed = function(cmp, s) {
        return cr.do_cmp(cr.distanceTo(0, 0, this.dx, this.dy), cmp, s);
    };
    Cnds.prototype.CompareTravelled = function(cmp, d) {
        return cr.do_cmp(this.travelled, cmp, d);
    };
    behaviorProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.SetSpeed = function(s) {
        var a = cr.angleTo(0, 0, this.dx, this.dy);
        this.dx = Math.cos(a) * s;
        this.dy = Math.sin(a) * s;
    };
    Acts.prototype.SetAcceleration = function(a) {
        this.acc = a;
    };
    Acts.prototype.SetGravity = function(g) {
        this.g = g;
    };
    Acts.prototype.SetAngleOfMotion = function(a) {
        a = cr.to_radians(a);
        var s = cr.distanceTo(0, 0, this.dx, this.dy)
        this.dx = Math.cos(a) * s;
        this.dy = Math.sin(a) * s;
    };
    Acts.prototype.Bounce = function(objtype) {
        if (!objtype)
            return;
        var otherinst = objtype.getFirstPicked(this.inst);
        if (!otherinst)
            return;
        var dt = this.runtime.getDt(this.inst);
        var s = cr.distanceTo(0, 0, this.dx, this.dy);
        var bounceAngle = this.runtime.calculateSolidBounceAngle(this.inst, this.lastx, this.lasty, otherinst);
        this.dx = Math.cos(bounceAngle) * s;
        this.dy = Math.sin(bounceAngle) * s;
        this.inst.x += this.dx * dt; // move out for one tick since the object can't have spent a tick in the solid
        this.inst.y += this.dy * dt;
        this.inst.set_bbox_changed();
        if (this.setAngle) {
            this.inst.angle = bounceAngle;
            this.lastKnownAngle = bounceAngle;
            this.inst.set_bbox_changed();
        }
        if (this.bounceOffSolid) {
            if (!this.runtime.pushOutSolid(this.inst, this.dx / s, this.dy / s, Math.max(s * 2.5 * dt, 30)))
                this.runtime.pushOutSolidNearest(this.inst, 100);
        } else {
            this.runtime.pushOut(this.inst, this.dx / s, this.dy / s, Math.max(s * 2.5 * dt, 30), otherinst)
        }
    };
    Acts.prototype.SetEnabled = function(en) {
        this.enabled = (en === 1);
    };
    behaviorProto.acts = new Acts();

    function Exps() {};
    Exps.prototype.Speed = function(ret) {
        var s = cr.distanceTo(0, 0, this.dx, this.dy);
        s = cr.round6dp(s);
        ret.set_float(s);
    };
    Exps.prototype.Acceleration = function(ret) {
        ret.set_float(this.acc);
    };
    Exps.prototype.AngleOfMotion = function(ret) {
        ret.set_float(cr.to_degrees(cr.angleTo(0, 0, this.dx, this.dy)));
    };
    Exps.prototype.DistanceTravelled = function(ret) {
        ret.set_float(this.travelled);
    };
    behaviorProto.exps = new Exps();
}());;;
cr.behaviors.Platform = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var behaviorProto = cr.behaviors.Platform.prototype;
    behaviorProto.Type = function(behavior, objtype) {
        this.behavior = behavior;
        this.objtype = objtype;
        this.runtime = behavior.runtime;
    };
    var behtypeProto = behaviorProto.Type.prototype;
    behtypeProto.onCreate = function() {};
    var ANIMMODE_STOPPED = 0;
    var ANIMMODE_MOVING = 1;
    var ANIMMODE_JUMPING = 2;
    var ANIMMODE_FALLING = 3;
    behaviorProto.Instance = function(type, inst) {
        this.type = type;
        this.behavior = type.behavior;
        this.inst = inst; // associated object instance to modify
        this.runtime = type.runtime;
        this.leftkey = false;
        this.rightkey = false;
        this.jumpkey = false;
        this.jumped = false; // prevent bunnyhopping
        this.ignoreInput = false;
        this.simleft = false;
        this.simright = false;
        this.simjump = false;
        this.lastFloorObject = null;
        this.loadFloorObject = -1;
        this.lastFloorX = 0;
        this.lastFloorY = 0;
        this.floorIsJumpthru = false;
        this.animMode = ANIMMODE_STOPPED;
        this.fallthrough = 0; // fall through jump-thru.  >0 to disable, lasts a few ticks
        this.firstTick = true;
        this.dx = 0;
        this.dy = 0;
    };
    var behinstProto = behaviorProto.Instance.prototype;
    behinstProto.updateGravity = function() {
        this.downx = Math.cos(this.ga);
        this.downy = Math.sin(this.ga);
        this.rightx = Math.cos(this.ga - Math.PI / 2);
        this.righty = Math.sin(this.ga - Math.PI / 2);
        this.downx = cr.round6dp(this.downx);
        this.downy = cr.round6dp(this.downy);
        this.rightx = cr.round6dp(this.rightx);
        this.righty = cr.round6dp(this.righty);
        this.g1 = this.g;
        if (this.g < 0) {
            this.downx *= -1;
            this.downy *= -1;
            this.g = Math.abs(this.g);
        }
    };
    behinstProto.onCreate = function() {
        this.maxspeed = this.properties[0];
        this.acc = this.properties[1];
        this.dec = this.properties[2];
        this.jumpStrength = this.properties[3];
        this.g = this.properties[4];
        this.g1 = this.g;
        this.maxFall = this.properties[5];
        this.defaultControls = (this.properties[6] === 1); // 0=no, 1=yes
        this.enabled = (this.properties[7] !== 0);
        this.wasOnFloor = false;
        this.wasOverJumpthru = this.runtime.testOverlapJumpThru(this.inst);
        this.loadOverJumpthru = -1;
        this.ga = cr.to_radians(90);
        this.updateGravity();
        var self = this;
        if (this.defaultControls && !this.runtime.isDomFree) {
            jQuery(document).keydown(function(info) {
                self.onKeyDown(info);
            });
            jQuery(document).keyup(function(info) {
                self.onKeyUp(info);
            });
        }
        if (!this.recycled) {
            this.myDestroyCallback = function(inst) {
                self.onInstanceDestroyed(inst);
            };
        }
        this.runtime.addDestroyCallback(this.myDestroyCallback);
    };
    behinstProto.saveToJSON = function() {
        return {
            "ii": this.ignoreInput,
            "lfx": this.lastFloorX,
            "lfy": this.lastFloorY,
            "lfo": (this.lastFloorObject ? this.lastFloorObject.uid : -1),
            "am": this.animMode,
            "en": this.enabled,
            "fall": this.fallthrough,
            "ft": this.firstTick,
            "dx": this.dx,
            "dy": this.dy,
            "ms": this.maxspeed,
            "acc": this.acc,
            "dec": this.dec,
            "js": this.jumpStrength,
            "g": this.g,
            "g1": this.g1,
            "mf": this.maxFall,
            "wof": this.wasOnFloor,
            "woj": (this.wasOverJumpthru ? this.wasOverJumpthru.uid : -1),
            "ga": this.ga
        };
    };
    behinstProto.loadFromJSON = function(o) {
        this.ignoreInput = o["ii"];
        this.lastFloorX = o["lfx"];
        this.lastFloorY = o["lfy"];
        this.loadFloorObject = o["lfo"];
        this.animMode = o["am"];
        this.enabled = o["en"];
        this.fallthrough = o["fall"];
        this.firstTick = o["ft"];
        this.dx = o["dx"];
        this.dy = o["dy"];
        this.maxspeed = o["ms"];
        this.acc = o["acc"];
        this.dec = o["dec"];
        this.jumpStrength = o["js"];
        this.g = o["g"];
        this.g1 = o["g1"];
        this.maxFall = o["mf"];
        this.wasOnFloor = o["wof"];
        this.loadOverJumpthru = o["woj"];
        this.ga = o["ga"];
        this.leftkey = false;
        this.rightkey = false;
        this.jumpkey = false;
        this.jumped = false;
        this.simleft = false;
        this.simright = false;
        this.simjump = false;
        this.updateGravity();
    };
    behinstProto.afterLoad = function() {
        if (this.loadFloorObject === -1)
            this.lastFloorObject = null;
        else
            this.lastFloorObject = this.runtime.getObjectByUID(this.loadFloorObject);
        if (this.loadOverJumpthru === -1)
            this.wasOverJumpthru = null;
        else
            this.wasOverJumpthru = this.runtime.getObjectByUID(this.loadOverJumpthru);
    };
    behinstProto.onInstanceDestroyed = function(inst) {
        if (this.lastFloorObject == inst)
            this.lastFloorObject = null;
    };
    behinstProto.onDestroy = function() {
        this.lastFloorObject = null;
        this.runtime.removeDestroyCallback(this.myDestroyCallback);
    };
    behinstProto.onKeyDown = function(info) {
        switch (info.which) {
            case 38: // up
                info.preventDefault();
                this.jumpkey = true;
                break;
            case 37: // left
                info.preventDefault();
                this.leftkey = true;
                break;
            case 39: // right
                info.preventDefault();
                this.rightkey = true;
                break;
        }
    };
    behinstProto.onKeyUp = function(info) {
        switch (info.which) {
            case 38: // up
                info.preventDefault();
                this.jumpkey = false;
                this.jumped = false;
                break;
            case 37: // left
                info.preventDefault();
                this.leftkey = false;
                break;
            case 39: // right
                info.preventDefault();
                this.rightkey = false;
                break;
        }
    };
    behinstProto.getGDir = function() {
        if (this.g < 0)
            return -1;
        else
            return 1;
    };
    behinstProto.isOnFloor = function() {
        var ret = null;
        var ret2 = null;
        var i, len, j;
        var oldx = this.inst.x;
        var oldy = this.inst.y;
        this.inst.x += this.downx;
        this.inst.y += this.downy;
        this.inst.set_bbox_changed();
        if (this.lastFloorObject && this.runtime.testOverlap(this.inst, this.lastFloorObject)) {
            this.inst.x = oldx;
            this.inst.y = oldy;
            this.inst.set_bbox_changed();
            return this.lastFloorObject;
        } else {
            ret = this.runtime.testOverlapSolid(this.inst);
            if (!ret && this.fallthrough === 0)
                ret2 = this.runtime.testOverlapJumpThru(this.inst, true);
            this.inst.x = oldx;
            this.inst.y = oldy;
            this.inst.set_bbox_changed();
            if (ret) // was overlapping solid
            {
                if (this.runtime.testOverlap(this.inst, ret))
                    return null;
                else {
                    this.floorIsJumpthru = false;
                    return ret;
                }
            }
            if (ret2 && ret2.length) {
                for (i = 0, j = 0, len = ret2.length; i < len; i++) {
                    ret2[j] = ret2[i];
                    if (!this.runtime.testOverlap(this.inst, ret2[i]))
                        j++;
                }
                if (j >= 1) {
                    this.floorIsJumpthru = true;
                    return ret2[0];
                }
            }
            return null;
        }
    };
    behinstProto.tick = function() {};
    behinstProto.posttick = function() {
        var dt = this.runtime.getDt(this.inst);
        var mx, my, obstacle, mag, allover, i, len, j, oldx, oldy;
        if (!this.jumpkey && !this.simjump)
            this.jumped = false;
        var left = this.leftkey || this.simleft;
        var right = this.rightkey || this.simright;
        var jump = (this.jumpkey || this.simjump) && !this.jumped;
        this.simleft = false;
        this.simright = false;
        this.simjump = false;
        if (!this.enabled)
            return;
        if (this.ignoreInput) {
            left = false;
            right = false;
            jump = false;
        }
        var lastFloor = this.lastFloorObject;
        var floor_moved = false;
        if (this.firstTick) {
            if (this.runtime.testOverlapSolid(this.inst) || this.runtime.testOverlapJumpThru(this.inst)) {
                this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy, 4, true);
            }
            this.firstTick = false;
        }
        if (lastFloor && this.dy === 0 && (lastFloor.y !== this.lastFloorY || lastFloor.x !== this.lastFloorX)) {
            mx = (lastFloor.x - this.lastFloorX);
            my = (lastFloor.y - this.lastFloorY);
            this.inst.x += mx;
            this.inst.y += my;
            this.inst.set_bbox_changed();
            this.lastFloorX = lastFloor.x;
            this.lastFloorY = lastFloor.y;
            floor_moved = true;
            if (this.runtime.testOverlapSolid(this.inst)) {
                this.runtime.pushOutSolid(this.inst, -mx, -my, Math.sqrt(mx * mx + my * my) * 2.5);
            }
        }
        var floor_ = this.isOnFloor();
        var collobj = this.runtime.testOverlapSolid(this.inst);
        if (collobj) {
            if (this.runtime.pushOutSolidNearest(this.inst, Math.max(this.inst.width, this.inst.height) / 2))
                this.runtime.registerCollision(this.inst, collobj);
            else
                return;
        }
        if (floor_) {
            if (this.dy > 0) {
                if (!this.wasOnFloor) {
                    this.runtime.pushInFractional(this.inst, -this.downx, -this.downy, floor_, 16);
                    this.wasOnFloor = true;
                }
                this.dy = 0;
            }
            if (lastFloor != floor_) {
                this.lastFloorObject = floor_;
                this.lastFloorX = floor_.x;
                this.lastFloorY = floor_.y;
                this.runtime.registerCollision(this.inst, floor_);
            } else if (floor_moved) {
                collobj = this.runtime.testOverlapSolid(this.inst);
                if (collobj) {
                    this.runtime.registerCollision(this.inst, collobj);
                    if (mx !== 0) {
                        if (mx > 0)
                            this.runtime.pushOutSolid(this.inst, -this.rightx, -this.righty);
                        else
                            this.runtime.pushOutSolid(this.inst, this.rightx, this.righty);
                    }
                    this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy);
                }
            }
            if (jump) {
                oldx = this.inst.x;
                oldy = this.inst.y;
                this.inst.x -= this.downx;
                this.inst.y -= this.downy;
                this.inst.set_bbox_changed();
                if (!this.runtime.testOverlapSolid(this.inst)) {
                    this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnJump, this.inst);
                    this.animMode = ANIMMODE_JUMPING;
                    this.dy = -this.jumpStrength;
                    this.jumped = true;
                } else
                    jump = false;
                this.inst.x = oldx;
                this.inst.y = oldy;
                this.inst.set_bbox_changed();
            }
        } else {
            this.lastFloorObject = null;
            this.dy += this.g * dt;
            if (this.dy > this.maxFall)
                this.dy = this.maxFall;
            if (jump)
                this.jumped = true;
        }
        this.wasOnFloor = !!floor_;
        if (left == right) // both up or both down
        {
            if (this.dx < 0) {
                this.dx += this.dec * dt;
                if (this.dx > 0)
                    this.dx = 0;
            } else if (this.dx > 0) {
                this.dx -= this.dec * dt;
                if (this.dx < 0)
                    this.dx = 0;
            }
        }
        if (left && !right) {
            if (this.dx > 0)
                this.dx -= (this.acc + this.dec) * dt;
            else
                this.dx -= this.acc * dt;
        }
        if (right && !left) {
            if (this.dx < 0)
                this.dx += (this.acc + this.dec) * dt;
            else
                this.dx += this.acc * dt;
        }
        if (this.dx > this.maxspeed)
            this.dx = this.maxspeed;
        else if (this.dx < -this.maxspeed)
            this.dx = -this.maxspeed;
        var landed = false;
        if (this.dx !== 0) {
            oldx = this.inst.x;
            oldy = this.inst.y;
            mx = this.dx * dt * this.rightx;
            my = this.dx * dt * this.righty;
            this.inst.x += this.rightx * (this.dx > 1 ? 1 : -1) - this.downx;
            this.inst.y += this.righty * (this.dx > 1 ? 1 : -1) - this.downy;
            this.inst.set_bbox_changed();
            var is_jumpthru = false;
            var slope_too_steep = this.runtime.testOverlapSolid(this.inst);
            /*
			if (!slope_too_steep && floor_)
			{
				slope_too_steep = this.runtime.testOverlapJumpThru(this.inst);
				is_jumpthru = true;
				if (slope_too_steep)
				{
					this.inst.x = oldx;
					this.inst.y = oldy;
					this.inst.set_bbox_changed();
					if (this.runtime.testOverlap(this.inst, slope_too_steep))
					{
						slope_too_steep = null;
						is_jumpthru = false;
					}
				}
			}
			*/
            this.inst.x = oldx + mx;
            this.inst.y = oldy + my;
            this.inst.set_bbox_changed();
            obstacle = this.runtime.testOverlapSolid(this.inst);
            if (!obstacle && floor_) {
                obstacle = this.runtime.testOverlapJumpThru(this.inst);
                if (obstacle) {
                    this.inst.x = oldx;
                    this.inst.y = oldy;
                    this.inst.set_bbox_changed();
                    if (this.runtime.testOverlap(this.inst, obstacle)) {
                        obstacle = null;
                        is_jumpthru = false;
                    } else
                        is_jumpthru = true;
                    this.inst.x = oldx + mx;
                    this.inst.y = oldy + my;
                    this.inst.set_bbox_changed();
                }
            }
            if (obstacle) {
                var push_dist = Math.abs(this.dx * dt) + 2;
                if (slope_too_steep || !this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy, push_dist, is_jumpthru, obstacle)) {
                    this.runtime.registerCollision(this.inst, obstacle);
                    push_dist = Math.max(Math.abs(this.dx * dt * 2.5), 30);
                    if (!this.runtime.pushOutSolid(this.inst, this.rightx * (this.dx < 0 ? 1 : -1), this.righty * (this.dx < 0 ? 1 : -1), push_dist, false)) {
                        this.inst.x = oldx;
                        this.inst.y = oldy;
                        this.inst.set_bbox_changed();
                    } else if (floor_ && !is_jumpthru && !this.floorIsJumpthru) {
                        oldx = this.inst.x;
                        oldy = this.inst.y;
                        this.inst.x += this.downx;
                        this.inst.y += this.downy;
                        if (this.runtime.testOverlapSolid(this.inst)) {
                            if (!this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy, 3, false)) {
                                this.inst.x = oldx;
                                this.inst.y = oldy;
                                this.inst.set_bbox_changed();
                            }
                        } else {
                            this.inst.x = oldx;
                            this.inst.y = oldy;
                            this.inst.set_bbox_changed();
                        }
                    }
                    if (!is_jumpthru)
                        this.dx = 0; // stop
                } else if (!slope_too_steep && !jump && (Math.abs(this.dy) < Math.abs(this.jumpStrength / 2))) {
                    this.dy = 0;
                    if (!floor_)
                        landed = true;
                }
            } else {
                var newfloor = this.isOnFloor();
                if (floor_ && !newfloor) {
                    mag = Math.ceil(Math.abs(this.dx * dt)) + 2;
                    oldx = this.inst.x;
                    oldy = this.inst.y;
                    this.inst.x += this.downx * mag;
                    this.inst.y += this.downy * mag;
                    this.inst.set_bbox_changed();
                    if (this.runtime.testOverlapSolid(this.inst) || this.runtime.testOverlapJumpThru(this.inst))
                        this.runtime.pushOutSolid(this.inst, -this.downx, -this.downy, mag + 2, true);
                    else {
                        this.inst.x = oldx;
                        this.inst.y = oldy;
                        this.inst.set_bbox_changed();
                    }
                } else if (newfloor && this.dy === 0) {
                    this.runtime.pushInFractional(this.inst, -this.downx, -this.downy, newfloor, 16);
                }
            }
        }
        if (this.dy !== 0) {
            oldx = this.inst.x;
            oldy = this.inst.y;
            this.inst.x += this.dy * dt * this.downx;
            this.inst.y += this.dy * dt * this.downy;
            var newx = this.inst.x;
            var newy = this.inst.y;
            this.inst.set_bbox_changed();
            collobj = this.runtime.testOverlapSolid(this.inst);
            var fell_on_jumpthru = false;
            if (!collobj && (this.dy > 0) && !floor_) {
                allover = this.fallthrough > 0 ? null : this.runtime.testOverlapJumpThru(this.inst, true);
                if (allover && allover.length) {
                    if (this.wasOverJumpthru) {
                        this.inst.x = oldx;
                        this.inst.y = oldy;
                        this.inst.set_bbox_changed();
                        for (i = 0, j = 0, len = allover.length; i < len; i++) {
                            allover[j] = allover[i];
                            if (!this.runtime.testOverlap(this.inst, allover[i]))
                                j++;
                        }
                        allover.length = j;
                        this.inst.x = newx;
                        this.inst.y = newy;
                        this.inst.set_bbox_changed();
                    }
                    if (allover.length >= 1)
                        collobj = allover[0];
                }
                fell_on_jumpthru = !!collobj;
            }
            if (collobj) {
                this.runtime.registerCollision(this.inst, collobj);
                var push_dist = (fell_on_jumpthru ? Math.abs(this.dy * dt * 2.5 + 10) : Math.max(Math.abs(this.dy * dt * 2.5 + 10), 30));
                if (!this.runtime.pushOutSolid(this.inst, this.downx * (this.dy < 0 ? 1 : -1), this.downy * (this.dy < 0 ? 1 : -1), push_dist, fell_on_jumpthru, collobj)) {
                    this.inst.x = oldx;
                    this.inst.y = oldy;
                    this.inst.set_bbox_changed();
                    this.wasOnFloor = true; // prevent adjustment for unexpected floor landings
                    if (!fell_on_jumpthru)
                        this.dy = 0; // stop
                } else {
                    this.lastFloorObject = collobj;
                    this.lastFloorX = collobj.x;
                    this.lastFloorY = collobj.y;
                    this.floorIsJumpthru = fell_on_jumpthru;
                    if (fell_on_jumpthru)
                        landed = true;
                    this.dy = 0; // stop
                }
            }
        }
        if (this.animMode !== ANIMMODE_FALLING && this.dy > 0 && !floor_) {
            this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnFall, this.inst);
            this.animMode = ANIMMODE_FALLING;
        }
        if (floor_ || landed) {
            if (this.animMode === ANIMMODE_FALLING || landed || (jump && this.dy === 0)) {
                this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnLand, this.inst);
                if (this.dx === 0 && this.dy === 0)
                    this.animMode = ANIMMODE_STOPPED;
                else
                    this.animMode = ANIMMODE_MOVING;
            } else {
                if (this.animMode !== ANIMMODE_STOPPED && this.dx === 0 && this.dy === 0) {
                    this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnStop, this.inst);
                    this.animMode = ANIMMODE_STOPPED;
                }
                if (this.animMode !== ANIMMODE_MOVING && (this.dx !== 0 || this.dy !== 0) && !jump) {
                    this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnMove, this.inst);
                    this.animMode = ANIMMODE_MOVING;
                }
            }
        }
        if (this.fallthrough > 0)
            this.fallthrough--;
        this.wasOverJumpthru = this.runtime.testOverlapJumpThru(this.inst);
    };

    function Cnds() {};
    Cnds.prototype.IsMoving = function() {
        return this.dx !== 0 || this.dy !== 0;
    };
    Cnds.prototype.CompareSpeed = function(cmp, s) {
        var speed = Math.sqrt(this.dx * this.dx + this.dy * this.dy);
        return cr.do_cmp(speed, cmp, s);
    };
    Cnds.prototype.IsOnFloor = function() {
        if (this.dy !== 0)
            return false;
        var ret = null;
        var ret2 = null;
        var i, len, j;
        var oldx = this.inst.x;
        var oldy = this.inst.y;
        this.inst.x += this.downx;
        this.inst.y += this.downy;
        this.inst.set_bbox_changed();
        ret = this.runtime.testOverlapSolid(this.inst);
        if (!ret && this.fallthrough === 0)
            ret2 = this.runtime.testOverlapJumpThru(this.inst, true);
        this.inst.x = oldx;
        this.inst.y = oldy;
        this.inst.set_bbox_changed();
        if (ret) // was overlapping solid
        {
            return !this.runtime.testOverlap(this.inst, ret);
        }
        if (ret2 && ret2.length) {
            for (i = 0, j = 0, len = ret2.length; i < len; i++) {
                ret2[j] = ret2[i];
                if (!this.runtime.testOverlap(this.inst, ret2[i]))
                    j++;
            }
            if (j >= 1)
                return true;
        }
        return false;
    };
    Cnds.prototype.IsByWall = function(side) {
        var ret = false;
        var oldx = this.inst.x;
        var oldy = this.inst.y;
        this.inst.x -= this.downx * 3;
        this.inst.y -= this.downy * 3;
        this.inst.set_bbox_changed();
        if (this.runtime.testOverlapSolid(this.inst)) {
            this.inst.x = oldx;
            this.inst.y = oldy;
            this.inst.set_bbox_changed();
            return false;
        }
        if (side === 0) // left
        {
            this.inst.x -= this.rightx * 2;
            this.inst.y -= this.righty * 2;
        } else {
            this.inst.x += this.rightx * 2;
            this.inst.y += this.righty * 2;
        }
        this.inst.set_bbox_changed();
        ret = this.runtime.testOverlapSolid(this.inst);
        this.inst.x = oldx;
        this.inst.y = oldy;
        this.inst.set_bbox_changed();
        return ret;
    };
    Cnds.prototype.IsJumping = function() {
        return this.dy < 0;
    };
    Cnds.prototype.IsFalling = function() {
        return this.dy > 0;
    };
    Cnds.prototype.OnJump = function() {
        return true;
    };
    Cnds.prototype.OnFall = function() {
        return true;
    };
    Cnds.prototype.OnStop = function() {
        return true;
    };
    Cnds.prototype.OnMove = function() {
        return true;
    };
    Cnds.prototype.OnLand = function() {
        return true;
    };
    behaviorProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.SetIgnoreInput = function(ignoring) {
        this.ignoreInput = ignoring;
    };
    Acts.prototype.SetMaxSpeed = function(maxspeed) {
        this.maxspeed = maxspeed;
        if (this.maxspeed < 0)
            this.maxspeed = 0;
    };
    Acts.prototype.SetAcceleration = function(acc) {
        this.acc = acc;
        if (this.acc < 0)
            this.acc = 0;
    };
    Acts.prototype.SetDeceleration = function(dec) {
        this.dec = dec;
        if (this.dec < 0)
            this.dec = 0;
    };
    Acts.prototype.SetJumpStrength = function(js) {
        this.jumpStrength = js;
        if (this.jumpStrength < 0)
            this.jumpStrength = 0;
    };
    Acts.prototype.SetGravity = function(grav) {
        if (this.g1 === grav)
            return; // no change
        this.g = grav;
        this.updateGravity();
        if (this.runtime.testOverlapSolid(this.inst)) {
            this.runtime.pushOutSolid(this.inst, this.downx, this.downy, 10);
            this.inst.x += this.downx * 2;
            this.inst.y += this.downy * 2;
            this.inst.set_bbox_changed();
        }
        this.lastFloorObject = null;
    };
    Acts.prototype.SetMaxFallSpeed = function(mfs) {
        this.maxFall = mfs;
        if (this.maxFall < 0)
            this.maxFall = 0;
    };
    Acts.prototype.SimulateControl = function(ctrl) {
        switch (ctrl) {
            case 0:
                this.simleft = true;
                break;
            case 1:
                this.simright = true;
                break;
            case 2:
                this.simjump = true;
                break;
        }
    };
    Acts.prototype.SetVectorX = function(vx) {
        this.dx = vx;
    };
    Acts.prototype.SetVectorY = function(vy) {
        this.dy = vy;
    };
    Acts.prototype.SetGravityAngle = function(a) {
        a = cr.to_radians(a);
        a = cr.clamp_angle(a);
        if (this.ga === a)
            return; // no change
        this.ga = a;
        this.updateGravity();
        this.lastFloorObject = null;
    };
    Acts.prototype.SetEnabled = function(en) {
        if (this.enabled !== (en === 1)) {
            this.enabled = (en === 1);
            if (!this.enabled)
                this.lastFloorObject = null;
        }
    };
    Acts.prototype.FallThrough = function() {
        var oldx = this.inst.x;
        var oldy = this.inst.y;
        this.inst.x += this.downx;
        this.inst.y += this.downy;
        this.inst.set_bbox_changed();
        var overlaps = this.runtime.testOverlapJumpThru(this.inst, false);
        this.inst.x = oldx;
        this.inst.y = oldy;
        this.inst.set_bbox_changed();
        if (!overlaps)
            return;
        this.fallthrough = 3; // disable jumpthrus for 3 ticks (1 doesn't do it, 2 does, 3 to be on safe side)
        this.lastFloorObject = null;
    };
    behaviorProto.acts = new Acts();

    function Exps() {};
    Exps.prototype.Speed = function(ret) {
        ret.set_float(Math.sqrt(this.dx * this.dx + this.dy * this.dy));
    };
    Exps.prototype.MaxSpeed = function(ret) {
        ret.set_float(this.maxspeed);
    };
    Exps.prototype.Acceleration = function(ret) {
        ret.set_float(this.acc);
    };
    Exps.prototype.Deceleration = function(ret) {
        ret.set_float(this.dec);
    };
    Exps.prototype.JumpStrength = function(ret) {
        ret.set_float(this.jumpStrength);
    };
    Exps.prototype.Gravity = function(ret) {
        ret.set_float(this.g);
    };
    Exps.prototype.GravityAngle = function(ret) {
        ret.set_float(cr.to_degrees(this.ga));
    };
    Exps.prototype.MaxFallSpeed = function(ret) {
        ret.set_float(this.maxFall);
    };
    Exps.prototype.MovingAngle = function(ret) {
        ret.set_float(cr.to_degrees(Math.atan2(this.dy, this.dx)));
    };
    Exps.prototype.VectorX = function(ret) {
        ret.set_float(this.dx);
    };
    Exps.prototype.VectorY = function(ret) {
        ret.set_float(this.dy);
    };
    behaviorProto.exps = new Exps();
}());;;
cr.behaviors.Rotate = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var behaviorProto = cr.behaviors.Rotate.prototype;
    behaviorProto.Type = function(behavior, objtype) {
        this.behavior = behavior;
        this.objtype = objtype;
        this.runtime = behavior.runtime;
    };
    var behtypeProto = behaviorProto.Type.prototype;
    behtypeProto.onCreate = function() {};
    behaviorProto.Instance = function(type, inst) {
        this.type = type;
        this.behavior = type.behavior;
        this.inst = inst; // associated object instance to modify
        this.runtime = type.runtime;
    };
    var behinstProto = behaviorProto.Instance.prototype;
    behinstProto.onCreate = function() {
        this.speed = cr.to_radians(this.properties[0]);
        this.acc = cr.to_radians(this.properties[1]);
    };
    behinstProto.saveToJSON = function() {
        return {
            "speed": this.speed,
            "acc": this.acc
        };
    };
    behinstProto.loadFromJSON = function(o) {
        this.speed = o["speed"];
        this.acc = o["acc"];
    };
    behinstProto.tick = function() {
        var dt = this.runtime.getDt(this.inst);
        if (dt === 0)
            return;
        if (this.acc !== 0)
            this.speed += this.acc * dt;
        if (this.speed !== 0) {
            this.inst.angle = cr.clamp_angle(this.inst.angle + this.speed * dt);
            this.inst.set_bbox_changed();
        }
    };

    function Cnds() {};
    behaviorProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.SetSpeed = function(s) {
        this.speed = cr.to_radians(s);
    };
    Acts.prototype.SetAcceleration = function(a) {
        this.acc = cr.to_radians(a);
    };
    behaviorProto.acts = new Acts();

    function Exps() {};
    Exps.prototype.Speed = function(ret) {
        ret.set_float(cr.to_degrees(this.speed));
    };
    Exps.prototype.Acceleration = function(ret) {
        ret.set_float(cr.to_degrees(this.acc));
    };
    behaviorProto.exps = new Exps();
}());;;
cr.behaviors.Sin = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var behaviorProto = cr.behaviors.Sin.prototype;
    behaviorProto.Type = function(behavior, objtype) {
        this.behavior = behavior;
        this.objtype = objtype;
        this.runtime = behavior.runtime;
    };
    var behtypeProto = behaviorProto.Type.prototype;
    behtypeProto.onCreate = function() {};
    behaviorProto.Instance = function(type, inst) {
        this.type = type;
        this.behavior = type.behavior;
        this.inst = inst; // associated object instance to modify
        this.runtime = type.runtime;
        this.i = 0; // period offset (radians)
    };
    var behinstProto = behaviorProto.Instance.prototype;
    var _2pi = 2 * Math.PI;
    var _pi_2 = Math.PI / 2;
    var _3pi_2 = (3 * Math.PI) / 2;
    behinstProto.onCreate = function() {
        this.active = (this.properties[0] === 1);
        this.movement = this.properties[1]; // 0=Horizontal|1=Vertical|2=Size|3=Width|4=Height|5=Angle|6=Opacity|7=Value only
        this.wave = this.properties[2]; // 0=Sine|1=Triangle|2=Sawtooth|3=Reverse sawtooth|4=Square
        this.period = this.properties[3];
        this.period += Math.random() * this.properties[4]; // period random
        if (this.period === 0)
            this.i = 0;
        else {
            this.i = (this.properties[5] / this.period) * _2pi; // period offset
            this.i += ((Math.random() * this.properties[6]) / this.period) * _2pi; // period offset random
        }
        this.mag = this.properties[7]; // magnitude
        this.mag += Math.random() * this.properties[8]; // magnitude random
        this.initialValue = 0;
        this.initialValue2 = 0;
        this.ratio = 0;
        this.init();
    };
    behinstProto.saveToJSON = function() {
        return {
            "i": this.i,
            "a": this.active,
            "mv": this.movement,
            "w": this.wave,
            "p": this.period,
            "mag": this.mag,
            "iv": this.initialValue,
            "iv2": this.initialValue2,
            "r": this.ratio,
            "lkv": this.lastKnownValue,
            "lkv2": this.lastKnownValue2
        };
    };
    behinstProto.loadFromJSON = function(o) {
        this.i = o["i"];
        this.active = o["a"];
        this.movement = o["mv"];
        this.wave = o["w"];
        this.period = o["p"];
        this.mag = o["mag"];
        this.initialValue = o["iv"];
        this.initialValue2 = o["iv2"] || 0;
        this.ratio = o["r"];
        this.lastKnownValue = o["lkv"];
        this.lastKnownValue2 = o["lkv2"] || 0;
    };
    behinstProto.init = function() {
        switch (this.movement) {
            case 0: // horizontal
                this.initialValue = this.inst.x;
                break;
            case 1: // vertical
                this.initialValue = this.inst.y;
                break;
            case 2: // size
                this.initialValue = this.inst.width;
                this.ratio = this.inst.height / this.inst.width;
                break;
            case 3: // width
                this.initialValue = this.inst.width;
                break;
            case 4: // height
                this.initialValue = this.inst.height;
                break;
            case 5: // angle
                this.initialValue = this.inst.angle;
                this.mag = cr.to_radians(this.mag); // convert magnitude from degrees to radians
                break;
            case 6: // opacity
                this.initialValue = this.inst.opacity;
                break;
            case 7:
                this.initialValue = 0;
                break;
            case 8: // forwards/backwards
                this.initialValue = this.inst.x;
                this.initialValue2 = this.inst.y;
                break;
            default:
                ;
        }
        this.lastKnownValue = this.initialValue;
        this.lastKnownValue2 = this.initialValue2;
    };
    behinstProto.waveFunc = function(x) {
        x = x % _2pi;
        switch (this.wave) {
            case 0: // sine
                return Math.sin(x);
            case 1: // triangle
                if (x <= _pi_2)
                    return x / _pi_2;
                else if (x <= _3pi_2)
                    return 1 - (2 * (x - _pi_2) / Math.PI);
                else
                    return (x - _3pi_2) / _pi_2 - 1;
            case 2: // sawtooth
                return 2 * x / _2pi - 1;
            case 3: // reverse sawtooth
                return -2 * x / _2pi + 1;
            case 4: // square
                return x < Math.PI ? -1 : 1;
        };
        return 0;
    };
    behinstProto.tick = function() {
        var dt = this.runtime.getDt(this.inst);
        if (!this.active || dt === 0)
            return;
        if (this.period === 0)
            this.i = 0;
        else {
            this.i += (dt / this.period) * _2pi;
            this.i = this.i % _2pi;
        }
        switch (this.movement) {
            case 0: // horizontal
                if (this.inst.x !== this.lastKnownValue)
                    this.initialValue += this.inst.x - this.lastKnownValue;
                this.inst.x = this.initialValue + this.waveFunc(this.i) * this.mag;
                this.lastKnownValue = this.inst.x;
                break;
            case 1: // vertical
                if (this.inst.y !== this.lastKnownValue)
                    this.initialValue += this.inst.y - this.lastKnownValue;
                this.inst.y = this.initialValue + this.waveFunc(this.i) * this.mag;
                this.lastKnownValue = this.inst.y;
                break;
            case 2: // size
                this.inst.width = this.initialValue + this.waveFunc(this.i) * this.mag;
                this.inst.height = this.inst.width * this.ratio;
                break;
            case 3: // width
                this.inst.width = this.initialValue + this.waveFunc(this.i) * this.mag;
                break;
            case 4: // height
                this.inst.height = this.initialValue + this.waveFunc(this.i) * this.mag;
                break;
            case 5: // angle
                if (this.inst.angle !== this.lastKnownValue)
                    this.initialValue = cr.clamp_angle(this.initialValue + (this.inst.angle - this.lastKnownValue));
                this.inst.angle = cr.clamp_angle(this.initialValue + this.waveFunc(this.i) * this.mag);
                this.lastKnownValue = this.inst.angle;
                break;
            case 6: // opacity
                this.inst.opacity = this.initialValue + (this.waveFunc(this.i) * this.mag) / 100;
                if (this.inst.opacity < 0)
                    this.inst.opacity = 0;
                else if (this.inst.opacity > 1)
                    this.inst.opacity = 1;
                break;
            case 8: // forwards/backwards
                if (this.inst.x !== this.lastKnownValue)
                    this.initialValue += this.inst.x - this.lastKnownValue;
                if (this.inst.y !== this.lastKnownValue2)
                    this.initialValue2 += this.inst.y - this.lastKnownValue2;
                this.inst.x = this.initialValue + Math.cos(this.inst.angle) * this.waveFunc(this.i) * this.mag;
                this.inst.y = this.initialValue2 + Math.sin(this.inst.angle) * this.waveFunc(this.i) * this.mag;
                this.lastKnownValue = this.inst.x;
                this.lastKnownValue2 = this.inst.y;
                break;
        }
        this.inst.set_bbox_changed();
    };
    behinstProto.onSpriteFrameChanged = function(prev_frame, next_frame) {
        switch (this.movement) {
            case 2: // size
                this.initialValue *= (next_frame.width / prev_frame.width);
                this.ratio = next_frame.height / next_frame.width;
                break;
            case 3: // width
                this.initialValue *= (next_frame.width / prev_frame.width);
                break;
            case 4: // height
                this.initialValue *= (next_frame.height / prev_frame.height);
                break;
        }
    };

    function Cnds() {};
    Cnds.prototype.IsActive = function() {
        return this.active;
    };
    Cnds.prototype.CompareMovement = function(m) {
        return this.movement === m;
    };
    Cnds.prototype.ComparePeriod = function(cmp, v) {
        return cr.do_cmp(this.period, cmp, v);
    };
    Cnds.prototype.CompareMagnitude = function(cmp, v) {
        if (this.movement === 5)
            return cr.do_cmp(this.mag, cmp, cr.to_radians(v));
        else
            return cr.do_cmp(this.mag, cmp, v);
    };
    Cnds.prototype.CompareWave = function(w) {
        return this.wave === w;
    };
    behaviorProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.SetActive = function(a) {
        this.active = (a === 1);
    };
    Acts.prototype.SetPeriod = function(x) {
        this.period = x;
    };
    Acts.prototype.SetMagnitude = function(x) {
        this.mag = x;
        if (this.movement === 5) // angle
            this.mag = cr.to_radians(this.mag);
    };
    Acts.prototype.SetMovement = function(m) {
        if (this.movement === 5)
            this.mag = cr.to_degrees(this.mag);
        this.movement = m;
        this.init();
    };
    Acts.prototype.SetWave = function(w) {
        this.wave = w;
    };
    Acts.prototype.SetPhase = function(x) {
        this.i = (x * _2pi) % _2pi;
    };
    behaviorProto.acts = new Acts();

    function Exps() {};
    Exps.prototype.CyclePosition = function(ret) {
        ret.set_float(this.i / _2pi);
    };
    Exps.prototype.Period = function(ret) {
        ret.set_float(this.period);
    };
    Exps.prototype.Magnitude = function(ret) {
        if (this.movement === 5) // angle
            ret.set_float(cr.to_degrees(this.mag));
        else
            ret.set_float(this.mag);
    };
    Exps.prototype.Value = function(ret) {
        ret.set_float(this.waveFunc(this.i) * this.mag);
    };
    behaviorProto.exps = new Exps();
}());;;
cr.behaviors.scrollto = function(runtime) {
    this.runtime = runtime;
    this.shakeMag = 0;
    this.shakeStart = 0;
    this.shakeEnd = 0;
    this.shakeMode = 0;
};
(function() {
    var behaviorProto = cr.behaviors.scrollto.prototype;
    behaviorProto.Type = function(behavior, objtype) {
        this.behavior = behavior;
        this.objtype = objtype;
        this.runtime = behavior.runtime;
    };
    var behtypeProto = behaviorProto.Type.prototype;
    behtypeProto.onCreate = function() {};
    behaviorProto.Instance = function(type, inst) {
        this.type = type;
        this.behavior = type.behavior;
        this.inst = inst; // associated object instance to modify
        this.runtime = type.runtime;
    };
    var behinstProto = behaviorProto.Instance.prototype;
    behinstProto.onCreate = function() {
        this.enabled = (this.properties[0] !== 0);
    };
    behinstProto.saveToJSON = function() {
        return {
            "smg": this.behavior.shakeMag,
            "ss": this.behavior.shakeStart,
            "se": this.behavior.shakeEnd,
            "smd": this.behavior.shakeMode
        };
    };
    behinstProto.loadFromJSON = function(o) {
        this.behavior.shakeMag = o["smg"];
        this.behavior.shakeStart = o["ss"];
        this.behavior.shakeEnd = o["se"];
        this.behavior.shakeMode = o["smd"];
    };
    behinstProto.tick = function() {};

    function getScrollToBehavior(inst) {
        var i, len, binst;
        for (i = 0, len = inst.behavior_insts.length; i < len; ++i) {
            binst = inst.behavior_insts[i];
            if (binst.behavior instanceof cr.behaviors.scrollto)
                return binst;
        }
        return null;
    };
    behinstProto.tick2 = function() {
        if (!this.enabled)
            return;
        var all = this.behavior.my_instances.valuesRef();
        var sumx = 0,
            sumy = 0;
        var i, len, binst, count = 0;
        for (i = 0, len = all.length; i < len; i++) {
            binst = getScrollToBehavior(all[i]);
            if (!binst || !binst.enabled)
                continue;
            sumx += all[i].x;
            sumy += all[i].y;
            ++count;
        }
        var layout = this.inst.layer.layout;
        var now = this.runtime.kahanTime.sum;
        var offx = 0,
            offy = 0;
        if (now >= this.behavior.shakeStart && now < this.behavior.shakeEnd) {
            var mag = this.behavior.shakeMag * Math.min(this.runtime.timescale, 1);
            if (this.behavior.shakeMode === 0)
                mag *= 1 - (now - this.behavior.shakeStart) / (this.behavior.shakeEnd - this.behavior.shakeStart);
            var a = Math.random() * Math.PI * 2;
            var d = Math.random() * mag;
            offx = Math.cos(a) * d;
            offy = Math.sin(a) * d;
        }
        layout.scrollToX(sumx / count + offx);
        layout.scrollToY(sumy / count + offy);
    };

    function Acts() {};
    Acts.prototype.Shake = function(mag, dur, mode) {
        this.behavior.shakeMag = mag;
        this.behavior.shakeStart = this.runtime.kahanTime.sum;
        this.behavior.shakeEnd = this.behavior.shakeStart + dur;
        this.behavior.shakeMode = mode;
    };
    Acts.prototype.SetEnabled = function(e) {
        this.enabled = (e !== 0);
    };
    behaviorProto.acts = new Acts();
}());;;
cr.behaviors.solid = function(runtime) {
    this.runtime = runtime;
};
(function() {
    var behaviorProto = cr.behaviors.solid.prototype;
    behaviorProto.Type = function(behavior, objtype) {
        this.behavior = behavior;
        this.objtype = objtype;
        this.runtime = behavior.runtime;
    };
    var behtypeProto = behaviorProto.Type.prototype;
    behtypeProto.onCreate = function() {};
    behaviorProto.Instance = function(type, inst) {
        this.type = type;
        this.behavior = type.behavior;
        this.inst = inst; // associated object instance to modify
        this.runtime = type.runtime;
    };
    var behinstProto = behaviorProto.Instance.prototype;
    behinstProto.onCreate = function() {
        this.inst.extra.solidEnabled = (this.properties[0] !== 0);
    };
    behinstProto.tick = function() {};

    function Cnds() {};
    Cnds.prototype.IsEnabled = function() {
        return this.inst.extra.solidEnabled;
    };
    behaviorProto.cnds = new Cnds();

    function Acts() {};
    Acts.prototype.SetEnabled = function(e) {
        this.inst.extra.solidEnabled = !!e;
    };
    behaviorProto.acts = new Acts();
}());
cr.getProjectModel = function() {
    return [
        null,
        "Loader", [
            [
                cr.plugins_.Arr,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false
            ],
            [
                cr.plugins_.Audio,
                true,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false
            ],
            [
                cr.plugins_.pix_spilgames,
                true,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false
            ],
            [
                cr.plugins_.TiledBg,
                false,
                true,
                true,
                true,
                true,
                true,
                true,
                true,
                true
            ],
            [
                cr.plugins_.Text,
                false,
                true,
                true,
                true,
                true,
                true,
                true,
                true,
                false
            ],
            [
                cr.plugins_.Touch,
                true,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false
            ],
            [
                cr.plugins_.Sprite,
                false,
                true,
                true,
                true,
                true,
                true,
                true,
                true,
                false
            ],
            [
                cr.plugins_.WebStorage,
                true,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false
            ]
        ],
        [
            [
                "t0",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/backforest.png", 26391, 0],
                null, [],
                false,
                false,
                891082430713935, [],
                null
            ],
            [
                "t1",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/backfield.png", 25496, 1],
                null, [],
                false,
                false,
                4590677426042927, [],
                null
            ],
            [
                "t2",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/backsavanna.png", 22213, 1],
                null, [],
                false,
                false,
                3134679094355627, [],
                null
            ],
            [
                "t3",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/backdesert.png", 45415, 1],
                null, [],
                false,
                false,
                907857591267088, [],
                null
            ],
            [
                "t4",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/backmountains.png", 35438, 1],
                null, [],
                false,
                false,
                3786657100630278, [],
                null
            ],
            [
                "t5",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/backsky.png", 36461, 0],
                null, [],
                false,
                false,
                7890615505903785, [],
                null
            ],
            [
                "t6",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/frontfield.png", 14008, 0],
                null, [],
                false,
                false,
                9472023448817279, [],
                null
            ],
            [
                "t7",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/frontforest.png", 42649, 0],
                null, [],
                false,
                false,
                9902643189006269, [],
                null
            ],
            [
                "t8",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/frontsavanna.png", 13570, 0],
                null, [],
                false,
                false,
                4863009614151443, [],
                null
            ],
            [
                "t9",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/frontdesert.png", 48870, 0],
                null, [],
                false,
                false,
                7782891952909832, [],
                null
            ],
            [
                "t10",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/frontmountains.png", 17644, 0],
                null, [],
                false,
                false,
                8382219571806116, [],
                null
            ],
            [
                "t11",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/frontsky.png", 18089, 0],
                null, [],
                false,
                false,
                3201428147823014, [],
                null
            ],
            [
                "t12",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/platformfield.png", 6303, 1],
                null, [],
                false,
                false,
                1648026000606636, [],
                null
            ],
            [
                "t13",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/platformforest.png", 40108, 0],
                null, [],
                false,
                false,
                6397258331441935, [],
                null
            ],
            [
                "t14",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/platformsavanna.png", 34787, 1],
                null, [],
                false,
                false,
                4762201217518889, [],
                null
            ],
            [
                "t15",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/platformdesert.png", 15272, 1],
                null, [],
                false,
                false,
                1714144663240948, [],
                null
            ],
            [
                "t16",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/platformmountains.png", 6868, 1],
                null, [],
                false,
                false,
                7682589164593647, [],
                null
            ],
            [
                "t17",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/platformmountains.png", 6868, 1],
                null, [],
                false,
                false,
                260095045912004, [],
                null
            ],
            [
                "t18",
                cr.plugins_.Sprite,
                false, [6211601889057979],
                1,
                0,
                null, [
                    [
                        "Default",
                        0,
                        false,
                        0,
                        0,
                        false,
                        5399458219153007, [
                            ["images/buttonsmenu-sheet0.png", 12004, 153, 1, 100, 110, 1, 0.5, 0.5, [],
                                [-0.3199999928474426, -0.3363640010356903, 0, -0.4636363983154297, 0.3299999833106995, -0.3454549908638001, 0.4700000286102295, 0, 0.3299999833106995, 0.3454549908638001, 0, 0.4727270007133484, -0.3199999928474426, 0.3363639712333679, -0.4699999988079071, 0], 0
                            ],
                            ["images/buttonsmenu-sheet0.png", 12004, 153, 113, 100, 110, 1, 0.5, 0.5, [],
                                [-0.3199999928474426, -0.3363640010356903, 0, -0.4636363983154297, 0.3299999833106995, -0.3454549908638001, 0.4700000286102295, 0, 0.3299999833106995, 0.3454549908638001, 0, 0.4727270007133484, -0.3199999928474426, 0.3363639712333679, -0.4699999988079071, 0], 0
                            ],
                            ["images/buttonsmenu-sheet0.png", 12004, 1, 1, 150, 153, 1, 0.5, 0.5032680034637451, [],
                                [-0.3333330154418945, -0.3398690223693848, 0, -0.4901961088180542, 0.3399999737739563, -0.3464049994945526, 0.4733330011367798, -0.006536006927490234, 0.3466669917106628, 0.3464049696922302, 0, 0.4901959896087647, -0.3333330154418945, 0.3333330154418945, -0.4600000083446503, -0.006536006927490234], 0
                            ],
                            ["images/buttonsmenu-sheet1.png", 8394, 1, 1, .1, .10, 1, 0.5, 0.5, [],
                                [-0.3100000023841858, -0.3272730112075806, 0, -0.4363636076450348, 0.300000011920929, -0.3181819915771484, 0.4399999976158142, 0, 0.300000011920929, 0.3181819915771484, 0, 0.4363639950752258, -0.300000011920929, 0.3181819915771484, -0.449999988079071, 0], 0
                            ],
                            ["images/buttonsmenu-sheet1.png", 8394, 103, 1, 100, 110, 1, 0.5, 0.5, [],
                                [-0.300000011920929, -0.3181819915771484, 0, -0.4272727072238922, 0.300000011920929, -0.3181819915771484, 0.4399999976158142, 0, 0.3100000023841858, 0.3272730112075806, 0, 0.445455014705658, -0.3100000023841858, 0.3272730112075806, -0.449999988079071, 0], 0
                            ],
                            ["images/buttonsmenu-sheet1.png", 8394, 1, 113, 100, 110, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/buttonsmenu-sheet1.png", 8394, 103, 113, 100, 103, 1, 0.5, 0.5048543810844421, [],
                                [-0.3199999928474426, -0.3300973773002625, 0, -0.4757281839847565, 0.3299999833106995, -0.3398053646087647, 0.4700000286102295, -0.009708374738693237, 0.3399999737739563, 0.3398056030273438, 0, 0.4854366183280945, -0.3299999833106995, 0.3300966024398804, -0.449999988079071, -0.009708374738693237], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        3816111259603715
                    ]
                ],
                false,
                false,
                3677814208359498, [],
                null
            ],
            [
                "t19",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        0,
                        false,
                        1,
                        0,
                        false,
                        1232180301374547, [
                            ["images/menubackground-sheet1.png", 251805, 0, 0, 970, 667, 1, 0.5, 0.5007496476173401, [],
                                [], 1
                            ],
                            ["images/menubackground-sheet0.png", 177159, 0, 0, 970, 670, 1, 0.5, 0.5, [
                                    ["Imagepoint 1", 0.1257731914520264, 0.2492537349462509],
                                    ["Imagepoint 2", 0.1793814450502396, 0.6567164063453674],
                                    ["Imagepoint 3", 0.357731968164444, 0.8761193752288818],
                                    ["Imagepoint 4", 0.8175257444381714, 0.7164179086685181],
                                    ["Imagepoint 5", 0.8587628602981567, 0.3761194050312042],
                                    ["Imagepoint 6", 0.5896907448768616, 0.1208955198526382]
                                ],
                                [], 1
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "ScrollTo",
                        cr.behaviors.scrollto,
                        9657377092495986
                    ]
                ],
                false,
                false,
                2118127616887011, [],
                null
            ],
            [
                "t20",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        3114299714185867, [
                            ["images/title-sheet0.png", 15348, 0, 0, 898, 238, 1, 0.5, 0.5, [],
                                [-0.4576837122440338, -0.3403359949588776, 0, 0.2100840210914612, 0.4175950288772583, -0.1890760064125061, 0.4743880033493042, 0, 0.4265030026435852, 0.2226889729499817, 0, 0.4201679825782776, -0.4365255832672119, 0.2605040073394775, -0.4788419008255005, 0], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        2571628967756246
                    ]
                ],
                false,
                false,
                2594503710483601, [],
                null
            ],
            [
                "t21",
                cr.plugins_.Sprite,
                false, [6063946182212269, 6182261436045476, 7859288674636377, 5629313940451761, 8969558860275115, 540176615317967, 898971450117711],
                3,
                0,
                null, [
                    [
                        "Owly1",
                        12,
                        true,
                        0,
                        0,
                        true,
                        5817297785286022, [
                            ["images/player-sheet1.png", 20377, 1, 1, 150, 158, 1, 0.5, 0.5, [],
                                [-0.3133330047130585, -0.3227850198745728, 0, -0.449367105960846, 0.2933329939842224, -0.3037970066070557, 0.4466670155525208, 0, 0.3399999737739563, 0.348101019859314, 0, 0.4746840000152588, -0.3666670024394989, 0.3734179735183716, -0.4466666877269745, 0], 0
                            ],
                            ["images/player-sheet1.png", 20377, 153, 1, 150, 158, 1, 0.5, 0.5, [],
                                [-0.3133330047130585, -0.3227850198745728, 0, -0.449367105960846, 0.2933329939842224, -0.3037970066070557, 0.4466670155525208, 0, 0.3399999737739563, 0.348101019859314, 0, 0.4746840000152588, -0.3666670024394989, 0.3734179735183716, -0.4466666877269745, 0], 0
                            ],
                            ["images/player-sheet1.png", 20377, 305, 1, 150, 158, 1, 0.5, 0.5, [],
                                [-0.3133330047130585, -0.3227850198745728, 0, -0.449367105960846, 0.2933329939842224, -0.3037970066070557, 0.4466670155525208, 0, 0.3399999737739563, 0.348101019859314, 0, 0.4746840000152588, -0.3666670024394989, 0.3734179735183716, -0.4466666877269745, 0], 0
                            ],
                            ["images/player-sheet1.png", 20377, 1, 161, 150, 158, 1, 0.5, 0.5, [],
                                [-0.3133330047130585, -0.3227850198745728, 0, -0.449367105960846, 0.2933329939842224, -0.3037970066070557, 0.4466670155525208, 0, 0.3399999737739563, 0.348101019859314, 0, 0.4746840000152588, -0.3666670024394989, 0.3734179735183716, -0.4466666877269745, 0], 0
                            ]
                        ]
                    ],
                    [
                        "Owly2",
                        12,
                        true,
                        0,
                        0,
                        true,
                        5029394509214118, [
                            ["images/player-sheet0.png", 134742, 1, 1, 220, 206, 1, 0.5, 0.5, [],
                                [-0.3136360049247742, -0.3009710013866425, 0, -0.1941750049591065, 0.3590909838676453, -0.3495150208473206, 0.300000011920929, 0, 0.3318179845809937, 0.3203880190849304, 0, 0.4854369759559631, -0.2363640069961548, 0.2184469699859619, -0.199999988079071, 0], 0
                            ],
                            ["images/player-sheet0.png", 134742, 223, 1, 220, 206, 1, 0.5, 0.5, [],
                                [-0.3136360049247742, -0.3009710013866425, 0, -0.1941750049591065, 0.3590909838676453, -0.3495150208473206, 0.300000011920929, 0, 0.3318179845809937, 0.3203880190849304, 0, 0.4854369759559631, -0.2363640069961548, 0.2184469699859619, -0.199999988079071, 0], 0
                            ],
                            ["images/player-sheet0.png", 134742, 445, 1, 220, 206, 1, 0.5, 0.5, [],
                                [-0.3136360049247742, -0.3009710013866425, 0, -0.1941750049591065, 0.3590909838676453, -0.3495150208473206, 0.300000011920929, 0, 0.3318179845809937, 0.3203880190849304, 0, 0.4854369759559631, -0.2363640069961548, 0.2184469699859619, -0.199999988079071, 0], 0
                            ],
                            ["images/player-sheet0.png", 134742, 667, 1, 220, 206, 1, 0.5, 0.5, [],
                                [-0.3136360049247742, -0.3009710013866425, 0, -0.1941750049591065, 0.3590909838676453, -0.3495150208473206, 0.300000011920929, 0, 0.3318179845809937, 0.3203880190849304, 0, 0.4854369759559631, -0.2363640069961548, 0.2184469699859619, -0.199999988079071, 0], 0
                            ]
                        ]
                    ],
                    [
                        "Owly3",
                        12,
                        true,
                        0,
                        0,
                        true,
                        5503865815461305, [
                            ["images/player-sheet0.png", 134742, 1, 209, 220, 188, 1, 0.5, 0.5, [],
                                [-0.2590910196304321, -0.3723399937152863, 0.4181820154190064, -0.3723399937152863, 0.445455014705658, 0.4361699819564819, -0.2681819796562195, 0.4308509826660156], 0
                            ],
                            ["images/player-sheet0.png", 134742, 223, 209, 220, 188, 1, 0.5, 0.5, [],
                                [-0.2590910196304321, -0.3723399937152863, 0.4181820154190064, -0.3723399937152863, 0.445455014705658, 0.4361699819564819, -0.2681819796562195, 0.4308509826660156], 0
                            ],
                            ["images/player-sheet0.png", 134742, 445, 209, 220, 188, 1, 0.5, 0.5, [],
                                [-0.2590910196304321, -0.3723399937152863, 0.4181820154190064, -0.3723399937152863, 0.445455014705658, 0.4361699819564819, -0.2681819796562195, 0.4308509826660156], 0
                            ],
                            ["images/player-sheet0.png", 134742, 667, 209, 220, 188, 1, 0.5, 0.5, [],
                                [-0.2590910196304321, -0.3723399937152863, 0.4181820154190064, -0.3723399937152863, 0.445455014705658, 0.4361699819564819, -0.2681819796562195, 0.4308509826660156], 0
                            ]
                        ]
                    ],
                    [
                        "Owly4",
                        12,
                        true,
                        0,
                        0,
                        true,
                        486700819514529, [
                            ["images/player-sheet0.png", 134742, 1, 583, 220, 180, 1, 0.5, 0.5, [],
                                [-0.1318179965019226, -0.05000001192092896, 0, -0.3611109852790833, 0.449999988079071, -0.4388889074325562, 0.4227269887924194, 0, 0.3772730231285095, 0.3500000238418579, 0, 0.449999988079071, -0.3181819915771484, 0.2777779698371887, -0.4590908885002136, 0], 0
                            ],
                            ["images/player-sheet0.png", 134742, 223, 583, 220, 180, 1, 0.5, 0.5, [],
                                [-0.1318179965019226, -0.05000001192092896, 0, -0.3611109852790833, 0.449999988079071, -0.4388889074325562, 0.4227269887924194, 0, 0.3772730231285095, 0.3500000238418579, 0, 0.449999988079071, -0.3181819915771484, 0.2777779698371887, -0.4590908885002136, 0], 0
                            ],
                            ["images/player-sheet0.png", 134742, 445, 583, 220, 180, 1, 0.5, 0.5, [],
                                [-0.1318179965019226, -0.05000001192092896, 0, -0.3611109852790833, 0.449999988079071, -0.4388889074325562, 0.4227269887924194, 0, 0.3772730231285095, 0.3500000238418579, 0, 0.449999988079071, -0.3181819915771484, 0.2777779698371887, -0.4590908885002136, 0], 0
                            ],
                            ["images/player-sheet0.png", 134742, 667, 583, 220, 180, 1, 0.5, 0.5, [],
                                [-0.1318179965019226, -0.05000001192092896, 0, -0.3611109852790833, 0.449999988079071, -0.4388889074325562, 0.4227269887924194, 0, 0.3772730231285095, 0.3500000238418579, 0, 0.449999988079071, -0.3181819915771484, 0.2777779698371887, -0.4590908885002136, 0], 0
                            ]
                        ]
                    ],
                    [
                        "Owly5",
                        12,
                        true,
                        0,
                        0,
                        true,
                        3358874053872829, [
                            ["images/player-sheet0.png", 134742, 1, 399, 220, 182, 1, 0.5, 0.5, [],
                                [-0.2954549789428711, -0.401098906993866, 0.3909090161323547, -0.406593382358551, 0.3500000238418579, 0.4395599961280823, -0.2272729873657227, 0.4505490064620972], 0
                            ],
                            ["images/player-sheet0.png", 134742, 223, 399, 220, 182, 1, 0.5, 0.5, [],
                                [-0.2954549789428711, -0.401098906993866, 0.3909090161323547, -0.406593382358551, 0.3500000238418579, 0.4395599961280823, -0.2272729873657227, 0.4505490064620972], 0
                            ],
                            ["images/player-sheet0.png", 134742, 445, 399, 220, 182, 1, 0.5, 0.5, [],
                                [-0.2954549789428711, -0.401098906993866, 0.3909090161323547, -0.406593382358551, 0.3500000238418579, 0.4395599961280823, -0.2272729873657227, 0.4505490064620972], 0
                            ],
                            ["images/player-sheet0.png", 134742, 667, 399, 220, 182, 1, 0.5, 0.5, [],
                                [-0.2954549789428711, -0.401098906993866, 0.3909090161323547, -0.406593382358551, 0.3500000238418579, 0.4395599961280823, -0.2272729873657227, 0.4505490064620972], 0
                            ]
                        ]
                    ],
                    [
                        "Owly6",
                        12,
                        true,
                        0,
                        0,
                        true,
                        3732027789964664, [
                            ["images/player-sheet0.png", 134742, 1, 765, 220, 180, 1, 0.5, 0.5, [],
                                [-0.1818180084228516, -0.1111110150814056, 0, -0.3833329975605011, 0.3363639712333679, -0.300000011920929, 0.4590910077095032, 0, 0.3818179965019226, 0.3555560111999512, 0, 0.4611110091209412, -0.3818179965019226, 0.3555560111999512, -0.2045449912548065, 0], 0
                            ],
                            ["images/player-sheet0.png", 134742, 223, 765, 220, 180, 1, 0.5, 0.5, [],
                                [-0.1818180084228516, -0.1111110150814056, 0, -0.3833329975605011, 0.3363639712333679, -0.300000011920929, 0.4590910077095032, 0, 0.3818179965019226, 0.3555560111999512, 0, 0.4611110091209412, -0.3818179965019226, 0.3555560111999512, -0.2045449912548065, 0], 0
                            ],
                            ["images/player-sheet0.png", 134742, 445, 765, 220, 180, 1, 0.5, 0.5, [],
                                [-0.1818180084228516, -0.1111110150814056, 0, -0.3833329975605011, 0.3363639712333679, -0.300000011920929, 0.4590910077095032, 0, 0.3818179965019226, 0.3555560111999512, 0, 0.4611110091209412, -0.3818179965019226, 0.3555560111999512, -0.2045449912548065, 0], 0
                            ],
                            ["images/player-sheet0.png", 134742, 667, 765, 220, 180, 1, 0.5, 0.5, [],
                                [-0.1818180084228516, -0.1111110150814056, 0, -0.3833329975605011, 0.3363639712333679, -0.300000011920929, 0.4590910077095032, 0, 0.3818179965019226, 0.3555560111999512, 0, 0.4611110091209412, -0.3818179965019226, 0.3555560111999512, -0.2045449912548065, 0], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Platform",
                        cr.behaviors.Platform,
                        6243487112628446
                    ],
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        9831668826401623
                    ],
                    [
                        "Sine2",
                        cr.behaviors.Sin,
                        4616599284477552
                    ]
                ],
                false,
                false,
                4228662021134412, [],
                null
            ],
            [
                "t22",
                cr.plugins_.Touch,
                false, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                1482165510496078, [],
                null, [1]
            ],
            [
                "t23",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Forest",
                        0,
                        false,
                        0,
                        0,
                        false,
                        793706585508946, [
                            ["images/obstacle-sheet0.png", 68437, 1, 1, 150, 150, 1, 0.5, 0.5, [],
                                [-0.3133330047130585, -0.2466669976711273, 0.2866669893264771, -0.2266669869422913, 0.4399999976158142, 0.4399999976158142, 0, 0.4399999976158142, -0.4133332967758179, 0.413332998752594], 0
                            ],
                            ["images/obstacle-sheet0.png", 68437, 153, 1, 150, 150, 1, 0.5, 0.5, [],
                                [-0.300000011920929, -0.300000011920929, 0.0133330225944519, -0.01333299279212952, 0.4333329796791077, 0.4333329796791077, 0, 0.4666669964790344, -0.4266667068004608, 0.4266669750213623], 0
                            ],
                            ["images/obstacle-sheet0.png", 68437, 305, 1, 150, 150, 1, 0.5, 0.5, [],
                                [-0.3533329963684082, -0.3533329963684082, 0, -0.3733330070972443, 0.2466670274734497, -0.2466669976711273, 0.413332998752594, 0, 0.3733329772949219, 0.3733329772949219, 0, 0.413332998752594, -0.3133330047130585, 0.3133329749107361], 0
                            ],
                            ["images/obstacle-sheet0.png", 68437, 1, 153, 150, 150, 1, 0.5, 0.5, [],
                                [-0.2333329916000366, -0.2466669976711273, 0.2466670274734497, -0.3066670000553131, 0.2533329725265503, 0, 0.2599999904632568, 0.2599999904632568, 0, 0.3066669702529907, -0.1466670036315918, 0.1466670036315918, -0.1866669952869415, 0], 0
                            ],
                            ["images/obstacle-sheet0.png", 68437, 153, 153, 150, 150, 1, 0.5, 0.5, [],
                                [-0.300000011920929, -0.08000001311302185, 0.3466669917106628, -0.09333300590515137, 0.4266669750213623, 0.4266669750213623, -0.3933330178260803, 0.3933330178260803], 0
                            ],
                            ["images/obstacle-sheet0.png", 68437, 305, 153, 150, 150, 1, 0.5, 0.5, [],
                                [-0.03333300352096558, -0.3333330154418945, 0.2733330130577087, 0.09333300590515137, 0.4333329796791077, 0.4333329796791077, 0, 0.4733330011367798, -0.4466666877269745, 0.4466670155525208, -0.213333010673523, 0], 0
                            ],
                            ["images/obstacle-sheet0.png", 68437, 1, 305, 150, 150, 1, 0.5, 0.5, [],
                                [-0.2466669976711273, -0.1399999856948853, 0.1800000071525574, -0.1466670036315918, 0.3333330154418945, 0.2866669893264771, -0.3333330154418945, 0.3333330154418945], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Bullet",
                        cr.behaviors.Bullet,
                        9965913448173556
                    ]
                ],
                false,
                false,
                6897787714296698, [],
                null
            ],
            [
                "t24",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        1313575145335898, [
                            ["images/stand-sheet0.png", 156, 0, 0, 50, 20, 1, 0.5, 0.5, [],
                                [], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Solid",
                        cr.behaviors.solid,
                        556731216482698
                    ]
                ],
                false,
                false,
                7282697223224987, [],
                null
            ],
            [
                "t25",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        0,
                        false,
                        0,
                        0,
                        false,
                        4871885140089344, [
                            ["images/obstaclehive-sheet0.png", 15587, 0, 0, 150, 150, 1, 0.5, 0.5, [],
                                [-0.3133330047130585, -0.3133330047130585, 0, -0.4733332991600037, 0.3199999928474426, -0.3199999928474426, 0.4666669964790344, 0, 0.3399999737739563, 0.3399999737739563, 0, 0.4800000190734863, -0.3333330154418945, 0.3333330154418945, -0.4600000083446503, 0], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Bullet",
                        cr.behaviors.Bullet,
                        938066516080199
                    ]
                ],
                false,
                false,
                6430895583337222, [],
                null
            ],
            [
                "t26",
                cr.plugins_.Sprite,
                false, [],
                3,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        150328888570837, [
                            ["images/hivebees-sheet0.png", 12813, 0, 0, 200, 200, 1, 0.5, 0.5, [],
                                [0.2300000190734863, 0.2300000190734863, 0, -0.4799999892711639, -0.1599999964237213, 0.1600000262260437, 0.4300000071525574, 0.4300000071525574, 0, -0.199999988079071, -0.300000011920929, 0.300000011920929], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Bullet",
                        cr.behaviors.Bullet,
                        1717985985756799
                    ],
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        380778510306395
                    ],
                    [
                        "Sine2",
                        cr.behaviors.Sin,
                        5389628279941905
                    ]
                ],
                false,
                false,
                9150340761009227, [],
                null
            ],
            [
                "t27",
                cr.plugins_.Sprite,
                false, [7619757305945004],
                1,
                0,
                null, [
                    [
                        "Default",
                        0,
                        false,
                        0,
                        0,
                        false,
                        3032707399452826, [
                            ["images/button-sheet0.png", 40161, 1, 1, 200, 197, 1, 0.5, 0.5025380849838257, [],
                                [-0.324999988079071, -0.3248730897903442, 0, -0.4670050740242004, 0.324999988079071, -0.3248730897903442, 0.4549999833106995, -0.005076080560684204, 0.324999988079071, 0.3197969198226929, 0, 0.4619289040565491, -0.324999988079071, 0.3197969198226929, -0.4549999833106995, -0.005076080560684204], 0
                            ],
                            ["images/button-sheet0.png", 40161, 203, 1, 200, 197, 1, 0.5, 0.5025380849838257, [],
                                [-0.324999988079071, -0.3248730897903442, 0, -0.4670050740242004, 0.324999988079071, -0.3248730897903442, 0.4549999833106995, -0.005076080560684204, 0.324999988079071, 0.3197969198226929, 0, 0.4619289040565491, -0.324999988079071, 0.3197969198226929, -0.4549999833106995, -0.005076080560684204], 0
                            ],
                            ["images/button-sheet0.png", 40161, 1, 200, 200, 197, 1, 0.5, 0.5025380849838257, [],
                                [-0.3299999833106995, -0.3299490809440613, 0, -0.472081184387207, 0.3299999833106995, -0.3299490809440613, 0.4549999833106995, -0.005076080560684204, 0.324999988079071, 0.3197969198226929, 0, 0.456852912902832, -0.324999988079071, 0.3197969198226929, -0.4549999833106995, -0.005076080560684204], 0
                            ],
                            ["images/button-sheet0.png", 40161, 203, 200, 200, 197, 1, 0.5, 0.5025380849838257, [],
                                [-0.3199999928474426, -0.3197970986366272, 0, -0.4619289934635162, 0.324999988079071, -0.3248730897903442, 0.4599999785423279, -0.005076080560684204, 0.3299999833106995, 0.3248729109764099, 0, 0.4670048952102661, -0.324999988079071, 0.3197969198226929, -0.449999988079071, -0.005076080560684204], 0
                            ],
                            ["images/button-sheet1.png", 24895, 1, 1, 200, 197, 1, 0.5, 0.5025380849838257, [],
                                [-0.324999988079071, -0.3248730897903442, 0, -0.4619289934635162, 0.324999988079071, -0.3248730897903442, 0.4549999833106995, -0.005076080560684204, 0.3299999833106995, 0.3248729109764099, 0, 0.4670048952102661, -0.3299999833106995, 0.3248729109764099, -0.4549999833106995, -0.005076080560684204], 0
                            ],
                            ["images/button-sheet1.png", 24895, 203, 1, 200, 197, 1, 0.5, 0.5025380849838257, [],
                                [-0.3299999833106995, -0.3299490809440613, 0, -0.472081184387207, 0.3299999833106995, -0.3299490809440613, 0.4549999833106995, -0.005076080560684204, 0.324999988079071, 0.3197969198226929, 0, 0.456852912902832, -0.324999988079071, 0.3197969198226929, -0.4549999833106995, -0.005076080560684204], 0
                            ],
                            ["images/button-sheet1.png", 24895, 1, 200, 123, 150, 1, 0.5040650367736816, 0.5, [],
                                [-0.2764230370521545, -0.3133330047130585, -0.008130043745040894, -0.4733332991600037, 0.2845529913902283, -0.3266670107841492, 0.4146339893341065, 0, 0.3902439475059509, 0.413332998752594, -0.008130043745040894, 0.4599999785423279, -0.3577240407466888, 0.3799999952316284, -0.3902440369129181, 0], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        8055265140165916
                    ]
                ],
                false,
                false,
                4490859993117923, [],
                null
            ],
            [
                "t28",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        6079443408184702, [
                            ["images/splashmenu-sheet0.png", 20518, 0, 0, 699, 511, 1, 0.5007153153419495, 0.5009784698486328, [],
                                [-0.4606581032276154, -0.446183979511261, -0.001430302858352661, -0.4774950742721558, 0.4635196924209595, -0.4520547688007355, 0.4835476875305176, -0.001956462860107422, 0.4620887041091919, 0.4481405019760132, -0.001430302858352661, 0.4755385518074036, -0.4606581032276154, 0.4442265033721924, -0.4778255224227905, -0.001956462860107422], 0
                            ]
                        ]
                    ]
                ],
                [],
                false,
                false,
                9326688238386716, [],
                null
            ],
            [
                "t29",
                cr.plugins_.Sprite,
                false, [],
                2,
                0,
                null, [
                    [
                        "Forest",
                        0,
                        false,
                        0,
                        0,
                        false,
                        7442096190824541, [
                            ["images/animal-sheet0.png", 4872, 0, 0, 182, 150, 1, 0.5, 0.5, [],
                                [-0.2582420110702515, -0.2066670060157776, 0, -0.4666666984558106, 0.03846198320388794, 0.06000000238418579, -0.1208789944648743, 0, 0.3736259937286377, 0.3466669917106628, 0, 0.4800000190734863, -0.4120879173278809, 0.3933330178260803, -0.2582420110702515, 0], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Bullet",
                        cr.behaviors.Bullet,
                        8821789589646812
                    ],
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        7297370922042082
                    ]
                ],
                false,
                false,
                2502021014843247, [],
                null
            ],
            [
                "t30",
                cr.plugins_.Sprite,
                false, [],
                2,
                0,
                null, [
                    [
                        "Savanna",
                        14,
                        true,
                        1,
                        0,
                        true,
                        5140846749066264, [
                            ["images/birds-sheet1.png", 22309, 1, 153, 258, 150, 1, 0.5, 0.5, [],
                                [-0.24031001329422, -0.05333301424980164, 0, 0.1399999856948853, 0.3914729952812195, -0.3133330047130585, 0.3178290128707886, 0, 0.3720930218696594, 0.2799999713897705, 0, 0.3133329749107361, -0.3100779950618744, 0.1733329892158508, -0.2906979918479919, 0], 0
                            ],
                            ["images/birds-sheet1.png", 22309, 1, 305, 258, 150, 1, 0.5, 0.5, [],
                                [-0.24031001329422, -0.05333301424980164, 0, 0.1399999856948853, 0.3914729952812195, -0.3133330047130585, 0.3178290128707886, 0, 0.3720930218696594, 0.2799999713897705, 0, 0.3133329749107361, -0.3100779950618744, 0.1733329892158508, -0.2906979918479919, 0], 0
                            ],
                            ["images/birds-sheet2.png", 16850, 1, 1, 258, 150, 1, 0.5, 0.5, [],
                                [-0.24031001329422, -0.05333301424980164, 0, 0.1399999856948853, 0.3914729952812195, -0.3133330047130585, 0.3178290128707886, 0, 0.3720930218696594, 0.2799999713897705, 0, 0.3133329749107361, -0.3100779950618744, 0.1733329892158508, -0.2906979918479919, 0], 0
                            ],
                            ["images/birds-sheet2.png", 16850, 1, 153, 258, 150, 1, 0.5, 0.5, [],
                                [-0.24031001329422, -0.05333301424980164, 0, 0.1399999856948853, 0.3914729952812195, -0.3133330047130585, 0.3178290128707886, 0, 0.3720930218696594, 0.2799999713897705, 0, 0.3133329749107361, -0.3100779950618744, 0.1733329892158508, -0.2906979918479919, 0], 0
                            ]
                        ]
                    ],
                    [
                        "Mountain",
                        12,
                        true,
                        1,
                        0,
                        true,
                        828274681756359, [
                            ["images/birds-sheet0.png", 16270, 1, 1, 266, 150, 1, 0.5, 0.5, [],
                                [-0.2932330071926117, -0.1333329975605011, 0.2368419766426086, 0, 0.4323310256004334, 0.3799999952316284, -0.3270680010318756, 0.1933329701423645], 0
                            ],
                            ["images/birds-sheet0.png", 16270, 1, 153, 266, 150, 1, 0.5, 0.5, [],
                                [-0.2932330071926117, -0.1333329975605011, 0, -0.2666670083999634, 0.2443609833717346, -0.04666700959205627, 0.2368419766426086, 0, 0.4323310256004334, 0.3799999952316284, 0, 0.4599999785423279, -0.3270680010318756, 0.1933329701423645, -0.3796989917755127, 0], 0
                            ],
                            ["images/birds-sheet0.png", 16270, 1, 305, 266, 150, 1, 0.5, 0.5, [],
                                [-0.2932330071926117, -0.1333329975605011, 0, -0.2666670083999634, 0.2443609833717346, -0.04666700959205627, 0.2368419766426086, 0, 0.4323310256004334, 0.3799999952316284, 0, 0.4599999785423279, -0.3270680010318756, 0.1933329701423645, -0.3796989917755127, 0], 0
                            ],
                            ["images/birds-sheet1.png", 22309, 1, 1, 266, 150, 1, 0.5, 0.5, [],
                                [-0.2932330071926117, -0.1333329975605011, 0, -0.2666670083999634, 0.2443609833717346, -0.04666700959205627, 0.2368419766426086, 0, 0.4323310256004334, 0.3799999952316284, 0, 0.4599999785423279, -0.3270680010318756, 0.1933329701423645, -0.3796989917755127, 0], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Bullet",
                        cr.behaviors.Bullet,
                        5237387909460039
                    ],
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        3925130304620372
                    ]
                ],
                false,
                false,
                4027893960142454, [],
                null
            ],
            [
                "t31",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        12,
                        true,
                        1,
                        0,
                        true,
                        3422463550056073, [
                            ["images/tornado-sheet0.png", 37158, 1, 1, 150, 225, 1, 0.5, 0.5022222399711609, [],
                                [-0.3333330154418945, -0.3911112546920776, 0, -0.426666647195816, 0.4066669940948486, -0.4400000274181366, 0.199999988079071, 0.457777738571167, 0, 0.1644447445869446, 0, 0.1644447445869446, -0.199999988079071, -0.004444241523742676], 0
                            ],
                            ["images/tornado-sheet0.png", 37158, 153, 1, 150, 225, 1, 0.5, 0.5022222399711609, [],
                                [-0.3333330154418945, -0.3911112546920776, 0, -0.426666647195816, 0.4066669940948486, -0.4400000274181366, 0.199999988079071, 0.457777738571167, 0, 0.1644447445869446, 0, 0.1644447445869446, -0.199999988079071, -0.004444241523742676], 0
                            ],
                            ["images/tornado-sheet0.png", 37158, 305, 1, 150, 225, 1, 0.5, 0.5022222399711609, [],
                                [-0.3333330154418945, -0.3911112546920776, 0, -0.426666647195816, 0.4066669940948486, -0.4400000274181366, 0.199999988079071, 0.457777738571167, 0, 0.1644447445869446, 0, 0.1644447445869446, -0.199999988079071, -0.004444241523742676], 0
                            ],
                            ["images/tornado-sheet0.png", 37158, 1, 228, 150, 225, 1, 0.5, 0.5022222399711609, [],
                                [-0.3333330154418945, -0.3911112546920776, 0, -0.426666647195816, 0.4066669940948486, -0.4400000274181366, 0.199999988079071, 0.457777738571167, 0, 0.1644447445869446, 0, 0.1644447445869446, -0.199999988079071, -0.004444241523742676], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Bullet",
                        cr.behaviors.Bullet,
                        9305720550617903
                    ]
                ],
                false,
                false,
                7199955662995436, [],
                null
            ],
            [
                "t32",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        16,
                        true,
                        1,
                        0,
                        true,
                        6533929519989738, [
                            ["images/cloud-sheet0.png", 8496, 1, 1, 175, 150, 1, 0.5028571486473084, 0.5, [],
                                [-0.3714281320571899, -0.3466669917106628, -0.005714148283004761, -0.4733332991600037, 0.3542858362197876, -0.3333330154418945, 0.4571428298950195, 0, 0.1714288592338562, 0.1200000047683716, -0.005714148283004761, 0.1333330273628235, -0.1828571557998657, 0.1266670227050781, -0.4114285409450531, 0], 0
                            ],
                            ["images/cloud-sheet0.png", 8496, 178, 1, 175, 150, 1, 0.5028571486473084, 0.5, [],
                                [-0.3714281320571899, -0.3466669917106628, -0.005714148283004761, -0.4733332991600037, 0.3542858362197876, -0.3333330154418945, 0.4571428298950195, 0, 0.1714288592338562, 0.1200000047683716, -0.005714148283004761, 0.1333330273628235, -0.1828571557998657, 0.1266670227050781, -0.4114285409450531, 0], 0
                            ],
                            ["images/cloud-sheet0.png", 8496, 1, 153, 175, 150, 1, 0.5028571486473084, 0.5, [],
                                [-0.3714281320571899, -0.3466669917106628, -0.005714148283004761, -0.4733332991600037, 0.3542858362197876, -0.3333330154418945, 0.4571428298950195, 0, 0.1714288592338562, 0.1200000047683716, -0.005714148283004761, 0.1333330273628235, -0.1828571557998657, 0.1266670227050781, -0.4114285409450531, 0], 0
                            ],
                            ["images/cloud-sheet0.png", 8496, 178, 153, 175, 150, 1, 0.5028571486473084, 0.5, [],
                                [-0.3714281320571899, -0.3466669917106628, -0.005714148283004761, -0.4733332991600037, 0.3542858362197876, -0.3333330154418945, 0.4571428298950195, 0, 0.1714288592338562, 0.1200000047683716, -0.005714148283004761, 0.1333330273628235, -0.1828571557998657, 0.1266670227050781, -0.4114285409450531, 0], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Bullet",
                        cr.behaviors.Bullet,
                        3925168750705929
                    ]
                ],
                false,
                false,
                265356725181026, [],
                null
            ],
            [
                "t33",
                cr.plugins_.Sprite,
                false, [],
                2,
                0,
                null, [
                    [
                        "Default",
                        0,
                        false,
                        0,
                        0,
                        false,
                        6205082339863435, [
                            ["images/playersad-sheet1.png", 29359, 223, 1, 150, 155, 1, 0.5, 0.5032258033752441, [],
                                [], 0
                            ],
                            ["images/playersad-sheet0.png", 51950, 1, 1, 220, 199, 1, 0.5, 0.5025125741958618, [],
                                [], 0
                            ],
                            ["images/playersad-sheet0.png", 51950, 223, 1, 220, 190, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/playersad-sheet0.png", 51950, 223, 193, 220, 183, 1, 0.5, 0.5027322173118591, [],
                                [], 0
                            ],
                            ["images/playersad-sheet0.png", 51950, 1, 202, 220, 182, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/playersad-sheet1.png", 29359, 1, 1, 220, 181, 1, 0.5, 0.5027624368667603, [],
                                [], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        5352448835528999
                    ],
                    [
                        "Platform",
                        cr.behaviors.Platform,
                        4544385127905386
                    ]
                ],
                false,
                false,
                7640013882405754, [],
                null
            ],
            [
                "t34",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        8,
                        true,
                        1,
                        0,
                        true,
                        227695047705706, [
                            ["images/river-sheet0.png", 10608, 1, 1, 350, 200, 1, 0.5, 0.5, [],
                                [-0.2914289832115173, -0.3950000107288361, 0.3257139921188355, 0.01499998569488525, 0.3514279723167419, 0.4449999928474426, 0, 0.4549999833106995, -0.4285714030265808, -0.3400000035762787], 0
                            ],
                            ["images/river-sheet0.png", 10608, 1, 203, 350, 200, 1, 0.5, 0.5, [],
                                [0.1428570151329041, -0.1049999892711639, 0.3257139921188355, 0.01499998569488525, 0.3514279723167419, 0.4449999928474426, 0, 0.4549999833106995, 0.008571982383728027, -0.05500000715255737], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Bullet",
                        cr.behaviors.Bullet,
                        286644727532609
                    ]
                ],
                false,
                false,
                5383792581044155, [],
                null
            ],
            [
                "t35",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        0,
                        false,
                        0,
                        0,
                        false,
                        3195407317950684, [
                            ["images/uibar-sheet0.png", 26215, 1, 1, 601, 100, 1, 0.5008319616317749, 0.5, [
                                    ["Imagepoint 1", 0.351081520318985, 0.5199999809265137],
                                    ["Imagepoint 4", 0.3527454137802124, 0.4000000059604645]
                                ],
                                [-0.4775374531745911, -0.3600000143051148, -0.001663953065872192, -0.4099999964237213, 0.4742100238800049, -0.3499999940395355, 0.4758730530738831, 0.3600000143051148, -0.001663953065872192, 0.4300000071525574, -0.4792013764381409, 0.3700000047683716], 0
                            ],
                            ["images/uibar-sheet0.png", 26215, 1, 103, 600, 100, 1, 0.5, 0.5, [
                                    ["Imagepoint 1", 0.7733333110809326, 0.3300000131130219],
                                    ["Imagepoint 2", 0.2649999856948853, 0.3499999940395355],
                                    ["Imagepoint 3", 1.076666712760925, 0.4900000095367432],
                                    ["Imagepoint 4", 1.223333358764648, 0.5]
                                ],
                                [-0.4766666889190674, -0.3600000143051148, 0, -0.4099999964237213, 0.4750000238418579, -0.3499999940395355, 0.4766669869422913, 0.3600000143051148, 0, 0.4300000071525574, -0.4783332943916321, 0.3700000047683716], 0
                            ]
                        ]
                    ]
                ],
                [],
                false,
                false,
                5217546509909379, [],
                null
            ],
            [
                "t36",
                cr.plugins_.Text,
                false, [],
                1,
                0,
                null,
                null, [
                    [
                        "ScrollTo",
                        cr.behaviors.scrollto,
                        5758771672902028
                    ]
                ],
                false,
                false,
                4100231914219357, [],
                null
            ],
            [
                "t37",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        0,
                        false,
                        0,
                        0,
                        false,
                        2812474734276688, [
                            ["images/tutorial-sheet0.png", 270717, 973, 1, 970, 606, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/tutorial-sheet0.png", 270717, 973, 609, 970, 606, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/tutorial-sheet0.png", 270717, 1, 673, 970, 606, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/tutorial-sheet0.png", 270717, 973, 1217, 970, 606, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/tutorial-sheet0.png", 270717, 1, 1, 970, 670, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/tutorial-sheet0.png", 270717, 1, 1281, 970, 606, 1, 0.5, 0.5, [],
                                [], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "ScrollTo",
                        cr.behaviors.scrollto,
                        8884947484090981
                    ]
                ],
                false,
                false,
                7691483027873405, [],
                null
            ],
            [
                "t38",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        12,
                        true,
                        1,
                        0,
                        true,
                        1683692975285924, [
                            ["images/star-sheet0.png", 967, 0, 0, 100, 94, 1, 0.5, 0.5, [],
                                [], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        7786488976420087
                    ]
                ],
                false,
                false,
                9826158107216794, [],
                null
            ],
            [
                "t39",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        4862055356144455, [
                            ["images/button-sheet1.png", 24895, 1, 200, 123, 150, 1, 0.5040650367736816, 0.5, [],
                                [-0.2764230370521545, -0.3133330047130585, -0.008130043745040894, -0.4733332991600037, 0.2845529913902283, -0.3266670107841492, 0.4146339893341065, 0, 0.3902439475059509, 0.413332998752594, -0.008130043745040894, 0.4599999785423279, -0.3577240407466888, 0.3799999952316284, -0.3902440369129181, 0], 0
                            ]
                        ]
                    ]
                ],
                [],
                false,
                false,
                5668116914513199, [],
                null
            ],
            [
                "t40",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        3543081842074418, [
                            ["images/pause-sheet0.png", 2168, 0, 0, 100, 110, 1, 0.5, 0.5, [],
                                [-0.3199999928474426, -0.3363640010356903, 0, -0.4636363983154297, 0.3199999928474426, -0.3363640010356903, 0.4700000286102295, 0, 0.3299999833106995, 0.3454549908638001, 0, 0.4727270007133484, -0.3199999928474426, 0.3363639712333679, -0.4699999988079071, 0], 0
                            ]
                        ]
                    ]
                ],
                [],
                false,
                false,
                571019921435907, [],
                null
            ],
            [
                "t41",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        0,
                        false,
                        0,
                        0,
                        false,
                        3969996303273793, [
                            ["images/splashscreen-sheet0.png", 25953, 1, 1, 700, 500, 1, 0.5, 0.5, [
                                    ["Imagepoint 1", 0.2199999988079071, 0.8240000009536743],
                                    ["Imagepoint 2", 0.5114285945892334, 0.8119999766349793],
                                    ["Imagepoint 3", 0.8199999928474426, 0.8159999847412109],
                                    ["Imagepoint 4", 0.3285714387893677, 0.5180000066757202],
                                    ["Imagepoint 5", 0.5042856931686401, 0.4860000014305115],
                                    ["Imagepoint 6", 0.6757143139839172, 0.5180000066757202]
                                ],
                                [-0.452857106924057, -0.4340000152587891, 0, -0.472000002861023, 0.4571430087089539, -0.4399999976158142, 0.4742860198020935, 0, 0.4599999785423279, 0.4440000057220459, 0, 0.4860000014305115, -0.4571428894996643, 0.4399999976158142, -0.4685713946819305, 0], 0
                            ],
                            ["images/splashscreen-sheet1.png", 11938, 0, 0, 700, 436, 1, 0.5, 0.5, [
                                    ["Imagepoint 1", 0.2199999988079071, 0.752293586730957],
                                    ["Imagepoint 2", 0.7799999713897705, 0.747706413269043]
                                ],
                                [-0.4600000083446503, -0.4357798099517822, 0, -0.4701834917068481, 0.4614289999008179, -0.4380733966827393, 0.4785709977149963, 0, 0.4614289999008179, 0.4380729794502258, 0, 0.4724770188331604, -0.4614286124706268, 0.4380729794502258, -0.4771429002285004, 0], 0
                            ],
                            ["images/splashscreen-sheet0.png", 25953, 1, 503, 699, 443, 1, 0.5007153153419495, 0.5011286735534668, [
                                    ["Imagepoint 1", 0.1802575141191483, 0.7449209690093994],
                                    ["Imagepoint 2", 0.4892703890800476, 0.7133182883262634],
                                    ["Imagepoint 3", 0.818311870098114, 0.7268623113632202]
                                ],
                                [-0.4620887041091919, -0.4401805698871613, -0.001430302858352661, -0.4717832803726196, 0.4620887041091919, -0.4424379765987396, 0.4806866645812988, -0.002257674932479858, 0.4577966928482056, 0.4334083199501038, -0.001430302858352661, 0.4604963064193726, -0.4592275023460388, 0.4334083199501038, -0.4792561233043671, -0.002257674932479858], 0
                            ]
                        ]
                    ]
                ],
                [],
                false,
                false,
                5211561072642017, [],
                null
            ],
            [
                "t42",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        0,
                        false,
                        0,
                        0,
                        false,
                        52286179762336, [
                            ["images/comic1-sheet0.png", 1375652, 1, 1, 970, 670, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/comic1-sheet0.png", 1375652, 973, 1, 970, 670, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/comic1-sheet0.png", 1375652, 1, 673, 970, 670, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/comic1-sheet0.png", 1375652, 973, 673, 970, 670, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/comic1-sheet0.png", 1375652, 1, 1345, 970, 670, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/comic1-sheet0.png", 1375652, 973, 1345, 970, 670, 1, 0.5, 0.5, [],
                                [], 0
                            ],
                            ["images/comic1-sheet1.png", 186418, 0, 0, 970, 670, 1, 0.5, 0.5, [],
                                [], 1
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "ScrollTo",
                        cr.behaviors.scrollto,
                        511930055968432
                    ]
                ],
                false,
                false,
                920263686726219, [],
                null
            ],
            [
                "t43",
                cr.plugins_.Audio,
                false, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                9113124553859266, [],
                null, [0, 0, 1, 1, 600, 600, 10000, 1, 5000, 1]
            ],
            [
                "t44",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        0,
                        false,
                        0,
                        0,
                        false,
                        3295349269312231, [
                            ["images/buttonsmode-sheet0.png", 22688, 1, 1, 500, 143, 1, 0.5, 0.503496527671814, [],
                                [], 0
                            ],
                            ["images/buttonsmode-sheet0.png", 22688, 1, 146, 500, 143, 1, 0.5, 0.503496527671814, [],
                                [], 0
                            ],
                            ["images/buttonsmode-sheet0.png", 22688, 1, 291, 500, 143, 1, 0.5, 0.503496527671814, [],
                                [], 0
                            ],
                            ["images/buttonsmode-sheet1.png", 4363, 0, 0, .01, .01, 1, 0.05, 0.05, [],
                                [-0.4698491990566254, -0.3888890147209168, 0, -0.4629629850387573, 0.4748740196228027, -0.4074074029922485, 0.4698489904403687, 0.3888890147209168, 0, 0.4444440007209778, -0.4673367142677307, 0.3796300292015076], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        6907060888317536
                    ]
                ],
                false,
                false,
                8956161187943922, [],
                null
            ],
            [
                "t45",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        7234343656129536, [
                            ["images/highscores-sheet0.png", 25398, 0, 0, 500, 550, 1, 0.5, 0.5, [],
                                [-0.4539999961853027, -0.4581817984580994, 0, -0.4727272987365723, 0.4539999961853027, -0.4581817984580994, 0.4800000190734863, 0, 0.4559999704360962, 0.4599999785423279, 0, 0.4745450019836426, -0.4539999961853027, 0.4581819772720337, -0.4760000109672546, 0], 0
                            ]
                        ]
                    ]
                ],
                [],
                false,
                false,
                5795234835676886, [],
                null
            ],
            [
                "t46",
                cr.plugins_.Text,
                false, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                4302307500870716, [],
                null
            ],
            [
                "t47",
                cr.plugins_.WebStorage,
                false, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                3594266046052013, [],
                null, []
            ],
            [
                "t48",
                cr.plugins_.Arr,
                false, [],
                0,
                0,
                null,
                null, [],
                true,
                false,
                2193789040066422, [],
                null
            ],
            [
                "t49",
                cr.plugins_.Text,
                false, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                9969968841132321, [],
                null
            ],
            [
                "t50",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        3827936699819661, [
                            ["images/background-sheet0.png", 25498, 0, 0, 970, 670, 1, 0.5, 0.5, [],
                                [], 1
                            ]
                        ]
                    ]
                ],
                [],
                false,
                false,
                6989383148970568, [],
                null
            ],
            [
                "t51",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        9201547235890021, [
                            ["images/whitefilter-sheet0.png", 155, 0, 0, 250, 250, 1, 0.5, 0.5, [],
                                [], 1
                            ]
                        ]
                    ]
                ],
                [],
                false,
                false,
                4266902137090846, [],
                null
            ],
            [
                "t52",
                cr.plugins_.Sprite,
                false, [],
                2,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        3768890536365315, [
                            ["images/okraglykrzak-sheet0.png", 24545, 0, 0, 150, 150, 1, 0.5, 0.5, [],
                                [0.0133330225944519, -0.2666670083999634, 0.3266670107841492, 0.0133330225944519, 0, 0.3199999928474426, -0.3066670000553131, 0.006667017936706543], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Bullet",
                        cr.behaviors.Bullet,
                        4109302722682616
                    ],
                    [
                        "Rotate",
                        cr.behaviors.Rotate,
                        5000533068932481
                    ]
                ],
                false,
                false,
                462385101592093, [],
                null
            ],
            [
                "t53",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        7441453162616484, [
                            ["images/border-sheet0.png", 336, 0, 0, 500, 500, 1, 0.5, 0.5, [],
                                [], 1
                            ]
                        ]
                    ]
                ],
                [],
                false,
                false,
                4439742857650616, [],
                null
            ],
            [
                "t54",
                cr.plugins_.pix_spilgames,
                false, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                3296585015131587, [],
                null, []
            ],
            [
                "t55",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        7906206332321064, [
                            ["images/logo-sheet0.png", 94, 0, 0, 50, 50, 1, 0.5, 0.5, [],
                                [], 1
                            ]
                        ]
                    ]
                ],
                [],
                false,
                false,
                1267774650069, [],
                null
            ],
            [
                "t56",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        90303414763883, [
                            ["images/backgroundloader-sheet0.png", 155, 0, 0, 250, 250, 1, 0.5, 0.5, [],
                                [], 4
                            ]
                        ]
                    ]
                ],
                [],
                false,
                true,
                7433206138727252, [],
                null
            ],
            [
                "t57",
                cr.plugins_.Sprite,
                false, [],
                0,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        7242834451734882, [
                            ["images/logofunky-sheet0.png", 2451, 0, 0, 200, 77, 1, 0.5, 0.5064935088157654, [],
                                [-0.4749999940395355, -0.4415584206581116, 0, -0.4675325155258179, 0.425000011920929, -0.3116885125637054, 0.4399999976158142, -0.01298749446868897, 0.3999999761581421, 0.233766496181488, 0, 0.3766235113143921, -0.4799999892711639, 0.4415584802627564], 0
                            ]
                        ]
                    ]
                ],
                [],
                false,
                true,
                6031128027738435, [],
                null
            ],
            [
                "t58",
                cr.plugins_.Text,
                false, [],
                1,
                0,
                null,
                null, [
                    [
                        "ScrollTo",
                        cr.behaviors.scrollto,
                        5215884076123772
                    ]
                ],
                false,
                true,
                2840595287313499, [],
                null
            ],
            [
                "t59",
                cr.plugins_.TiledBg,
                false, [],
                0,
                0, ["images/distancebar2.png", 110, 1],
                null, [],
                false,
                false,
                8431538912223178, [],
                null
            ],
            [
                "t60",
                cr.plugins_.Sprite,
                false, [],
                1,
                0,
                null, [
                    [
                        "Default",
                        5,
                        false,
                        1,
                        0,
                        false,
                        776150296919673, [
                            ["images/moregame-sheet0.png", 4888, 0, 0, .1, .1, 1, 0.5, 0.5034482479095459, [],
                                [-0.3199999928474426, -0.3172412514686585, 0, -0.4689654409885407, 0.3333330154418945, -0.331034243106842, 0.4666669964790344, -0.006896257400512695, 0.3399999737739563, 0.331034779548645, 0, 0.4689657688140869, -0.3199999928474426, 0.3103447556495667, -0.4399999976158142, -0.006896257400512695], 0
                            ]
                        ]
                    ]
                ],
                [
                    [
                        "Sine",
                        cr.behaviors.Sin,
                        5910369372807192
                    ]
                ],
                false,
                false,
                2572025741737228, [],
                null
            ],
            [
                "t61",
                cr.plugins_.Sprite,
                true, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                5655530244569217, [],
                null
            ],
            [
                "t62",
                cr.plugins_.TiledBg,
                true, [],
                1,
                0,
                null,
                null, [
                    [
                        "Bullet2",
                        cr.behaviors.Bullet,
                        5828651637719857
                    ]
                ],
                false,
                false,
                5700414765346832, [],
                null
            ],
            [
                "t63",
                cr.plugins_.TiledBg,
                true, [],
                1,
                0,
                null,
                null, [
                    [
                        "Bullet2",
                        cr.behaviors.Bullet,
                        211302198905537
                    ]
                ],
                false,
                false,
                2353356954382375, [],
                null
            ],
            [
                "t64",
                cr.plugins_.TiledBg,
                true, [],
                1,
                0,
                null,
                null, [
                    [
                        "Bullet2",
                        cr.behaviors.Bullet,
                        7525627024531174
                    ]
                ],
                false,
                false,
                2776029845798651, [],
                null
            ],
            [
                "t65",
                cr.plugins_.TiledBg,
                true, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                2308539770873091, [],
                null
            ],
            [
                "t66",
                cr.plugins_.TiledBg,
                true, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                7252129862699713, [],
                null
            ],
            [
                "t67",
                cr.plugins_.TiledBg,
                true, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                1694631546918831, [],
                null
            ],
            [
                "t68",
                cr.plugins_.TiledBg,
                true, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                1375789978559697, [],
                null
            ],
            [
                "t69",
                cr.plugins_.TiledBg,
                true, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                1647426792643327, [],
                null
            ],
            [
                "t70",
                cr.plugins_.TiledBg,
                true, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                976880182612232, [],
                null
            ],
            [
                "t71",
                cr.plugins_.Sprite,
                true, [],
                0,
                0,
                null,
                null, [],
                false,
                false,
                5937488943555366, [],
                null
            ]
        ],
        [
            [61, 29, 30, 32, 23, 25, 52, 34, 31],
            [62, 3, 1, 0, 4, 2, 5],
            [63, 9, 6, 7, 10, 8, 11],
            [64, 15, 12, 13, 16, 14, 17],
            [65, 3, 9, 15],
            [66, 1, 6, 12],
            [67, 0, 7, 13],
            [68, 4, 10, 16],
            [69, 2, 8, 14],
            [70, 5, 11, 17],
            [71, 18, 44]
        ],
        [
            [
                "Game",
                960,
                640,
                false,
                "Game",
                4907627773701389, [
                    [
                        "Layer 0",
                        0,
                        3720286883352792,
                        true, [110, 199, 234],
                        false,
                        1,
                        1,
                        1,
                        false,
                        1,
                        0,
                        0, [
                            [
                                [197, 561, 0, 273, 20, 0, 0, 0, 0.5, 0.5, 0, 0, []],
                                24,
                                6, [],
                                [
                                    [
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [-1108, 990, 0, 430, 416, 0, 0, 1, 0, 0, 0, 0, []],
                                3,
                                0, [],
                                [
                                    [
                                        100,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [1312, 2931, 0, 512, 512, 0, 0, 1, 0, 0, 0, 0, []],
                                0,
                                2, [],
                                [
                                    [
                                        100,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [2454, 2613, 0, 502, 484, 0, 0, 1, 0, 0, 0, 0, []],
                                1,
                                1, [],
                                [
                                    [
                                        100,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [-1186, 2474, 0, 470, 494, 0, 0, 1, 0, 0, 0, 0, []],
                                4,
                                71, [],
                                [
                                    [
                                        100,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [-661, 2522, 0, 500, 502, 0, 0, 1, 0, 0, 0, 0, []],
                                2,
                                72, [],
                                [
                                    [
                                        100,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [996, 2529, 0, 500, 464, 0, 0, 1, 0, 0, 0, 0, []],
                                5,
                                73, [],
                                [
                                    [
                                        100,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [-1849, 2575, 0, 440, 410, 0, 0, 1, 0, 0, 0, 0, []],
                                9,
                                74, [],
                                [
                                    [
                                        200,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [3264, 2555, 0, 400, 298, 0, 0, 1, 0, 0, 0, 0, []],
                                6,
                                75, [],
                                [
                                    [
                                        200,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [-73, 3004, 0, 440, 440, 0, 0, 1, 0, 0, 0, 0, []],
                                10,
                                77, [],
                                [
                                    [
                                        200,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [1771, 2564, 0, 520, 420, 0, 0, 1, 0, 0, 0, 0, []],
                                8,
                                78, [],
                                [
                                    [
                                        200,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [-70, 2570, 0, 418, 308, 0, 0, 1, 0, 0, 0, 0, []],
                                11,
                                79, [],
                                [
                                    [
                                        200,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [-1916, 1443, 0, 512, 512, 0, 0, 1, 0, 0, 0, 0, []],
                                7,
                                76, [],
                                [
                                    [
                                        200,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [-647, 2918, 0, 390, 332, 0, 0, 1, 0, 0, 0, 0, []],
                                12,
                                81, [],
                                [
                                    [
                                        500,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [467, 2557, 0, 390, 362, 0, 0, 1, 0, 0, 0, 0, []],
                                16,
                                83, [],
                                [
                                    [
                                        500,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [-1127, 2918, 0, 240, 254, 0, 0, 1, 0, 0, 0, 0, []],
                                14,
                                84, [],
                                [
                                    [
                                        500,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [556, 3066, 0, 470, 410, 0, 0, 1, 0, 0, 0, 0, []],
                                15,
                                80, [],
                                [
                                    [
                                        500,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [-1272, 1858, 0, 512, 512, 0, 0, 1, 0, 0, 0, 0, []],
                                13,
                                82, [],
                                [
                                    [
                                        500,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [3211, 2976, 0, 450, 352, 0, 0, 1, 0, 0, 0, 0, []],
                                17,
                                85, [],
                                [
                                    [
                                        500,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [1544, 534, 0, 150, 150, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                23,
                                5, [],
                                [
                                    [
                                        500,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [-1166, 301, 0, 350, 200, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                34,
                                36, [],
                                [
                                    [
                                        400,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [502, -170, 0, 150, 150, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                25,
                                7, [],
                                [
                                    [
                                        200,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [871, -194, 0, 200, 200, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                26,
                                8, [],
                                [
                                    [
                                        200,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ],
                                    [
                                        1,
                                        5,
                                        0,
                                        0.2,
                                        0,
                                        0,
                                        0,
                                        5,
                                        0
                                    ],
                                    [
                                        1,
                                        1,
                                        0,
                                        0.5,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [-816, -563, 0, 182, 150, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                29,
                                37, [],
                                [
                                    [
                                        400,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ],
                                    [
                                        1,
                                        4,
                                        0,
                                        1,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [-278, -306, 0, 150, 150, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                52,
                                38, [],
                                [
                                    [
                                        400,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ],
                                    [
                                        180,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [466, 52, 0, 601, 100, 0, 0, 1, 0.5008319616317749, 0.5, 0, 0, []],
                                35,
                                69, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [120, -250, 0, 280, 65, 0, 0, 1, 0, 0, 0, 0, []],
                                36,
                                70, [],
                                [
                                    [
                                        0
                                    ]
                                ],
                                [
                                    "Text",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [821, 50, 0, 77.20692443847656, 84.92761993408203, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                40,
                                89, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [-146, 1013, 0, 258, 150, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                30,
                                12, [],
                                [
                                    [
                                        800,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ],
                                    [
                                        1,
                                        1,
                                        0,
                                        1,
                                        0,
                                        0,
                                        0,
                                        20,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [-457, 460, 0, 100, 94, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                38,
                                13, [],
                                [
                                    [
                                        1,
                                        3,
                                        0,
                                        1,
                                        0,
                                        0,
                                        0,
                                        20,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [54, -1039, 0, 500, 143, 0, 0, 1, 0.5, 0.503496527671814, 0, 0, []],
                                44,
                                14, [],
                                [
                                    [
                                        1,
                                        3,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [-527, -245, 0, 175, 150, 0, 0, 1, 0.5028571486473084, 0.5, 0, 0, []],
                                32,
                                39, [],
                                [
                                    [
                                        400,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [-1238, -407, 0, 150, 225, 0, 0, 1, 0.5, 0.5022222399711609, 0, 0, []],
                                31,
                                40, [],
                                [
                                    [
                                        400,
                                        0,
                                        0,
                                        0,
                                        0,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [576, 1014, 0, 700, 500, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                41,
                                90, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [-419, -23, 0, 371, 124, 0, 0, 0, 0, 0, 0, 0, []],
                                46,
                                41, [],
                                [],
                                [
                                    "0",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [3550, 2010, 0, 150, 155, 0, 0, 1, 0.5, 0.5032258033752441, 0, 0, []],
                                33,
                                88, [],
                                [
                                    [
                                        1,
                                        5,
                                        0,
                                        6,
                                        0,
                                        0,
                                        0,
                                        360,
                                        0
                                    ],
                                    [
                                        330,
                                        1500,
                                        1500,
                                        650,
                                        1500,
                                        1000,
                                        1,
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [87.62050628662109, 484.9082641601563, 0, 117.2410125732422, 123.4938735961914, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                21,
                                3, [
                                    [0],
                                    [1],
                                    [15],
                                    [0],
                                    [""],
                                    [0],
                                    [0]
                                ],
                                [
                                    [
                                        330,
                                        800,
                                        800,
                                        750,
                                        1800,
                                        2000,
                                        0,
                                        1
                                    ],
                                    [
                                        0,
                                        4,
                                        0,
                                        0.5,
                                        0,
                                        0,
                                        0,
                                        3,
                                        0
                                    ],
                                    [
                                        1,
                                        3,
                                        0,
                                        0.5,
                                        0,
                                        0,
                                        0,
                                        5,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [914, 53, 0, 77.71158599853516, 85.48274993896484, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                18,
                                53, [
                                    [1]
                                ],
                                [
                                    [
                                        1,
                                        5,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        20,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [82.24810791015625, -148, 0, 300, 21, 0, 0, 1, 0, 0, 0, 0, []],
                                59,
                                67, [],
                                [],
                                [
                                    0,
                                    0
                                ]
                            ],
                            [
                                [-432, 114, 0, 80.55014038085938, 79.34188842773438, 0, 0, 0, 0.5, 0.5025380849838257, 0, 0, []],
                                27,
                                45, [
                                    [0]
                                ],
                                [
                                    [
                                        1,
                                        2,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [1022, 571, 0, 50, 50, 0, 0, 0, 0.5, 0.5, 0, 0, []],
                                55,
                                48, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ]
                        ],
                        []
                    ]
                ],
                [
                    [
                        null,
                        48,
                        21, [],
                        [],
                        [
                            5,
                            1,
                            1
                        ]
                    ]
                ],
                []
            ],
            [
                "Levels",
                960,
                640,
                true,
                "Menu",
                623277906688561, [
                    [
                        "Layer 0",
                        0,
                        7954592426675806,
                        true, [110, 199, 234],
                        false,
                        1,
                        1,
                        1,
                        false,
                        1,
                        0,
                        0, [
                            [
                                [492, 303, 0, 1375.507690429688, 950.0928955078125, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                50,
                                32, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [493, 301, 0, 1380, 956, 0, 0, 0.300000011920929, 0.5, 0.5, 0, 0, []],
                                51,
                                33, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [162, -788, 0, 500, 500, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                53,
                                43, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [481, 316, 0, 964, 642.8785400390625, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                19,
                                68, [],
                                [
                                    [
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    1,
                                    1
                                ]
                            ],
                            [
                                [181, 199, 0, 200, 197, 0, 0, 0, 0.5, 0.5025380849838257, 0, 0, []],
                                27,
                                55, [
                                    [0]
                                ],
                                [
                                    [
                                        1,
                                        2,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [134, 384, 0, 200, 197, 0, 0, 0, 0.5, 0.5025380849838257, 0, 0, []],
                                27,
                                56, [
                                    [0]
                                ],
                                [
                                    [
                                        1,
                                        2,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    1,
                                    1
                                ]
                            ],
                            [
                                [365, 494, 0, 200, 197, 0, 0, 0, 0.5, 0.5025380849838257, 0, 0, []],
                                27,
                                57, [
                                    [0]
                                ],
                                [
                                    [
                                        1,
                                        2,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    2,
                                    1
                                ]
                            ],
                            [
                                [745, 443, 0, 200, 197, 0, 0, 0, 0.5, 0.5025380849838257, 0, 0, []],
                                27,
                                58, [
                                    [0]
                                ],
                                [
                                    [
                                        1,
                                        2,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    3,
                                    1
                                ]
                            ],
                            [
                                [806, 254, 0, 200, 197, 0, 0, 0, 0.5, 0.5025380849838257, 0, 0, []],
                                27,
                                59, [
                                    [0]
                                ],
                                [
                                    [
                                        1,
                                        2,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    4,
                                    1
                                ]
                            ],
                            [
                                [687, 124, 0, 200, 197, 0, 0, 0, 0.5, 0.5025380849838257, 0, 0, []],
                                27,
                                60, [
                                    [0]
                                ],
                                [
                                    [
                                        1,
                                        2,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    5,
                                    1
                                ]
                            ],
                            [
                                [561, 925, 0, 123, 150, 0, 0, 1, 0.5040650367736816, 0.5, 0, 0, []],
                                39,
                                87, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ]
                        ],
                        []
                    ]
                ],
                [],
                []
            ],
            [
                "Menu",
                960,
                640,
                true,
                "Menu",
                9385552187810883, [
                    [
                        "Layer 0",
                        0,
                        3075590376220685,
                        true, [110, 199, 234],
                        false,
                        1,
                        1,
                        1,
                        false,
                        1,
                        0,
                        0, [
                            [
                                [468, 328, 0, 1375.507690429688, 950.0928955078125, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                50,
                                31, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [103, 1605, 0, 500, 500, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                53,
                                42, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [485, 322.8920288085938, 0, 964, 640, 0, 0, 1, 0.5, 0.5007496476173401, 0, 0, []],
                                19,
                                65, [],
                                [
                                    [
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [60, 565, 0, 100, 110, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                18,
                                61, [
                                    [0]
                                ],
                                [
                                    [
                                        1,
                                        5,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        20,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [539, 571, 0, 100, 110, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                18,
                                62, [
                                    [0]
                                ],
                                [
                                    [
                                        1,
                                        5,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        20,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    3,
                                    1
                                ]
                            ],
                            [
                                [386, 546, 0, 168.2784729003906, 171.64404296875, 0, 0, 1, 0.5, 0.5032680034637451, 0, 0, []],
                                18,
                                63, [
                                    [0]
                                ],
                                [
                                    [
                                        1,
                                        5,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        20,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    2,
                                    1
                                ]
                            ],
                            [
                                [530, -423, 0, 699, 511, 0, 0, 1, 0.5007153153419495, 0.5009784698486328, 0, 0, []],
                                28,
                                64, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [490, 135, 0, 898, 238, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                20,
                                66, [],
                                [
                                    [
                                        1,
                                        0,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [490, 78, 0, 500, 143, 0, 0, 0, 0.5, 0.503496527671814, 0, 0, []],
                                44,
                                15, [],
                                [
                                    [
                                        1,
                                        3,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [486, 229, 0, 500, 143, 0, 0, 0, 0.5, 0.503496527671814, 0, 0, []],
                                44,
                                16, [],
                                [
                                    [
                                        1,
                                        3,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    1,
                                    1
                                ]
                            ],
                            [
                                [489, 396, 0, 500, 143, 0, 0, 0, 0.5, 0.503496527671814, 0, 0, []],
                                44,
                                17, [],
                                [
                                    [
                                        1,
                                        3,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    2,
                                    1
                                ]
                            ],
                            [
                                [479, 315, 0, 500, 550, 0, 0, 0, 0.5, 0.5, 0, 0, []],
                                45,
                                18, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [416, 224, 0, 340, 49, 0, 0, 0, 0, 0, 0, 0, []],
                                46,
                                22, [],
                                [],
                                [
                                    "0",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [416, 288, 0, 340, 49, 0, 0, 0, 0, 0, 0, 0, []],
                                46,
                                19, [],
                                [],
                                [
                                    "0",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [416, 352, 0, 340, 49, 0, 0, 0, 0, 0, 0, 0, []],
                                46,
                                23, [],
                                [],
                                [
                                    "0",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [416, 416, 0, 340, 49, 0, 0, 0, 0, 0, 0, 0, []],
                                46,
                                24, [],
                                [],
                                [
                                    "0",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [416, 480, 0, 340, 49, 0, 0, 0, 0, 0, 0, 0, []],
                                46,
                                25, [],
                                [],
                                [
                                    "0",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [304, 224, 0, 64, 48, 0, 0, 0, 0, 0, 0, 0, []],
                                49,
                                26, [],
                                [],
                                [
                                    "1.",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [304, 288, 0, 64, 48, 0, 0, 0, 0, 0, 0, 0, []],
                                49,
                                27, [],
                                [],
                                [
                                    "2.",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [304, 352, 0, 64, 48, 0, 0, 0, 0, 0, 0, 0, []],
                                49,
                                28, [],
                                [],
                                [
                                    "3.",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [304, 416, 0, 64, 48, 0, 0, 0, 0, 0, 0, 0, []],
                                49,
                                29, [],
                                [],
                                [
                                    "4.",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [304, 480, 0, 64, 48, 0, 0, 0, 0, 0, 0, 0, []],
                                49,
                                30, [],
                                [],
                                [
                                    "5.",
                                    0,
                                    "bold 24pt Arial",
                                    "rgb(255,255,51)",
                                    0,
                                    0,
                                    0,
                                    0,
                                    0
                                ]
                            ],
                            [
                                [485, 546, 0, 398, 108, 0, 0, 0, 0.5, 0.5, 0, 0, []],
                                44,
                                46, [],
                                [
                                    [
                                        1,
                                        3,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        10,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    3,
                                    1
                                ]
                            ],
                            [
                                [200, 554, 0, 145.4126129150391, 140.5655212402344, 0, 0, 1, 0.5, 0.5034482479095459, 0, 0, []],
                                60,
                                91, [],
                                [
                                    [
                                        1,
                                        5,
                                        0,
                                        2,
                                        0,
                                        0,
                                        0,
                                        20,
                                        0
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [812, 585, 0, 50, 50, 0, 0, 0, 0.5, 0.5, 0, 0, []],
                                55,
                                94, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ]
                        ],
                        []
                    ]
                ],
                [],
                []
            ],
            [
                "Tutorial",
                1708,
                960,
                true,
                "Tutorial",
                9233264577845731, [
                    [
                        "Layer 0",
                        0,
                        6510927267782606,
                        true, [110, 199, 234],
                        false,
                        1,
                        1,
                        1,
                        false,
                        1,
                        0,
                        0, [
                            [
                                [515, 323, 0, 1375.507690429688, 950.0928955078125, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                50,
                                92, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [520, 316, 0, 1380, 956, 0, 0, 0.300000011920929, 0.5, 0.5, 0, 0, []],
                                51,
                                93, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [486, 304, 0, 970, 606, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                37,
                                86, [],
                                [
                                    [
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ]
                        ],
                        []
                    ]
                ],
                [],
                []
            ],
            [
                "Comic",
                960,
                640,
                true,
                "Comic",
                168591523905896, [
                    [
                        "Layer 0",
                        0,
                        7861201507599642,
                        true, [110, 199, 234],
                        false,
                        1,
                        1,
                        1,
                        false,
                        1,
                        0,
                        0, [
                            [
                                [479, 364, 0, 1375.507690429688, 950.0928955078125, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                50,
                                34, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [489, 372, 0, 1380, 956, 0, 0, 0.300000011920929, 0.5, 0.5, 0, 0, []],
                                51,
                                35, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [564, -478, 0, 500, 500, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                53,
                                44, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [479, 317, 0, 924.9446411132813, 638.8792724609375, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                42,
                                9, [],
                                [
                                    [
                                        1
                                    ]
                                ],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ]
                        ],
                        []
                    ]
                ],
                [],
                []
            ],
            [
                "Loader",
                960,
                640,
                true,
                "Loader",
                2548886104894444, [
                    [
                        "Layer 0",
                        0,
                        6184501762918901,
                        true, [110, 199, 234],
                        false,
                        1,
                        1,
                        1,
                        false,
                        1,
                        0,
                        0, [
                            [
                                [552, 389, 0, 1701, 1073, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                56,
                                49, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [524, 228, 0, 200, 77, 0, 0, 1, 0.5, 0.5064935088157654, 0, 0, []],
                                57,
                                51, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [521, 376, 0, 527, 80, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                58,
                                50, [],
                                [
                                    [
                                        0
                                    ]
                                ],
                                [
                                    "Text",
                                    0,
                                    "20pt Hobo Std",
                                    "rgb(255,255,204)",
                                    1,
                                    0,
                                    1,
                                    0,
                                    0
                                ]
                            ]
                        ],
                        []
                    ]
                ],
                [],
                []
            ],
            [
                "Splash",
                960,
                640,
                true,
                "Splash",
                6208898994424436, [
                    [
                        "Layer 0",
                        0,
                        5781847058716766,
                        true, [110, 199, 234],
                        false,
                        1,
                        1,
                        1,
                        false,
                        1,
                        0,
                        0, [
                            [
                                [468, 328, 0, 1375.507690429688, 950.0928955078125, 0, 0, 1, 0.5, 0.5, 0, 0, []],
                                50,
                                54, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ],
                            [
                                [477, 315, 0, 50, 50, 0, 0, 0, 0.5, 0.5, 0, 0, []],
                                55,
                                52, [],
                                [],
                                [
                                    0,
                                    "Default",
                                    0,
                                    1
                                ]
                            ]
                        ],
                        []
                    ]
                ],
                [],
                []
            ]
        ],
        [
            [
                "Game", [
                    [
                        1,
                        "Ending",
                        0,
                        0,
                        false, false, 2916875831422948, false
                    ],
                    [
                        1,
                        "Endless",
                        0,
                        0,
                        false, false, 3693360967269205, false
                    ],
                    [
                        1,
                        "Pause",
                        0,
                        0,
                        false, false, 3430658781921472, false
                    ],
                    [
                        1,
                        "Difficulty",
                        0,
                        0,
                        false, false, 4428988848910335, false
                    ],
                    [
                        1,
                        "MaxLevel",
                        0,
                        0,
                        false, false, 1662065945877229, false
                    ],
                    [
                        1,
                        "DistancePlayer",
                        0,
                        600,
                        false, false, 4391249874186569, false
                    ],
                    [
                        1,
                        "PlayerFame",
                        0,
                        0,
                        false, false, 7589280672311142, false
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        9481149408917672, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                1184367873288848,
                                false
                            ]
                        ],
                        [
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                662373365342426,
                                false
                            ],
                            [
                                61,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                4695811066558897,
                                false
                            ],
                            [
                                62,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet2",
                                5246870383019511,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ],
                            [
                                63,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet2",
                                102414469081259,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ],
                            [
                                64,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet2",
                                7368728505725685,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.acts.SetAnim,
                                null,
                                3814073326930503,
                                false, [
                                    [
                                        1, [
                                            10, [
                                                2,
                                                "Owly"
                                            ],
                                            [
                                                4, [
                                                    23,
                                                    "PlayerFame"
                                                ],
                                                [
                                                    0,
                                                    1
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ],
                            [
                                63,
                                cr.plugins_.TiledBg.prototype.acts.SetSize,
                                null,
                                2320737460972797,
                                false, [
                                    [
                                        0, [
                                            0,
                                            3840
                                        ]
                                    ],
                                    [
                                        0, [
                                            20,
                                            63,
                                            cr.plugins_.TiledBg.prototype.exps.ImageHeight,
                                            false,
                                            null
                                        ]
                                    ]
                                ]
                            ],
                            [
                                62,
                                cr.plugins_.TiledBg.prototype.acts.SetSize,
                                null,
                                5994263871852414,
                                false, [
                                    [
                                        0, [
                                            0,
                                            3840
                                        ]
                                    ],
                                    [
                                        0, [
                                            20,
                                            62,
                                            cr.plugins_.TiledBg.prototype.exps.ImageHeight,
                                            false,
                                            null
                                        ]
                                    ]
                                ]
                            ],
                            [
                                64,
                                cr.plugins_.TiledBg.prototype.acts.SetSize,
                                null,
                                5361646392697799,
                                false, [
                                    [
                                        0, [
                                            0,
                                            3840
                                        ]
                                    ],
                                    [
                                        0, [
                                            20,
                                            64,
                                            cr.plugins_.TiledBg.prototype.exps.ImageHeight,
                                            false,
                                            null
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                4601069884206199,
                                false, [
                                    [
                                        11,
                                        "DistancePlayer"
                                    ],
                                    [
                                        7, [
                                            0,
                                            600
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                1579990384005004,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Jump"
                                        ]
                                    ],
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                4576102071221188,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Flying"
                                        ]
                                    ],
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                1747232151508248,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Charged Jump"
                                        ]
                                    ],
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                586207013113696,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Bunny Jump"
                                        ]
                                    ],
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                5383503413739832,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Double Jump"
                                        ]
                                    ],
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                9493061326705877,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Controlled Jump"
                                        ]
                                    ],
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                6754271926778112,
                                false, [
                                    [
                                        11,
                                        "Difficulty"
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                null,
                                8668228226902055,
                                false, [
                                    [
                                        10,
                                        1
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                7564627213341386,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                8271746460711952,
                                false, [
                                    [
                                        11,
                                        "Endless"
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0, [true, "Background"],
                        false,
                        null,
                        7008839771047484, [
                            [-1,
                                cr.system_object.prototype.cnds.IsGroupActive,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7008839771047484,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Background"
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [],
                        [
                            [
                                0,
                                null,
                                false,
                                null,
                                4916014835427583, [
                                    [-1,
                                        cr.system_object.prototype.cnds.EveryTick,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        1082667776813829,
                                        false
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.acts.SetX,
                                        null,
                                        9126181437802474,
                                        false, [
                                            [
                                                0, [
                                                    0,
                                                    200
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        6985770425943297, [
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.IsOverlapping,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8754023265407478,
                                false, [
                                    [
                                        4,
                                        61
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2362215440793334,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                21,
                                cr.behaviors.Platform.prototype.acts.SetVectorY,
                                "Platform",
                                6681662040636099,
                                false, [
                                    [
                                        0, [
                                            0, -700
                                        ]
                                    ]
                                ]
                            ],
                            [
                                43,
                                cr.plugins_.Audio.prototype.acts.Play,
                                null,
                                2285094107979552,
                                false, [
                                    [
                                        2, ["slip on banana peel-soundbible.com-1301716389", false]
                                    ],
                                    [
                                        3,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        1, [
                                            2,
                                            "Finished"
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                null,
                                8172732760757937,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.behaviors.Bullet.prototype.acts.SetEnabled,
                                "Bullet",
                                4360873195341697,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                24,
                                cr.behaviors.solid.prototype.acts.SetEnabled,
                                "Solid",
                                9067845764286538,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.behaviors.Sin.prototype.acts.SetActive,
                                "Sine2",
                                338368951679717,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                25,
                                cr.behaviors.Bullet.prototype.acts.SetEnabled,
                                "Bullet",
                                174702609723418,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                26,
                                cr.behaviors.Bullet.prototype.acts.SetEnabled,
                                "Bullet",
                                944004445949171,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                34,
                                cr.behaviors.Bullet.prototype.acts.SetEnabled,
                                "Bullet",
                                9156846048033688,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                31,
                                cr.behaviors.Bullet.prototype.acts.SetEnabled,
                                "Bullet",
                                2010342657000217,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                29,
                                cr.behaviors.Bullet.prototype.acts.SetEnabled,
                                "Bullet",
                                6192353513471419,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                4065442700068243,
                                false, [
                                    [
                                        4,
                                        33
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                602094866010694,
                                false
                            ],
                            [
                                62,
                                cr.behaviors.Bullet.prototype.acts.SetEnabled,
                                "Bullet2",
                                5337661454760253,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                63,
                                cr.behaviors.Bullet.prototype.acts.SetEnabled,
                                "Bullet2",
                                8481503225538242,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                64,
                                cr.behaviors.Bullet.prototype.acts.SetEnabled,
                                "Bullet2",
                                4503586759958167,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                6846570056480942,
                                false, [
                                    [
                                        0, [
                                            1,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                2801745394662154,
                                false, [
                                    [
                                        4,
                                        41
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            600
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            350
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                330639660778475,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                5497371541912508,
                                false, [
                                    [
                                        4,
                                        18
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                3712648638925858,
                                false, [
                                    [
                                        0, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                256054102769371,
                                false, [
                                    [
                                        4,
                                        18
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                353102422728882,
                                false, [
                                    [
                                        0, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                0,
                                null,
                                false,
                                null,
                                479513899384246, [
                                    [
                                        47,
                                        cr.plugins_.WebStorage.prototype.cnds.LocalStorageExists,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        3694578924657358,
                                        false, [
                                            [
                                                1, [
                                                    2,
                                                    "wHighscore"
                                                ]
                                            ]
                                        ]
                                    ]
                                ],
                                [],
                                [
                                    [
                                        0,
                                        null,
                                        false,
                                        null,
                                        3690399271200022, [
                                            [
                                                48,
                                                cr.plugins_.Arr.prototype.cnds.ArrForEach,
                                                null,
                                                0,
                                                true,
                                                false,
                                                false,
                                                5533817382075316,
                                                false, [
                                                    [
                                                        3,
                                                        2
                                                    ]
                                                ]
                                            ]
                                        ],
                                        []
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                4328963407236876, [
                                    [-1,
                                        cr.system_object.prototype.cnds.Else,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        5988484544641108,
                                        false
                                    ]
                                ],
                                []
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                2260901267340506, [
                                    [-1,
                                        cr.system_object.prototype.cnds.Compare,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        2436444412452454,
                                        false, [
                                            [
                                                7, [
                                                    19,
                                                    cr.system_object.prototype.exps["int"],
                                                    [
                                                        [
                                                            23,
                                                            "Endless"
                                                        ]
                                                    ]
                                                ]
                                            ],
                                            [
                                                8,
                                                4
                                            ],
                                            [
                                                7, [
                                                    20,
                                                    48,
                                                    cr.plugins_.Arr.prototype.exps.At,
                                                    false,
                                                    null, [
                                                        [
                                                            0,
                                                            0
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.cnds.TriggerOnce,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        5253534413007082,
                                        false
                                    ]
                                ],
                                [
                                    [
                                        48,
                                        cr.plugins_.Arr.prototype.acts.Delete,
                                        null,
                                        4348736116504833,
                                        false, [
                                            [
                                                0, [
                                                    0,
                                                    0
                                                ]
                                            ],
                                            [
                                                3,
                                                0
                                            ]
                                        ]
                                    ],
                                    [
                                        48,
                                        cr.plugins_.Arr.prototype.acts.Insert,
                                        null,
                                        5648780525406361,
                                        false, [
                                            [
                                                7, [
                                                    19,
                                                    cr.system_object.prototype.exps["int"],
                                                    [
                                                        [
                                                            23,
                                                            "Endless"
                                                        ]
                                                    ]
                                                ]
                                            ],
                                            [
                                                0, [
                                                    0,
                                                    0
                                                ]
                                            ],
                                            [
                                                3,
                                                0
                                            ]
                                        ]
                                    ],
                                    [
                                        48,
                                        cr.plugins_.Arr.prototype.acts.Sort,
                                        null,
                                        9847353729687391,
                                        false, [
                                            [
                                                3,
                                                0
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                3475420662923923, [],
                                [
                                    [
                                        48,
                                        cr.plugins_.Arr.prototype.acts.Sort,
                                        null,
                                        652915817984753,
                                        false, [
                                            [
                                                3,
                                                0
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                9036194470150133, [],
                                [
                                    [
                                        47,
                                        cr.plugins_.WebStorage.prototype.acts.StoreLocal,
                                        null,
                                        5992133275324552,
                                        false, [
                                            [
                                                1, [
                                                    2,
                                                    "wHighscore"
                                                ]
                                            ],
                                            [
                                                7, [
                                                    10, [
                                                        10, [
                                                            10, [
                                                                10, [
                                                                    10, [
                                                                        10, [
                                                                            10, [
                                                                                10, [
                                                                                    20,
                                                                                    48,
                                                                                    cr.plugins_.Arr.prototype.exps.At,
                                                                                    false,
                                                                                    null, [
                                                                                        [
                                                                                            0,
                                                                                            0
                                                                                        ]
                                                                                    ]
                                                                                ],
                                                                                [
                                                                                    2,
                                                                                    ","
                                                                                ]
                                                                            ],
                                                                            [
                                                                                20,
                                                                                48,
                                                                                cr.plugins_.Arr.prototype.exps.At,
                                                                                false,
                                                                                null, [
                                                                                    [
                                                                                        0,
                                                                                        1
                                                                                    ]
                                                                                ]
                                                                            ]
                                                                        ],
                                                                        [
                                                                            2,
                                                                            ","
                                                                        ]
                                                                    ],
                                                                    [
                                                                        20,
                                                                        48,
                                                                        cr.plugins_.Arr.prototype.exps.At,
                                                                        false,
                                                                        null, [
                                                                            [
                                                                                0,
                                                                                2
                                                                            ]
                                                                        ]
                                                                    ]
                                                                ],
                                                                [
                                                                    2,
                                                                    ","
                                                                ]
                                                            ],
                                                            [
                                                                20,
                                                                48,
                                                                cr.plugins_.Arr.prototype.exps.At,
                                                                false,
                                                                null, [
                                                                    [
                                                                        0,
                                                                        3
                                                                    ]
                                                                ]
                                                            ]
                                                        ],
                                                        [
                                                            2,
                                                            ","
                                                        ]
                                                    ],
                                                    [
                                                        20,
                                                        48,
                                                        cr.plugins_.Arr.prototype.exps.At,
                                                        false,
                                                        null, [
                                                            [
                                                                0,
                                                                4
                                                            ]
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4760026973698857, [
                            [
                                23,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                3864776218115171,
                                false
                            ]
                        ],
                        [
                            [
                                23,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet",
                                543071385904444,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        7699488643864267, [
                            [-1,
                                cr.system_object.prototype.cnds.Every,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6023195583029647,
                                false, [
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    4
                                                ],
                                                [
                                                    0,
                                                    5
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7538649687909799,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9059490536844153,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7396621632077269,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                8050925129885613,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            1700
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                2032580966135132,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                3174221934603394,
                                false, [
                                    [
                                        4,
                                        25
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2100
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    250
                                                ],
                                                [
                                                    0,
                                                    250
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                6398792222911178,
                                false, [
                                    [
                                        4,
                                        34
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2600
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    590
                                                ],
                                                [
                                                    0,
                                                    590
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                2537162952395692,
                                false, [
                                    [
                                        4,
                                        29
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            3300
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        596145039410285, [
                            [-1,
                                cr.system_object.prototype.cnds.Every,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3252366365042838,
                                false, [
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    4
                                                ],
                                                [
                                                    0,
                                                    5
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                533436657205601,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7711818297460868,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                749466967181681,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                1242525396707675,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2100
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                6832321811468082,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                8073289712899026,
                                false, [
                                    [
                                        4,
                                        34
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2700
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    590
                                                ],
                                                [
                                                    0,
                                                    590
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                9389947775486845,
                                false, [
                                    [
                                        4,
                                        29
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            3500
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                8207287613165619,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            1600
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                7334790437220113,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        925367531429103, [
                            [-1,
                                cr.system_object.prototype.cnds.Every,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9347541004224333,
                                false, [
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    3
                                                ],
                                                [
                                                    0,
                                                    4
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6112153703065843,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6592935454393018,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9863775067641466,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                5077463515895373,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2000
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                5568536070325155,
                                false, [
                                    [
                                        0, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                6737917689808271,
                                false, [
                                    [
                                        4,
                                        29
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            3000
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                8798506322025267,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            1500
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                8302940966713955,
                                false, [
                                    [
                                        0, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                4923304545610708,
                                false, [
                                    [
                                        4,
                                        30
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    1400
                                                ],
                                                [
                                                    0,
                                                    1700
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    100
                                                ],
                                                [
                                                    0,
                                                    100
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                526302146682907,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            1600
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                5266444456723468,
                                false, [
                                    [
                                        0, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        5020402947856498, [
                            [-1,
                                cr.system_object.prototype.cnds.Every,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6405416808815248,
                                false, [
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    2
                                                ],
                                                [
                                                    0,
                                                    5
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                737015691671117,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3111341762320047,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7589273447803756,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                2557941596887804,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2000
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                3050604561606118,
                                false, [
                                    [
                                        0, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                8263812851035782,
                                false, [
                                    [
                                        4,
                                        29
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            3000
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                517730065398527,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            1500
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                6882211182469018,
                                false, [
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                8902392143948597,
                                false, [
                                    [
                                        4,
                                        30
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    1400
                                                ],
                                                [
                                                    0,
                                                    1700
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    150
                                                ],
                                                [
                                                    0,
                                                    150
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                9947004751987984,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            1600
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                257769606725518,
                                false, [
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                8689254857878623,
                                false, [
                                    [
                                        4,
                                        52
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2000
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    500
                                                ],
                                                [
                                                    0,
                                                    2000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        6834262569785553, [
                            [-1,
                                cr.system_object.prototype.cnds.Every,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6536107551332861,
                                false, [
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    1
                                                ],
                                                [
                                                    0,
                                                    3
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5494618273892199,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3949029332647382,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9361357806594451,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                2862689504233582,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2000
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                6971525044254652,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                8379831844013758,
                                false, [
                                    [
                                        4,
                                        29
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            3000
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                8394645966887196,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            1500
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                537334513747223,
                                false, [
                                    [
                                        0, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                3127927617809819,
                                false, [
                                    [
                                        4,
                                        30
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    1400
                                                ],
                                                [
                                                    0,
                                                    1700
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    170
                                                ],
                                                [
                                                    0,
                                                    170
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                30,
                                cr.plugins_.Sprite.prototype.acts.SetAnim,
                                null,
                                5149172900312486,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Mountain"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                7015235312997458,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            1600
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                3755673575190534,
                                false, [
                                    [
                                        0, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8991080469372867, [
                            [-1,
                                cr.system_object.prototype.cnds.Every,
                                null,
                                0,
                                false,
                                false,
                                false,
                                4347907215091384,
                                false, [
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    1
                                                ],
                                                [
                                                    0,
                                                    3
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                155969053144405,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3367114187419012,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                689871840918202,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                5039989512543139,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2000
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                6500976276460595,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                1203604306882046,
                                false, [
                                    [
                                        4,
                                        29
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            3000
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                5548326354160936,
                                false, [
                                    [
                                        4,
                                        32
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    1400
                                                ],
                                                [
                                                    0,
                                                    1700
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    150
                                                ],
                                                [
                                                    0,
                                                    200
                                                ],
                                                [
                                                    0,
                                                    150
                                                ],
                                                [
                                                    0,
                                                    120
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                3988253709700939,
                                false, [
                                    [
                                        4,
                                        31
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2500
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    490
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                5809569008662698,
                                false, [
                                    [
                                        4,
                                        23
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            2200
                                        ]
                                    ],
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.choose, [
                                                [
                                                    0,
                                                    510
                                                ],
                                                [
                                                    0,
                                                    1000
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                4077220466764645,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        2739579294645858, [
                            [
                                23,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2884703053004029,
                                false
                            ]
                        ],
                        [
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                4289650510844135,
                                false, [
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps["int"],
                                            [
                                                [
                                                    19,
                                                    cr.system_object.prototype.exps.random, [
                                                        [
                                                            0,
                                                            0
                                                        ],
                                                        [
                                                            0,
                                                            12
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1590572962226824, [
                            [
                                25,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                1870489475085603,
                                false
                            ]
                        ],
                        [
                            [
                                25,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                4229745532752417,
                                false, [
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps["int"],
                                            [
                                                [
                                                    19,
                                                    cr.system_object.prototype.exps.random, [
                                                        [
                                                            0,
                                                            0
                                                        ],
                                                        [
                                                            0,
                                                            4
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                25,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet",
                                2112760143721065,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        53417782403212, [
                            [
                                25,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                5016867363766726,
                                false
                            ],
                            [
                                25,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8731808259030791,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                25,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                995863799185673,
                                false, [
                                    [
                                        4,
                                        26
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                26,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet",
                                9645812438703803,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0, [false, "Controlled Jump"],
                        false,
                        null,
                        3098918583836106, [
                            [-1,
                                cr.system_object.prototype.cnds.IsGroupActive,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3098918583836106,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Controlled Jump"
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [],
                        [
                            [
                                0,
                                null,
                                false,
                                null,
                                6382886331058109, [
                                    [-1,
                                        cr.system_object.prototype.cnds.EveryTick,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        7750380119917522,
                                        false
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                        null,
                                        5014002871262437,
                                        false, [
                                            [
                                                10,
                                                3
                                            ],
                                            [
                                                7, [
                                                    22,
                                                    21,
                                                    "Platform",
                                                    cr.behaviors.Platform.prototype.exps.VectorY,
                                                    false,
                                                    null
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                3347658707650965, [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.cnds.IsOnFloor,
                                        "Platform",
                                        0,
                                        false,
                                        false,
                                        false,
                                        5114990162875724,
                                        false
                                    ]
                                ],
                                [],
                                [
                                    [
                                        0,
                                        null,
                                        false,
                                        null,
                                        2853555742963473, [
                                            [
                                                21,
                                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                                null,
                                                0,
                                                false,
                                                false,
                                                false,
                                                4386497782543838,
                                                false, [
                                                    [
                                                        10,
                                                        1
                                                    ],
                                                    [
                                                        8,
                                                        2
                                                    ],
                                                    [
                                                        7, [
                                                            21,
                                                            21,
                                                            false,
                                                            null, 2
                                                        ]
                                                    ]
                                                ]
                                            ],
                                            [
                                                21,
                                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                                null,
                                                0,
                                                false,
                                                false,
                                                false,
                                                8391755443570148,
                                                false, [
                                                    [
                                                        10,
                                                        4
                                                    ],
                                                    [
                                                        8,
                                                        1
                                                    ],
                                                    [
                                                        7, [
                                                            2,
                                                            "jetpackready"
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ],
                                        [
                                            [
                                                21,
                                                cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                                null,
                                                6304680677608366,
                                                false, [
                                                    [
                                                        10,
                                                        1
                                                    ],
                                                    [
                                                        7, [
                                                            21,
                                                            21,
                                                            false,
                                                            null, 2
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                6469168553605174, [
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.OnTouchStart,
                                        null,
                                        1,
                                        false,
                                        false,
                                        false,
                                        2882868821585,
                                        false
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        6761669159344483,
                                        false, [
                                            [
                                                4,
                                                40
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.cnds.CompareVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        6114574027088202,
                                        false, [
                                            [
                                                11,
                                                "Pause"
                                            ],
                                            [
                                                8,
                                                0
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        1379539200079839,
                                        false, [
                                            [
                                                4,
                                                18
                                            ]
                                        ]
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.acts.SimulateControl,
                                        "Platform",
                                        6371530019319863,
                                        false, [
                                            [
                                                3,
                                                2
                                            ]
                                        ]
                                    ],
                                    [
                                        43,
                                        cr.plugins_.Audio.prototype.acts.Play,
                                        null,
                                        4972412613781404,
                                        false, [
                                            [
                                                2, ["146726__fins__jumping", false]
                                            ],
                                            [
                                                3,
                                                0
                                            ],
                                            [
                                                0, [
                                                    0, -10
                                                ]
                                            ],
                                            [
                                                1, [
                                                    2,
                                                    "Jump"
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                8139949994466842, [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.cnds.IsOnFloor,
                                        "Platform",
                                        0,
                                        false,
                                        true,
                                        false,
                                        9117147533581715,
                                        false
                                    ],
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        2194085994177487,
                                        false, [
                                            [
                                                10,
                                                1
                                            ],
                                            [
                                                8,
                                                4
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        140425238009861,
                                        false, [
                                            [
                                                10,
                                                3
                                            ],
                                            [
                                                8,
                                                2
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ]
                                ],
                                [],
                                [
                                    [
                                        0,
                                        null,
                                        false,
                                        null,
                                        2903650820167813, [
                                            [
                                                21,
                                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                                null,
                                                0,
                                                false,
                                                false,
                                                false,
                                                8679845050758196,
                                                false, [
                                                    [
                                                        10,
                                                        4
                                                    ],
                                                    [
                                                        8,
                                                        1
                                                    ],
                                                    [
                                                        7, [
                                                            2,
                                                            "jetpackready"
                                                        ]
                                                    ]
                                                ]
                                            ],
                                            [
                                                22,
                                                cr.plugins_.Touch.prototype.cnds.IsInTouch,
                                                null,
                                                0,
                                                false,
                                                false,
                                                false,
                                                2908631751821253,
                                                false
                                            ]
                                        ],
                                        [
                                            [
                                                21,
                                                cr.behaviors.Platform.prototype.acts.SetVectorY,
                                                "Platform",
                                                9994373083207452,
                                                false, [
                                                    [
                                                        0, [
                                                            5, [
                                                                22,
                                                                21,
                                                                "Platform",
                                                                cr.behaviors.Platform.prototype.exps.VectorY,
                                                                false,
                                                                null
                                                            ],
                                                            [
                                                                6, [
                                                                    0,
                                                                    27
                                                                ],
                                                                [
                                                                    6, [
                                                                        19,
                                                                        cr.system_object.prototype.exps.dt
                                                                    ],
                                                                    [
                                                                        0,
                                                                        60
                                                                    ]
                                                                ]
                                                            ]
                                                        ]
                                                    ]
                                                ]
                                            ],
                                            [
                                                21,
                                                cr.plugins_.Sprite.prototype.acts.SubInstanceVar,
                                                null,
                                                2816113899074211,
                                                false, [
                                                    [
                                                        10,
                                                        1
                                                    ],
                                                    [
                                                        7, [
                                                            0,
                                                            1
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        0,
                                        null,
                                        false,
                                        null,
                                        5388064592908048, [
                                            [
                                                22,
                                                cr.plugins_.Touch.prototype.cnds.IsInTouch,
                                                null,
                                                0,
                                                false,
                                                true,
                                                false,
                                                6026451021131008,
                                                false
                                            ],
                                            [
                                                21,
                                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                                null,
                                                0,
                                                false,
                                                false,
                                                false,
                                                3633704374631379,
                                                false, [
                                                    [
                                                        10,
                                                        4
                                                    ],
                                                    [
                                                        8,
                                                        1
                                                    ],
                                                    [
                                                        7, [
                                                            2,
                                                            "jetpackready"
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ],
                                        [
                                            [
                                                21,
                                                cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                                null,
                                                3730035883456167,
                                                false, [
                                                    [
                                                        10,
                                                        1
                                                    ],
                                                    [
                                                        7, [
                                                            0,
                                                            0
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0, [false, "Double Jump"],
                        false,
                        null,
                        8736266877693146, [
                            [-1,
                                cr.system_object.prototype.cnds.IsGroupActive,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8736266877693146,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Double Jump"
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [],
                        [
                            [
                                0,
                                null,
                                false,
                                null,
                                3661037495195026, [
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.OnTouchStart,
                                        null,
                                        1,
                                        false,
                                        false,
                                        false,
                                        3170980667167239,
                                        false
                                    ],
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        6019478713579168,
                                        false, [
                                            [
                                                10,
                                                1
                                            ],
                                            [
                                                8,
                                                0
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    1
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.cnds.IsOnFloor,
                                        "Platform",
                                        0,
                                        false,
                                        true,
                                        false,
                                        5734774844906099,
                                        false
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.acts.SetVectorY,
                                        "Platform",
                                        856810357597612,
                                        false, [
                                            [
                                                0, [
                                                    0, -800
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        43,
                                        cr.plugins_.Audio.prototype.acts.Play,
                                        null,
                                        4376565119586996,
                                        false, [
                                            [
                                                2, ["146726__fins__jumping", false]
                                            ],
                                            [
                                                3,
                                                0
                                            ],
                                            [
                                                0, [
                                                    0, -10
                                                ]
                                            ],
                                            [
                                                1, [
                                                    2,
                                                    "Jump"
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                4742672866949348, [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.cnds.OnLand,
                                        "Platform",
                                        1,
                                        false,
                                        false,
                                        false,
                                        7981026056420199,
                                        false
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                        null,
                                        17291636436336,
                                        false, [
                                            [
                                                10,
                                                1
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                5737449223161611, [
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.OnTouchStart,
                                        null,
                                        1,
                                        false,
                                        false,
                                        false,
                                        1638567371480211,
                                        false
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        2526471677156064,
                                        false, [
                                            [
                                                4,
                                                40
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.cnds.CompareVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        8663347729582484,
                                        false, [
                                            [
                                                11,
                                                "Pause"
                                            ],
                                            [
                                                8,
                                                0
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        3850886370220651,
                                        false, [
                                            [
                                                4,
                                                18
                                            ]
                                        ]
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.acts.SimulateControl,
                                        "Platform",
                                        6979081121595467,
                                        false, [
                                            [
                                                3,
                                                2
                                            ]
                                        ]
                                    ],
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.acts.AddInstanceVar,
                                        null,
                                        1229883346818744,
                                        false, [
                                            [
                                                10,
                                                1
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    1
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        43,
                                        cr.plugins_.Audio.prototype.acts.Play,
                                        null,
                                        7098526233872487,
                                        false, [
                                            [
                                                2, ["146726__fins__jumping", false]
                                            ],
                                            [
                                                3,
                                                0
                                            ],
                                            [
                                                0, [
                                                    0, -10
                                                ]
                                            ],
                                            [
                                                1, [
                                                    2,
                                                    "Jump"
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0, [false, "Bunny Jump"],
                        false,
                        null,
                        7863316860226915, [
                            [-1,
                                cr.system_object.prototype.cnds.IsGroupActive,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7863316860226915,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Bunny Jump"
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [],
                        [
                            [
                                0,
                                null,
                                false,
                                null,
                                9436312008013704, [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.cnds.IsOnFloor,
                                        "Platform",
                                        0,
                                        false,
                                        false,
                                        false,
                                        6974630868356954,
                                        false
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsInTouch,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        2355541186316087,
                                        false
                                    ],
                                    [-1,
                                        cr.system_object.prototype.cnds.CompareVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        23931474293814,
                                        false, [
                                            [
                                                11,
                                                "Pause"
                                            ],
                                            [
                                                8,
                                                0
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        1302731302116031,
                                        false, [
                                            [
                                                4,
                                                18
                                            ]
                                        ]
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.acts.SetVectorY,
                                        "Platform",
                                        7425904532295304,
                                        false, [
                                            [
                                                0, [
                                                    0, -800
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        43,
                                        cr.plugins_.Audio.prototype.acts.Play,
                                        null,
                                        121056270654412,
                                        false, [
                                            [
                                                2, ["146726__fins__jumping", false]
                                            ],
                                            [
                                                3,
                                                0
                                            ],
                                            [
                                                0, [
                                                    0, -10
                                                ]
                                            ],
                                            [
                                                1, [
                                                    2,
                                                    "Jump"
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                4893626343172264, [
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsInTouch,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        7657099029411479,
                                        false
                                    ],
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.cnds.IsOnFloor,
                                        "Platform",
                                        0,
                                        false,
                                        true,
                                        false,
                                        2039966519722443,
                                        false
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.acts.SetVectorY,
                                        "Platform",
                                        9425053934940172,
                                        false, [
                                            [
                                                0, [
                                                    0,
                                                    800
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0, [false, "Charged Jump"],
                        false,
                        null,
                        7639824337550844, [
                            [-1,
                                cr.system_object.prototype.cnds.IsGroupActive,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7639824337550844,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Charged Jump"
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [],
                        [
                            [
                                0,
                                null,
                                false,
                                null,
                                4019336668381012, [
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.OnTouchStart,
                                        null,
                                        1,
                                        false,
                                        false,
                                        false,
                                        7156690262667997,
                                        false
                                    ],
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.cnds.IsOnFloor,
                                        "Platform",
                                        0,
                                        false,
                                        true,
                                        false,
                                        4920294622766842,
                                        false
                                    ],
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        8620268975843797,
                                        false, [
                                            [
                                                10,
                                                5
                                            ],
                                            [
                                                8,
                                                0
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.acts.SetEnabled,
                                        "Platform",
                                        2518679387581258,
                                        false, [
                                            [
                                                3,
                                                0
                                            ]
                                        ]
                                    ],
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                        null,
                                        7502652280174429,
                                        false, [
                                            [
                                                10,
                                                5
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    1
                                                ]
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.acts.AddVar,
                                        null,
                                        2763386891373849,
                                        false, [
                                            [
                                                11,
                                                "Difficulty"
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    200
                                                ]
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.acts.Wait,
                                        null,
                                        952633633562081,
                                        false, [
                                            [
                                                0, [
                                                    1,
                                                    0.7
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.acts.SetEnabled,
                                        "Platform",
                                        2676494014961402,
                                        false, [
                                            [
                                                3,
                                                1
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.acts.SubVar,
                                        null,
                                        715867609492525,
                                        false, [
                                            [
                                                11,
                                                "Difficulty"
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    200
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                8306230553076912, [
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.OnTouchStart,
                                        null,
                                        1,
                                        false,
                                        false,
                                        false,
                                        2217416747894412,
                                        false
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        9044794565485191,
                                        false, [
                                            [
                                                4,
                                                40
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.cnds.CompareVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        5141522517188677,
                                        false, [
                                            [
                                                11,
                                                "Pause"
                                            ],
                                            [
                                                8,
                                                0
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        6891497751634458,
                                        false, [
                                            [
                                                4,
                                                18
                                            ]
                                        ]
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.acts.SimulateControl,
                                        "Platform",
                                        8311999467889757,
                                        false, [
                                            [
                                                3,
                                                2
                                            ]
                                        ]
                                    ],
                                    [
                                        43,
                                        cr.plugins_.Audio.prototype.acts.Play,
                                        null,
                                        4869496202346311,
                                        false, [
                                            [
                                                2, ["146726__fins__jumping", false]
                                            ],
                                            [
                                                3,
                                                0
                                            ],
                                            [
                                                0, [
                                                    0, -10
                                                ]
                                            ],
                                            [
                                                1, [
                                                    2,
                                                    "Jump"
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                4910717953445049, [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.cnds.OnLand,
                                        "Platform",
                                        1,
                                        false,
                                        false,
                                        false,
                                        3210059586577916,
                                        false
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                        null,
                                        1794051747869398,
                                        false, [
                                            [
                                                10,
                                                5
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0, [false, "Flying"],
                        false,
                        null,
                        3402712149644818, [
                            [-1,
                                cr.system_object.prototype.cnds.IsGroupActive,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3402712149644818,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Flying"
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [],
                        [
                            [
                                0,
                                null,
                                false,
                                null,
                                5422627619125306, [
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.OnTouchStart,
                                        null,
                                        1,
                                        false,
                                        false,
                                        false,
                                        296520411746433,
                                        false
                                    ],
                                    [
                                        21,
                                        cr.plugins_.Sprite.prototype.cnds.CompareY,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        6014310103444736,
                                        false, [
                                            [
                                                8,
                                                4
                                            ],
                                            [
                                                0, [
                                                    0,
                                                    20
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        2814638953566088,
                                        false, [
                                            [
                                                4,
                                                40
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.cnds.CompareVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        6464079326640599,
                                        false, [
                                            [
                                                11,
                                                "Pause"
                                            ],
                                            [
                                                8,
                                                0
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        4733311855808937,
                                        false, [
                                            [
                                                4,
                                                18
                                            ]
                                        ]
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.acts.SetVectorY,
                                        "Platform",
                                        1504233686651195,
                                        false, [
                                            [
                                                0, [
                                                    0, -650
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        43,
                                        cr.plugins_.Audio.prototype.acts.Play,
                                        null,
                                        4750774423131549,
                                        false, [
                                            [
                                                2, ["146726__fins__jumping", false]
                                            ],
                                            [
                                                3,
                                                0
                                            ],
                                            [
                                                0, [
                                                    0, -10
                                                ]
                                            ],
                                            [
                                                1, [
                                                    2,
                                                    "Jump"
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0, [false, "Jump"],
                        false,
                        null,
                        3171039140992277, [
                            [-1,
                                cr.system_object.prototype.cnds.IsGroupActive,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3171039140992277,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Jump"
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [],
                        [
                            [
                                0,
                                null,
                                false,
                                null,
                                6242927817845761, [
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.OnTouchStart,
                                        null,
                                        1,
                                        false,
                                        false,
                                        false,
                                        6545797571413511,
                                        false
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        5681305699067029,
                                        false, [
                                            [
                                                4,
                                                40
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.cnds.CompareVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        5315495551539073,
                                        false, [
                                            [
                                                11,
                                                "Pause"
                                            ],
                                            [
                                                8,
                                                0
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        22,
                                        cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                        null,
                                        0,
                                        false,
                                        true,
                                        false,
                                        3516582876495661,
                                        false, [
                                            [
                                                4,
                                                18
                                            ]
                                        ]
                                    ]
                                ],
                                [
                                    [
                                        21,
                                        cr.behaviors.Platform.prototype.acts.SimulateControl,
                                        "Platform",
                                        1689986233668918,
                                        false, [
                                            [
                                                3,
                                                2
                                            ]
                                        ]
                                    ],
                                    [
                                        43,
                                        cr.plugins_.Audio.prototype.acts.Play,
                                        null,
                                        7964201453766949,
                                        false, [
                                            [
                                                2, ["146726__fins__jumping", false]
                                            ],
                                            [
                                                3,
                                                0
                                            ],
                                            [
                                                0, [
                                                    0, -10
                                                ]
                                            ],
                                            [
                                                1, [
                                                    2,
                                                    "Jump"
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4230518904935294, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2712748466511967,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9945584006323619,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                2487357830586681,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Jump"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        9113783755261258, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                4236713994233061,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3968952227312833,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                249632655113749,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Bunny Jump"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1281087518940957, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                8165249908219322,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2222922532294138,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                3941031396095003,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Controlled Jump"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1014059326105607, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                5614562989325905,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8172921200710249,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                9309965696133005,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Double Jump"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        3008772154792219, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2684903500497491,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8880972070626899,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                4869738109325169,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Charged Jump"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        9244466509271811, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                4650531008849758,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5652194073053424,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.SetGroupActive,
                                null,
                                5809352744994768,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Flying"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        7610036957674027, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2280457280131431,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1135641617095222,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                1,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                370789654003335,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0, -100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                6,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                7906524392251705,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            300
                                        ]
                                    ]
                                ]
                            ],
                            [
                                12,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                1970969954247217,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            500
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        2244939929803327, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                7017551464964731,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5486661944127103,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                0,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                4437073519422946,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0, -100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                7,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                5815525832547318,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0, -100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                13,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                8628736564679371,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            450
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8717577869993133, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                4992939938445831,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8261546654132999,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                2,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                3144763253075182,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                8,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                6344209603926245,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            150
                                        ]
                                    ]
                                ]
                            ],
                            [
                                14,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                3896216116706824,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            500
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8536097930231781, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                5456764385388709,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9986767199488709,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                3,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                4612759362566293,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0, -100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                9,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                7272023795815183,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            150
                                        ]
                                    ]
                                ]
                            ],
                            [
                                15,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                4593744432318582,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            450
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1869436677967525, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2532837859659051,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                675812203808202,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                4,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                626163588603803,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0, -100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                10,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                2392739883456008,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            140
                                        ]
                                    ]
                                ]
                            ],
                            [
                                16,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                616186473812827,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            450
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        650596320928532, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                1571644255027349,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5201554660433372,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                5,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                6680001548096232,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0, -50
                                        ]
                                    ]
                                ]
                            ],
                            [
                                11,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                4081029659215339,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            200
                                        ]
                                    ]
                                ]
                            ],
                            [
                                17,
                                cr.plugins_.TiledBg.prototype.acts.SetPos,
                                null,
                                5318711121196256,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            480
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        6276366630402889, [
                            [-1,
                                cr.system_object.prototype.cnds.Every,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3330829384834094,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1559268737795179,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8317066028018679,
                                false, [
                                    [
                                        11,
                                        "Adventure"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                4189266294877045,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.SubVar,
                                null,
                                3206202578549002,
                                false, [
                                    [
                                        11,
                                        "DistancePlayer"
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8240961565599944, [
                            [-1,
                                cr.system_object.prototype.cnds.Every,
                                null,
                                0,
                                false,
                                false,
                                false,
                                4022662637334435,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7784118169848721,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3641206788019604,
                                false, [
                                    [
                                        11,
                                        "Adventure"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8831012186092367,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.AddVar,
                                null,
                                89548260497683,
                                false, [
                                    [
                                        11,
                                        "Endless"
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                36,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                2645431809066346,
                                false, [
                                    [
                                        7, [
                                            23,
                                            "Endless"
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        3338776636822407, [
                            [
                                33,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                1835822794814257,
                                false
                            ]
                        ],
                        [
                            [
                                33,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                1573338045709005,
                                false, [
                                    [
                                        0, [
                                            23,
                                            "PlayerFame"
                                        ]
                                    ]
                                ]
                            ],
                            [
                                33,
                                cr.behaviors.Platform.prototype.acts.SetVectorY,
                                "Platform",
                                821117314059923,
                                false, [
                                    [
                                        0, [
                                            0, -700
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        9633141695685752, [
                            [
                                63,
                                cr.plugins_.TiledBg.prototype.cnds.CompareX,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9456243054205028,
                                false, [
                                    [
                                        8,
                                        3
                                    ],
                                    [
                                        0, [
                                            7, [
                                                3, [
                                                    20,
                                                    63,
                                                    cr.plugins_.TiledBg.prototype.exps.Width,
                                                    false,
                                                    null
                                                ]
                                            ],
                                            [
                                                0,
                                                2
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                63,
                                cr.plugins_.TiledBg.prototype.cnds.IsVisible,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9843660138242908,
                                false
                            ]
                        ],
                        [
                            [
                                63,
                                cr.plugins_.TiledBg.prototype.acts.SetX,
                                null,
                                992400526499619,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                20,
                                                63,
                                                cr.plugins_.TiledBg.prototype.exps.X,
                                                false,
                                                null
                                            ],
                                            [
                                                7, [
                                                    20,
                                                    63,
                                                    cr.plugins_.TiledBg.prototype.exps.Width,
                                                    false,
                                                    null
                                                ],
                                                [
                                                    0,
                                                    2
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        3335296795952114, [
                            [
                                62,
                                cr.plugins_.TiledBg.prototype.cnds.CompareX,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2464782162248488,
                                false, [
                                    [
                                        8,
                                        3
                                    ],
                                    [
                                        0, [
                                            7, [
                                                3, [
                                                    20,
                                                    62,
                                                    cr.plugins_.TiledBg.prototype.exps.Width,
                                                    false,
                                                    null
                                                ]
                                            ],
                                            [
                                                0,
                                                2
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                62,
                                cr.plugins_.TiledBg.prototype.cnds.IsVisible,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6329764221811338,
                                false
                            ]
                        ],
                        [
                            [
                                62,
                                cr.plugins_.TiledBg.prototype.acts.SetX,
                                null,
                                1527338739850948,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                20,
                                                62,
                                                cr.plugins_.TiledBg.prototype.exps.X,
                                                false,
                                                null
                                            ],
                                            [
                                                7, [
                                                    20,
                                                    62,
                                                    cr.plugins_.TiledBg.prototype.exps.Width,
                                                    false,
                                                    null
                                                ],
                                                [
                                                    0,
                                                    2
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        3563455538348265, [
                            [
                                64,
                                cr.plugins_.TiledBg.prototype.cnds.CompareX,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9780008135541569,
                                false, [
                                    [
                                        8,
                                        3
                                    ],
                                    [
                                        0, [
                                            7, [
                                                3, [
                                                    20,
                                                    64,
                                                    cr.plugins_.TiledBg.prototype.exps.Width,
                                                    false,
                                                    null
                                                ]
                                            ],
                                            [
                                                0,
                                                2
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                64,
                                cr.plugins_.TiledBg.prototype.cnds.IsVisible,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8461246296819163,
                                false
                            ]
                        ],
                        [
                            [
                                64,
                                cr.plugins_.TiledBg.prototype.acts.SetX,
                                null,
                                8712855552614451,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                20,
                                                64,
                                                cr.plugins_.TiledBg.prototype.exps.X,
                                                false,
                                                null
                                            ],
                                            [
                                                7, [
                                                    20,
                                                    64,
                                                    cr.plugins_.TiledBg.prototype.exps.Width,
                                                    false,
                                                    null
                                                ],
                                                [
                                                    0,
                                                    2
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        6411571443467004, [
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                4923568401742249,
                                false, [
                                    [
                                        11,
                                        "DistancePlayer"
                                    ],
                                    [
                                        8,
                                        3
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.TriggerOnce,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5475929409586009,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                4668618202399566,
                                false, [
                                    [
                                        11,
                                        "Adventure"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                21,
                                cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                null,
                                4342728798176905,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                43,
                                cr.plugins_.Audio.prototype.acts.Play,
                                null,
                                2252728929483203,
                                false, [
                                    [
                                        2, ["ta da-soundbible.com-1884170640", false]
                                    ],
                                    [
                                        3,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        1, [
                                            2,
                                            "Tada"
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                9444707404195456,
                                false, [
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                54,
                                cr.plugins_.pix_spilgames.prototype.acts.requestGameBreak,
                                null,
                                4853876148642933,
                                false
                            ],
                            [
                                43,
                                cr.plugins_.Audio.prototype.acts.SetSilent,
                                null,
                                230942882042331,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                3554321663899222,
                                false, [
                                    [
                                        4,
                                        41
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            600
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            350
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                2593964180523289,
                                false, [
                                    [
                                        4,
                                        18
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                7259335009931771,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                9485943689917897,
                                false, [
                                    [
                                        4,
                                        18
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                3209413820311282,
                                false, [
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                6199666122664952,
                                false, [
                                    [
                                        4,
                                        18
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                4709119376303163,
                                false, [
                                    [
                                        0, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                8522953123915367,
                                false, [
                                    [
                                        0, [
                                            1,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                9356315005385394,
                                false, [
                                    [
                                        4,
                                        38
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                1172430036979135,
                                false, [
                                    [
                                        0, [
                                            1,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                2064209463245547,
                                false, [
                                    [
                                        4,
                                        38
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                8299567642833138,
                                false, [
                                    [
                                        0, [
                                            1,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                8130551237573967,
                                false, [
                                    [
                                        4,
                                        38
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                0,
                                null,
                                false,
                                null,
                                8513361555264679, [
                                    [-1,
                                        cr.system_object.prototype.cnds.EveryTick,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        6083348700373711,
                                        false
                                    ]
                                ],
                                [
                                    [-1,
                                        cr.system_object.prototype.acts.SetVar,
                                        null,
                                        8997276230035785,
                                        false, [
                                            [
                                                11,
                                                "DistancePlayer"
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    0
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                7307168549975507, [
                                    [-1,
                                        cr.system_object.prototype.cnds.CompareVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        6757948674048387,
                                        false, [
                                            [
                                                11,
                                                "MaxLevel"
                                            ],
                                            [
                                                8,
                                                0
                                            ],
                                            [
                                                7, [
                                                    23,
                                                    "PlayerFame"
                                                ]
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.cnds.CompareVar,
                                        null,
                                        0,
                                        false,
                                        false,
                                        false,
                                        9696862165413697,
                                        false, [
                                            [
                                                11,
                                                "MaxLevel"
                                            ],
                                            [
                                                8,
                                                3
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    5
                                                ]
                                            ]
                                        ]
                                    ]
                                ],
                                [
                                    [-1,
                                        cr.system_object.prototype.acts.AddVar,
                                        null,
                                        6931087062745633,
                                        false, [
                                            [
                                                11,
                                                "MaxLevel"
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    1
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        47,
                                        cr.plugins_.WebStorage.prototype.acts.StoreLocal,
                                        null,
                                        1787281748377779,
                                        false, [
                                            [
                                                1, [
                                                    2,
                                                    "Level"
                                                ]
                                            ],
                                            [
                                                7, [
                                                    23,
                                                    "MaxLevel"
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4253565791821539, [
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3658804300510929,
                                false, [
                                    [
                                        11,
                                        "DistancePlayer"
                                    ],
                                    [
                                        8,
                                        3
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.TriggerOnce,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7455446898297202,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8780968738194425,
                                false, [
                                    [
                                        11,
                                        "Adventure"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7142627912564876,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                21,
                                cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                null,
                                5294954617282851,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                43,
                                cr.plugins_.Audio.prototype.acts.Play,
                                null,
                                7772003347280004,
                                false, [
                                    [
                                        2, ["ta da-soundbible.com-1884170640", false]
                                    ],
                                    [
                                        3,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        1, [
                                            2,
                                            "Tada"
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                4971181858302113,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                2526239976704333,
                                false, [
                                    [
                                        11,
                                        "Ending"
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                7836000634055563,
                                false, [
                                    [
                                        6,
                                        "Comic"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        7936122135300898, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                152962331227771,
                                false, [
                                    [
                                        4,
                                        40
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                8587344075720053,
                                false, [
                                    [
                                        4,
                                        41
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            600
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            350
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                5682363309525726,
                                false, [
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                6065021893261849,
                                false, [
                                    [
                                        4,
                                        18
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                4491361884487054,
                                false, [
                                    [
                                        0, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                2239270330350441,
                                false, [
                                    [
                                        4,
                                        18
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                6566317384370132,
                                false, [
                                    [
                                        0, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                7660656560881264,
                                false, [
                                    [
                                        4,
                                        18
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                5967466127381619,
                                false, [
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                62,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet2",
                                6022651300981402,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                63,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet2",
                                3765965488319783,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                64,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet2",
                                8021733105942768,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                30,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                6390440093449647,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                6049086039162795,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                25,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                930433430330514,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                34,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                8780427897408604,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                31,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                1421661168749121,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                29,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                6432861378870423,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                26,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                8363323156528616,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                52,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                440827766183416,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                32,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                2172667318810296,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                3551529735838871,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.behaviors.Sin.prototype.acts.SetActive,
                                "Sine2",
                                5996555972924814,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.acts.StopAnim,
                                null,
                                7513393493760249,
                                false
                            ],
                            [
                                21,
                                cr.behaviors.Platform.prototype.acts.SetEnabled,
                                "Platform",
                                1031810915849625,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        3512300441514124, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                1826148021544758,
                                false, [
                                    [
                                        4,
                                        18
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9718410853552695,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                2716584390682834,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                818069671355162,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                41,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                2250500179182664,
                                false
                            ],
                            [
                                71,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                4693113353709758,
                                false
                            ],
                            [
                                21,
                                cr.behaviors.Sin.prototype.acts.SetActive,
                                "Sine2",
                                2851824072773631,
                                false, [
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.acts.StartAnim,
                                null,
                                9848105079011399,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.behaviors.Platform.prototype.acts.SetEnabled,
                                "Platform",
                                391337318366374,
                                false, [
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        5360123077023065, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                3107951580113965,
                                false, [
                                    [
                                        4,
                                        18
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                896682845791145,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                131647835102614,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                5946473243388077,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                43,
                                cr.plugins_.Audio.prototype.acts.SetSilent,
                                null,
                                6263711463927439,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        7658018157810159, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                6983706586965356,
                                false, [
                                    [
                                        4,
                                        18
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                999063704662548,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                32773060664941,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                7426275067197883,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                43,
                                cr.plugins_.Audio.prototype.acts.SetSilent,
                                null,
                                164259814925755,
                                false, [
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4464632578965825, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                9980842437869731,
                                false, [
                                    [
                                        4,
                                        18
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9873546019573598,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                5722231993974089,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                5379859251938414,
                                false, [
                                    [
                                        6,
                                        "Menu"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1849794683439366, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                6566751258835517,
                                false, [
                                    [
                                        4,
                                        18
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                369749699189731,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                2335217943805751,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.RestartLayout,
                                null,
                                8479636593999662,
                                false
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8780663540548931, [
                            [
                                30,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2931124545463276,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9440969061028716,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                30,
                                cr.plugins_.Sprite.prototype.acts.SetAnim,
                                null,
                                4143420884745745,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Savanna"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        7436187435446116, [
                            [
                                30,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                7866270338189348,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7088422656952173,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                30,
                                cr.plugins_.Sprite.prototype.acts.SetAnim,
                                null,
                                8273196947287127,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Savanna"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        2694267967324827, [
                            [
                                30,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                7772548297637138,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                728838991692552,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                30,
                                cr.plugins_.Sprite.prototype.acts.SetAnim,
                                null,
                                4644990858992298,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Mountain"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        3356348133011376, [
                            [
                                30,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                6539443943415836,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                132935660649421,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                30,
                                cr.plugins_.Sprite.prototype.acts.SetAnim,
                                null,
                                8395540457128776,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Mountain"
                                        ]
                                    ],
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        687262393762631, [
                            [
                                30,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                1171326593411051,
                                false
                            ]
                        ],
                        [
                            [
                                30,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet",
                                7226890448026069,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        7608708316816562, [
                            [
                                23,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                9832776321212617,
                                false
                            ]
                        ],
                        [
                            [
                                23,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                4232210936748088,
                                false, [
                                    [
                                        0, [
                                            19,
                                            cr.system_object.prototype.exps.random, [
                                                [
                                                    0,
                                                    0
                                                ],
                                                [
                                                    0,
                                                    3
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8501208893472195, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3171989706820032,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3732584639128215,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                62,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet2",
                                2296762140797805,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                100
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                63,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet2",
                                3304019391289135,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                200
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                64,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet2",
                                5851841472080748,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                500
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                30,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                501933143838964,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                800
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                23,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                5306555236498336,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                500
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                25,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                9780340354682878,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                500
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                34,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                8016494046955027,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                500
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                31,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                6613395531827434,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                700
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                29,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                2740360247677902,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                500
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                26,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                1997032870794043,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                500
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                52,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                6455015268295668,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                800
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                32,
                                cr.behaviors.Bullet.prototype.acts.SetSpeed,
                                "Bullet",
                                3417259922554004,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                0,
                                                600
                                            ],
                                            [
                                                23,
                                                "Difficulty"
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        5824109946230281, [
                            [-1,
                                cr.system_object.prototype.cnds.Every,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6371841466048936,
                                false, [
                                    [
                                        0, [
                                            1,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9864207455469529,
                                false, [
                                    [
                                        11,
                                        "Pause"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.AddVar,
                                null,
                                263535748950201,
                                false, [
                                    [
                                        11,
                                        "Difficulty"
                                    ],
                                    [
                                        7, [
                                            0,
                                            7
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        5910691770313806, [
                            [
                                34,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                6119704381166936,
                                false
                            ]
                        ],
                        [
                            [
                                34,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet",
                                3368487337570116,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8452496677491288, [
                            [
                                61,
                                cr.plugins_.Sprite.prototype.cnds.CompareX,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9276726807050871,
                                false, [
                                    [
                                        8,
                                        2
                                    ],
                                    [
                                        0, [
                                            0, -500
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                61,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                1408340013549449,
                                false
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4388222399753841, [
                            [
                                29,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                8180666934819742,
                                false
                            ]
                        ],
                        [
                            [
                                29,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet",
                                4472391110035345,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        2220191944178425, [
                            [
                                29,
                                cr.plugins_.Sprite.prototype.cnds.IsOverlapping,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2609499685417189,
                                false, [
                                    [
                                        4,
                                        34
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                29,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                564910948299267,
                                false
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        6206297081441025, [
                            [
                                52,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                8423375388302059,
                                false
                            ]
                        ],
                        [
                            [
                                52,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet",
                                2022752743451219,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4894985694439604, [
                            [
                                32,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                9280281754671784,
                                false
                            ]
                        ],
                        [
                            [
                                32,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet",
                                5039169373175807,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        516238951628337, [
                            [
                                31,
                                cr.plugins_.Sprite.prototype.cnds.OnCreated,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2775643780312379,
                                false
                            ]
                        ],
                        [
                            [
                                31,
                                cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,
                                "Bullet",
                                7306459225898193,
                                false, [
                                    [
                                        0, [
                                            0,
                                            180
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        2017026423431776, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2177891229394877,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7381040577850427,
                                false, [
                                    [
                                        11,
                                        "Adventure"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                35,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                2495988331390676,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                35,
                                cr.plugins_.Sprite.prototype.acts.Spawn,
                                null,
                                8820387606293779,
                                false, [
                                    [
                                        4,
                                        46
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                46,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                5652554657772764,
                                false, [
                                    [
                                        7, [
                                            20,
                                            48,
                                            cr.plugins_.Arr.prototype.exps.At,
                                            false,
                                            null, [
                                                [
                                                    0,
                                                    4
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                46,
                                cr.plugins_.Text.prototype.acts.SetOpacity,
                                null,
                                7625812215617338,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                36,
                                cr.plugins_.Text.prototype.acts.SetPosToObject,
                                null,
                                8950848104554717,
                                false, [
                                    [
                                        4,
                                        35
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                59,
                                cr.plugins_.TiledBg.prototype.acts.Destroy,
                                null,
                                9122852095171216,
                                false
                            ],
                            [
                                40,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                7453405751661364,
                                false, [
                                    [
                                        4,
                                        35
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                8112107971131275,
                                false, [
                                    [
                                        4,
                                        35
                                    ],
                                    [
                                        7, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1373356622402021, [
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                4814477943950677,
                                false, [
                                    [
                                        11,
                                        "Endless"
                                    ],
                                    [
                                        8,
                                        4
                                    ],
                                    [
                                        7, [
                                            20,
                                            48,
                                            cr.plugins_.Arr.prototype.exps.At,
                                            false,
                                            null, [
                                                [
                                                    0,
                                                    4
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.TriggerOnce,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9771776108193872,
                                false
                            ],
                            [
                                48,
                                cr.plugins_.Arr.prototype.cnds.CompareX,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3208146864419644,
                                false, [
                                    [
                                        0, [
                                            0,
                                            4
                                        ]
                                    ],
                                    [
                                        8,
                                        1
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                43,
                                cr.plugins_.Audio.prototype.acts.Play,
                                null,
                                5008009176684039,
                                false, [
                                    [
                                        2, ["ta da-soundbible.com-1884170640", false]
                                    ],
                                    [
                                        3,
                                        0
                                    ],
                                    [
                                        0, [
                                            0, -5
                                        ]
                                    ],
                                    [
                                        1, [
                                            2,
                                            "Tada2"
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        6408782356745412, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                1888872986269803,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3111081276816287,
                                false, [
                                    [
                                        11,
                                        "Adventure"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                9158030298401418,
                                false, [
                                    [
                                        4,
                                        35
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                36,
                                cr.plugins_.Text.prototype.acts.Destroy,
                                null,
                                4310704963181048,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetInstanceVar,
                                null,
                                5177204922603575,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        7, [
                                            20,
                                            27,
                                            cr.plugins_.Sprite.prototype.exps.X,
                                            false,
                                            null
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                6886479517118295,
                                false, [
                                    [
                                        0, [
                                            23,
                                            "PlayerFame"
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                4330873871120239,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                59,
                                cr.plugins_.TiledBg.prototype.acts.SetPosToObject,
                                null,
                                9299199665723492,
                                false, [
                                    [
                                        4,
                                        35
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        2849447224345362, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3459098169452345,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9653408908789007,
                                false, [
                                    [
                                        11,
                                        "Adventure"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetX,
                                null,
                                2169794640180529,
                                false, [
                                    [
                                        0, [
                                            5, [
                                                21,
                                                27,
                                                false,
                                                null, 0
                                            ],
                                            [
                                                5, [
                                                    7, [
                                                        23,
                                                        "DistancePlayer"
                                                    ],
                                                    [
                                                        0,
                                                        2
                                                    ]
                                                ],
                                                [
                                                    0,
                                                    300
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                59,
                                cr.plugins_.TiledBg.prototype.acts.SetWidth,
                                null,
                                3683338333656978,
                                false, [
                                    [
                                        0, [
                                            5, [
                                                0,
                                                300
                                            ],
                                            [
                                                7, [
                                                    23,
                                                    "DistancePlayer"
                                                ],
                                                [
                                                    0,
                                                    2
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8267907578667606, [
                            [
                                54,
                                cr.plugins_.pix_spilgames.prototype.cnds.pauseGame,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2753677135461874,
                                false
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.SetTimescale,
                                null,
                                5018637976527288,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        898460205079752, [
                            [
                                54,
                                cr.plugins_.pix_spilgames.prototype.cnds.resumeGame,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2493277256238428,
                                false
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.SetTimescale,
                                null,
                                9345330818359623,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1541869915203757, [
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8922508622130397,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                18,
                                cr.behaviors.Sin.prototype.acts.SetActive,
                                "Sine",
                                9234156850244097,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        2860746353732922, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                5999177477457874,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1176339458962911,
                                false, [
                                    [
                                        11,
                                        "Adventure"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7299780495412521,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                35,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9137830288651823,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                40,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                7348012227721022,
                                false, [
                                    [
                                        4,
                                        35
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1241833600900596, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                9004320473112819,
                                false, [
                                    [
                                        4,
                                        18
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6335815829545891,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                21,
                                cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7203405619113797,
                                false, [
                                    [
                                        10,
                                        0
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                2977369265389325,
                                false, [
                                    [
                                        6,
                                        "Levels"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1390386549821365, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                8198380759047872,
                                false
                            ],
                            [
                                43,
                                cr.plugins_.Audio.prototype.cnds.IsSilent,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7364969755987562,
                                false
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6263647692448438,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                6954481197487878,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
            ],
            [
                "Menu", [
                    [
                        1,
                        "Adventure",
                        0,
                        0,
                        false, false, 1540270234126032, false
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        5497823578538828, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2397082923149382,
                                false, [
                                    [
                                        4,
                                        27
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                true,
                                false,
                                5032257745626077,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                6961438961901202,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                411623251837634,
                                false, [
                                    [
                                        11,
                                        "PlayerFame"
                                    ],
                                    [
                                        7, [
                                            20,
                                            27,
                                            cr.plugins_.Sprite.prototype.exps.AnimationFrame,
                                            false,
                                            null
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                1993794097337194,
                                false, [
                                    [
                                        6,
                                        "Comic"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        7638730175031235, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                8048858433231111,
                                false, [
                                    [
                                        4,
                                        18
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                4520139236855209,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                null,
                                0,
                                false,
                                true,
                                false,
                                320656918788166,
                                false, [
                                    [
                                        4,
                                        28
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                9204807248049509,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                322994819411657,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                43,
                                cr.plugins_.Audio.prototype.acts.SetSilent,
                                null,
                                6018024403358272,
                                false, [
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        7810419803497541, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                5528397283049133,
                                false, [
                                    [
                                        4,
                                        18
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9302323308421081,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                null,
                                0,
                                false,
                                true,
                                false,
                                4585409355993862,
                                false, [
                                    [
                                        4,
                                        28
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                7875998659345086,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                4940842328914532,
                                false, [
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                43,
                                cr.plugins_.Audio.prototype.acts.SetSilent,
                                null,
                                8547693316928283,
                                false, [
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1464165758997034, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                8007643744248246,
                                false, [
                                    [
                                        4,
                                        18
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1433155442373239,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                null,
                                0,
                                false,
                                true,
                                false,
                                2531855746974716,
                                false, [
                                    [
                                        4,
                                        28
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                1088864288419401,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.3
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                3001231236735762,
                                false
                            ],
                            [
                                20,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                1338097890681146,
                                false
                            ],
                            [
                                44,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                1086786625061744,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                60,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                7156239549305459,
                                false
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        9561002185146618, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                938654050187157,
                                false, [
                                    [
                                        4,
                                        18
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9542705026227952,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                null,
                                0,
                                false,
                                true,
                                false,
                                6965098385186337,
                                false, [
                                    [
                                        4,
                                        28
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                3893318829176697,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.CreateObject,
                                null,
                                4162653033800913,
                                false, [
                                    [
                                        4,
                                        28
                                    ],
                                    [
                                        5, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            500
                                        ]
                                    ],
                                    [
                                        0, [
                                            0,
                                            300
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        5355358835754076, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2149700169506976,
                                false, [
                                    [
                                        4,
                                        28
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                1566588234523865,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                28,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                7611638222310882,
                                false
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1222466711782429, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2178131841791097,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5472386680492246,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                800680817471846,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        3033304198170525, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2737315935531679,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5293422820870825,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                256819243330773,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                5425595390325435,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        9564695143446695, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8995887040583411,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5192261685862094,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8362680108164326,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                2921211809916848,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        7709575426829051, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2141056728263118,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3874864519118137,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6902993666530369,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                1186315080241349,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        6040878282818611, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6949763518155423,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8750767353320229,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5819234593109341,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                9100131992252309,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        5738428555840143, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3223870410499589,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1207767103299287,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3952223701363555,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                5080486369380392,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4143283256194336, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                4284854093054038,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9662390478407834,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7149145178849885,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        8,
                                        2
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                9742038147866376,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                8384204339832308,
                                false, [
                                    [
                                        0, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                1376162586335385,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        3972292238570892, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1978310587720777,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1127036612427608,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9978754079111735,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        8,
                                        2
                                    ],
                                    [
                                        7, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                4212520350481749,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                9898671498262151,
                                false, [
                                    [
                                        0, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                4832519043278505,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4683383620425585, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5363174254271622,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                4574183110678289,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                348840507360928,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        8,
                                        2
                                    ],
                                    [
                                        7, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                5187728219901964,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                2291719201759813,
                                false, [
                                    [
                                        0, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                6678167049075078,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        261618544487564, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7970205001143302,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8091329666903523,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7257559494368405,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        8,
                                        2
                                    ],
                                    [
                                        7, [
                                            0,
                                            4
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                6614527493307195,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                6914790655942212,
                                false, [
                                    [
                                        0, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                3346818682298177,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4149881948692584, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2421043256500505,
                                false
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7460128179207512,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                4415703882351294,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        8,
                                        2
                                    ],
                                    [
                                        7, [
                                            0,
                                            5
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                6474698257787426,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                3872090635420925,
                                false, [
                                    [
                                        0, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ],
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                2986521038794106,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1650435845768523, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                6904204647985332,
                                false
                            ],
                            [
                                43,
                                cr.plugins_.Audio.prototype.cnds.IsTagPlaying,
                                null,
                                0,
                                false,
                                true,
                                false,
                                2545808974714194,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "Music"
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                43,
                                cr.plugins_.Audio.prototype.acts.Play,
                                null,
                                5343737437683502,
                                false, [
                                    [
                                        2, ["monkeys spinning monkeys", false]
                                    ],
                                    [
                                        3,
                                        1
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ],
                                    [
                                        1, [
                                            2,
                                            "Music"
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4545193280838903, [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3113874610685323,
                                false, [
                                    [
                                        8,
                                        1
                                    ],
                                    [
                                        0, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                27,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                4991211196128351,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4314966775038151, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8931238560626617,
                                false, [
                                    [
                                        4,
                                        44
                                    ]
                                ]
                            ],
                            [
                                44,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8655507131166086,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                44,
                                cr.plugins_.Sprite.prototype.cnds.CompareOpacity,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1667634809444281,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                1893643623860921,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                3113980809756233,
                                false, [
                                    [
                                        6,
                                        "Levels"
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                4988037096457647,
                                false, [
                                    [
                                        11,
                                        "Adventure"
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1730129069289125, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8227653954304892,
                                false, [
                                    [
                                        4,
                                        44
                                    ]
                                ]
                            ],
                            [
                                44,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2553434994678752,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                44,
                                cr.plugins_.Sprite.prototype.cnds.CompareOpacity,
                                null,
                                0,
                                false,
                                false,
                                false,
                                3286491589225487,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                2126224624149636,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                8851660139227396,
                                false, [
                                    [
                                        6,
                                        "Levels"
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                4634848120755831,
                                false, [
                                    [
                                        11,
                                        "Adventure"
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        9611401655918113, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6488890553528125,
                                false, [
                                    [
                                        4,
                                        44
                                    ]
                                ]
                            ],
                            [
                                44,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1863988003432538,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [
                                44,
                                cr.plugins_.Sprite.prototype.cnds.CompareOpacity,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1111428741245786,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                54,
                                cr.plugins_.pix_spilgames.prototype.acts.openOutgoingLink,
                                null,
                                9799118641612987,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "more_games"
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.RestartLayout,
                                null,
                                8222398013800941,
                                false
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4805977794847112, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.IsTouchingObject,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8537783650880944,
                                false, [
                                    [
                                        4,
                                        44
                                    ]
                                ]
                            ],
                            [
                                44,
                                cr.plugins_.Sprite.prototype.cnds.CompareFrame,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5448861735263581,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                44,
                                cr.plugins_.Sprite.prototype.cnds.CompareOpacity,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7081519232225633,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                8359308165963202,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [
                                18,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                4303840072197807,
                                false
                            ],
                            [
                                45,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                7981965338508649,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                46,
                                cr.plugins_.Text.prototype.acts.SetOpacity,
                                null,
                                951955169085455,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                49,
                                cr.plugins_.Text.prototype.acts.SetOpacity,
                                null,
                                6280006916938938,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                71,
                                cr.plugins_.Sprite.prototype.acts.Destroy,
                                null,
                                5401350810005494,
                                false
                            ]
                        ],
                        [
                            [
                                1,
                                "n",
                                0,
                                4,
                                false, false, 1535277343336742, false
                            ],
                            [
                                0,
                                null,
                                false,
                                null,
                                9400286570717449, [
                                    [-1,
                                        cr.system_object.prototype.cnds.ForEach,
                                        null,
                                        0,
                                        true,
                                        false,
                                        false,
                                        6380621885804534,
                                        false, [
                                            [
                                                4,
                                                46
                                            ]
                                        ]
                                    ]
                                ],
                                [
                                    [
                                        46,
                                        cr.plugins_.Text.prototype.acts.SetText,
                                        null,
                                        9811858041886393,
                                        false, [
                                            [
                                                7, [
                                                    20,
                                                    48,
                                                    cr.plugins_.Arr.prototype.exps.At,
                                                    false,
                                                    null, [
                                                        [
                                                            23,
                                                            "n"
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ]
                                    ],
                                    [-1,
                                        cr.system_object.prototype.acts.SubVar,
                                        null,
                                        3594083464579705,
                                        false, [
                                            [
                                                11,
                                                "n"
                                            ],
                                            [
                                                7, [
                                                    0,
                                                    1
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8364030776176477, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                7682600478312876,
                                false, [
                                    [
                                        4,
                                        45
                                    ]
                                ]
                            ],
                            [
                                45,
                                cr.plugins_.Sprite.prototype.cnds.CompareOpacity,
                                null,
                                0,
                                false,
                                false,
                                false,
                                8271182484352093,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                553243629310057,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.RestartLayout,
                                null,
                                6822818580104534,
                                false
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        9593928604238623, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                8364377933105881,
                                false
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                3357282700629226,
                                false, [
                                    [
                                        11,
                                        "MaxLevel"
                                    ],
                                    [
                                        7, [
                                            19,
                                            cr.system_object.prototype.exps["int"],
                                            [
                                                [
                                                    20,
                                                    47,
                                                    cr.plugins_.WebStorage.prototype.exps.LocalValue,
                                                    true,
                                                    null, [
                                                        [
                                                            2,
                                                            "Level"
                                                        ]
                                                    ]
                                                ]
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.SetVar,
                                null,
                                2127264621358312,
                                false, [
                                    [
                                        11,
                                        "Ending"
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                55,
                                cr.plugins_.Sprite.prototype.acts.LoadURL,
                                null,
                                2576508237709618,
                                false, [
                                    [
                                        1, [
                                            20,
                                            54,
                                            cr.plugins_.pix_spilgames.prototype.exps.logoImage,
                                            true,
                                            null
                                        ]
                                    ],
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        4251903753748796, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                1648232073208521,
                                false
                            ]
                        ],
                        [
                            [
                                53,
                                cr.plugins_.Sprite.prototype.acts.SetSize,
                                null,
                                4854317627590904,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                20,
                                                19,
                                                cr.plugins_.Sprite.prototype.exps.Width,
                                                false,
                                                null
                                            ],
                                            [
                                                0,
                                                20
                                            ]
                                        ]
                                    ],
                                    [
                                        0, [
                                            4, [
                                                20,
                                                19,
                                                cr.plugins_.Sprite.prototype.exps.Height,
                                                false,
                                                null
                                            ],
                                            [
                                                0,
                                                20
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                53,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                498890687121999,
                                false, [
                                    [
                                        4,
                                        19
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                53,
                                cr.plugins_.Sprite.prototype.acts.ZMoveToObject,
                                null,
                                2062169476964726,
                                false, [
                                    [
                                        3,
                                        1
                                    ],
                                    [
                                        4,
                                        19
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8236041231549385, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                6658620201681381,
                                false, [
                                    [
                                        4,
                                        60
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                54,
                                cr.plugins_.pix_spilgames.prototype.acts.openOutgoingLink,
                                null,
                                6764046795557062,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "more_games"
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        569109442373408, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                7999803007221136,
                                false, [
                                    [
                                        4,
                                        55
                                    ]
                                ]
                            ],
                            [
                                55,
                                cr.plugins_.Sprite.prototype.cnds.CompareOpacity,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7308375753128446,
                                false, [
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                54,
                                cr.plugins_.pix_spilgames.prototype.acts.openOutgoingLink,
                                null,
                                3785239395199913,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "logo"
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1476098143903811, [
                            [
                                55,
                                cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,
                                null,
                                1,
                                false,
                                false,
                                false,
                                5373734675389524,
                                false
                            ]
                        ],
                        [
                            [
                                55,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                8346134849533771,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ],
                            [
                                55,
                                cr.plugins_.Sprite.prototype.acts.SetSize,
                                null,
                                6978252902395128,
                                false, [
                                    [
                                        0, [
                                            20,
                                            55,
                                            cr.plugins_.Sprite.prototype.exps.ImageWidth,
                                            false,
                                            null
                                        ]
                                    ],
                                    [
                                        0, [
                                            20,
                                            55,
                                            cr.plugins_.Sprite.prototype.exps.ImageHeight,
                                            false,
                                            null
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
            ],
            [
                "Tutorial", [
                    [
                        0,
                        null,
                        false,
                        null,
                        6328206187847519, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                3392802485773405,
                                false
                            ]
                        ],
                        [
                            [
                                37,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                968957947635239,
                                false, [
                                    [
                                        0, [
                                            23,
                                            "PlayerFame"
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                5890333844243216,
                                false, [
                                    [
                                        0, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                2693260127060644,
                                false, [
                                    [
                                        6,
                                        "Game"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        7405152722302952, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                9676426857783309,
                                false
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                8385806572674302,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                6500279114380296,
                                false, [
                                    [
                                        6,
                                        "Game"
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
            ],
            [
                "Comic", [
                    [
                        0,
                        null,
                        false,
                        null,
                        6025907091081733, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2346583191276767,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                9407519985206962,
                                false, [
                                    [
                                        11,
                                        "Ending"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                42,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                2763987221693078,
                                false, [
                                    [
                                        0, [
                                            23,
                                            "PlayerFame"
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                7001299320671502,
                                false, [
                                    [
                                        0, [
                                            0,
                                            7
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                1613727996939096,
                                false, [
                                    [
                                        6,
                                        "Tutorial"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1357428674263959, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                9515171570351926,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                759545743075292,
                                false, [
                                    [
                                        11,
                                        "Ending"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                42,
                                cr.plugins_.Sprite.prototype.acts.SetAnimFrame,
                                null,
                                108422518851216,
                                false, [
                                    [
                                        0, [
                                            0,
                                            6
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                1211091054816523,
                                false, [
                                    [
                                        0, [
                                            0,
                                            10
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                7437309482795473,
                                false, [
                                    [
                                        6,
                                        "Menu"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        2012475823887692, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                9155108337933455,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                316992385933435,
                                false, [
                                    [
                                        11,
                                        "Ending"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                7421899511593311,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                6979218246577317,
                                false, [
                                    [
                                        6,
                                        "Tutorial"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        9697204460321301, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                1405319863009254,
                                false
                            ],
                            [-1,
                                cr.system_object.prototype.cnds.CompareVar,
                                null,
                                0,
                                false,
                                false,
                                false,
                                6259323576993255,
                                false, [
                                    [
                                        11,
                                        "Ending"
                                    ],
                                    [
                                        8,
                                        0
                                    ],
                                    [
                                        7, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                1042615135425668,
                                false, [
                                    [
                                        0, [
                                            1,
                                            0.2
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                6185471504941663,
                                false, [
                                    [
                                        6,
                                        "Menu"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1608488537598566, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5835731725413025,
                                false
                            ]
                        ],
                        [
                            [
                                53,
                                cr.plugins_.Sprite.prototype.acts.SetSize,
                                null,
                                8409307811255588,
                                false, [
                                    [
                                        0, [
                                            4, [
                                                20,
                                                42,
                                                cr.plugins_.Sprite.prototype.exps.Width,
                                                false,
                                                null
                                            ],
                                            [
                                                0,
                                                20
                                            ]
                                        ]
                                    ],
                                    [
                                        0, [
                                            4, [
                                                20,
                                                42,
                                                cr.plugins_.Sprite.prototype.exps.Height,
                                                false,
                                                null
                                            ],
                                            [
                                                0,
                                                20
                                            ]
                                        ]
                                    ]
                                ]
                            ],
                            [
                                53,
                                cr.plugins_.Sprite.prototype.acts.SetPosToObject,
                                null,
                                7396157724488407,
                                false, [
                                    [
                                        4,
                                        42
                                    ],
                                    [
                                        7, [
                                            0,
                                            0
                                        ]
                                    ]
                                ]
                            ],
                            [
                                53,
                                cr.plugins_.Sprite.prototype.acts.ZMoveToObject,
                                null,
                                6176061409662317,
                                false, [
                                    [
                                        3,
                                        1
                                    ],
                                    [
                                        4,
                                        42
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
            ],
            [
                "Loader", [
                    [
                        0,
                        null,
                        false,
                        null,
                        4650536263889615, [
                            [-1,
                                cr.system_object.prototype.cnds.EveryTick,
                                null,
                                0,
                                false,
                                false,
                                false,
                                5414269107472898,
                                false
                            ]
                        ],
                        []
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        1734816426236494, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLoadFinished,
                                null,
                                1,
                                false,
                                false,
                                false,
                                9863227867003682,
                                false
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                9456980592965838,
                                false, [
                                    [
                                        6,
                                        "Splash"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        601776612665932, [
                            [-1,
                                cr.system_object.prototype.cnds.OnLayoutStart,
                                null,
                                1,
                                false,
                                false,
                                false,
                                9085909114596467,
                                false
                            ]
                        ],
                        [
                            [
                                58,
                                cr.behaviors.scrollto.prototype.acts.SetEnabled,
                                "ScrollTo",
                                273554326887971,
                                false, [
                                    [
                                        3,
                                        1
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                3397518954835926,
                                false, [
                                    [
                                        7, [
                                            2,
                                            ""
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                1657092023247439,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                6772633802147289,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                7463812759907582,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                4089047716932066,
                                false, [
                                    [
                                        7, [
                                            2,
                                            ".."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                7802285111160354,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                2702543714036927,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Testing out jumps."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                233989590512461,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                1430189389108167,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Testing out jumps.."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                7909411042359828,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                6515968737259579,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Testing out jumps…"
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                3410934240994435,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                2830641428257857,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Packing survival kit."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                7666880735273162,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                630153490886349,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Packing survival kit.."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                6709005118379764,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                1231603299544354,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Packing survival kit…"
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                5750319343315821,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                42105982141268,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Drawing road map."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                8190021314577003,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                6285650506996463,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Drawing road map.."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                158417327296044,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                8179566265257379,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Drawing road map…"
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                8225990453313227,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                36147227710037,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                4585443895930038,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                6664454775749721,
                                false, [
                                    [
                                        7, [
                                            2,
                                            ".."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                3911458156779975,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                2363853851095001,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Testing out jumps."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                424905597828612,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                599018881683098,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Testing out jumps.."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                2012877550220435,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                2617711066525728,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Testing out jumps…"
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                8147850388084289,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                3541814974859059,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Packing survival kit."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                6720167319178735,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                8386233464201794,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Packing survival kit.."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                5864083971247732,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                4433209622082321,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Packing survival kit…"
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                6759932043553613,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                2311722041197512,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Drawing road map."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                3495959782100738,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                6443648409318577,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Drawing road map.."
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                356744846127317,
                                false, [
                                    [
                                        0, [
                                            0,
                                            1
                                        ]
                                    ]
                                ]
                            ],
                            [
                                58,
                                cr.plugins_.Text.prototype.acts.SetText,
                                null,
                                1906570005857872,
                                false, [
                                    [
                                        7, [
                                            2,
                                            "Drawing road map…"
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
            ],
            [
                "Splash", [
                    [
                        0,
                        null,
                        false,
                        null,
                        9350266316185307, [
                            [-1,
                                cr.system_object.prototype.cnds.TriggerOnce,
                                null,
                                0,
                                false,
                                false,
                                false,
                                7949667121925324,
                                false
                            ]
                        ],
                        [
                            [-1,
                                cr.system_object.prototype.acts.Wait,
                                null,
                                6342283856694544,
                                false, [
                                    [
                                        0, [
                                            0,
                                            3
                                        ]
                                    ]
                                ]
                            ],
                            [-1,
                                cr.system_object.prototype.acts.GoToLayout,
                                null,
                                261443648484968,
                                false, [
                                    [
                                        6,
                                        "Menu"
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        8115297152456005, [
                            [
                                54,
                                cr.plugins_.pix_spilgames.prototype.cnds.isSplashScreenEnabled,
                                null,
                                0,
                                false,
                                false,
                                false,
                                2265839898110622,
                                false
                            ]
                        ],
                        [
                            [
                                55,
                                cr.plugins_.Sprite.prototype.acts.LoadURL,
                                null,
                                9526607471240061,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "default/Splash_Image_GGG.png"
                                        ]
                                    ],
                                    [
                                        3,
                                        0
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        2507856274623867, [
                            [
                                22,
                                cr.plugins_.Touch.prototype.cnds.OnTouchObject,
                                null,
                                1,
                                false,
                                false,
                                false,
                                1460439729333506,
                                false, [
                                    [
                                        4,
                                        55
                                    ]
                                ]
                            ]
                        ],
                        [
                            [
                                54,
                                cr.plugins_.pix_spilgames.prototype.acts.openOutgoingLink,
                                null,
                                9800254881577225,
                                false, [
                                    [
                                        1, [
                                            2,
                                            "splashScreen"
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ],
                    [
                        0,
                        null,
                        false,
                        null,
                        6972875461732437, [
                            [
                                55,
                                cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,
                                null,
                                1,
                                false,
                                false,
                                false,
                                2469247400797199,
                                false
                            ]
                        ],
                        [
                            [
                                55,
                                cr.plugins_.Sprite.prototype.acts.SetOpacity,
                                null,
                                8392070787296808,
                                false, [
                                    [
                                        0, [
                                            0,
                                            100
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
            ]
        ],
        "media/",
        false,
        960,
        640,
        3,
        true,
        true,
        false,
        "1.0.0.0",
        true,
        true,
        3,
        2,
        95,
        true,
        true,
        1, []
    ];
};
